# æ•°æ®åº“è¿ç§»ç®¡ç†å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“š ç›®å½•

- [å·¥å…·ç®€ä»‹](#å·¥å…·ç®€ä»‹)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å·¥å…·è¯¦è§£](#å·¥å…·è¯¦è§£)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è§„èŒƒè¯´æ˜](#è§„èŒƒè¯´æ˜)

---

## å·¥å…·ç®€ä»‹

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå·¥å…·ï¼Œç”¨äºå¼ºåˆ¶æ‰§è¡Œæ•°æ®åº“è¿ç§»è§„èŒƒï¼š

### 1ï¸âƒ£ `create-migration.js` - è¿ç§»æ–‡ä»¶åˆ›å»ºå·¥å…·

**ç”¨é€”**: å¼ºåˆ¶è§„èŒƒï¼Œé˜²æ­¢æ‰‹åŠ¨åˆ›å»ºä¸è§„èŒƒçš„è¿ç§»æ–‡ä»¶

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„æ–‡ä»¶å
- âœ… æä¾›15ç§è¿ç§»æ¨¡æ¿
- âœ… äº¤äº’å¼å¼•å¯¼åˆ›å»ºè¿‡ç¨‹
- âœ… è‡ªåŠ¨æ›´æ–° VERSION.js
- âœ… é˜²æ­¢å‘½åé”™è¯¯

### 2ï¸âƒ£ `verify-migrations.js` - è¿ç§»æ–‡ä»¶éªŒè¯å·¥å…·

**ç”¨é€”**: æœåŠ¡å¯åŠ¨å‰éªŒè¯æ‰€æœ‰è¿ç§»æ–‡ä»¶çš„è§„èŒƒæ€§

**éªŒè¯å†…å®¹**:
- âœ… æ–‡ä»¶åæ ¼å¼æ˜¯å¦ç¬¦åˆè§„èŒƒ
- âœ… Actionç±»å‹æ˜¯å¦åˆæ³•
- âœ… VERSION.jsä¸€è‡´æ€§
- âœ… æ—¶é—´æˆ³åˆç†æ€§
- âœ… ç¦æ­¢fix/temp/testç­‰ä¸è§„èŒƒå‘½å

---

## å¿«é€Ÿå¼€å§‹

### åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»æ–‡ä»¶

```bash
# æ–¹å¼1: ä½¿ç”¨npmè„šæœ¬ï¼ˆæ¨èï¼‰
npm run migration:create

# æ–¹å¼2: ç›´æ¥æ‰§è¡Œ
node scripts/database/create-migration.js
```

### éªŒè¯æ‰€æœ‰è¿ç§»æ–‡ä»¶

```bash
# æ–¹å¼1: ä½¿ç”¨npmè„šæœ¬
npm run migration:verify

# æ–¹å¼2: è‡ªåŠ¨éªŒè¯ï¼ˆæ¯æ¬¡ npm start å‰ï¼‰
npm start  # è‡ªåŠ¨æ‰§è¡Œ prestart hook
```

### æ‰§è¡Œè¿ç§»

```bash
# æ‰§è¡Œè¿ç§»ï¼ˆä¼šå…ˆè‡ªåŠ¨éªŒè¯ï¼‰
npm run migration:up

# å›æ»šæœ€åä¸€æ¬¡è¿ç§»
npm run migration:down

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
npm run migration:status
```

---

## å·¥å…·è¯¦è§£

### create-migration.js è¯¦ç»†è¯´æ˜

#### äº¤äº’å¼åˆ›å»ºæµç¨‹

1. **é€‰æ‹©æ“ä½œç±»å‹**ï¼ˆ15ç§ï¼‰:
   ```
   è¡¨æ“ä½œ:
     1.  åˆ›å»ºæ–°è¡¨         (create-table)
     2.  ä¿®æ”¹è¡¨ç»“æ„       (alter-table)
     3.  åˆ é™¤è¡¨          (drop-table)
     4.  é‡å‘½åè¡¨        (rename-table)
   
   åˆ—æ“ä½œ:
     5.  æ·»åŠ åˆ—          (add-column)
     6.  ä¿®æ”¹åˆ—          (alter-column)
     7.  åˆ é™¤åˆ—          (drop-column)
     8.  é‡å‘½ååˆ—        (rename-column)
   
   ç´¢å¼•æ“ä½œ:
     9.  åˆ›å»ºç´¢å¼•        (create-index)
     10. ä¿®æ”¹ç´¢å¼•        (alter-index)
     11. åˆ é™¤ç´¢å¼•        (drop-index)
   
   çº¦æŸæ“ä½œ:
     12. æ·»åŠ çº¦æŸ        (add-constraint)
     13. åˆ é™¤çº¦æŸ        (drop-constraint)
   
   æ•°æ®æ“ä½œ:
     14. æ•°æ®è¿ç§»        (migrate-data)
     15. åˆå§‹åŒ–æ•°æ®      (seed-data)
   ```

2. **è¾“å…¥ç›®æ ‡åç§°**:
   - å‘½åè§„åˆ™: å°å†™å­—æ¯å¼€å¤´ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
   - ç¤ºä¾‹: `users`, `user-vip-level`, `lottery-campaigns`

3. **è¯´æ˜åˆ›å»ºåŸå› **:
   - è‡³å°‘5ä¸ªå­—ç¬¦
   - è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªè¿ç§»

4. **è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶**:
   - æ–‡ä»¶åæ ¼å¼: `{YYYYMMDD}{HHMMSS}-{action}-{target}.js`
   - ç¤ºä¾‹: `20251012120000-add-column-users-vip-level.js`

5. **è‡ªåŠ¨æ›´æ–° VERSION.js**:
   - æ›´æ–° `lastMigration`
   - æ›´æ–° `lastUpdated`

#### ç”Ÿæˆçš„æ¨¡æ¿ç¤ºä¾‹

##### 1. åˆ›å»ºè¡¨æ¨¡æ¿

```javascript
/**
 * åˆ›å»ºè¡¨: users
 * 
 * åˆ›å»ºæ—¶é—´: 2025-10-12T12:00:00.000Z
 * åˆ›å»ºåŸå› : åˆ›å»ºç”¨æˆ·åŸºç¡€è¡¨
 * ä½œè€…: developer
 */

module.exports = {
  up: async (queryInterface, Sequelize) => {
    await queryInterface.createTable('users', {
      id: {
        type: Sequelize.INTEGER,
        primaryKey: true,
        autoIncrement: true,
        comment: 'ä¸»é”®ID'
      },
      // TODO: æ·»åŠ å…¶ä»–å­—æ®µ
      
      created_at: {
        type: Sequelize.DATE,
        allowNull: false,
        defaultValue: Sequelize.literal('CURRENT_TIMESTAMP'),
        comment: 'åˆ›å»ºæ—¶é—´'
      },
      updated_at: {
        type: Sequelize.DATE,
        allowNull: false,
        defaultValue: Sequelize.literal('CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'),
        comment: 'æ›´æ–°æ—¶é—´'
      }
    })
    
    console.log('âœ… è¡¨ users åˆ›å»ºæˆåŠŸ')
  },
  
  down: async (queryInterface, Sequelize) => {
    await queryInterface.dropTable('users')
    console.log('âœ… è¡¨ users å·²åˆ é™¤')
  }
}
```

##### 2. æ·»åŠ åˆ—æ¨¡æ¿

```javascript
module.exports = {
  up: async (queryInterface, Sequelize) => {
    await queryInterface.addColumn('users', 'vip_level', {
      type: Sequelize.STRING(100),
      allowNull: true,
      defaultValue: null,
      comment: 'VIPç­‰çº§'
    })
    
    console.log('âœ… åˆ— vip_level å·²æ·»åŠ åˆ°è¡¨ users')
  },
  
  down: async (queryInterface, Sequelize) => {
    await queryInterface.removeColumn('users', 'vip_level')
    console.log('âœ… åˆ— vip_level å·²åˆ é™¤')
  }
}
```

---

### verify-migrations.js è¯¦ç»†è¯´æ˜

#### éªŒè¯è§„åˆ™

1. **æ–‡ä»¶åæ ¼å¼éªŒè¯**:
   ```javascript
   // âœ… æ­£ç¡®æ ¼å¼
   20251012120000-create-table-users.js
   20251012130000-add-column-users-vip-level.js
   
   // âŒ é”™è¯¯æ ¼å¼
   2025_10_12-create-table-users.js  // æ—¶é—´æˆ³æ ¼å¼é”™è¯¯
   20251012-create-users.js          // ç¼ºå°‘ç§’æ•°
   20251012120000_create_table_users.js  // ä½¿ç”¨ä¸‹åˆ’çº¿è€Œéè¿å­—ç¬¦
   ```

2. **Actionç±»å‹éªŒè¯**:
   ```javascript
   // âœ… å…è®¸çš„Action
   create-table, alter-table, drop-table, rename-table
   add-column, alter-column, drop-column, rename-column
   create-index, alter-index, drop-index
   add-constraint, drop-constraint
   migrate-data, seed-data
   baseline  // ä»…ç”¨äºV1.0.0
   
   // âŒ ç¦æ­¢çš„Actionï¼ˆä¼šå¯¼è‡´éªŒè¯å¤±è´¥ï¼‰
   fix       // è¯´æ˜è®¾è®¡æœ‰é—®é¢˜
   temp      // ä¸åº”è¯¥æäº¤ä¸´æ—¶è¿ç§»
   test      // ä¸åº”è¯¥æäº¤æµ‹è¯•è¿ç§»
   update    // å¤ªæ¨¡ç³Š
   change    // å¤ªæ¨¡ç³Š
   modify    // å¤ªæ¨¡ç³Š
   ```

3. **æ—¶é—´æˆ³åˆç†æ€§éªŒè¯**:
   - å¹´ä»½èŒƒå›´: 2025-2030
   - æœˆä»½èŒƒå›´: 1-12
   - æ—¥æœŸèŒƒå›´: 1-31
   - å°æ—¶èŒƒå›´: 0-23
   - åˆ†é’ŸèŒƒå›´: 0-59
   - ç§’æ•°èŒƒå›´: 0-59

4. **VERSION.jsä¸€è‡´æ€§éªŒè¯**:
   - lastMigration æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - lastMigration æ˜¯å¦çœŸçš„æ˜¯æœ€åä¸€ä¸ªæ–‡ä»¶
   - æ–‡ä»¶æ•°é‡æ˜¯å¦ä¸è®°å½•ä¸€è‡´

#### éªŒè¯è¾“å‡ºç¤ºä¾‹

##### éªŒè¯é€šè¿‡

```bash
============================================================
ğŸ” æ•°æ®åº“è¿ç§»æ–‡ä»¶éªŒè¯å·¥å…·
============================================================

ğŸ“ æ‰¾åˆ° 3 ä¸ªè¿ç§»æ–‡ä»¶

âœ… [1/3] 20251013100000-baseline-v1.0.0.js
âœ… [2/3] 20251014120000-add-column-users-vip-level.js
âœ… [3/3] 20251015150000-create-table-promotions.js

ğŸ“Œ VERSION.js ä¿¡æ¯:
   å½“å‰ç‰ˆæœ¬: V1.0.0-clean-start
   æœ€åæ›´æ–°: 2025-10-12 12:00:00
   è¡¨æ•°é‡: 18
   æœ€åè¿ç§»: 20251015150000-create-table-promotions.js

============================================================
âœ… éªŒè¯é€šè¿‡
============================================================

âœ¨ æ‰€æœ‰ 3 ä¸ªè¿ç§»æ–‡ä»¶ç¬¦åˆè§„èŒƒ
```

##### éªŒè¯å¤±è´¥

```bash
============================================================
ğŸ” æ•°æ®åº“è¿ç§»æ–‡ä»¶éªŒè¯å·¥å…·
============================================================

ğŸ“ æ‰¾åˆ° 3 ä¸ªè¿ç§»æ–‡ä»¶

âœ… [1/3] 20251013100000-baseline-v1.0.0.js

[æ–‡ä»¶ 2/3] 20251012_fix_users.js:
  âŒ æ–‡ä»¶åå¿…é¡»ç¬¦åˆæ ¼å¼: {YYYYMMDD}{HHMMSS}-{action}-{target}.js

[æ–‡ä»¶ 3/3] 20251012120000-fix-users-table.js:
  âŒ ç¦æ­¢ä½¿ç”¨çš„action: fix
  âŒ   åŸå› : è¯´æ˜ä¹‹å‰çš„è®¾è®¡æœ‰é—®é¢˜ï¼Œåº”è¯¥åœ¨è®¾è®¡é˜¶æ®µå°±é¿å…
  âŒ   å»ºè®®: é‡æ–°è®¾è®¡è¿ç§»ï¼Œä½¿ç”¨æ­£ç¡®çš„actionç±»å‹

============================================================
âŒ éªŒè¯å¤±è´¥
============================================================

å‘ç°ä»¥ä¸‹é”™è¯¯:

[æ–‡ä»¶ 2/3] 20251012_fix_users.js:
  âŒ æ–‡ä»¶åå¿…é¡»ç¬¦åˆæ ¼å¼: {YYYYMMDD}{HHMMSS}-{action}-{target}.js

[æ–‡ä»¶ 3/3] 20251012120000-fix-users-table.js:
  âŒ ç¦æ­¢ä½¿ç”¨çš„action: fix
  âŒ   åŸå› : è¯´æ˜ä¹‹å‰çš„è®¾è®¡æœ‰é—®é¢˜ï¼Œåº”è¯¥åœ¨è®¾è®¡é˜¶æ®µå°±é¿å…
  âŒ   å»ºè®®: é‡æ–°è®¾è®¡è¿ç§»ï¼Œä½¿ç”¨æ­£ç¡®çš„actionç±»å‹

============================================================
ğŸš« è¿ç§»æ–‡ä»¶å­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡æ‹’ç»å¯åŠ¨ï¼
============================================================

ğŸ’¡ è§£å†³æ–¹æ³•:

   1. ä½¿ç”¨å·¥å…·åˆ›å»ºè¿ç§»: npm run migration:create
   2. ä¿®å¤ä¸Šè¿°é”™è¯¯ä¸­çš„é—®é¢˜
   3. æˆ–åˆ é™¤ä¸ç¬¦åˆè§„èŒƒçš„è¿ç§»æ–‡ä»¶
   4. é‡æ–°éªŒè¯: npm run migration:verify
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åˆ›å»ºä¸€ä¸ªæ–°è¡¨

```bash
$ npm run migration:create

============================================================
ğŸ¯ æ•°æ®åº“è¿ç§»æ–‡ä»¶åˆ›å»ºå·¥å…·
============================================================

ğŸ“‹ æœ¬å·¥å…·å°†å¼•å¯¼ä½ åˆ›å»ºè§„èŒƒçš„è¿ç§»æ–‡ä»¶

ğŸ“Œ æ­¥éª¤1: é€‰æ‹©æ“ä½œç±»å‹

   è¡¨æ“ä½œ:
     1.  åˆ›å»ºæ–°è¡¨         (create-table)
     ...

ğŸ‘‰ è¯·é€‰æ‹© (1-15): 1

âœ… å·²é€‰æ‹©: åˆ›å»ºæ–°è¡¨ (create-table)

ğŸ“Œ æ­¥éª¤2: è¾“å…¥ç›®æ ‡åç§°

   å‘½åè§„åˆ™:
     â€¢ å°å†™å­—æ¯å¼€å¤´
     â€¢ åªèƒ½åŒ…å«: å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
     â€¢ ç¤ºä¾‹: users, user-vip-level, lottery-campaigns

ğŸ‘‰ ç›®æ ‡åç§°: promotions

âœ… ç›®æ ‡åç§°: promotions

ğŸ“Œ æ­¥éª¤3: è¯´æ˜åˆ›å»ºåŸå› 

ğŸ‘‰ åˆ›å»ºåŸå›  (è‡³å°‘5ä¸ªå­—ç¬¦): æ·»åŠ ä¿ƒé”€æ´»åŠ¨åŠŸèƒ½ï¼Œéœ€è¦æ–°çš„ä¿ƒé”€è¡¨

âœ… åˆ›å»ºåŸå› : æ·»åŠ ä¿ƒé”€æ´»åŠ¨åŠŸèƒ½ï¼Œéœ€è¦æ–°çš„ä¿ƒé”€è¡¨

ğŸ“Œ æ­¥éª¤4: ç”Ÿæˆè¿ç§»æ–‡ä»¶

============================================================
âœ… è¿ç§»æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼
============================================================

ğŸ“„ æ–‡ä»¶å: 20251015150000-create-table-promotions.js
ğŸ“‚ è·¯å¾„: /home/devbox/project/migrations/20251015150000-create-table-promotions.js

âœ… VERSION.js å·²è‡ªåŠ¨æ›´æ–°

ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ:

   1ï¸âƒ£  ç¼–è¾‘æ–‡ä»¶: 20251015150000-create-table-promotions.js
   2ï¸âƒ£  å®Œå–„è¿ç§»é€»è¾‘ï¼ˆæ ‡è®°ä¸ºTODOçš„éƒ¨åˆ†ï¼‰
   3ï¸âƒ£  æ‰§è¡Œè¿ç§»: npm run migration:up
   4ï¸âƒ£  éªŒè¯ç»“æœ: æ£€æŸ¥æ•°æ®åº“å˜æ›´
   5ï¸âƒ£  æµ‹è¯•å›æ»š: npm run migration:down

ğŸ’¡ æç¤º: è¿ç§»æ–‡ä»¶å·²ç»åŒ…å«åŸºç¡€æ¨¡æ¿ï¼Œè¯·æ ¹æ®å®é™…éœ€æ±‚ä¿®æ”¹
```

### ç¤ºä¾‹2: æ·»åŠ ä¸€ä¸ªåˆ—

```bash
$ npm run migration:create

ğŸ‘‰ è¯·é€‰æ‹© (1-15): 5  # æ·»åŠ åˆ—

ğŸ‘‰ ç›®æ ‡åç§°: users-vip-level

âš ï¸ å»ºè®®æ ¼å¼: tablename-columnname (å¦‚: users-vip-level)

âœ… ç›®æ ‡åç§°: users-vip-level

ğŸ‘‰ åˆ›å»ºåŸå› : æ·»åŠ ç”¨æˆ·VIPç­‰çº§å­—æ®µï¼Œç”¨äºåŒºåˆ†ç”¨æˆ·æƒç›Š

âœ… è¿ç§»æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼
ğŸ“„ æ–‡ä»¶å: 20251014120000-add-column-users-vip-level.js
```

### ç¤ºä¾‹3: åˆ›å»ºç´¢å¼•

```bash
$ npm run migration:create

ğŸ‘‰ è¯·é€‰æ‹© (1-15): 9  # åˆ›å»ºç´¢å¼•

ğŸ‘‰ ç›®æ ‡åç§°: users-mobile

ğŸ‘‰ åˆ›å»ºåŸå› : ä¼˜åŒ–æ‰‹æœºå·æŸ¥è¯¢æ€§èƒ½ï¼Œæ·»åŠ mobileå­—æ®µç´¢å¼•

âœ… è¿ç§»æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼
ğŸ“„ æ–‡ä»¶å: 20251014130000-create-index-users-mobile.js
```

---

## å¸¸è§é—®é¢˜

### Q1: æˆ‘å¯ä»¥æ‰‹åŠ¨åˆ›å»ºè¿ç§»æ–‡ä»¶å—ï¼Ÿ

**A**: âŒ ä¸å»ºè®®ï¼æ‰‹åŠ¨åˆ›å»ºå®¹æ˜“å‡ºé”™ï¼š

```bash
# âŒ é”™è¯¯åšæ³•
touch migrations/fix_users.js  # å‘½åä¸è§„èŒƒ
touch migrations/20251012-add-users.js  # æ—¶é—´æˆ³æ ¼å¼é”™è¯¯

# âœ… æ­£ç¡®åšæ³•
npm run migration:create  # ä½¿ç”¨å·¥å…·åˆ›å»º
```

**åŸå› **:
- æ‰‹åŠ¨åˆ›å»ºæ— æ³•ä¿è¯å‘½åè§„èŒƒ
- æ—¶é—´æˆ³å®¹æ˜“å†™é”™
- VERSION.jsä¸ä¼šè‡ªåŠ¨æ›´æ–°
- å¯åŠ¨éªŒè¯ä¼šå¤±è´¥

### Q2: å¦‚æœéªŒè¯å¤±è´¥ï¼ŒæœåŠ¡ä¼šå¯åŠ¨å—ï¼Ÿ

**A**: âŒ ä¸ä¼šï¼`prestart` hookä¼šé˜»æ­¢æœåŠ¡å¯åŠ¨ï¼š

```bash
$ npm start

> prestart
> npm run migration:verify

âŒ éªŒè¯å¤±è´¥
ğŸš« è¿ç§»æ–‡ä»¶å­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡æ‹’ç»å¯åŠ¨ï¼

# æœåŠ¡ä¸ä¼šå¯åŠ¨ï¼Œå¿…é¡»å…ˆä¿®å¤é—®é¢˜
```

### Q3: æˆ‘å·²ç»æœ‰ä¸è§„èŒƒçš„æ—§è¿ç§»æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿ

**æ–¹æ¡ˆA**: ä¿ç•™æ—§æ–‡ä»¶ï¼Œæ–°æ–‡ä»¶ä½¿ç”¨è§„èŒƒï¼ˆæ¨èç»™å·²ä¸Šçº¿é¡¹ç›®ï¼‰

```bash
# 1. å°†æ—§æ–‡ä»¶ç§»åˆ° migrations/legacy/ ç›®å½•
mkdir -p migrations/legacy
mv migrations/20250110_fix_*.js migrations/legacy/

# 2. ä»ç°åœ¨å¼€å§‹ä½¿ç”¨è§„èŒƒå·¥å…·
npm run migration:create
```

**æ–¹æ¡ˆB**: å®Œå…¨é‡æ„ï¼ˆæ¨èç»™æ–°é¡¹ç›®æˆ–æµ‹è¯•ç¯å¢ƒï¼‰

```bash
# å‚è€ƒã€Šæ•°æ®åº“å˜æ›´å†å²æ··ä¹±é—®é¢˜è§£å†³æ–¹æ¡ˆ_V1.0.mdã€‹ä¸­çš„æ–¹æ¡ˆC
# å®Œå…¨é‡å»ºï¼Œåˆ›å»ºåŸºå‡†è¿ç§»
```

### Q4: VERSION.js æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

**A**: VERSION.js æ˜¯æ•°æ®åº“ç‰ˆæœ¬çš„"èº«ä»½è¯"ï¼š

1. **è®°å½•ç‰ˆæœ¬ä¿¡æ¯**:
   ```javascript
   current: 'V1.0.0-clean-start',
   lastUpdated: '2025-10-12 12:00:00',
   tableCount: 18
   ```

2. **è¿½è¸ªæœ€åä¸€æ¬¡è¿ç§»**:
   ```javascript
   lastMigration: '20251015150000-create-table-promotions.js'
   ```

3. **è®°å½•å†å²å˜æ›´**:
   ```javascript
   history: {
     'V1.0.0': {
       createdAt: '2025-10-12',
       description: 'å®Œå…¨é‡æ„',
       migrations: 1,
       tables: 18
     }
   }
   ```

4. **æä¾›è‡ªéªŒè¯æ–¹æ³•**:
   ```javascript
   VERSION.validate()  // æ£€æŸ¥VERSION.jsè‡ªèº«ä¸€è‡´æ€§
   ```

### Q5: æˆ‘å¯ä»¥è·³è¿‡éªŒè¯å—ï¼Ÿ

**A**: âš ï¸ ä¸å»ºè®®ï¼Œä½†å¯ä»¥ï¼š

```bash
# æ–¹å¼1: è·³è¿‡prestartéªŒè¯ï¼ˆä¸æ¨èï¼‰
node app.js  # ç›´æ¥å¯åŠ¨ï¼Œä¸æ‰§è¡Œnpm start

# æ–¹å¼2: ä¸´æ—¶ç¦ç”¨éªŒè¯ï¼ˆä»…ç”¨äºç´§æ€¥æƒ…å†µï¼‰
# ç¼–è¾‘ package.jsonï¼Œæ³¨é‡Šæ‰ prestart
# "prestart": "npm run migration:verify",  // æ³¨é‡Šè¿™ä¸€è¡Œ
```

**é£é™©**:
- å¯èƒ½ä½¿ç”¨ä¸è§„èŒƒçš„è¿ç§»æ–‡ä»¶
- é•¿æœŸä¼šå¯¼è‡´è¿ç§»å†å²æ··ä¹±
- æ–°äººæ— æ³•ç†è§£æ•°æ®åº“æ¼”è¿›

### Q6: ä¸ºä»€ä¹ˆç¦æ­¢ fix/temp/test ç­‰actionï¼Ÿ

**A**: è¿™äº›actionåæ˜ äº†ä¸è‰¯çš„å¼€å‘ä¹ æƒ¯ï¼š

```bash
# âŒ fix-xxx - è¯´æ˜ä¹‹å‰è®¾è®¡æœ‰é—®é¢˜
20251012120000-fix-users-table.js
# é—®é¢˜: ä¸ºä»€ä¹ˆä¹‹å‰çš„è®¾è®¡è¦fixï¼Ÿåº”è¯¥åœ¨code reviewæ—¶å°±å‘ç°

# âŒ temp-xxx - ä¸´æ—¶è¿ç§»ä¸åº”è¯¥æäº¤
20251012120000-temp-test-migration.js
# é—®é¢˜: ä¸´æ—¶è¿ç§»ä¼šæ±¡æŸ“è¿ç§»å†å²

# âŒ test-xxx - æµ‹è¯•è¿ç§»ä¸åº”è¯¥æäº¤
20251012120000-test-new-feature.js
# é—®é¢˜: æµ‹è¯•åº”è¯¥åœ¨å¼€å‘ç¯å¢ƒè¿›è¡Œï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

# âœ… æ­£ç¡®åšæ³•
20251012120000-add-column-users-vip-level.js  # æ˜ç¡®è¯´æ˜åšä»€ä¹ˆ
```

**æ­£ç¡®çš„æµç¨‹**:
1. å……åˆ†è®¾è®¡ â†’ Code Review â†’ åˆ›å»ºè¿ç§»
2. åœ¨å¼€å‘ç¯å¢ƒå……åˆ†æµ‹è¯•
3. æäº¤è§„èŒƒçš„ã€æœ€ç»ˆçš„è¿ç§»æ–‡ä»¶

---

## è§„èŒƒè¯´æ˜

### è¿ç§»æ–‡ä»¶å‘½åè§„èŒƒ

#### æ ¼å¼

```
{YYYYMMDD}{HHMMSS}-{action}-{target}.js
â”‚         â”‚         â”‚        â”‚         â””â”€ æ–‡ä»¶æ‰©å±•å
â”‚         â”‚         â”‚        â””â”€ ç›®æ ‡å¯¹è±¡ï¼ˆè¡¨åã€å­—æ®µåç­‰ï¼‰
â”‚         â”‚         â””â”€ æ“ä½œç±»å‹ï¼ˆå¿…é¡»æ˜¯å…è®¸çš„actionï¼‰
â”‚         â””â”€ 6ä½æ—¶é—´æˆ³ï¼ˆæ—¶åˆ†ç§’ï¼‰
â””â”€ 8ä½æ—¥æœŸæˆ³ï¼ˆå¹´æœˆæ—¥ï¼‰
```

#### ç¤ºä¾‹

```bash
# è¡¨æ“ä½œ
20251012120000-create-table-users.js
20251012130000-alter-table-users.js
20251012140000-drop-table-old-logs.js
20251012150000-rename-table-old-users-to-legacy-users.js

# åˆ—æ“ä½œ
20251012160000-add-column-users-vip-level.js
20251012170000-alter-column-users-mobile.js
20251012180000-drop-column-users-deprecated-field.js
20251012190000-rename-column-users-old-name-to-new-name.js

# ç´¢å¼•æ“ä½œ
20251012200000-create-index-users-mobile.js
20251012210000-drop-index-users-old-index.js

# æ•°æ®æ“ä½œ
20251012220000-migrate-data-merge-user-roles.js
20251012230000-seed-data-initial-configs.js
```

### ç›®æ ‡åç§°è§„èŒƒ

#### è§„åˆ™

1. **å°å†™å­—æ¯å¼€å¤´**
2. **åªèƒ½åŒ…å«**: å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
3. **é•¿åº¦é™åˆ¶**: æœ€å¤š50å­—ç¬¦

#### ç¤ºä¾‹

```bash
# âœ… æ­£ç¡®ç¤ºä¾‹
users
user-vip-level
lottery-campaigns
point-exchange-records

# âŒ é”™è¯¯ç¤ºä¾‹
Users              # å¤§å†™å­—æ¯å¼€å¤´
user_vip_level     # ä½¿ç”¨ä¸‹åˆ’çº¿
userVipLevel       # é©¼å³°å‘½å
user.vip.level     # ä½¿ç”¨ç‚¹å·
```

### Actionç±»å‹è¯´æ˜

| åˆ†ç±» | Action | è¯´æ˜ | ç›®æ ‡æ ¼å¼ç¤ºä¾‹ |
|------|--------|------|-------------|
| **è¡¨æ“ä½œ** | create-table | åˆ›å»ºæ–°è¡¨ | `users` |
| | alter-table | ä¿®æ”¹è¡¨ç»“æ„ | `users` |
| | drop-table | åˆ é™¤è¡¨ | `old-logs` |
| | rename-table | é‡å‘½åè¡¨ | `old-users-to-legacy-users` |
| **åˆ—æ“ä½œ** | add-column | æ·»åŠ åˆ— | `users-vip-level` |
| | alter-column | ä¿®æ”¹åˆ— | `users-mobile` |
| | drop-column | åˆ é™¤åˆ— | `users-deprecated-field` |
| | rename-column | é‡å‘½ååˆ— | `users-old-name-to-new-name` |
| **ç´¢å¼•æ“ä½œ** | create-index | åˆ›å»ºç´¢å¼• | `users-mobile` |
| | alter-index | ä¿®æ”¹ç´¢å¼• | `users-mobile-idx` |
| | drop-index | åˆ é™¤ç´¢å¼• | `users-old-index` |
| **çº¦æŸæ“ä½œ** | add-constraint | æ·»åŠ çº¦æŸ | `users-mobile-unique` |
| | drop-constraint | åˆ é™¤çº¦æŸ | `users-old-constraint` |
| **æ•°æ®æ“ä½œ** | migrate-data | æ•°æ®è¿ç§» | `merge-user-roles` |
| | seed-data | åˆå§‹åŒ–æ•°æ® | `initial-configs` |
| **ç‰¹æ®Š** | baseline | åŸºå‡†è¿ç§» | `v1.0.0` |

---

## é™„å½•

### package.json è„šæœ¬è¯´æ˜

```json
{
  "scripts": {
    // åˆ›å»ºè¿ç§»æ–‡ä»¶ï¼ˆäº¤äº’å¼ï¼‰
    "migration:create": "node scripts/database/create-migration.js",
    
    // éªŒè¯æ‰€æœ‰è¿ç§»æ–‡ä»¶
    "migration:verify": "node scripts/database/verify-migrations.js",
    
    // æ‰§è¡Œè¿ç§»ï¼ˆä¼šå…ˆéªŒè¯ï¼‰
    "migration:up": "npm run migration:verify && npx sequelize-cli db:migrate",
    
    // å›æ»šæœ€åä¸€æ¬¡è¿ç§»
    "migration:down": "npx sequelize-cli db:migrate:undo",
    
    // æŸ¥çœ‹è¿ç§»çŠ¶æ€
    "migration:status": "npx sequelize-cli db:migrate:status",
    
    // æœåŠ¡å¯åŠ¨å‰è‡ªåŠ¨éªŒè¯
    "prestart": "npm run migration:verify"
  }
}
```

### ç›¸å…³æ–‡æ¡£

- ã€Šæ•°æ®åº“å˜æ›´å†å²æ··ä¹±é—®é¢˜è§£å†³æ–¹æ¡ˆ_V1.0.mdã€‹- å®Œæ•´é‡æ„æ–¹æ¡ˆ
- ã€Šæ•°æ®åº“è¿ç§»è§„èŒƒè‡ªåŠ¨åŒ–ä¿éšœç³»ç»Ÿ.mdã€‹- è‡ªåŠ¨åŒ–ä¿éšœç³»ç»Ÿè®¾è®¡

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0.0  
**åˆ›å»ºæ—¶é—´**: 2025å¹´10æœˆ12æ—¥  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ12æ—¥

