# PM2æœåŠ¡ç®¡ç†æŒ‡å—

**é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ v2.0 - åå°æœåŠ¡ç®¡ç†**  
**åˆ›å»ºæ—¶é—´**: 2025å¹´08æœˆ10æ—¥  
**çŠ¶æ€**: âœ… åå°æœåŠ¡å·²é…ç½®å®Œæˆ

---

## ğŸ¯ **è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

âœ… **æœåŠ¡æŒç»­è¿è¡Œ**: å…³é—­Cursoræˆ–ç»ˆç«¯åï¼ŒæœåŠ¡ç»§ç»­åœ¨åå°è¿è¡Œ  
âœ… **è‡ªåŠ¨é‡å¯**: æœåŠ¡å´©æºƒæ—¶è‡ªåŠ¨é‡å¯  
âœ… **å†…å­˜ç®¡ç†**: å†…å­˜ä½¿ç”¨è¶…é™æ—¶è‡ªåŠ¨é‡å¯  
âœ… **æ—¥å¿—ç®¡ç†**: å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œè½®è½¬  
âœ… **è¿›ç¨‹ç›‘æ§**: å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€å’Œèµ„æºä½¿ç”¨

---

## ğŸš€ **å¸¸ç”¨PM2å‘½ä»¤**

### **æœåŠ¡çŠ¶æ€æŸ¥çœ‹**
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
pm2 list

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show restaurant-lottery-backend

# å®æ—¶ç›‘æ§
pm2 monit
```

### **æœåŠ¡æ§åˆ¶**
```bash
# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js

# åœæ­¢æœåŠ¡
pm2 stop restaurant-lottery-backend

# é‡å¯æœåŠ¡
pm2 restart restaurant-lottery-backend

# é‡æ–°åŠ è½½æœåŠ¡ï¼ˆé›¶åœæœºæ—¶é—´ï¼‰
pm2 reload restaurant-lottery-backend

# åˆ é™¤æœåŠ¡
pm2 delete restaurant-lottery-backend
```

### **æ—¥å¿—ç®¡ç†**
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs restaurant-lottery-backend

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
pm2 logs restaurant-lottery-backend --lines 50

# æ¸…ç©ºæ—¥å¿—
pm2 flush

# æ—¥å¿—è½®è½¬
pm2 reloadLogs
```

---

## ğŸ“Š **æœåŠ¡çŠ¶æ€æŒ‡æ ‡è¯´æ˜**

| å­—æ®µ | è¯´æ˜ |
|------|------|
| **id** | è¿›ç¨‹ID |
| **name** | æœåŠ¡åç§° |
| **mode** | è¿è¡Œæ¨¡å¼ (fork/cluster) |
| **â†º** | é‡å¯æ¬¡æ•° |
| **status** | çŠ¶æ€ (online/stopped/errored) |
| **cpu** | CPUä½¿ç”¨ç‡ |
| **memory** | å†…å­˜ä½¿ç”¨é‡ |

### **æ­£å¸¸çŠ¶æ€ç¤ºä¾‹**
```bash
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name               â”‚ mode     â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ restaurant-lotterâ€¦ â”‚ fork     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 92.1mb   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ **é…ç½®æ–‡ä»¶è¯´æ˜**

### **ecosystem.config.js æ ¸å¿ƒé…ç½®**
- **name**: `restaurant-lottery-backend` - æœåŠ¡åç§°
- **script**: `app.js` - å¯åŠ¨è„šæœ¬
- **instances**: `1` - å•å®ä¾‹æ¨¡å¼ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **autorestart**: `true` - è‡ªåŠ¨é‡å¯
- **max_memory_restart**: `512M` - å†…å­˜é™åˆ¶

### **æ—¥å¿—é…ç½®**
- **combined.log**: åˆå¹¶æ—¥å¿—
- **out.log**: æ ‡å‡†è¾“å‡ºæ—¥å¿—
- **error.log**: é”™è¯¯æ—¥å¿—
- **æ—¥å¿—ç›®å½•**: `./logs/`

---

## âš¡ **å¿«é€Ÿæ“ä½œå‘½ä»¤**

### **ä¸€é”®å¯åŠ¨**
```bash
cd /home/devbox/project
pm2 start ecosystem.config.js
```

### **æœåŠ¡å¥åº·æ£€æŸ¥**
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 list

# éªŒè¯APIå“åº”
curl -s http://localhost:3000/health | grep "healthy"

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep :3000
```

### **æ•…éšœæ’æŸ¥**
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs restaurant-lottery-backend --err --lines 50

# é‡å¯æœåŠ¡
pm2 restart restaurant-lottery-backend

# å¦‚æœæœåŠ¡å¡æ­»
pm2 delete restaurant-lottery-backend
pm2 start ecosystem.config.js
```

---

## ğŸ›¡ï¸ **è‡ªåŠ¨å¯åŠ¨é…ç½®**

### **å·²å®Œæˆé…ç½®**
- âœ… PM2é…ç½®å·²ä¿å­˜: `pm2 save`
- âš ï¸ ç³»ç»Ÿå¯åŠ¨è„šæœ¬: éœ€è¦ç®¡ç†å‘˜æƒé™æ‰§è¡Œ

### **å¼€æœºè‡ªå¯åŠ¨å‘½ä»¤ï¼ˆå¯é€‰ï¼‰**
```bash
# éœ€è¦sudoæƒé™æ‰§è¡Œï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo env PATH=$PATH:/home/devbox/.nvm/versions/node/v20.18.0/bin \
     /home/devbox/.nvm/versions/node/v20.18.0/lib/node_modules/pm2/bin/pm2 \
     startup systemd -u devbox --hp /home/devbox
```

---

## ğŸ“ˆ **æ€§èƒ½ç›‘æ§**

### **èµ„æºä½¿ç”¨ç›‘æ§**
```bash
# å®æ—¶ç›‘æ§ç•Œé¢
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡
pm2 show restaurant-lottery-backend

# æŸ¥çœ‹æ—¥å¿—ç»Ÿè®¡
pm2 logs restaurant-lottery-backend --timestamp
```

### **æ­£å¸¸èµ„æºä½¿ç”¨èŒƒå›´**
- **å†…å­˜**: 80-120MBï¼ˆæ­£å¸¸ï¼‰
- **CPU**: 0-5%ï¼ˆç©ºé—²æ—¶ï¼‰
- **é‡å¯æ¬¡æ•°**: 0ï¼ˆç¨³å®šè¿è¡Œï¼‰

---

## ğŸš¨ **æ•…éšœå¤„ç†æŒ‡å—**

### **æœåŠ¡æ— æ³•å¯åŠ¨**
1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tlnp | grep :3000`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼š`node -c ecosystem.config.js`
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`pm2 logs restaurant-lottery-backend --err`

### **æœåŠ¡é¢‘ç¹é‡å¯**
1. æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼š`pm2 monit`
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`pm2 logs restaurant-lottery-backend --err --lines 100`
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼š`curl http://localhost:3000/health`

### **å†…å­˜æ³„æ¼å¤„ç†**
1. ç›‘æ§å†…å­˜ä½¿ç”¨ï¼š`pm2 monit`
2. æ‰‹åŠ¨é‡å¯ï¼š`pm2 restart restaurant-lottery-backend`
3. è°ƒæ•´å†…å­˜é™åˆ¶ï¼šä¿®æ”¹`ecosystem.config.js`ä¸­çš„`max_memory_restart`

---

## âœ… **éªŒè¯æ¸…å•**

### **æœåŠ¡è¿è¡ŒéªŒè¯**
- [ ] `pm2 list` æ˜¾ç¤ºæœåŠ¡çŠ¶æ€ä¸º `online`
- [ ] `curl http://localhost:3000/health` è¿”å›healthyçŠ¶æ€
- [ ] å†…å­˜ä½¿ç”¨åœ¨åˆç†èŒƒå›´å†…ï¼ˆ<200MBï¼‰
- [ ] é‡å¯æ¬¡æ•°ä¸º0ï¼ˆç¨³å®šè¿è¡Œï¼‰

### **æŒä¹…åŒ–éªŒè¯**
- [ ] å…³é—­CursoråæœåŠ¡ç»§ç»­è¿è¡Œ
- [ ] å…³é—­ç»ˆç«¯åæœåŠ¡ç»§ç»­è¿è¡Œ
- [ ] æœåŠ¡é…ç½®å·²ä¿å­˜ï¼ˆ`pm2 save`ï¼‰
- [ ] æ—¥å¿—æ­£å¸¸è®°å½•

---

## ğŸ‰ **ä¼˜åŠ¿æ€»ç»“**

### **è§£å†³çš„å…³é”®é—®é¢˜**
1. **âœ… æŒç»­è¿è¡Œ**: å…³é—­å¼€å‘å·¥å…·åæœåŠ¡ä¸ä¼šåœæ­¢
2. **âœ… è‡ªåŠ¨æ¢å¤**: å´©æºƒåè‡ªåŠ¨é‡å¯ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
3. **âœ… èµ„æºç®¡ç†**: å†…å­˜ä½¿ç”¨ç›‘æ§å’Œè‡ªåŠ¨é‡å¯
4. **âœ… æ—¥å¿—ç®¡ç†**: å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œè½®è½¬
5. **âœ… è¿›ç¨‹ç›‘æ§**: å®æ—¶ç›‘æ§å’Œæ€§èƒ½ç»Ÿè®¡

### **å¼€å‘ä½“éªŒæå‡**
- ğŸš€ **å¼€å‘æ•ˆç‡**: æ— éœ€åå¤æ‰‹åŠ¨å¯åŠ¨æœåŠ¡
- ğŸ›¡ï¸ **ç¨³å®šæ€§**: æœåŠ¡å´©æºƒè‡ªåŠ¨æ¢å¤
- ğŸ“Š **å¯è§‚æµ‹æ€§**: è¯¦ç»†çš„è¿è¡ŒçŠ¶æ€ç›‘æ§
- ğŸ”§ **æ˜“ç»´æŠ¤**: æ ‡å‡†åŒ–çš„è¿›ç¨‹ç®¡ç†

**å½“å‰çŠ¶æ€**: ï¿½ï¿½ æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œå¯å®‰å…¨å…³é—­å¼€å‘å·¥å…· 