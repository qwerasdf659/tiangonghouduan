# é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ - æ•°æ®åº“å¼€å‘æ–‡æ¡£

> **åŸºäºå¼€å‘æ€»æ–‡æ¡£1å·å’Œå‰ç«¯1å·æ–‡æ¡£çš„æ•°æ®åº“è®¾è®¡ä¸å®ç°**

## ğŸ¯ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ ¹æ®å¼€å‘æ€»æ–‡æ¡£1å·å’Œå‰ç«¯1å·æ–‡æ¡£çš„è¦æ±‚ï¼Œè¯¦ç»†è¯´æ˜æ•°æ®åº“è®¾è®¡ã€è¡¨ç»“æ„ã€ç´¢å¼•ä¼˜åŒ–ã€æ•°æ®è¿ç§»ç­‰æ•°æ®åº“å¼€å‘çš„æ‰€æœ‰å…³é”®ç‚¹ã€‚

---

## ğŸ—„ï¸ ä¸€ã€æ•°æ®åº“ç¯å¢ƒé…ç½®

### 1.1 è¿æ¥ä¿¡æ¯
```sql
-- æ•°æ®åº“è¿æ¥é…ç½®
-- å†…ç½‘åœ°å€ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
Host: test-db-mysql.ns-br0za7uc.svc
Port: 3306
User: root
Password: mc6r9cgb
Connection: mysql://root:mc6r9cgb@test-db-mysql.ns-br0za7uc.svc:3306

-- å¤–ç½‘åœ°å€ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
Host: dbconn.sealosbja.site  
Port: 42182
User: root
Password: mc6r9cgb
Connection: mysql://root:mc6r9cgb@dbconn.sealosbja.site:42182
```

### 1.2 æ•°æ®åº“åˆ›å»º
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS restaurant_points_dev 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

CREATE DATABASE IF NOT EXISTS restaurant_points_prod 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- ä½¿ç”¨æ•°æ®åº“
USE restaurant_points_dev;
```

---

## ğŸ“Š äºŒã€æ ¸å¿ƒæ•°æ®è¡¨è®¾è®¡

### 2.1 ç”¨æˆ·è¡¨ (users)
```sql
-- ğŸ”´ ç”¨æˆ·æ ¸å¿ƒä¿¡æ¯è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šuser_id(ä¸»é”®)ã€total_points(å®æ—¶åŒæ­¥)ã€is_merchant(æƒé™æ§åˆ¶)
CREATE TABLE users (
  user_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†',
  mobile VARCHAR(11) UNIQUE NOT NULL COMMENT 'æ‰‹æœºå·ï¼ˆå‰ç«¯è„±æ•æ˜¾ç¤ºï¼‰',
  total_points INT DEFAULT 1000 COMMENT 'ç§¯åˆ†ä½™é¢ï¼ˆå‰ç«¯å®æ—¶æ˜¾ç¤ºï¼‰',
  is_merchant BOOLEAN DEFAULT FALSE COMMENT 'å•†å®¶æƒé™ï¼ˆå‰ç«¯é¡µé¢è®¿é—®æ§åˆ¶ï¼‰',
  nickname VARCHAR(50) DEFAULT NULL COMMENT 'ç”¨æˆ·æ˜µç§°',
  avatar VARCHAR(255) DEFAULT NULL COMMENT 'å¤´åƒURL',
  wx_openid VARCHAR(100) DEFAULT NULL COMMENT 'å¾®ä¿¡OpenID',
  device_info JSON DEFAULT NULL COMMENT 'è®¾å¤‡ä¿¡æ¯',
  last_login TIMESTAMP NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
  status ENUM('active', 'banned') DEFAULT 'active' COMMENT 'ç”¨æˆ·çŠ¶æ€',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_mobile (mobile),
  INDEX idx_openid (wx_openid),
  INDEX idx_status (status),
  INDEX idx_is_merchant (is_merchant),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨';
```

### 2.2 ç§¯åˆ†è®°å½•è¡¨ (points_records)
```sql
-- ğŸ”´ ç§¯åˆ†æ˜ç»†è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šåˆ†é¡µå±•ç¤ºã€ç±»å‹ç­›é€‰ã€ä½™é¢è®¡ç®—
CREATE TABLE points_records (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  type ENUM('earn', 'spend') NOT NULL COMMENT 'ç§¯åˆ†ç±»å‹ï¼ˆå‰ç«¯ï¼šæ”¶å…¥/æ”¯å‡ºæ ‡è¯†ï¼‰',
  points INT NOT NULL COMMENT 'ç§¯åˆ†æ•°é‡ï¼ˆæ­£æ•°ä¸ºè·å¾—ï¼Œè´Ÿæ•°ä¸ºæ¶ˆè´¹ï¼‰',
  description VARCHAR(255) NOT NULL COMMENT 'æ“ä½œæè¿°ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰',
  source ENUM('photo_upload', 'lottery', 'exchange', 'check_in', 'admin', 'register') NOT NULL COMMENT 'æ¥æºï¼ˆå‰ç«¯å›¾æ ‡æ˜¾ç¤ºï¼‰',
  balance_after INT NOT NULL COMMENT 'æ“ä½œåä½™é¢ï¼ˆå‰ç«¯éªŒè¯ç”¨ï¼‰',
  related_id VARCHAR(50) DEFAULT NULL COMMENT 'å…³è”ä¸šåŠ¡IDï¼ˆè®¢å•å·ã€æŠ½å¥–IDç­‰ï¼‰',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  -- å¤–é”®çº¦æŸ
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_user_id (user_id),
  INDEX idx_type (type),
  INDEX idx_source (source),
  INDEX idx_created_at (created_at),
  INDEX idx_user_created (user_id, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç§¯åˆ†å˜åŠ¨è®°å½•è¡¨';
```

### 2.3 æŠ½å¥–é…ç½®è¡¨ (lottery_settings)
```sql
-- ğŸ”´ è½¬ç›˜å¥–å“é…ç½®è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šangle(Canvasè§’åº¦)ã€is_activity(ç‰¹æ®ŠåŠ¨æ•ˆ)ã€probability(ä¸­å¥–æ¦‚ç‡)
CREATE TABLE lottery_settings (
  prize_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'å¥–å“ID',
  prize_name VARCHAR(100) NOT NULL COMMENT 'å¥–å“åç§°ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰',
  prize_type ENUM('points', 'coupon', 'physical', 'empty') NOT NULL COMMENT 'å¥–å“ç±»å‹',
  prize_value DECIMAL(10,2) DEFAULT 0.00 COMMENT 'å¥–å“ä»·å€¼',
  angle INT NOT NULL COMMENT 'è½¬ç›˜è§’åº¦ï¼ˆå‰ç«¯Canvasæ˜ å°„0-315åº¦ï¼‰',
  color VARCHAR(7) NOT NULL COMMENT 'æ‰‡å½¢é¢œè‰²ï¼ˆå‰ç«¯æ¸²æŸ“ï¼‰',
  probability DECIMAL(6,4) NOT NULL COMMENT 'ä¸­å¥–æ¦‚ç‡ï¼ˆ0-1ï¼Œå‰ç«¯ç®—æ³•ç”¨ï¼‰',
  is_activity BOOLEAN DEFAULT FALSE COMMENT 'ç‰¹æ®ŠåŠ¨æ•ˆæ ‡è®°ï¼ˆå‰ç«¯å·®ç‚¹ä¸­å¥–åŠ¨ç”»ï¼‰',
  daily_limit INT DEFAULT 0 COMMENT 'æ¯æ—¥é™åˆ¶æ¬¡æ•°',
  total_limit INT DEFAULT 0 COMMENT 'æ€»é™åˆ¶æ¬¡æ•°',
  cost_points INT DEFAULT 100 COMMENT 'æŠ½å¥–æ¶ˆè€—ç§¯åˆ†',
  stock INT DEFAULT -1 COMMENT 'å¥–å“åº“å­˜ï¼ˆ-1ä¸ºæ— é™ï¼‰',
  sort_order INT DEFAULT 0 COMMENT 'æ’åºæƒé‡',
  status ENUM('active', 'inactive') DEFAULT 'active' COMMENT 'çŠ¶æ€',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_status (status),
  INDEX idx_angle (angle),
  INDEX idx_probability (probability),
  INDEX idx_sort_order (sort_order),
  
  -- çº¦æŸæ£€æŸ¥
  CONSTRAINT chk_angle CHECK (angle >= 0 AND angle <= 315 AND angle % 45 = 0),
  CONSTRAINT chk_probability CHECK (probability >= 0 AND probability <= 1),
  CONSTRAINT chk_color CHECK (color REGEXP '^#[0-9A-Fa-f]{6}$')
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æŠ½å¥–è½¬ç›˜é…ç½®è¡¨';
```

### 2.4 æŠ½å¥–è®°å½•è¡¨ (lottery_records)
```sql
-- ğŸ”´ æŠ½å¥–è®°å½•è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šç”¨æˆ·æŠ½å¥–å†å²ã€ä¸­å¥–ç»Ÿè®¡
CREATE TABLE lottery_records (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  prize_id INT NOT NULL COMMENT 'å¥–å“ID',
  prize_name VARCHAR(100) NOT NULL COMMENT 'å¥–å“åç§°',
  prize_type VARCHAR(20) NOT NULL COMMENT 'å¥–å“ç±»å‹',
  prize_value DECIMAL(10,2) DEFAULT 0.00 COMMENT 'å¥–å“ä»·å€¼',
  draw_type ENUM('single', 'triple', 'quintuple', 'decade') NOT NULL COMMENT 'æŠ½å¥–ç±»å‹',
  is_near_miss BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·®ç‚¹ä¸­å¥–ï¼ˆå‰ç«¯åŠ¨ç”»ç”¨ï¼‰',
  points_cost INT NOT NULL COMMENT 'æ¶ˆè€—ç§¯åˆ†',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æŠ½å¥–æ—¶é—´',
  
  -- å¤–é”®çº¦æŸ
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  FOREIGN KEY (prize_id) REFERENCES lottery_settings(prize_id),
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_user_id (user_id),
  INDEX idx_prize_id (prize_id),
  INDEX idx_draw_type (draw_type),
  INDEX idx_created_at (created_at),
  INDEX idx_user_created (user_id, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æŠ½å¥–è®°å½•è¡¨';
```

### 2.5 å•†å“åº“å­˜è¡¨ (commodity_pool)
```sql
-- ğŸ”´ å¯å…‘æ¢å•†å“è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šstock(å®æ—¶åº“å­˜)ã€exchange_points(å…‘æ¢ç§¯åˆ†)ã€category(åˆ†ç±»ç­›é€‰)
CREATE TABLE commodity_pool (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'å•†å“ID',
  name VARCHAR(100) NOT NULL COMMENT 'å•†å“åç§°ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰',
  description TEXT COMMENT 'å•†å“æè¿°',
  category VARCHAR(50) NOT NULL COMMENT 'å•†å“åˆ†ç±»ï¼ˆå‰ç«¯ç­›é€‰ç”¨ï¼‰',
  exchange_points INT NOT NULL COMMENT 'å…‘æ¢æ‰€éœ€ç§¯åˆ†ï¼ˆå‰ç«¯ä»·æ ¼æ˜¾ç¤ºï¼‰',
  stock INT NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡ï¼ˆå‰ç«¯å®æ—¶æ˜¾ç¤ºï¼ŒWebSocketåŒæ­¥ï¼‰',
  image VARCHAR(255) COMMENT 'å•†å“å›¾ç‰‡URL',
  status ENUM('active', 'inactive', 'sold_out') DEFAULT 'active' COMMENT 'å•†å“çŠ¶æ€',
  is_hot BOOLEAN DEFAULT FALSE COMMENT 'çƒ­é—¨å•†å“æ ‡è®°ï¼ˆå‰ç«¯æ¨èï¼‰',
  sort_order INT DEFAULT 0 COMMENT 'æ’åºæƒé‡ï¼ˆå‰ç«¯æ’åºï¼‰',
  rating DECIMAL(3,2) DEFAULT 5.0 COMMENT 'è¯„åˆ†ï¼ˆå‰ç«¯æ˜Ÿçº§æ˜¾ç¤ºï¼‰',
  sales_count INT DEFAULT 0 COMMENT 'é”€é‡ï¼ˆå‰ç«¯æ’åºç”¨ï¼‰',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_category (category),
  INDEX idx_exchange_points (exchange_points),
  INDEX idx_status (status),
  INDEX idx_stock (stock),
  INDEX idx_is_hot (is_hot),
  INDEX idx_sort_order (sort_order),
  INDEX idx_sales_count (sales_count),
  
  -- çº¦æŸæ£€æŸ¥
  CONSTRAINT chk_stock CHECK (stock >= 0),
  CONSTRAINT chk_exchange_points CHECK (exchange_points > 0),
  CONSTRAINT chk_rating CHECK (rating >= 0 AND rating <= 5)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å•†å“åº“å­˜è¡¨';
```

### 2.6 å…‘æ¢è®°å½•è¡¨ (exchange_records)
```sql
-- ğŸ”´ å•†å“å…‘æ¢è®°å½•è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šè®¢å•çŠ¶æ€ã€å…‘æ¢å†å²ã€ç§¯åˆ†æ¶ˆè´¹
CREATE TABLE exchange_records (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  commodity_id INT NOT NULL COMMENT 'å•†å“ID',
  order_id VARCHAR(50) UNIQUE NOT NULL COMMENT 'è®¢å•å·ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰',
  product_name VARCHAR(100) NOT NULL COMMENT 'å•†å“åç§°ï¼ˆé˜²æ­¢å•†å“åˆ é™¤ï¼‰',
  quantity INT NOT NULL DEFAULT 1 COMMENT 'å…‘æ¢æ•°é‡',
  points_cost INT NOT NULL COMMENT 'æ¶ˆè€—ç§¯åˆ†ï¼ˆå‰ç«¯è´¦å•æ˜¾ç¤ºï¼‰',
  status ENUM('pending', 'completed', 'cancelled', 'shipped') DEFAULT 'pending' COMMENT 'è®¢å•çŠ¶æ€ï¼ˆå‰ç«¯çŠ¶æ€æ˜¾ç¤ºï¼‰',
  delivery_info JSON COMMENT 'é…é€ä¿¡æ¯ï¼ˆå‰ç«¯è¡¨å•æ•°æ®ï¼‰',
  remark TEXT COMMENT 'å¤‡æ³¨ä¿¡æ¯',
  exchange_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'å…‘æ¢æ—¶é—´',
  completed_time TIMESTAMP NULL COMMENT 'å®Œæˆæ—¶é—´',
  
  -- å¤–é”®çº¦æŸ
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  FOREIGN KEY (commodity_id) REFERENCES commodity_pool(commodity_id),
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_user_id (user_id),
  INDEX idx_commodity_id (commodity_id),
  INDEX idx_order_id (order_id),
  INDEX idx_status (status),
  INDEX idx_exchange_time (exchange_time),
  INDEX idx_user_time (user_id, exchange_time),
  
  -- çº¦æŸæ£€æŸ¥
  CONSTRAINT chk_quantity CHECK (quantity > 0),
  CONSTRAINT chk_points_cost CHECK (points_cost > 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å•†å“å…‘æ¢è®°å½•è¡¨';
```

### 2.7 æ‹ç…§å®¡æ ¸è¡¨ (photo_reviews)
```sql
-- ğŸ”´ æ‹ç…§å®¡æ ¸è¡¨
-- å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼šupload_id(ä¸Šä¼ æ ‡è¯†)ã€points_awarded(ç§¯åˆ†å¥–åŠ±)ã€review_status(å®¡æ ¸çŠ¶æ€)
CREATE TABLE photo_reviews (
  review_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'å®¡æ ¸ID',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  upload_id VARCHAR(50) UNIQUE NOT NULL COMMENT 'ä¸Šä¼ IDï¼ˆå‰ç«¯è¿½è¸ªç”¨ï¼‰',
  image_url VARCHAR(500) NOT NULL COMMENT 'å›¾ç‰‡URLï¼ˆSealoså­˜å‚¨ï¼‰',
  input_amount DECIMAL(8,2) NOT NULL COMMENT 'ç”¨æˆ·è¾“å…¥é‡‘é¢',
  recognized_amount DECIMAL(8,2) DEFAULT NULL COMMENT 'AIè¯†åˆ«é‡‘é¢ï¼ˆå‰ç«¯å¯¹æ¯”æ˜¾ç¤ºï¼‰',
  match_status ENUM('matched', 'mismatched', 'unclear') DEFAULT 'unclear' COMMENT 'åŒ¹é…çŠ¶æ€ï¼ˆå‰ç«¯å›¾æ ‡æ˜¾ç¤ºï¼‰',
  points_awarded INT DEFAULT 0 COMMENT 'å¥–åŠ±ç§¯åˆ†ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼šé‡‘é¢Ã—10ï¼‰',
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'å®¡æ ¸çŠ¶æ€ï¼ˆå‰ç«¯çŠ¶æ€æ˜¾ç¤ºï¼‰',
  review_reason TEXT COMMENT 'å®¡æ ¸ç†ç”±ï¼ˆå‰ç«¯æ˜¾ç¤ºï¼‰',
  reviewer_id INT DEFAULT NULL COMMENT 'å®¡æ ¸å‘˜ID',
  upload_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸Šä¼ æ—¶é—´',
  review_time TIMESTAMP NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  
  -- å¤–é”®çº¦æŸ
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  FOREIGN KEY (reviewer_id) REFERENCES users(user_id),
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_user_id (user_id),
  INDEX idx_upload_id (upload_id),
  INDEX idx_review_status (review_status),
  INDEX idx_match_status (match_status),
  INDEX idx_reviewer_id (reviewer_id),
  INDEX idx_upload_time (upload_time),
  INDEX idx_review_time (review_time),
  INDEX idx_user_upload (user_id, upload_time),
  
  -- çº¦æŸæ£€æŸ¥
  CONSTRAINT chk_input_amount CHECK (input_amount >= 0),
  CONSTRAINT chk_recognized_amount CHECK (recognized_amount IS NULL OR recognized_amount >= 0),
  CONSTRAINT chk_points_awarded CHECK (points_awarded >= 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ‹ç…§å®¡æ ¸è¡¨';
```

---

## ğŸ”§ ä¸‰ã€è¾…åŠ©è¡¨è®¾è®¡

### 3.1 ç³»ç»Ÿé…ç½®è¡¨ (system_configs)
```sql
-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_configs (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'é…ç½®ID',
  config_key VARCHAR(100) UNIQUE NOT NULL COMMENT 'é…ç½®é”®',
  config_value TEXT NOT NULL COMMENT 'é…ç½®å€¼',
  config_type ENUM('string', 'number', 'boolean', 'json') DEFAULT 'string' COMMENT 'é…ç½®ç±»å‹',
  description VARCHAR(255) COMMENT 'é…ç½®æè¿°',
  is_public BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å…¬å¼€ï¼ˆå‰ç«¯å¯è®¿é—®ï¼‰',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  INDEX idx_config_key (config_key),
  INDEX idx_is_public (is_public)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿé…ç½®è¡¨';
```

### 3.2 å•†å®¶ç”³è¯·è¡¨ (merchant_applications)
```sql
-- å•†å®¶æƒé™ç”³è¯·è¡¨
CREATE TABLE merchant_applications (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”³è¯·ID',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  business_name VARCHAR(100) NOT NULL COMMENT 'å•†æˆ·åç§°',
  business_license VARCHAR(100) COMMENT 'è¥ä¸šæ‰§ç…§å·',
  contact_person VARCHAR(50) NOT NULL COMMENT 'è”ç³»äºº',
  contact_phone VARCHAR(20) NOT NULL COMMENT 'è”ç³»ç”µè¯',
  business_address TEXT COMMENT 'è¥ä¸šåœ°å€',
  application_reason TEXT COMMENT 'ç”³è¯·ç†ç”±',
  status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'ç”³è¯·çŠ¶æ€',
  review_reason TEXT COMMENT 'å®¡æ ¸æ„è§',
  reviewer_id INT COMMENT 'å®¡æ ¸å‘˜ID',
  applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ç”³è¯·æ—¶é—´',
  reviewed_at TIMESTAMP NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  FOREIGN KEY (reviewer_id) REFERENCES users(user_id),
  
  INDEX idx_user_id (user_id),
  INDEX idx_status (status),
  INDEX idx_applied_at (applied_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å•†å®¶æƒé™ç”³è¯·è¡¨';
```

### 3.3 æ€§èƒ½ç›‘æ§è¡¨ (performance_metrics)
```sql
-- æ€§èƒ½ç›‘æ§è¡¨
CREATE TABLE performance_metrics (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®°å½•ID',
  user_id INT COMMENT 'ç”¨æˆ·ID',
  api_response_time INT COMMENT 'APIå“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',
  canvas_render_fps INT COMMENT 'Canvasæ¸²æŸ“å¸§ç‡',
  page_load_time INT COMMENT 'é¡µé¢åŠ è½½æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',
  memory_usage DECIMAL(8,2) COMMENT 'å†…å­˜å ç”¨ï¼ˆMBï¼‰',
  error_rate DECIMAL(5,4) COMMENT 'é”™è¯¯ç‡',
  client_info JSON COMMENT 'å®¢æˆ·ç«¯ä¿¡æ¯',
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'è®°å½•æ—¶é—´',
  
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE SET NULL,
  
  INDEX idx_user_id (user_id),
  INDEX idx_timestamp (timestamp)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ€§èƒ½ç›‘æ§è¡¨';
```

### 3.4 é”™è¯¯æ—¥å¿—è¡¨ (error_logs)
```sql
-- é”™è¯¯æ—¥å¿—è¡¨
CREATE TABLE error_logs (
  id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  user_id INT COMMENT 'ç”¨æˆ·ID',
  error_message TEXT NOT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
  error_stack TEXT COMMENT 'é”™è¯¯å †æ ˆ',
  page_route VARCHAR(255) COMMENT 'é¡µé¢è·¯ç”±',
  user_agent TEXT COMMENT 'ç”¨æˆ·ä»£ç†',
  client_info JSON COMMENT 'å®¢æˆ·ç«¯ä¿¡æ¯',
  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'é”™è¯¯æ—¶é—´',
  
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE SET NULL,
  
  INDEX idx_user_id (user_id),
  INDEX idx_timestamp (timestamp),
  INDEX idx_page_route (page_route)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='é”™è¯¯æ—¥å¿—è¡¨';
```

---

## ğŸ“Š å››ã€åˆå§‹åŒ–æ•°æ®

### 4.1 æŠ½å¥–è½¬ç›˜é…ç½®æ•°æ®
```sql
-- ğŸ”´ æŠ½å¥–è½¬ç›˜é…ç½®ï¼ˆ8ä¸ªå¥–å“ï¼Œå¯¹åº”å‰ç«¯Canvas 8ç­‰åˆ†ï¼‰
INSERT INTO lottery_settings (prize_name, prize_type, prize_value, angle, color, probability, is_activity, cost_points) VALUES
('å…«å…«æŠ˜åˆ¸', 'coupon', 88.00, 0, '#FF6B6B', 0.05, TRUE, 100),
('50ç§¯åˆ†', 'points', 50.00, 45, '#4ECDC4', 0.20, FALSE, 100),
('ä¹ä¹æŠ˜åˆ¸', 'coupon', 99.00, 90, '#45B7D1', 0.10, FALSE, 100),
('100ç§¯åˆ†', 'points', 100.00, 135, '#96CEB4', 0.15, FALSE, 100),
('å…è´¹å’–å•¡', 'physical', 25.00, 180, '#FFEAA7', 0.08, TRUE, 100),
('30ç§¯åˆ†', 'points', 30.00, 225, '#DDA0DD', 0.25, FALSE, 100),
('ç¥ç§˜å¤§å¥–', 'physical', 500.00, 270, '#FF7675', 0.02, TRUE, 100),
('è°¢è°¢å‚ä¸', 'empty', 0.00, 315, '#74B9FF', 0.15, FALSE, 100);
```

### 4.2 å•†å“åº“å­˜åˆå§‹æ•°æ®
```sql
-- ğŸ”´ å•†å“åº“å­˜æ•°æ®ï¼ˆ100ä¸ªå•†å“ï¼Œæ”¯æŒå‰ç«¯ç­›é€‰åˆ†é¡µï¼‰
INSERT INTO commodity_pool (name, description, category, exchange_points, stock, image, is_hot, sort_order, rating, sales_count) VALUES
-- é¥®å“ç±»
('æ˜Ÿå·´å…‹æ‹¿é“', 'ç»å…¸æ‹¿é“å’–å•¡ï¼Œé¦™é†‡æµ“éƒ', 'é¥®å“', 800, 50, '/images/starbucks-latte.jpg', TRUE, 1, 4.8, 156),
('å–œèŒ¶èŠèŠè“è“', 'æ–°é²œè‰è“ä¸èŠå£«çš„å®Œç¾ç»“åˆ', 'é¥®å“', 600, 30, '/images/heytea-berry.jpg', TRUE, 2, 4.9, 203),
('å¥ˆé›ªçš„èŒ¶éœ¸æ°”æ©™å­', 'æ–°é²œæ©™å­åˆ¶ä½œï¼Œç»´Cæ»¡æ»¡', 'é¥®å“', 550, 25, '/images/naixue-orange.jpg', FALSE, 3, 4.7, 89),

-- ç¾é£Ÿç±»
('è‚¯å¾·åŸºå…¨å®¶æ¡¶', '8å—åŸå‘³é¸¡+è–¯æ¡+æ±½æ°´', 'ç¾é£Ÿ', 1500, 20, '/images/kfc-bucket.jpg', TRUE, 4, 4.6, 78),
('å¿…èƒœå®¢9å¯¸æŠ«è¨', 'ç»å…¸ç›æ ¼ä¸½ç‰¹æŠ«è¨', 'ç¾é£Ÿ', 1200, 15, '/images/pizza-hut.jpg', FALSE, 5, 4.5, 45),
('æµ·åº•æç«é”…åˆ¸', '200å…ƒä»£é‡‘åˆ¸ï¼Œå…¨å›½é€šç”¨', 'ç¾é£Ÿ', 2000, 10, '/images/haidilao-voucher.jpg', TRUE, 6, 4.9, 234),

-- é›¶é£Ÿç±»
('ä¸‰åªæ¾é¼ åšæœ', 'æ¯æ—¥åšæœæ··åˆè£…', 'é›¶é£Ÿ', 300, 100, '/images/squirrel-nuts.jpg', FALSE, 7, 4.4, 312),
('è‰¯å“é“ºå­è‚‰è„¯', 'åŸå‘³ç‰›è‚‰è„¯ï¼Œé¦™å«©å¯å£', 'é›¶é£Ÿ', 400, 80, '/images/bestore-jerky.jpg', FALSE, 8, 4.3, 156),
('æ¥ä¼Šä»½é¸­è„–', 'é¦™è¾£é¸­è„–ï¼Œå›å‘³æ— ç©·', 'é›¶é£Ÿ', 350, 60, '/images/lyfen-duck.jpg', FALSE, 9, 4.2, 67);

-- ç»§ç»­æ’å…¥æ›´å¤šå•†å“æ•°æ®...
-- è¿™é‡Œä¸ºäº†æ–‡æ¡£ç®€æ´ï¼Œåªå±•ç¤ºéƒ¨åˆ†æ•°æ®ï¼Œå®é™…éœ€è¦æ’å…¥100ä¸ªå•†å“
```

### 4.3 ç³»ç»Ÿé…ç½®åˆå§‹æ•°æ®
```sql
-- ğŸ”´ ç³»ç»Ÿé…ç½®æ•°æ®
INSERT INTO system_configs (config_key, config_value, config_type, description, is_public) VALUES
('lottery_cost_points', '100', 'number', 'å•æ¬¡æŠ½å¥–æ¶ˆè€—ç§¯åˆ†', TRUE),
('daily_lottery_limit', '10', 'number', 'æ¯æ—¥æœ€å¤§æŠ½å¥–æ¬¡æ•°', TRUE),
('photo_points_rate', '10', 'number', 'æ‹ç…§ç§¯åˆ†å€ç‡ï¼ˆé‡‘é¢Ã—å€ç‡ï¼‰', FALSE),
('min_points_award', '50', 'number', 'æœ€ä½ç§¯åˆ†å¥–åŠ±', FALSE),
('max_points_award', '2000', 'number', 'æœ€é«˜ç§¯åˆ†å¥–åŠ±', FALSE),
('new_user_points', '1000', 'number', 'æ–°ç”¨æˆ·æ³¨å†Œå¥–åŠ±ç§¯åˆ†', FALSE),
('system_maintenance', 'false', 'boolean', 'ç³»ç»Ÿç»´æŠ¤çŠ¶æ€', TRUE),
('announcement', 'æ¬¢è¿ä½¿ç”¨é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿï¼', 'string', 'ç³»ç»Ÿå…¬å‘Š', TRUE);
```

---

## ğŸ” äº”ã€ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

### 5.1 å¤åˆç´¢å¼•åˆ›å»º
```sql
-- ğŸ”´ é’ˆå¯¹å‰ç«¯é«˜é¢‘æŸ¥è¯¢çš„å¤åˆç´¢å¼•

-- ç”¨æˆ·ç§¯åˆ†è®°å½•æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_points_records_user_type_time ON points_records(user_id, type, created_at DESC);

-- æŠ½å¥–è®°å½•æŸ¥è¯¢ä¼˜åŒ–  
CREATE INDEX idx_lottery_records_user_time ON lottery_records(user_id, created_at DESC);

-- å…‘æ¢è®°å½•æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_exchange_records_user_status_time ON exchange_records(user_id, status, exchange_time DESC);

-- å•†å“ç­›é€‰ä¼˜åŒ–
CREATE INDEX idx_commodity_category_points_stock ON commodity_pool(category, exchange_points, stock);

-- å®¡æ ¸è®°å½•æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_photo_reviews_status_time ON photo_reviews(review_status, upload_time DESC);
CREATE INDEX idx_photo_reviews_user_status ON photo_reviews(user_id, review_status);
```

### 5.2 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
```sql
-- ğŸ”´ ç»Ÿè®¡æŸ¥è¯¢è§†å›¾ï¼ˆå‡å°‘å¤æ‚æŸ¥è¯¢çš„è®¡ç®—é‡ï¼‰

-- ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡è§†å›¾
CREATE VIEW user_points_summary AS
SELECT 
  u.user_id,
  u.total_points,
  COALESCE(earn.total_earn, 0) as total_earned,
  COALESCE(spend.total_spend, 0) as total_spent,
  COALESCE(records.record_count, 0) as transaction_count
FROM users u
LEFT JOIN (
  SELECT user_id, SUM(points) as total_earn 
  FROM points_records 
  WHERE type = 'earn' 
  GROUP BY user_id
) earn ON u.user_id = earn.user_id
LEFT JOIN (
  SELECT user_id, SUM(ABS(points)) as total_spend 
  FROM points_records 
  WHERE type = 'spend' 
  GROUP BY user_id
) spend ON u.user_id = spend.user_id
LEFT JOIN (
  SELECT user_id, COUNT(*) as record_count 
  FROM points_records 
  GROUP BY user_id
) records ON u.user_id = records.user_id;

-- å•†å“é”€å”®ç»Ÿè®¡è§†å›¾
CREATE VIEW product_sales_summary AS
SELECT 
  c.commodity_id,
  c.name,
  c.category,
  c.exchange_points,
  c.stock,
  COALESCE(sales.total_sales, 0) as total_sales,
  COALESCE(sales.total_quantity, 0) as total_quantity,
  COALESCE(sales.total_points, 0) as total_points_earned
FROM commodity_pool c
LEFT JOIN (
  SELECT 
    commodity_id, 
    COUNT(*) as total_sales,
    SUM(quantity) as total_quantity,
    SUM(points_cost) as total_points_earned
  FROM exchange_records 
  WHERE status = 'completed'
  GROUP BY commodity_id
) sales ON c.commodity_id = sales.commodity_id;
```

---

## ğŸ“ˆ å…­ã€æ•°æ®åº“ç›‘æ§ä¸ç»´æŠ¤

### 6.1 æ€§èƒ½ç›‘æ§æŸ¥è¯¢
```sql
-- ğŸ”´ æ•°æ®åº“æ€§èƒ½ç›‘æ§SQL

-- æŸ¥çœ‹è¡¨å¤§å°å’Œè¡Œæ•°
SELECT 
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS table_size_mb,
    table_rows
FROM information_schema.tables 
WHERE table_schema = 'restaurant_points_dev' 
ORDER BY (data_length + index_length) DESC;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log 
ORDER BY query_time DESC 
LIMIT 10;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    table_name,
    index_name,
    cardinality,
    nullable
FROM information_schema.statistics 
WHERE table_schema = 'restaurant_points_dev'
ORDER BY table_name, cardinality DESC;
```

### 6.2 æ•°æ®æ¸…ç†ç­–ç•¥
```sql
-- ğŸ”´ å®šæœŸæ•°æ®æ¸…ç†è„šæœ¬

-- æ¸…ç†90å¤©å‰çš„æ€§èƒ½ç›‘æ§æ•°æ®
DELETE FROM performance_metrics 
WHERE timestamp < DATE_SUB(NOW(), INTERVAL 90 DAY);

-- æ¸…ç†180å¤©å‰çš„é”™è¯¯æ—¥å¿—
DELETE FROM error_logs 
WHERE timestamp < DATE_SUB(NOW(), INTERVAL 180 DAY);

-- æ¸…ç†å·²å®Œæˆçš„å…‘æ¢è®°å½•ï¼ˆä¿ç•™1å¹´ï¼‰
UPDATE exchange_records 
SET status = 'archived' 
WHERE status = 'completed' 
AND completed_time < DATE_SUB(NOW(), INTERVAL 1 YEAR);
```

### 6.3 å¤‡ä»½ç­–ç•¥
```bash
#!/bin/bash
# ğŸ”´ æ•°æ®åº“å¤‡ä»½è„šæœ¬

# å¤‡ä»½é…ç½®
DB_HOST="test-db-mysql.ns-br0za7uc.svc"
DB_PORT="3306"
DB_USER="root"
DB_PASS="mc6r9cgb"
DB_NAME="restaurant_points_dev"
BACKUP_DIR="/backup"
DATE=$(date +"%Y%m%d_%H%M%S")

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å…¨é‡å¤‡ä»½
mysqldump -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS \
  --single-transaction \
  --routines \
  --triggers \
  --events \
  $DB_NAME > $BACKUP_DIR/restaurant_points_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/restaurant_points_$DATE.sql

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "restaurant_points_*.sql.gz" -mtime +7 -delete

echo "æ•°æ®åº“å¤‡ä»½å®Œæˆ: restaurant_points_$DATE.sql.gz"
```

---

## ğŸš€ ä¸ƒã€éƒ¨ç½²æ‰§è¡Œè„šæœ¬

### 7.1 æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
```sql
-- ğŸ”´ complete_database_init.sql - å®Œæ•´çš„æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

-- è®¾ç½®å­—ç¬¦é›†
SET NAMES utf8mb4;
SET character_set_client = utf8mb4;

-- åˆ›å»ºæ•°æ®åº“
DROP DATABASE IF EXISTS restaurant_points_dev;
CREATE DATABASE restaurant_points_dev CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE restaurant_points_dev;

-- ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰è¡¨åˆ›å»ºè¯­å¥
-- (è¿™é‡ŒåŒ…å«ä¸Šé¢æ‰€æœ‰çš„CREATE TABLEè¯­å¥)

-- æ’å…¥åˆå§‹åŒ–æ•°æ®
-- (è¿™é‡ŒåŒ…å«ä¸Šé¢æ‰€æœ‰çš„INSERTè¯­å¥)

-- åˆ›å»ºç´¢å¼•å’Œè§†å›¾
-- (è¿™é‡ŒåŒ…å«ä¸Šé¢æ‰€æœ‰çš„CREATE INDEXå’ŒCREATE VIEWè¯­å¥)

-- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹
DELIMITER //

-- ğŸ”´ ç§¯åˆ†å˜åŠ¨å­˜å‚¨è¿‡ç¨‹ï¼ˆä¿è¯åŸå­æ€§ï¼‰
CREATE PROCEDURE UpdateUserPoints(
    IN p_user_id INT,
    IN p_points INT,
    IN p_description VARCHAR(255),
    IN p_source ENUM('photo_upload', 'lottery', 'exchange', 'check_in', 'admin', 'register'),
    IN p_related_id VARCHAR(50)
)
BEGIN
    DECLARE v_current_points INT DEFAULT 0;
    DECLARE v_new_balance INT DEFAULT 0;
    DECLARE v_type ENUM('earn', 'spend');
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    START TRANSACTION;
    
    -- è·å–å½“å‰ç§¯åˆ†ï¼ˆåŠ é”é˜²å¹¶å‘ï¼‰
    SELECT total_points INTO v_current_points 
    FROM users 
    WHERE user_id = p_user_id 
    FOR UPDATE;
    
    -- è®¡ç®—æ–°ä½™é¢
    SET v_new_balance = v_current_points + p_points;
    
    -- æ£€æŸ¥ä½™é¢ä¸èƒ½ä¸ºè´Ÿ
    IF v_new_balance < 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'ç§¯åˆ†ä½™é¢ä¸è¶³';
    END IF;
    
    -- ç¡®å®šç§¯åˆ†ç±»å‹
    IF p_points > 0 THEN
        SET v_type = 'earn';
    ELSE
        SET v_type = 'spend';
    END IF;
    
    -- æ›´æ–°ç”¨æˆ·ç§¯åˆ†
    UPDATE users 
    SET total_points = v_new_balance,
        updated_at = CURRENT_TIMESTAMP
    WHERE user_id = p_user_id;
    
    -- è®°å½•ç§¯åˆ†å˜åŠ¨
    INSERT INTO points_records (
        user_id, type, points, description, source, balance_after, related_id
    ) VALUES (
        p_user_id, v_type, p_points, p_description, p_source, v_new_balance, p_related_id
    );
    
    COMMIT;
END //

DELIMITER ;

-- æˆæƒ
GRANT ALL PRIVILEGES ON restaurant_points_dev.* TO 'root'@'%';
FLUSH PRIVILEGES;

SELECT 'æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼' as status;
```

### 7.2 éƒ¨ç½²æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# ğŸ”´ database_deploy_check.sh - æ•°æ®åº“éƒ¨ç½²æ£€æŸ¥è„šæœ¬

echo "=== é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿæ•°æ®åº“éƒ¨ç½²æ£€æŸ¥ ==="

# æ•°æ®åº“è¿æ¥é…ç½®
DB_HOST="test-db-mysql.ns-br0za7uc.svc"
DB_PORT="3306"
DB_USER="root"
DB_PASS="mc6r9cgb"
DB_NAME="restaurant_points_dev"

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
echo "1. æ£€æŸ¥æ•°æ®åº“è¿æ¥..."
mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -e "SELECT 1" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸"
else
    echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥"
    exit 1
fi

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
echo "2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨..."
mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -e "USE $DB_NAME" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… æ•°æ®åº“ $DB_NAME å­˜åœ¨"
else
    echo "âŒ æ•°æ®åº“ $DB_NAME ä¸å­˜åœ¨"
    exit 1
fi

# æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
echo "3. æ£€æŸ¥æ ¸å¿ƒè¡¨æ˜¯å¦å­˜åœ¨..."
TABLES=("users" "points_records" "lottery_settings" "lottery_records" "commodity_pool" "exchange_records" "photo_reviews")

for table in "${TABLES[@]}"; do
    result=$(mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -D$DB_NAME -e "SHOW TABLES LIKE '$table'" 2>/dev/null | grep $table)
    if [ -n "$result" ]; then
        echo "âœ… è¡¨ $table å­˜åœ¨"
    else
        echo "âŒ è¡¨ $table ä¸å­˜åœ¨"
        exit 1
    fi
done

# æ£€æŸ¥åˆå§‹æ•°æ®
echo "4. æ£€æŸ¥åˆå§‹æ•°æ®..."
lottery_count=$(mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -D$DB_NAME -e "SELECT COUNT(*) FROM lottery_settings" 2>/dev/null | tail -1)
echo "æŠ½å¥–é…ç½®æ•°é‡: $lottery_count"

commodity_count=$(mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -D$DB_NAME -e "SELECT COUNT(*) FROM commodity_pool" 2>/dev/null | tail -1)
echo "å•†å“æ•°é‡: $commodity_count"

# æ£€æŸ¥ç´¢å¼•
echo "5. æ£€æŸ¥ç´¢å¼•..."
index_count=$(mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS -D$DB_NAME -e "SELECT COUNT(*) FROM information_schema.statistics WHERE table_schema='$DB_NAME'" 2>/dev/null | tail -1)
echo "ç´¢å¼•æ•°é‡: $index_count"

echo "=== æ•°æ®åº“éƒ¨ç½²æ£€æŸ¥å®Œæˆ ==="
```

---

## ğŸ“‹ å…«ã€å¯¹æ¥æ£€æŸ¥æ¸…å•

### 8.1 æ•°æ®åº“ç»“æ„æ£€æŸ¥
- [ ] âœ… æ‰€æœ‰æ ¸å¿ƒè¡¨åˆ›å»ºå®Œæˆ
- [ ] âœ… å¤–é”®çº¦æŸè®¾ç½®æ­£ç¡®
- [ ] âœ… ç´¢å¼•ä¼˜åŒ–å®Œæˆ
- [ ] âœ… å­—ç¬¦é›†è®¾ç½®ä¸ºutf8mb4
- [ ] âœ… å­˜å‚¨è¿‡ç¨‹åˆ›å»ºæˆåŠŸ

### 8.2 åˆå§‹æ•°æ®æ£€æŸ¥
- [ ] âœ… æŠ½å¥–é…ç½®æ•°æ®æ­£ç¡®ï¼ˆ8ä¸ªå¥–å“ï¼‰
- [ ] âœ… å•†å“åº“å­˜æ•°æ®å®Œæ•´ï¼ˆ100ä¸ªå•†å“ï¼‰
- [ ] âœ… ç³»ç»Ÿé…ç½®æ•°æ®æ­£ç¡®
- [ ] âœ… æµ‹è¯•ç”¨æˆ·æ•°æ®å‡†å¤‡

### 8.3 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥
- [ ] âœ… å¤åˆç´¢å¼•åˆ›å»ºå®Œæˆ
- [ ] âœ… ç»Ÿè®¡è§†å›¾åˆ›å»ºæˆåŠŸ
- [ ] âœ… æŸ¥è¯¢æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] âœ… å¹¶å‘å‹åŠ›æµ‹è¯•é€šè¿‡

### 8.4 å®‰å…¨æœºåˆ¶æ£€æŸ¥
- [ ] âœ… æ•°æ®åº“æƒé™é…ç½®æ­£ç¡®
- [ ] âœ… æ•æ„Ÿå­—æ®µåŠ å¯†å¤„ç†
- [ ] âœ… SQLæ³¨å…¥é˜²æŠ¤æµ‹è¯•
- [ ] âœ… å¤‡ä»½æ¢å¤æµç¨‹éªŒè¯

---

> **ğŸ”´ é‡è¦æé†’**: 
> 1. æ•°æ®åº“å­—æ®µå¿…é¡»ä¸¥æ ¼æŒ‰ç…§å‰ç«¯1å·æ–‡æ¡£è¦æ±‚è®¾è®¡
> 2. æ‰€æœ‰è¡¨çš„å­—ç¬¦é›†å¿…é¡»è®¾ç½®ä¸ºutf8mb4
> 3. ç´¢å¼•ä¼˜åŒ–å¿…é¡»è€ƒè™‘å‰ç«¯çš„æŸ¥è¯¢æ¨¡å¼
> 4. åˆå§‹æ•°æ®å¿…é¡»ä¸å‰ç«¯Mockæ•°æ®ä¿æŒä¸€è‡´

> **ğŸ“Š ç›‘æ§å»ºè®®**:
> 1. å»ºç«‹æ•°æ®åº“æ€§èƒ½ç›‘æ§æœºåˆ¶
> 2. è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—å’Œå‘Šè­¦
> 3. å®šæœŸæ‰§è¡Œæ•°æ®æ¸…ç†è„šæœ¬
> 4. å»ºç«‹å®Œæ•´çš„å¤‡ä»½æ¢å¤æµç¨‹ 