<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <%- include('partials/head', { 
    title: 'ç³»ç»Ÿç»´æŠ¤', 
    pageStyle: '[x-cloak] { display: none !important; } .tab-content-frame { border: none; width: 100%; min-height: calc(100vh - 180px); }' 
  }) %>
</head>
<body class="themed-bg-subtle min-h-screen">
  
  <!-- å¯¼èˆªæ  -->
  <nav class="themed-bg-primary text-white shadow-lg">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a href="/admin/workspace.html" class="hover:text-blue-200">â† è¿”å›å·¥ä½œå°</a>
        <span class="text-lg font-semibold">ğŸ”§ ç³»ç»Ÿç»´æŠ¤</span>
      </div>
    </div>
  </nav>

  <!-- é¡µé¢ä¸»ä½“ -->
  <div class="container mx-auto px-4 py-6" x-data="sysMaintainPage()" x-init="init()">
    
    <!-- Tabå¯¼èˆª -->
    <div class="themed-card rounded-lg shadow mb-6">
      <div class="flex border-b overflow-x-auto">
        <template x-for="tab in tabs" :key="tab.id">
          <button 
            @click="switchTab(tab.id)"
            :class="currentTab === tab.id ? 'border-b-2 themed-border-primary themed-text-primary themed-bg-primary-light' : 'themed-text-muted themed-hover-bg'"
            class="px-6 py-3 font-medium whitespace-nowrap transition-colors"
            x-text="tab.icon + ' ' + tab.name"
          ></button>
        </template>
      </div>
    </div>

    <!-- Tabå†…å®¹åŒºåŸŸ -->
    <div class="themed-card rounded-lg shadow overflow-hidden">
      <!-- ç³»ç»Ÿé…ç½® -->
      <div x-show="currentTab === 'settings'" x-cloak>
        <iframe 
          src="/admin/system-settings.html?embed=true" 
          class="tab-content-frame"
          x-ref="settingsFrame"
        ></iframe>
      </div>
      
      <!-- ä¼šè¯ç®¡ç† -->
      <div x-show="currentTab === 'sessions'" x-cloak>
        <iframe 
          src="/admin/sessions.html?embed=true" 
          class="tab-content-frame"
          x-ref="sessionsFrame"
        ></iframe>
      </div>
      
      <!-- æ“ä½œå®¡è®¡ -->
      <div x-show="currentTab === 'audit-logs'" x-cloak>
        <iframe 
          src="/admin/audit-logs.html?embed=true" 
          class="tab-content-frame"
          x-ref="auditLogsFrame"
        ></iframe>
      </div>
      
      <!-- é«˜çº§å·¥å…· -->
      <div x-show="currentTab === 'config-tools'" x-cloak>
        <iframe 
          src="/admin/config-tools.html?embed=true" 
          class="tab-content-frame"
          x-ref="configToolsFrame"
        ></iframe>
      </div>
    </div>

  </div>

  <%- include('partials/footer') %>

  <script type="module">
    import { logger } from './src/utils/logger.js'
    import { Alpine, createPageMixin } from './src/alpine/index.js'

    document.addEventListener('alpine:init', () => {
      logger.info('[SysMaintainPage] æ³¨å†Œ Alpine ç»„ä»¶...')

      Alpine.data('sysMaintainPage', () => ({
        ...createPageMixin(),

        // Tabé…ç½®
        tabs: [
          { id: 'settings', name: 'ç³»ç»Ÿé…ç½®', icon: 'âš™ï¸' },
          { id: 'sessions', name: 'ä¼šè¯ç®¡ç†', icon: 'ğŸ’¬' },
          { id: 'audit-logs', name: 'æ“ä½œå®¡è®¡', icon: 'ğŸ“‹' },
          { id: 'config-tools', name: 'é«˜çº§å·¥å…·', icon: 'ğŸ› ï¸' }
        ],

        // å½“å‰é€‰ä¸­çš„Tab
        currentTab: 'settings',

        init() {
          logger.info('[SysMaintainPage] é¡µé¢åˆå§‹åŒ–')
          if (!this.checkAuth()) return

          // ä»URLå‚æ•°è¯»å–åˆå§‹Tab
          const urlParams = new URLSearchParams(window.location.search)
          const tabParam = urlParams.get('tab')
          if (tabParam && this.tabs.some(t => t.id === tabParam)) {
            this.currentTab = tabParam
          }
        },

        switchTab(tabId) {
          this.currentTab = tabId
          // æ›´æ–°URLå‚æ•°
          const url = new URL(window.location)
          url.searchParams.set('tab', tabId)
          window.history.pushState({}, '', url)
          logger.info('[SysMaintainPage] åˆ‡æ¢Tab:', tabId)
        }
      }))

      logger.info('[SysMaintainPage] Alpine ç»„ä»¶å·²æ³¨å†Œ')
    })
  </script>
</body>
</html>

