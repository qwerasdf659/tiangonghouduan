<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <%- include('partials/head', { 
    title: 'å¥–å“é…ç½®', 
    pageStyle: '[x-cloak] { display: none !important; } .tab-content-frame { border: none; width: 100%; min-height: calc(100vh - 180px); }' 
  }) %>
</head>
<body class="themed-bg-subtle min-h-screen">
  
  <!-- å¯¼èˆªæ  -->
  <nav class="themed-bg-primary text-white shadow-lg">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a href="/admin/workspace.html" class="hover:text-blue-200">â† è¿”å›å·¥ä½œå°</a>
        <span class="text-lg font-semibold">ğŸ å¥–å“é…ç½®</span>
      </div>
    </div>
  </nav>

  <!-- é¡µé¢ä¸»ä½“ -->
  <div class="container mx-auto px-4 py-6" x-data="prizeConfigPage()" x-init="init()">
    
    <!-- Tabå¯¼èˆª -->
    <div class="themed-card rounded-lg shadow mb-6">
      <div class="flex border-b overflow-x-auto">
        <template x-for="tab in tabs" :key="tab.id">
          <button 
            @click="switchTab(tab.id)"
            :class="currentTab === tab.id ? 'border-b-2 themed-border-primary themed-text-primary themed-bg-primary-light' : 'themed-text-muted themed-hover-bg'"
            class="px-6 py-3 font-medium whitespace-nowrap transition-colors"
            x-text="tab.icon + ' ' + tab.name"
          ></button>
        </template>
      </div>
    </div>

    <!-- Tabå†…å®¹åŒºåŸŸ -->
    <div class="themed-card rounded-lg shadow overflow-hidden">
      <!-- ç‰©å“æ¨¡æ¿ -->
      <div x-show="currentTab === 'item-templates'" x-cloak>
        <iframe 
          src="/admin/item-templates.html?embed=true" 
          class="tab-content-frame"
          x-ref="itemTemplatesFrame"
        ></iframe>
      </div>
      
      <!-- ç‰©æ–™è½¬æ¢è§„åˆ™ -->
      <div x-show="currentTab === 'material-rules'" x-cloak>
        <iframe 
          src="/admin/material-conversion-rules.html?embed=true" 
          class="tab-content-frame"
          x-ref="materialRulesFrame"
        ></iframe>
      </div>
      
      <!-- èµ„äº§ç»„åˆ -->
      <div x-show="currentTab === 'assets-portfolio'" x-cloak>
        <iframe 
          src="/admin/assets-portfolio.html?embed=true" 
          class="tab-content-frame"
          x-ref="assetsPortfolioFrame"
        ></iframe>
      </div>
    </div>

  </div>

  <%- include('partials/footer') %>

  <script type="module">
    import { logger } from './src/utils/logger.js'
    import { Alpine, createPageMixin } from './src/alpine/index.js'

    document.addEventListener('alpine:init', () => {
      logger.info('[PrizeConfigPage] æ³¨å†Œ Alpine ç»„ä»¶...')

      Alpine.data('prizeConfigPage', () => ({
        ...createPageMixin(),

        // Tabé…ç½®
        tabs: [
          { id: 'item-templates', name: 'ç‰©å“æ¨¡æ¿', icon: 'ğŸ“¦' },
          { id: 'material-rules', name: 'ç‰©æ–™è½¬æ¢è§„åˆ™', icon: 'ğŸ”„' },
          { id: 'assets-portfolio', name: 'èµ„äº§ç»„åˆ', icon: 'ğŸ’' }
        ],

        // å½“å‰é€‰ä¸­çš„Tab
        currentTab: 'item-templates',

        init() {
          logger.info('[PrizeConfigPage] é¡µé¢åˆå§‹åŒ–')
          if (!this.checkAuth()) return

          // ä»URLå‚æ•°è¯»å–åˆå§‹Tab
          const urlParams = new URLSearchParams(window.location.search)
          const tabParam = urlParams.get('tab')
          if (tabParam && this.tabs.some(t => t.id === tabParam)) {
            this.currentTab = tabParam
          }
        },

        switchTab(tabId) {
          this.currentTab = tabId
          // æ›´æ–°URLå‚æ•°
          const url = new URL(window.location)
          url.searchParams.set('tab', tabId)
          window.history.pushState({}, '', url)
          logger.info('[PrizeConfigPage] åˆ‡æ¢Tab:', tabId)
        }
      }))

      logger.info('[PrizeConfigPage] Alpine ç»„ä»¶å·²æ³¨å†Œ')
    })
  </script>
</body>
</html>

