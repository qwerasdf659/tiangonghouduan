<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†åå° - æŠ½å¥–ç³»ç»Ÿå·¥ä½œå°</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/admin/favicon.svg">
  
  <!-- æ³¨æ„ï¼šæ ·å¼é€šè¿‡ JS æ¨¡å—å¯¼å…¥ï¼Œæ— éœ€å¤–éƒ¨é“¾æ¥ -->
  
  <!-- è‡ªå®šä¹‰æ ·å¼ - ç¡®ä¿å¸ƒå±€å˜é‡å¯ç”¨ -->
  <style>
    /* å¸ƒå±€å˜é‡ï¼ˆä» variables.css å¤åˆ¶ä»¥ç¡®ä¿å…¼å®¹æ€§ï¼‰ */
    :root {
      --sidebar-width: 260px;
      --sidebar-collapsed-width: 72px;
      --header-height: 56px;
      --tab-bar-height: 40px;
    }
    
    /* åŠ è½½ä¸­çŠ¶æ€ */
    .workspace-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: var(--content-bg, #f3f4f6);
    }
    
    .workspace-loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e2e8f0;
      border-top-color: var(--primary, #3b82f6);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* éšè—æœªåˆå§‹åŒ–çš„ Alpine å…ƒç´  */
    [x-cloak] { display: none !important; }
  </style>
  
  <!-- é˜²æ­¢ workspace è¢«åµŒå¥—åœ¨ iframe ä¸­å¯¼è‡´é‡å¤ä¾§è¾¹æ  -->
  <script>
    (function() {
      // æ£€æµ‹æ˜¯å¦åœ¨ iframe ä¸­
      if (window.self !== window.top) {
        console.warn('[Workspace] æ£€æµ‹åˆ°è¢«åµŒå¥—åœ¨ iframe ä¸­ï¼Œè·³å‡ºåˆ°é¡¶å±‚çª—å£');
        // è·³å‡º iframeï¼Œåœ¨é¡¶å±‚çª—å£åŠ è½½
        window.top.location.href = window.location.href;
      }
      
      // æ¸…ç†å¯èƒ½å¯¼è‡´é—®é¢˜çš„æ—§çŠ¶æ€
      // å¦‚æœ URL åŒ…å«ç‰¹æ®Šæ ‡è®°ï¼Œè¯´æ˜æ˜¯é‡æ–°ç™»å½•åçš„è·³è½¬
      if (window.location.search.includes('fresh=1')) {
        console.log('[Workspace] æ£€æµ‹åˆ°æ–°ç™»å½•ï¼Œæ¸…ç†æ—§çŠ¶æ€');
        // æ¸…ç† Tab çŠ¶æ€ï¼Œé¿å…åŠ è½½æ—§çš„åµŒå¥—é¡µé¢
        try {
          const savedTabs = localStorage.getItem('workspace_tabs');
          if (savedTabs) {
            const state = JSON.parse(savedTabs);
            // æ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å‘ workspace.html çš„ Tabï¼ˆä¼šå¯¼è‡´åµŒå¥—ï¼‰
            const hasNestedWorkspace = state.tabs && state.tabs.some(tab => 
              tab.url && tab.url.includes('workspace.html')
            );
            if (hasNestedWorkspace) {
              console.warn('[Workspace] æ£€æµ‹åˆ°å¯èƒ½å¯¼è‡´åµŒå¥—çš„ Tabï¼Œæ¸…ç†çŠ¶æ€');
              localStorage.removeItem('workspace_tabs');
            }
          }
        } catch (e) {
          console.warn('[Workspace] æ¸…ç†çŠ¶æ€æ—¶å‡ºé”™:', e);
        }
        // ç§»é™¤ URL ä¸­çš„ fresh å‚æ•°
        const cleanUrl = window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
      }
    })();
  </script>
</head>
<body class="themed-bg-subtle">
  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <div id="loading-screen" class="workspace-loading">
    <div class="workspace-loading-spinner"></div>
  </div>

  <!-- å·¥ä½œå°ä¸»å®¹å™¨ -->
  <div 
    class="admin-layout" 
    x-data="workspaceTabs()" 
    x-cloak
    @toggle-mobile-menu.window="$refs.sidebar && ($refs.sidebar.mobileOpen = !$refs.sidebar.mobileOpen)"
    @keydown.ctrl.k.prevent="$store.shortcuts?.trigger('openSearch')"
    @keydown.escape="$store.shortcuts?.trigger('closeModal')"
    @keydown.ctrl.s.prevent="$store.shortcuts?.trigger('save')"
  >
    <!-- ä¾§è¾¹æ  -->
    <aside 
      class="admin-sidebar"
      x-data="sidebarNav()"
      x-ref="sidebar"
      :class="{ 'collapsed': collapsed, 'mobile-open': mobileOpen }"
    >
      <!-- Logo åŒºåŸŸ -->
      <div class="sidebar-logo">
        <span class="logo-icon">ğŸ°</span>
        <span class="logo-text">æŠ½å¥–ç®¡ç†åå°</span>
      </div>

      <!-- å¯¼èˆªèœå• -->
      <nav class="sidebar-nav scrollbar-thin">
        <template x-for="group in navGroups" :key="group.id">
          <div class="nav-menu-item">
            <!-- å•é¡¹èœå•ï¼ˆå¦‚è¿è¥ä»ªè¡¨ç›˜ï¼‰ -->
            <a 
              x-show="group.type === 'single'"
              class="nav-single"
              :class="{ 'active': isItemActive(group.url) }"
              @click.prevent="navigateTo(group.url, group.id, group.name, group.icon)"
              href="javascript:;"
            >
              <span class="nav-icon" x-text="group.icon"></span>
              <span class="nav-text" x-text="group.name"></span>
            </a>

            <!-- äºŒçº§åˆ†ç»„èœå•ï¼ˆæœ‰ items ä½†æ²¡æœ‰ subGroupsï¼‰ -->
            <div 
              x-show="group.type !== 'single' && group.items && group.items.length > 0 && (!group.subGroups || group.subGroups.length === 0)"
              class="nav-group"
              :class="{ 'expanded': isGroupExpanded(group.id) }"
            >
              <div 
                class="nav-group-title"
                @click="toggleGroup(group.id)"
              >
                <span class="nav-icon" x-text="group.icon"></span>
                <span class="nav-text" x-text="group.name"></span>
                <span class="toggle-icon">â–¼</span>
              </div>
              <div class="nav-group-items">
                <template x-for="item in (group.items || [])" :key="item.id">
                  <a 
                    class="nav-item"
                    :class="{ 'active': isItemActive(item.url) }"
                    @click.prevent="navigateTo(item.url, item.id, item.name, group.icon)"
                    href="javascript:;"
                  >
                    <span x-text="item.name"></span>
                    <template x-if="item.badge === 'live'">
                      <span class="ml-auto w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    </template>
                    <template x-if="item.badgeKey && getBadgeCount(item.badgeKey) > 0">
                      <span 
                        class="ml-auto px-1.5 py-0.5 text-xs font-medium bg-red-500 text-white rounded-full min-w-[20px] text-center"
                        x-text="getBadgeCount(item.badgeKey) > 99 ? '99+' : getBadgeCount(item.badgeKey)"
                      ></span>
                    </template>
                  </a>
                </template>
              </div>
            </div>

            <!-- ä¸‰çº§åˆ†ç»„èœå•ï¼ˆå¦‚ç³»ç»Ÿè®¾ç½®ï¼Œæœ‰ subGroupsï¼‰ -->
            <div 
              x-show="group.subGroups && group.subGroups.length > 0"
              class="nav-group nav-group-3level"
              :class="{ 'expanded': isGroupExpanded(group.id) }"
              :data-group-id="group.id"
            >
              <div 
                class="nav-group-title"
                @click="toggleGroup(group.id)"
              >
                <span class="nav-icon" x-text="group.icon"></span>
                <span class="nav-text" x-text="group.name"></span>
                <span class="toggle-icon">â–¼</span>
              </div>
              <div class="nav-group-items">
                <template x-for="subGroup in (group.subGroups || [])" :key="subGroup.id">
                  <div class="nav-subgroup" :class="{ 'expanded': isSubGroupExpanded(subGroup.id) }">
                    <div 
                      class="nav-subgroup-title"
                      @click="toggleSubGroup(subGroup.id)"
                    >
                      <span class="nav-subicon" x-text="subGroup.icon || 'ğŸ“'"></span>
                      <span x-text="subGroup.name"></span>
                      <span class="toggle-icon text-xs">â–¼</span>
                    </div>
                    <div class="nav-subgroup-items">
                      <template x-for="item in (subGroup.items || [])" :key="item.id">
                        <a 
                          class="nav-item nav-item-nested"
                          :class="{ 'active': isItemActive(item.url) }"
                          @click.prevent="navigateTo(item.url, item.id, item.name, subGroup.icon || group.icon)"
                          href="javascript:;"
                        >
                          <span x-text="item.name"></span>
                        </a>
                      </template>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </template>
      </nav>

      <!-- ä¾§è¾¹æ åº•éƒ¨ -->
      <div class="sidebar-footer">
        <button 
          class="collapse-btn"
          @click="toggleCollapse()"
          :title="collapsed ? 'å±•å¼€èœå•' : 'æŠ˜å èœå•'"
        >
          <span x-show="!collapsed">â—€ æŠ˜å èœå•</span>
          <span x-show="collapsed">â–¶</span>
        </button>
      </div>
    </aside>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <main class="admin-main">
      <!-- é¡¶éƒ¨æ  -->
      <header class="workspace-header">
        <div class="header-left">
          <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
          <button 
            class="mobile-menu-btn"
            @click="$dispatch('toggle-mobile-menu')"
            title="èœå•"
          >
            â˜°
          </button>

          <!-- é¢åŒ…å±‘å¯¼èˆª -->
          <nav class="breadcrumb-nav">
            <span>ç®¡ç†åå°</span>
            <span>/</span>
            <span x-text="getActiveTab()?.title || 'å·¥ä½œå°'"></span>
          </nav>
        </div>

        <div class="header-right">
          <!-- å…¨å±€æœç´¢ -->
          <div class="global-search">
            <span class="global-search-icon">ğŸ”</span>
            <input 
              type="text" 
              placeholder="æœç´¢åŠŸèƒ½..." 
              @keyup.enter="handleGlobalSearch($event.target.value)"
            />
          </div>

          <!-- åˆ·æ–°æŒ‰é’® -->
          <button 
            class="header-btn" 
            title="åˆ·æ–°å½“å‰é¡µé¢"
            @click="refreshCurrentTab()"
          >
            ğŸ”„
          </button>

          <!-- å¤–è§‚è®¾ç½® - ä¸»é¢˜å’Œå­—ä½“åˆ‡æ¢ -->
          <div class="appearance-settings" x-data="appearanceSettings()" @click.outside="closePanel()">
            <!-- è§¦å‘æŒ‰é’® -->
            <button 
              class="appearance-trigger"
              @click="togglePanel()"
              :title="'å¤–è§‚è®¾ç½® - ä¸»é¢˜: ' + getCurrentThemeInfo().name + ', å­—ä½“: ' + getCurrentFontInfo().name"
            >
              <span class="trigger-icon" x-text="getCurrentThemeInfo().icon">ğŸ’™</span>
            </button>

            <!-- è®¾ç½®é¢æ¿ -->
            <div class="appearance-panel" :class="{ 'is-open': isOpen }">
              <!-- å¤´éƒ¨ -->
              <div class="appearance-header">
                <div class="appearance-title">
                  <span>âš™ï¸</span>
                  <span>å¤–è§‚è®¾ç½®</span>
                </div>
                <button class="appearance-close" @click="closePanel()">
                  <span>âœ•</span>
                </button>
              </div>

              <!-- Tabå¯¼èˆª -->
              <div class="appearance-tabs">
                <button 
                  class="appearance-tab" 
                  :class="{ 'is-active': activeTab === 'theme' }"
                  @click="activeTab = 'theme'"
                >
                  ğŸ¨ ä¸»é¢˜é…è‰²
                </button>
                <button 
                  class="appearance-tab" 
                  :class="{ 'is-active': activeTab === 'font' }"
                  @click="activeTab = 'font'"
                >
                  ğŸ”¤ å­—ä½“
                </button>
              </div>

              <!-- å†…å®¹åŒºåŸŸ -->
              <div class="appearance-content">
                <!-- ä¸»é¢˜é€‰æ‹© Tab -->
                <div x-show="activeTab === 'theme'" class="appearance-section">
                  <!-- æ·±è‰²ä¾§è¾¹æ ä¸»é¢˜ -->
                  <div class="theme-group">
                    <div class="theme-group-title">ğŸŒ™ æ·±è‰²ä¾§è¾¹æ </div>
                    <div class="theme-grid">
                      <template x-for="theme in darkSidebarThemes" :key="theme.id">
                        <button 
                          class="theme-card"
                          :class="{ 'is-active': currentTheme === theme.id }"
                          @click="setTheme(theme.id)"
                        >
                          <div class="theme-preview">
                            <template x-for="(color, idx) in theme.colors" :key="idx">
                              <div class="theme-color" :style="'background:' + color"></div>
                            </template>
                          </div>
                          <div class="theme-info">
                            <span class="theme-icon" x-text="theme.icon"></span>
                            <span class="theme-name" x-text="theme.name"></span>
                          </div>
                          <div class="theme-check" x-show="currentTheme === theme.id">âœ“</div>
                        </button>
                      </template>
                    </div>
                  </div>

                  <!-- æµ…è‰²ä¾§è¾¹æ ä¸»é¢˜ -->
                  <div class="theme-group">
                    <div class="theme-group-title">â˜€ï¸ æµ…è‰²ä¾§è¾¹æ </div>
                    <div class="theme-grid">
                      <template x-for="theme in lightSidebarThemes" :key="theme.id">
                        <button 
                          class="theme-card"
                          :class="{ 'is-active': currentTheme === theme.id }"
                          @click="setTheme(theme.id)"
                        >
                          <div class="theme-preview">
                            <template x-for="(color, idx) in theme.colors" :key="idx">
                              <div class="theme-color" :style="'background:' + color"></div>
                            </template>
                          </div>
                          <div class="theme-info">
                            <span class="theme-icon" x-text="theme.icon"></span>
                            <span class="theme-name" x-text="theme.name"></span>
                          </div>
                          <div class="theme-check" x-show="currentTheme === theme.id">âœ“</div>
                        </button>
                      </template>
                    </div>
                  </div>
                </div>

                <!-- å­—ä½“é€‰æ‹© Tab -->
                <div x-show="activeTab === 'font'" class="appearance-section">
                  <div class="font-list">
                    <template x-for="font in fonts" :key="font.id">
                      <button 
                        class="font-card"
                        :class="{ 'is-active': currentFont === font.id }"
                        @click="setFont(font.id)"
                      >
                        <div class="font-preview" :style="'font-family:' + font.preview">
                          Aa ä¸­æ–‡
                        </div>
                        <div class="font-info">
                          <span class="font-name" x-text="font.name"></span>
                          <span class="font-desc" x-text="font.desc"></span>
                        </div>
                        <div class="font-check" x-show="currentFont === font.id">âœ“</div>
                      </button>
                    </template>
                  </div>
                </div>
              </div>

              <!-- åº•éƒ¨ -->
              <div class="appearance-footer">
                <button class="appearance-reset" @click="resetToDefault()">
                  ğŸ”„ æ¢å¤é»˜è®¤
                </button>
              </div>
            </div>
          </div>

          <!-- å®æ—¶æé†’ä¸­å¿ƒ -->
          <div 
            class="notification-center relative" 
            x-data="notificationCenter()"
            x-init="init()"
            @click.away="closeDropdown()"
          >
            <!-- æé†’å›¾æ ‡æŒ‰é’® -->
            <button 
              class="header-btn relative"
              @click="toggleDropdown()"
              title="æ¶ˆæ¯é€šçŸ¥"
            >
              ğŸ””
              <!-- æœªè¯»å¾½ç«  -->
              <span 
                x-show="unreadCount > 0"
                class="absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center text-xs font-bold text-white bg-red-500 rounded-full px-1"
                x-text="unreadCount > 99 ? '99+' : unreadCount"
              ></span>
              <!-- WebSocket è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
              <span 
                x-show="wsConnected"
                class="absolute bottom-0 right-0 w-2 h-2 bg-green-400 rounded-full border border-white"
                title="å®æ—¶è¿æ¥å·²å»ºç«‹"
              ></span>
            </button>
            
            <!-- é€šçŸ¥ä¸‹æ‹‰åˆ—è¡¨ -->
            <div 
              x-show="isOpen"
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 transform scale-95 -translate-y-2"
              x-transition:enter-end="opacity-100 transform scale-100 translate-y-0"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 transform scale-100 translate-y-0"
              x-transition:leave-end="opacity-0 transform scale-95 -translate-y-2"
              class="absolute right-0 top-full mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden z-50"
              style="display: none;"
            >
              <!-- å¤´éƒ¨ -->
              <div class="px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gray-50">
                <div class="flex items-center gap-2">
                  <span class="font-semibold text-gray-800">æ¶ˆæ¯é€šçŸ¥</span>
                  <span 
                    x-show="unreadCount > 0"
                    class="px-2 py-0.5 text-xs font-medium bg-red-100 text-red-600 rounded-full"
                    x-text="unreadCount + 'æ¡æœªè¯»'"
                  ></span>
                </div>
                <div class="flex items-center gap-2">
                  <!-- å£°éŸ³å¼€å…³ -->
                  <button 
                    @click.stop="toggleSound()"
                    class="p-1.5 rounded hover:bg-gray-200 transition text-lg"
                    :title="soundEnabled ? 'å…³é—­å£°éŸ³æé†’' : 'å¼€å¯å£°éŸ³æé†’'"
                  >
                    <span x-text="soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'"></span>
                  </button>
                  <!-- å…¨éƒ¨å·²è¯» -->
                  <button 
                    @click.stop="markAllAsRead()"
                    x-show="unreadCount > 0"
                    class="text-xs text-blue-600 hover:text-blue-700 font-medium"
                  >
                    å…¨éƒ¨å·²è¯»
                  </button>
                </div>
              </div>
              
              <!-- é€šçŸ¥åˆ—è¡¨ -->
              <div class="max-h-[400px] overflow-y-auto">
                <!-- åŠ è½½ä¸­ -->
                <template x-if="loading">
                  <div class="p-8 text-center text-gray-400">
                    <div class="animate-spin text-2xl mb-2">â³</div>
                    <div class="text-sm">åŠ è½½ä¸­...</div>
                  </div>
                </template>
                
                <!-- ç©ºçŠ¶æ€ -->
                <template x-if="!loading && notifications.length === 0">
                  <div class="p-8 text-center text-gray-400">
                    <div class="text-3xl mb-2">ğŸ“­</div>
                    <div class="text-sm">æš‚æ— æ¶ˆæ¯é€šçŸ¥</div>
                  </div>
                </template>
                
                <!-- é€šçŸ¥é¡¹ -->
                <template x-for="notification in notifications" :key="notification.id">
                  <div 
                    class="px-4 py-3 border-b border-gray-50 hover:bg-gray-50 cursor-pointer transition"
                    :class="{ 'bg-blue-50/50': !notification.is_read }"
                    @click="handleNotificationClick(notification)"
                  >
                    <div class="flex items-start gap-3">
                      <!-- ç±»å‹å›¾æ ‡ -->
                      <div 
                        class="w-8 h-8 rounded-full flex items-center justify-center text-sm flex-shrink-0"
                        :class="getNotificationColorClass(notification.type)"
                      >
                        <span x-text="getNotificationIcon(notification.type)"></span>
                      </div>
                      
                      <!-- å†…å®¹ -->
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                          <span 
                            class="font-medium text-gray-800 text-sm truncate"
                            :class="{ 'font-semibold': !notification.is_read }"
                            x-text="notification.title"
                          ></span>
                          <!-- æœªè¯»æŒ‡ç¤ºå™¨ -->
                          <span 
                            x-show="!notification.is_read"
                            class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"
                          ></span>
                        </div>
                        <div class="text-xs text-gray-500 mt-0.5 line-clamp-2" x-text="notification.message"></div>
                        <div class="text-xs text-gray-400 mt-1" x-text="formatTime(notification.created_at)"></div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
              
              <!-- åº•éƒ¨ -->
              <div class="px-4 py-3 border-t border-gray-100 bg-gray-50">
                <button 
                  @click="viewAllNotifications()"
                  class="w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium"
                >
                  æŸ¥çœ‹å…¨éƒ¨æ¶ˆæ¯ â†’
                </button>
              </div>
            </div>
          </div>

          <!-- ä¸»é¢˜åˆ‡æ¢å·²æ•´åˆåˆ°å¤–è§‚è®¾ç½®é¢æ¿ä¸­ï¼ˆappearanceSettings ç»„ä»¶ï¼‰ -->

          <!-- ç”¨æˆ·ä¸‹æ‹‰èœå• -->
          <div class="user-dropdown relative" x-data="{ open: false }" @click.away="open = false">
            <div @click="open = !open" class="flex items-center gap-2 cursor-pointer">
              <span class="user-avatar">A</span>
              <span class="user-name">ç®¡ç†å‘˜</span>
              <span class="text-xs text-gray-400">â–¼</span>
            </div>
            
            <!-- ä¸‹æ‹‰èœå• -->
            <div 
              x-show="open"
              x-transition
              class="absolute right-0 top-full mt-2 w-48 themed-card rounded-lg shadow-lg border themed-border py-2 z-50"
              style="display: none;"
            >
              <a href="/admin/system-settings.html" class="block px-4 py-2 text-sm themed-text-secondary themed-hover-bg">
                ğŸ‘¤ ä¸ªäººè®¾ç½®
              </a>
              <a href="/admin/system-settings.html" class="block px-4 py-2 text-sm themed-text-secondary themed-hover-bg">
                âš™ï¸ ç³»ç»Ÿè®¾ç½®
              </a>
              <div class="border-t themed-border my-1"></div>
              <button 
                @click="handleLogout()"
                class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50"
              >
                ğŸšª é€€å‡ºç™»å½•
              </button>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Tab å·¥ä½œå° -->
      <div class="workspace-tab-bar">
        <!-- Tab åˆ—è¡¨ -->
        <template x-for="tab in tabs" :key="tab.id">
          <button 
            class="workspace-tab"
            :class="{ 'active': isActiveTab(tab.id) }"
            @click="switchTab(tab.id)"
            @contextmenu="showContextMenu(tab.id, $event)"
            :title="tab.title"
          >
            <span class="tab-icon" x-text="tab.icon"></span>
            <span class="tab-title" x-text="tab.title"></span>
            <span 
              class="tab-close-btn"
              @click.stop="closeTab(tab.id)"
              title="å…³é—­æ­¤æ ‡ç­¾"
              x-show="tabs.length > 1"
              style="display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; margin-left: 6px; border-radius: 50%; background: rgba(0,0,0,0.1); color: #666; font-size: 12px; cursor: pointer; transition: all 0.2s;"
              onmouseover="this.style.background='#ef4444'; this.style.color='white';"
              onmouseout="this.style.background='rgba(0,0,0,0.1)'; this.style.color='#666';"
            >âœ•</span>
          </button>
        </template>

        <!-- Tab æ“ä½œæŒ‰é’® -->
        <button 
          class="workspace-tab tab-add"
          @click="closeAllTabs()"
          title="å…³é—­æ‰€æœ‰å¹¶è¿”å›å·¥ä½œå°"
          x-show="tabs.length > 1"
        >
          âœ• å…³é—­æ‰€æœ‰
        </button>
      </div>

      <!-- Tab å†…å®¹åŒºåŸŸ -->
      <div class="workspace-content">
        <template x-for="tab in tabs" :key="tab.id">
          <div 
            class="tab-panel"
            :class="{ 'active': isActiveTab(tab.id) }"
            :data-tab-id="tab.id"
          >
            <!-- ä½¿ç”¨ iframe åŠ è½½é¡µé¢å†…å®¹ -->
            <iframe 
              :src="tab.url"
              :name="'tab-' + tab.id"
              title="é¡µé¢å†…å®¹"
              loading="lazy"
            ></iframe>
          </div>
        </template>

        <!-- ç©ºçŠ¶æ€ -->
        <div 
          class="empty-state"
          x-show="tabs.length === 0"
          style="height: 100%;"
        >
          <div class="empty-state-icon">ğŸ“‹</div>
          <div class="empty-state-text">æš‚æ— æ‰“å¼€çš„é¡µé¢</div>
          <div class="empty-state-description">ä»å·¦ä¾§èœå•é€‰æ‹©åŠŸèƒ½å¼€å§‹ä½¿ç”¨</div>
        </div>
      </div>
    </main>
  </div>

  <!-- JavaScript -->
  <script type="module">
    // å¯¼å…¥æ ·å¼
    import './src/styles/index.css'
    
    // å¯¼å…¥å¹¶åˆå§‹åŒ– Alpine.js
    import { initAlpine } from './src/alpine/index.js'
    
    // åˆå§‹åŒ– Alpine.js
    initAlpine()
    
    // éšè—åŠ è½½çŠ¶æ€
    setTimeout(() => {
      const loadingScreen = document.getElementById('loading-screen')
      if (loadingScreen) {
        loadingScreen.style.opacity = '0'
        loadingScreen.style.transition = 'opacity 0.3s'
        setTimeout(() => loadingScreen.remove(), 300)
      }
    }, 100)
    
    // å…¨å±€æœç´¢å¤„ç†
    window.handleGlobalSearch = function(keyword) {
      console.log('æœç´¢:', keyword)
      // å¯æ‰©å±•ï¼šå®ç°å…¨å±€æœç´¢é€»è¾‘
    }
    
    // é€€å‡ºç™»å½•å¤„ç†
    window.handleLogout = async function() {
      if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) return
      
      try {
        const response = await fetch('/api/v4/auth/logout', {
          method: 'POST',
          credentials: 'include'
        })
        
        // æ— è®ºAPIç»“æœå¦‚ä½•ï¼Œéƒ½æ¸…ç†æœ¬åœ°çŠ¶æ€
        clearAllLocalState()
        
        if (response.ok || response.status === 401) {
          // ç¡®ä¿åœ¨é¡¶å±‚çª—å£è·³è½¬
          if (window.self !== window.top) {
            window.top.location.href = '/admin/login.html'
          } else {
            window.location.href = '/admin/login.html'
          }
        }
      } catch (error) {
        console.error('é€€å‡ºç™»å½•å¤±è´¥:', error)
        // å³ä½¿APIå¤±è´¥ä¹Ÿæ¸…ç†æœ¬åœ°çŠ¶æ€å¹¶è·³è½¬
        clearAllLocalState()
        if (window.self !== window.top) {
          window.top.location.href = '/admin/login.html'
        } else {
          window.location.href = '/admin/login.html'
        }
      }
    }
    
    // å½»åº•æ¸…ç†æ‰€æœ‰æœ¬åœ°çŠ¶æ€
    function clearAllLocalState() {
      // æ¸…ç†è®¤è¯ç›¸å…³
      localStorage.removeItem('admin_token')
      localStorage.removeItem('admin_user_info')
      sessionStorage.removeItem('admin_token')
      sessionStorage.removeItem('admin_user_info')
      
      // æ¸…ç†å·¥ä½œåŒºçŠ¶æ€
      localStorage.removeItem('workspace_tabs')
      localStorage.removeItem('sidebar_collapsed')
      localStorage.removeItem('sidebar_expanded_groups')
      
      // æ¸…ç†æµè§ˆå™¨ä¼šè¯æ ‡è®°
      sessionStorage.removeItem('browser_session_id')
      
      console.log('[Workspace] å·²æ¸…ç†æ‰€æœ‰æœ¬åœ°çŠ¶æ€')
    }
    
    console.log('ğŸ° æŠ½å¥–ç®¡ç†åå°å·¥ä½œå°å·²åŠ è½½ - æ·±è“ç§‘æŠ€é£')
    
    // ç›‘å¬å­ iframe å‘é€çš„è®¤è¯è¿‡æœŸæ¶ˆæ¯
    window.addEventListener('message', function(event) {
      // å®‰å…¨æ£€æŸ¥ï¼šåªå¤„ç†è®¤è¯ç›¸å…³çš„æ¶ˆæ¯
      if (event.data && event.data.type === 'AUTH_EXPIRED') {
        console.log('[Workspace] æ”¶åˆ°è®¤è¯è¿‡æœŸæ¶ˆæ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ');
        // æ¸…ç†æ‰€æœ‰æœ¬åœ°çŠ¶æ€
        clearAllLocalState();
        // è·³è½¬åˆ°ç™»å½•é¡µ
        window.location.href = event.data.redirect || '/admin/login.html';
      }
    });
  </script>
</body>
</html>

