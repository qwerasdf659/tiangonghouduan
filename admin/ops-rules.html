<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <%- include('partials/head', { 
    title: 'è¿è¥è§„åˆ™', 
    pageStyle: '[x-cloak] { display: none !important; } .tab-content-frame { border: none; width: 100%; min-height: calc(100vh - 180px); }' 
  }) %>
</head>
<body class="themed-bg-subtle min-h-screen">
  
  <!-- å¯¼èˆªæ  -->
  <nav class="themed-bg-primary text-white shadow-lg">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a href="/admin/workspace.html" class="hover:text-blue-200">â† è¿”å›å·¥ä½œå°</a>
        <span class="text-lg font-semibold">ğŸ“Š è¿è¥è§„åˆ™</span>
      </div>
    </div>
  </nav>

  <!-- é¡µé¢ä¸»ä½“ -->
  <div class="container mx-auto px-4 py-6" x-data="opsRulesPage()" x-init="init()">
    
    <!-- Tabå¯¼èˆª -->
    <div class="themed-card rounded-lg shadow mb-6">
      <div class="flex border-b overflow-x-auto">
        <template x-for="tab in tabs" :key="tab.id">
          <button 
            @click="switchTab(tab.id)"
            :class="currentTab === tab.id ? 'border-b-2 themed-border-primary themed-text-primary themed-bg-primary-light' : 'themed-text-muted themed-hover-bg'"
            class="px-6 py-3 font-medium whitespace-nowrap transition-colors"
            x-text="tab.icon + ' ' + tab.name"
          ></button>
        </template>
      </div>
    </div>

    <!-- Tabå†…å®¹åŒºåŸŸ -->
    <div class="themed-card rounded-lg shadow overflow-hidden">
      <!-- å®šä»·é…ç½® -->
      <div x-show="currentTab === 'pricing'" x-cloak>
        <iframe 
          src="/admin/pricing-config.html?embed=true" 
          class="tab-content-frame"
          x-ref="pricingFrame"
        ></iframe>
      </div>
      
      <!-- åŠŸèƒ½å¼€å…³ -->
      <div x-show="currentTab === 'feature-flags'" x-cloak>
        <iframe 
          src="/admin/feature-flags.html?embed=true" 
          class="tab-content-frame"
          x-ref="featureFlagsFrame"
        ></iframe>
      </div>
      
      <!-- æé†’è§„åˆ™ -->
      <div x-show="currentTab === 'reminder-rules'" x-cloak>
        <iframe 
          src="/admin/reminder-rules.html?embed=true" 
          class="tab-content-frame"
          x-ref="reminderRulesFrame"
        ></iframe>
      </div>
    </div>

  </div>

  <%- include('partials/footer') %>

  <script type="module">
    import { logger } from './src/utils/logger.js'
    import { Alpine, createPageMixin } from './src/alpine/index.js'

    document.addEventListener('alpine:init', () => {
      logger.info('[OpsRulesPage] æ³¨å†Œ Alpine ç»„ä»¶...')

      Alpine.data('opsRulesPage', () => ({
        ...createPageMixin(),

        // Tabé…ç½®
        tabs: [
          { id: 'pricing', name: 'å®šä»·é…ç½®', icon: 'ğŸ’°' },
          { id: 'feature-flags', name: 'åŠŸèƒ½å¼€å…³', icon: 'ğŸšï¸' },
          { id: 'reminder-rules', name: 'æé†’è§„åˆ™', icon: 'ğŸ””' }
        ],

        // å½“å‰é€‰ä¸­çš„Tab
        currentTab: 'pricing',

        init() {
          logger.info('[OpsRulesPage] é¡µé¢åˆå§‹åŒ–')
          if (!this.checkAuth()) return

          // ä»URLå‚æ•°è¯»å–åˆå§‹Tab
          const urlParams = new URLSearchParams(window.location.search)
          const tabParam = urlParams.get('tab')
          if (tabParam && this.tabs.some(t => t.id === tabParam)) {
            this.currentTab = tabParam
          }
        },

        switchTab(tabId) {
          this.currentTab = tabId
          // æ›´æ–°URLå‚æ•°
          const url = new URL(window.location)
          url.searchParams.set('tab', tabId)
          window.history.pushState({}, '', url)
          logger.info('[OpsRulesPage] åˆ‡æ¢Tab:', tabId)
        }
      }))

      logger.info('[OpsRulesPage] Alpine ç»„ä»¶å·²æ³¨å†Œ')
    })
  </script>
</body>
</html>

