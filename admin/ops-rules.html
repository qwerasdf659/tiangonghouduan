<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <%- include('partials/head', { 
    title: 'è¿è¥è§„åˆ™', 
    pageStyle: '[x-cloak] { display: none !important; } .tab-content-frame { border: none; width: 100%; min-height: calc(100vh - 180px); }' 
  }) %>
</head>
<body class="themed-bg-subtle min-h-screen">
  
  <!-- é¡µé¢é¡¶éƒ¨æ¸å˜æ¨ªå¹… -->
  <div class="page-banner">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div>
        <div class="flex items-center gap-3 mb-1">
          <a href="/admin/workspace.html" class="text-blue-200 hover:text-white text-sm transition">â† è¿”å›å·¥ä½œå°</a>
        </div>
        <h1>ğŸ“Š è¿è¥è§„åˆ™</h1>
        <p>ç®¡ç†ç§¯åˆ†å®šä»·ã€åŠŸèƒ½ç°åº¦å¼€å…³å’Œè¿è¥æé†’è§„åˆ™ï¼Œç²¾ç»†åŒ–æ§åˆ¶ä¸šåŠ¡è¿è¥ç­–ç•¥</p>
      </div>
      <div class="text-6xl opacity-20">âš™ï¸</div>
    </div>
  </div>

  <!-- é¡µé¢ä¸»ä½“ -->
  <div class="container mx-auto px-4 py-6" x-data="opsRulesPage()" x-init="init()">
    
    <!-- Tabå¯¼èˆª -->
    <div class="enhanced-tabs mb-6">
      <template x-for="tab in tabs" :key="tab.id">
        <button 
          @click="switchTab(tab.id)"
          :class="currentTab === tab.id ? 'tab-item active' : 'tab-item'"
          x-text="tab.icon + ' ' + tab.name"
        ></button>
      </template>
    </div>

    <!-- Tabå†…å®¹åŒºåŸŸ -->
    <div class="themed-card rounded-xl shadow-sm overflow-hidden">
      <!-- å®šä»·é…ç½® -->
      <div x-show="currentTab === 'pricing'" x-cloak>
        <iframe 
          src="/admin/pricing-config.html?embed=true" 
          class="tab-content-frame"
          x-ref="pricingFrame"
        ></iframe>
      </div>
      
      <!-- åŠŸèƒ½å¼€å…³ -->
      <div x-show="currentTab === 'feature-flags'" x-cloak>
        <iframe 
          src="/admin/feature-flags.html?embed=true" 
          class="tab-content-frame"
          x-ref="featureFlagsFrame"
        ></iframe>
      </div>
      
      <!-- æé†’è§„åˆ™ -->
      <div x-show="currentTab === 'reminder-rules'" x-cloak>
        <iframe 
          src="/admin/reminder-rules.html?embed=true" 
          class="tab-content-frame"
          x-ref="reminderRulesFrame"
        ></iframe>
      </div>
    </div>

  </div>

  <%- include('partials/footer') %>

  <script type="module">
    import { logger } from './src/utils/logger.js'
    import { Alpine, createPageMixin } from './src/alpine/index.js'

    document.addEventListener('alpine:init', () => {
      logger.info('[OpsRulesPage] æ³¨å†Œ Alpine ç»„ä»¶...')

      Alpine.data('opsRulesPage', () => ({
        ...createPageMixin(),

        // Tabé…ç½®
        tabs: [
          { id: 'pricing', name: 'å®šä»·é…ç½®', icon: 'ğŸ’°' },
          { id: 'feature-flags', name: 'åŠŸèƒ½å¼€å…³', icon: 'ğŸšï¸' },
          { id: 'reminder-rules', name: 'æé†’è§„åˆ™', icon: 'ğŸ””' }
        ],

        // å½“å‰é€‰ä¸­çš„Tab
        currentTab: 'pricing',

        init() {
          logger.info('[OpsRulesPage] é¡µé¢åˆå§‹åŒ–')
          if (!this.checkAuth()) return

          // ä»URLå‚æ•°è¯»å–åˆå§‹Tab
          const urlParams = new URLSearchParams(window.location.search)
          const tabParam = urlParams.get('tab')
          if (tabParam && this.tabs.some(t => t.id === tabParam)) {
            this.currentTab = tabParam
          }
        },

        switchTab(tabId) {
          this.currentTab = tabId
          // æ›´æ–°URLå‚æ•°
          const url = new URL(window.location)
          url.searchParams.set('tab', tabId)
          window.history.pushState({}, '', url)
          logger.info('[OpsRulesPage] åˆ‡æ¢Tab:', tabId)
        }
      }))

      logger.info('[OpsRulesPage] Alpine ç»„ä»¶å·²æ³¨å†Œ')
    })
  </script>
</body>
</html>

