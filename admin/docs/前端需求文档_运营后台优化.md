# 📱 前端需求文档 - Admin运营后台优化

> **文档版本**：v1.1  
> **创建日期**：2026年2月3日  
> **更新日期**：2026年2月3日  
> **来源文档**：运营后台优化方案.md v1.8  
> **前端总工时**：51.5天  
> **技术栈**：Alpine.js + Vite + Tailwind CSS + ECharts

---

## 〇、技术评估与现有代码对照

### 0.1 技术栈兼容性 ✅ 完全匹配

| 需求技术栈 | 实际项目版本 | 状态 |
|-----------|-------------|------|
| Alpine.js | ^3.15.4 | ✅ 完全匹配 |
| Vite | ^6.4.1 | ✅ 完全匹配 |
| Tailwind CSS | ^3.4.19 | ✅ 完全匹配 |
| ECharts | ^6.0.0 | ✅ 完全匹配 |
| WebSocket | Socket.IO-client ^4.8.3 | ✅ **超出预期** |

### 0.2 现有页面与需求对照

#### 🟢 可直接增强的现有页面（8个）

| 需求功能 | 现有页面 | 需增强内容 | 复用度 |
|---------|---------|-----------|-------|
| 待办总览 | `pending-center.html` | 统计卡片、健康度条、紧急区 | **80%** |
| 消费审核批量 | `finance-management.html` | 批量选择、浮动操作栏 | **60%** |
| 消费审核超时 | `finance-management.html` | 超时样式、倒计时 | **90%** |
| 仪表盘健康度 | `dashboard-panel.html` | 健康度卡片、评分展示 | **50%** |
| 仪表盘预算预测 | `dashboard-panel.html` | 趋势图表、预测算法 | **50%** |
| 消息中心增强 | `message-center.html` | 实时推送、批量操作 | **70%** |
| 侧边栏健康灯 | `sidebar-nav.js` | 健康状态指示灯 | **90%** |
| 快捷键支持 | `keyboard-shortcuts.js` | 添加新快捷键映射 | **95%** |

#### 🟡 需要新建的页面（4个）

| 需求页面 | 建议文件名 | 主要功能 | 复杂度 |
|---------|-----------|---------|-------|
| 资产流动 | `asset-flow.html` | 资产流向桑基图、来源分析 | **高** |
| 操作审计 | `audit-logs.html` | 操作日志、人员统计 | **中** |
| 转化漏斗 | `conversion-funnel.html` | 漏斗图表、转化率 | **中** |
| 商户贡献度 | `merchant-contribution.html` | 贡献排名、环形图 | **中** |

### 0.3 可复用Alpine.js组件清单（24个）

```
admin/src/alpine/components/
├── data-table.js          # 🎯 批量操作、排序、分页 - 消费审核可直接复用
├── modal.js               # 🎯 弹窗 - 所有弹窗场景复用
├── pagination.js          # 🎯 分页 - 所有列表页复用
├── toast.js               # 🎯 消息提示 - 操作反馈复用
├── empty-state.js         # 🎯 空状态 - 空状态展示复用
├── stats-cards.js         # 🎯 统计卡片 - 健康度卡片基础
├── filter-bar.js          # 🎯 筛选栏 - 列表筛选复用
├── notification-center.js # 🎯 通知中心 - 消息中心基础
├── keyboard-shortcuts.js  # 🎯 快捷键 - 扩展G+P/G+D即可
├── mini-chart.js          # 🎯 迷你图表 - 趋势图基础
├── animated-counter.js    # 🎯 动画计数器 - 统计数字动效
├── virtual-list.js        # 🎯 虚拟滚动 - 大数据列表
├── workspace-tabs.js      # 🎯 Tab管理 - 多Tab支持
├── sidebar-nav.js         # 🎯 侧边栏 - 已有徽标系统
├── form-validation.js     # 表单验证
├── file-upload.js         # 文件上传
├── image-loader.js        # 图片加载
├── infinite-scroll.js     # 无限滚动
├── resizable-columns.js   # 可调整列宽
├── page-transitions.js    # 页面过渡
├── theme-switcher.js      # 主题切换
├── admin-page.js          # 页面基础组件
└── function-card.js       # 功能卡片
```

### 0.4 现有API模块

```
admin/src/api/
├── base.js      # API基础封装（authHeaders, handleResponse）
├── pending.js   # 待处理API（已实现 getSummary, getList）
├── finance.js   # 财务API
├── lottery.js   # 抽奖API
├── user.js      # 用户API
└── ...
```

### 0.5 侧边栏结构对照

**现有结构（sidebar-nav.js 已符合需求）**：
```javascript
navGroups: [
  { id: 'pending-center', name: '待处理中心', ... },  // ✅ 已置顶
  { id: 'dashboard', name: '运营仪表盘', ... },
  { id: 'lottery-ops', name: '抽奖运营', ... },
  { id: 'asset-trade', name: '资产交易', ... },
  { id: 'users', name: '用户门店', ... },
  { id: 'analytics', name: '数据分析', ... },
  { id: 'system', name: '系统设置', ... }
]
```

**已有功能**：
- ✅ 待处理中心已置顶
- ✅ 包含消费审核、客服、风控告警、抽奖告警
- ✅ 已有徽标数量系统（`badgeKey` + `fetchAllBadgeCounts`）
- ⚠️ 需添加：健康度指示灯

---

## 0.6 🎯 关键决策确认（已拍板）

> **决策日期**：2026年2月3日

### ✅ 决策1：页面命名确认

| 需求文档命名 | 现有项目命名 | 最终决策 |
|-------------|-------------|---------|
| `pending-overview.html` | `pending-center.html` | **直接增强现有页面，不新建** |

### ✅ 决策2：告警中心结构

**最终决策**：**A. 保持现状** - 两个独立页面（`risk-alerts.html` + `lottery-alerts.html`），分别增强

| 方案 | 说明 | 决策 |
|-----|------|------|
| ~~B. 合并为一个~~ | ~~新建 alert-center.html~~ | ❌ 不采用 |
| **A. 保持现状** | 两个独立页面，分别增强 | ✅ **采用** |

### ✅ 决策3：数据驾驶舱结构

**最终决策**：**完全合并为6个Tab**

```
📊 数据驾驶舱 (dashboard-panel.html)
├── 运营大盘 Tab      ← 现有仪表盘内容
├── 抽奖分析 Tab      ← 抽奖趋势、中奖分布
├── 用户分析 Tab      ← 用户行为、活跃度
├── 资产流动 Tab      ← 资产进出全貌（含桑基图）
├── 转化漏斗 Tab      ← 用户转化分析
└── 商户贡献度 Tab    ← 商户排名、健康度
```

**影响**：
- ❌ 不新建 `conversion-funnel.html`（作为Tab）
- ❌ 不新建 `merchant-contribution.html`（作为Tab）
- ❌ 不新建 `asset-flow.html`（作为Tab）
- ✅ 统一在 `dashboard-panel.html` 中实现多Tab

### ✅ 决策4：系统设置三级分组

**最终决策**：**按此结构调整侧边栏**

```
⚙️ 系统设置 (3个子分组)
├── 🎁 奖品配置
│   ├── 物品模板
│   ├── 物料转换规则
│   └── 资产组合
├── 📊 运营规则
│   ├── 定价配置
│   ├── 功能开关
│   └── 提醒规则配置
└── 🔧 系统维护
    ├── 内容管理
    ├── 字典管理
    ├── 系统配置
    ├── 会话管理
    └── 高级工具
```

### ✅ 决策5：资产流动图表类型

**最终决策**：**A. 使用桑基图**

| 方案 | 说明 | 决策 |
|-----|------|------|
| **A. 使用桑基图** | 视觉效果好，ECharts支持 | ✅ **采用** |
| ~~B. 简化为表格~~ | ~~开发快但视觉一般~~ | ❌ 不采用 |

---

## 一、工时总览

| 阶段 | 时间范围 | 前端工时 | 核心产出 |
|------|----------|----------|----------|
| P0 | 本周 | 7.5天 | 待办总览+批量操作+健康度+自动刷新+指示灯 |
| P1 | 2周内 | 21.5天 | 用户360°视图+预算预测+消息中心+快捷键+API监控等 |
| P2 | 1月内 | 15天 | 资产流动+数据驾驶舱+审计+数据导出等 |
| P3 | 2月内 | 7.5天 | 转化漏斗+商户贡献度+系统设置优化 |
| **总计** | **2.5-3月** | **51.5天** | **完整方案落地** |

---

## 二、P0 - 立即实施（本周，7.5天）

### 2.1 新增"待办总览"入口页（2天）

**文件路径**：`pending-center.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `pendingCenterPage()` Alpine组件
- 已有紧急事项区域 `urgentItems`
- 已有筛选器 `filter.type`、`filter.urgency`
- 已有分页和排序功能
- 需增强：健康度条、统计卡片、批量操作

**页面布局**：

```
┌─────────────────────────────────────────────────────────┐
│  🔔 待处理中心                          最后更新: 10:30 │
├─────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────┐   │
│  │  📊 待办健康度: 45/100  🔴 需要立即处理          │   │
│  │  ▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐           │
│  │ 📋 379 │ │ 💬 11  │ │ ⚠️ 0   │ │ 🎰 0   │           │
│  │内容审核│ │客服会话│ │风控告警│ │抽奖告警│           │
│  │🔴🔴积压│ │🟡5即将│ │ ✅     │ │ ✅     │           │
│  │[批量处理]│[接入最早]│         │         │           │
│  └────────┘ └────────┘ └────────┘ └────────┘           │
├─────────────────────────────────────────────────────────┤
│  🚨 紧急待办（超时+即将超时）           [全部处理超时] │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 🔴 [消费] ¥188.00 - 超时1小时 - [处理] [跳过]  │   │
│  │ 🟡 [客服] 用户咨询 - 15分钟后超时 - [接入]     │   │
│  │ ...                                              │   │
│  └─────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  📋 全部待办        [类型▼] [紧急度▼] [排序▼] [刷新]  │
│  ☑ 全选    [批量通过] [批量拒绝] [批量处理]           │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ☐ | 类型     | 标题     | 等待时间 | 状态 | 操作│   │
│  │ ☑ | 消费审核 | ¥188.00 | 25小时   | 超时 | 处理│   │
│  │ ☑ | 客服会话 | 用户咨询 | 45分钟   | 超时 | 接入│   │
│  │ ☐ | 消费审核 | ¥56.00  | 12小时   | 正常 | 处理│   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

**功能需求**：

| 功能点 | 说明 | 验收标准 |
|--------|------|----------|
| 顶部健康条 | 待办健康度评分（0-100） | 显示进度条+数字+状态颜色 |
| 4个统计卡片 | 消费审核/客服/风控/抽奖告警 | 显示数量+超时数+快捷操作按钮 |
| 紧急待办区 | 超时/即将超时列表 | 红色/黄色状态区分，支持快捷操作 |
| 全部待办区 | 统一列表+筛选+排序 | 支持类型/紧急度筛选，时间/状态排序 |
| 批量操作 | 全选+批量通过/拒绝 | 勾选后显示操作按钮，操作后刷新列表 |

**数据来源**：
- API: `GET /api/v4/console/pending/stats` - 获取待办统计
- API: `GET /api/v4/console/pending/list` - 获取待办列表
- API: `POST /api/v4/console/pending/batch` - 批量操作

**状态颜色规则**：

| 状态 | 颜色 | 条件 |
|------|------|------|
| 超时 | 🔴 红色 | 等待时间 > 阈值 |
| 即将超时 | 🟡 黄色 | 等待时间 > 阈值×0.5 |
| 正常 | 🟢 绿色 | 等待时间 < 阈值×0.5 |

---

### 2.2 待办总览增加健康度评分（1天）

**组件位置**：`pending-center.html` 顶部 ← ✅ **增强现有页面**

**可复用组件**：`stats-cards.js`（统计卡片基础样式）

**健康度计算公式**：

```javascript
健康度 = 100 - 超时扣分 - 积压扣分

超时扣分 = min(50, 超时数量 × 10)
积压扣分 = min(50, (待办总数 - 基准值) / 基准值 × 50)

// 基准值：消费审核=10条，客服=5条，告警=0条
// 健康度最低为0，不出现负数
// 数据获取失败时显示"--"
```

**健康度状态展示**：

| 分数范围 | 状态 | 颜色 | CSS Class |
|----------|------|------|-----------|
| 90-100 | 优秀 | 🟢 绿色 | `bg-green-500` |
| 70-89 | 良好 | 🟡 黄色 | `bg-yellow-500` |
| 50-69 | 警告 | 🟠 橙色 | `bg-orange-500` |
| 0-49 | 危险 | 🔴 红色 | `bg-red-500` |

**UI组件**：

```html
<!-- 健康度卡片 -->
<div class="health-score-card">
  <div class="score-value">
    <span class="number">45</span>
    <span class="total">/100</span>
  </div>
  <div class="status-badge danger">需要立即处理</div>
  <div class="progress-bar">
    <div class="progress" style="width: 45%"></div>
  </div>
</div>
```

---

### 2.3 消费审核增加批量操作（1天）

**文件路径**：`finance-management.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `financeNavigation()` Alpine组件
- 已有消费审核Tab `current_page === 'consumption'`
- 已有 `selectedIds` 批量选择数组
- 已有 `approveConsumption`、`rejectConsumption` 方法
- 需增强：浮动操作栏、批量操作API调用

**可复用组件**：`data-table.js`（批量选择逻辑）

**新增功能**：

| 功能 | 说明 | 交互 |
|------|------|------|
| 批量选择 | 表头全选复选框+每行复选框 | 勾选后底部浮动操作栏 |
| 批量通过 | 一键批量通过选中记录 | 二次确认弹窗 |
| 批量拒绝 | 一键批量拒绝选中记录 | 需填写拒绝原因 |
| 门店信息展示 | 列表显示消费门店名称 | 新增表格列 |
| 异常标记展示 | 显示anomaly_flags和anomaly_score | 分数>70红色高亮 |
| 快速筛选 | 按门店/金额范围/异常分数筛选 | 筛选条件联动 |

**批量操作栏布局**：

```
┌─────────────────────────────────────────────────────────┐
│  已选择 5 条记录    [批量通过] [批量拒绝] [取消选择]   │
└─────────────────────────────────────────────────────────┘
```

**数据来源**：
- API: `POST /api/v4/console/finance/batch-approve` - 批量通过
- API: `POST /api/v4/console/finance/batch-reject` - 批量拒绝

---

### 2.4 消费审核增加超时高亮（0.5天）

**文件路径**：`finance-management.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `anomalyStats` 异常统计
- 已有 `formatWaitingTime` 等待时间格式化（在pending-center中）
- 需增强：根据等待时间动态添加背景色

**超时规则**：

| 状态 | 条件 | 样式 |
|------|------|------|
| 严重超时 | 等待时间 > 48小时 | 红色背景 `bg-red-100` + 红色文字 |
| 超时 | 等待时间 > 24小时 | 橙色背景 `bg-orange-100` |
| 即将超时 | 等待时间 > 12小时 | 黄色背景 `bg-yellow-50` |
| 正常 | 等待时间 ≤ 12小时 | 无特殊样式 |

**实现要点**：
- 计算等待时间：`当前时间 - created_at`
- 列表行根据等待时间动态添加背景色class
- 等待时间列显示人类可读格式（如"25小时前"）

---

### 2.5 仪表盘增加业务健康度（1天）

**文件路径**：`dashboard-panel.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `dashboardPanelPage()` Alpine组件
- 已有核心指标区域 `stats`（抽奖次数、新增用户、中奖率等）
- 已有7日趋势图表 `trend-chart`
- 已有实时告警区域 `alerts`
- 已有预算列表 `budgetList`
- 需增强：健康度评分卡片、各维度分数

**可复用组件**：
- `stats-cards.js`（统计卡片）
- `mini-chart.js`（迷你图表）

**健康度卡片布局**：

```
┌─────────────────────────────────────────────────────────┐
│  📊 业务健康度                              [查看详情] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│     ┌───────────────────────────────────────┐          │
│     │           85                          │          │
│     │         /100                          │          │
│     │        🟢 良好                        │          │
│     └───────────────────────────────────────┘          │
│                                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │待办积压 │ │预算消耗 │ │库存健康 │ │系统稳定 │      │
│  │ 85/100  │ │ 90/100  │ │ 78/100  │ │ 95/100  │      │
│  │  30%    │ │  20%    │ │  20%    │ │  15%    │      │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
│  ⚠️ 待办积压偏高，建议优先处理消费审核                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**健康度计算维度**：

| 维度 | 权重 | 说明 |
|------|------|------|
| 待办积压 | 30% | 待办超时率反推 |
| 预算消耗 | 20% | 剩余预算占比 |
| 库存健康 | 20% | 各奖品库存充足度 |
| 系统稳定 | 15% | API响应时间、错误率 |
| 用户活跃 | 15% | DAU环比变化 |

**数据来源**：
- API: `GET /api/v4/console/dashboard/health-score` - 健康度评分

**交互**：
- 点击各维度小卡片展开详情弹窗
- 健康度低于70时显示警告提示

---

### 2.6 待办30秒自动刷新（0.5天）

**文件路径**：`pending-center.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `lastUpdateTime` 最后更新时间
- 已有 `loadData()` 数据加载方法
- 需增强：自动刷新定时器、刷新开关

**功能需求**：

| 功能 | 说明 |
|------|------|
| 自动刷新 | 每30秒自动刷新待办列表和统计数据 |
| 可配置开关 | 右上角开关控制是否自动刷新 |
| 刷新指示 | 显示"最后更新: HH:mm:ss"时间戳 |
| 刷新动画 | 刷新时显示loading状态 |

**实现代码示例**：

```javascript
// Alpine.js 组件
Alpine.data('pendingOverview', () => ({
  autoRefresh: true,
  lastUpdate: null,
  refreshInterval: null,
  
  init() {
    this.startAutoRefresh();
  },
  
  startAutoRefresh() {
    if (this.refreshInterval) clearInterval(this.refreshInterval);
    if (this.autoRefresh) {
      this.refreshInterval = setInterval(() => {
        this.fetchData();
      }, 30000);
    }
  },
  
  toggleAutoRefresh() {
    this.autoRefresh = !this.autoRefresh;
    this.startAutoRefresh();
  },
  
  async fetchData() {
    // 刷新逻辑
    this.lastUpdate = new Date().toLocaleTimeString();
  }
}));
```

---

### 2.7 侧边栏健康度指示灯（0.5天）

**文件路径**：
- `src/alpine/components/sidebar-nav.js` ← ✅ **已存在，增强现有组件**
- `src/templates/partials/sidebar.ejs` ← ✅ **已存在，添加HTML结构**

**现有代码基础**：
- 已有 `sidebarNav()` Alpine组件
- 已有 `fetchAllBadgeCounts()` 徽标数量获取
- 已有 `totalPendingCount` 等徽标变量
- 需增强：健康度分数获取、指示灯渲染

**布局位置**：Logo下方

```
┌────────────────────────────────────────┐
│  🏢 Logo                               │
│  ┌────────────────────────────────┐   │
│  │ 🟢 健康度: 85                   │   │  ← 鼠标悬浮显示详细分数
│  └────────────────────────────────┘   │
└────────────────────────────────────────┘
```

**功能需求**：

| 功能 | 说明 |
|------|------|
| 状态指示灯 | 绿/黄/红三色根据健康度显示 |
| 数字展示 | 显示健康度分数 |
| 悬浮详情 | 鼠标悬浮显示各维度分数 |
| 点击跳转 | 点击跳转到仪表盘页面 |

**颜色规则**：
- 🟢 绿色：健康度 ≥ 70
- 🟡 黄色：健康度 50-69
- 🔴 红色：健康度 < 50

---

## 三、P1 - 短期实施（2周内，21.5天）

### 3.1 用户360°视图抽屉（4天）

**文件路径**：
- `user-management.html` ← ✅ **已存在，增强触发逻辑**
- 新建 `src/alpine/components/user-drawer.js` ← 🟡 **需新建组件**

**可复用组件**：
- `modal.js`（弹窗/抽屉基础）
- `pagination.js`（Tab内列表分页）
- `data-table.js`（记录列表）

**触发方式**：点击用户列表中的用户名

**抽屉布局**：

```
┌─────────────────────────────────────────────────────────┐
│  👤 用户详情：张三 (ID: 123)              [×] 关闭     │
├─────────────────────────────────────────────────────────┤
│  [基本信息] [抽奖记录] [消费记录] [资产明细] [行为轨迹] │
├─────────────────────────────────────────────────────────┤
│  📊 基本信息                                            │
│  ├── 注册时间: 2025-12-01                              │
│  ├── 角色: user (权限等级: 0)                          │
│  ├── 风控等级: 正常                                     │
│  └── 累计消费: ¥1,234.00                               │
│                                                        │
│  🎰 近期抽奖（最近10次）                               │
│  ├── 2026-02-02 14:30 - 中奖：红宝石×1                │
│  ├── 2026-02-02 14:28 - 中奖：积分×100               │
│  └── ...                                               │
│                                                        │
│  [导出分析报告] [添加风控标记] [查看完整详情]          │
└─────────────────────────────────────────────────────────┘
```

**5个Tab内容**：

| Tab | 内容 | 数据来源 |
|-----|------|----------|
| 基本信息 | 用户信息+风险画像 | `users` + `user_risk_profiles` |
| 抽奖记录 | 抽奖历史列表（可展开详情） | `lottery_draws` |
| 消费记录 | 消费历史列表（可展开详情） | `consumption_records` |
| 资产明细 | 资产余额+流水明细 | `account_asset_balances` + `asset_transactions` |
| 行为轨迹 | 登录/抽奖/消费时间线 | `user_behavior_tracks` |

**底部操作按钮**：
- 导出分析报告：生成用户分析PDF
- 添加风控标记：打开风控标记弹窗
- 查看完整详情：跳转到用户详情页

**抽屉尺寸**：宽度480px，高度100vh

---

### 3.2 仪表盘增加预算预测（1天）

**文件路径**：`dashboard-panel.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `budgetList` 预算列表
- 已有 ECharts 趋势图表
- 需增强：预测算法、趋势图扩展

**可复用组件**：`mini-chart.js`（趋势图基础）

**预算预测卡片布局**：

```
┌─────────────────────────────────────────────────────────┐
│  💰 预算消耗预测                          [查看详情]   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  当前预算: ¥100,000    已消耗: ¥65,000 (65%)          │
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░ 65%   │
│                                                         │
│  📊 预测分析                                            │
│  ├── 日均消耗: ¥2,166                                  │
│  ├── 预计剩余天数: 16天                                │
│  └── 预计耗尽日期: 2026-02-19                          │
│                                                         │
│  [预算趋势图 - 折线图展示过去7天消耗+未来7天预测]      │
│                                                         │
│  ⚠️ 预算剩余不足3天时告警                              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**数据来源**：
- API: `GET /api/v4/console/dashboard/budget-forecast`

---

### 3.3 抽奖管理预设可视化（2天）

**文件路径**：`lottery-management.html`

**预设队列可视化布局**：

```
┌─────────────────────────────────────────────────────────┐
│  🎯 预设队列状态                    共 27 个活跃预设   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │ 🟢 活跃 │ │ 🟡 暂停 │ │ 🔴 耗尽 │ │ ⚪ 过期 │      │
│  │   20    │ │    3    │ │    2    │ │    2    │      │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
│  📋 预设列表                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 预设名称  | 状态 | 剩余次数 | 触发条件 | 操作  │   │
│  │ 新用户首抽| 🟢   | 1000次   | 首次抽奖 | [编辑]│   │
│  │ 高价值用户| 🟢   | 500次    | 消费>500 | [编辑]│   │
│  │ ...                                              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**数据来源**：
- API: `GET /api/v4/console/lottery/presets`

---

### 3.4 消息中心页面（2天）

**文件路径**：`message-center.html` ← ✅ **已存在，增强现有页面**

**现有代码基础**：
- 已有 `messageCenterPage()` Alpine组件
- 已有消息类型筛选 `filter.type`
- 已有批量选择 `selectedIds`
- 已有消息详情弹窗 `detailModal`
- 已有声音开关 `soundEnabled`
- 需增强：WebSocket实时推送、更多筛选项

**可复用组件**：
- `notification-center.js`（通知基础）
- `data-table.js`（批量操作）

**页面布局**：

```
┌─────────────────────────────────────────────────────────┐
│  📬 消息中心                   [全部标记已读] [设置]   │
├─────────────────────────────────────────────────────────┤
│  [全部(25)] [未读(8)] [系统通知] [提醒通知] [告警通知] │
├─────────────────────────────────────────────────────────┤
│  ☑ 全选    [批量标记已读] [批量删除]                   │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ☐ 🔴 [系统] 系统维护通知 - 2小时前 - [查看]    │   │
│  │ ☐ 🟡 [提醒] 待办超时提醒 - 30分钟前 - [处理]   │   │
│  │ ☑ ⚪ [告警] 库存不足告警 - 1天前 - [已读]      │   │
│  │ ...                                              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  分页: [< 上一页] 1 2 3 ... 10 [下一页 >]             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**功能需求**：

| 功能 | 说明 |
|------|------|
| 通知列表 | 分类展示系统/提醒/告警通知 |
| 已读/未读 | 状态标记和管理 |
| 批量操作 | 全部标记已读、批量删除 |
| 筛选功能 | 按类型、时间范围筛选 |
| 通知详情 | 点击查看详情并跳转相关页面 |

**数据来源**：
- API: `GET /api/v4/console/notifications`
- API: `POST /api/v4/console/notifications/mark-read`

---

### 3.5 智能提醒规则配置（1天）

**文件路径**：`reminder-rules.html`

**功能**：配置智能提醒规则的阈值和通知方式

**需配置的规则**：

| 规则 | 默认阈值 | 通知方式 |
|------|----------|----------|
| 消费审核超时 | 24小时 | 站内+徽标+弹窗 |
| 客服等待超时 | 30分钟 | 实时弹窗 |
| 预算超90% | 90% | 弹窗告警 |
| 库存不足 | 10件 | 侧边栏标记 |
| 健康度低于70 | 70分 | 弹窗告警 |

---

### 3.6 时间对比功能（1天）

**文件路径**：`dashboard-panel.html`

**时间对比卡片**：

```
┌─────────────────────────────────────────────────────────┐
│  📅 时间对比                                            │
├─────────────────────────────────────────────────────────┤
│  ┌───────────────────┐ ┌───────────────────┐           │
│  │ 今日 vs 昨日      │ │ 本周 vs 上周      │           │
│  │                   │ │                   │           │
│  │ 抽奖: 179 (+9.1%)🟢│ 抽奖: 1055 (+15%)🟢│           │
│  │ 消费: 12 (-5.2%)🔴│ │ 消费: 48 (+8.5%)🟢│           │
│  │ 新增: 3 (+50%)🟢  │ │ 新增: 15 (-10%)🔴│           │
│  └───────────────────┘ └───────────────────┘           │
└─────────────────────────────────────────────────────────┘
```

**规则**：
- 环比变化>30%标红
- 正增长显示🟢，负增长显示🔴

---

### 3.7 快捷键支持（1天）

**文件路径**：`src/alpine/components/keyboard-shortcuts.js` ← ✅ **已存在，扩展现有组件**

**现有代码基础**：
- 已有 `DEFAULT_SHORTCUTS` 快捷键配置
- 已有 `handleGlobalKey()` 全局键盘监听
- 已有 `executeAction()` 动作执行
- 已有 `openGlobalSearch()`、`triggerRefresh()` 等方法
- 需增强：添加 G+P、G+D 组合键，添加 Ctrl+Shift+R

**全局快捷键**：

| 快捷键 | 功能 | 实现说明 |
|--------|------|----------|
| `G` + `P` | 跳转待处理中心 | 按下G后500ms内按P触发 |
| `G` + `D` | 跳转数据驾驶舱 | 按下G后500ms内按D触发 |
| `/` | 全局搜索 | ✅ **已实现**，唤起搜索框 |
| `Ctrl+Shift+R` | 强制刷新 | 跳过缓存刷新当前页数据 |
| `Escape` | 关闭弹窗 | ✅ **已实现** |

**实现代码示例**：

```javascript
// 全局快捷键监听
document.addEventListener('keydown', (e) => {
  // G + P/D 组合键
  if (e.key === 'g' || e.key === 'G') {
    window.waitingForSecondKey = true;
    setTimeout(() => { window.waitingForSecondKey = false; }, 500);
  }
  
  if (window.waitingForSecondKey) {
    if (e.key === 'p' || e.key === 'P') {
      window.location.href = '/pending-overview.html';
    } else if (e.key === 'd' || e.key === 'D') {
      window.location.href = '/dashboard-panel.html';
    }
  }
  
  // / 全局搜索
  if (e.key === '/' && !e.target.matches('input, textarea')) {
    e.preventDefault();
    openGlobalSearch();
  }
  
  // Ctrl+Shift+R 强制刷新
  if (e.ctrlKey && e.shiftKey && e.key === 'R') {
    e.preventDefault();
    forceRefresh();
  }
});
```

---

### 3.8 API响应时间监控（0.5天）

**文件路径**：`dashboard-panel.html`

**API监控卡片**：

```
┌─────────────────────────────────────────────────────────┐
│  🔌 系统健康状态                                        │
├─────────────────────────────────────────────────────────┤
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                   │
│  │ 🟢 API  │ │ 🟢 DB   │ │ 🟢 Redis│                   │
│  │ 120ms   │ │ 连接正常│ │ 连接正常│                   │
│  └─────────┘ └─────────┘ └─────────┘                   │
│                                                         │
│  ⚠️ 慢接口告警：                                        │
│  • /api/v4/lottery/draw - 平均 3.2秒 🔴                │
└─────────────────────────────────────────────────────────┘
```

**规则**：
- API响应 >3秒 标红
- 显示最近1小时平均响应时间

---

### 3.9 告警中心Tab顺序调整（0.5天）

**文件路径**：`alert-center.html`

**调整后Tab顺序**：

```
[全部(5)] [🔴紧急(2)] [风控] [抽奖] [系统]
```

**说明**：
- 原顺序：风控→抽奖→系统→全部
- 新顺序：全部→紧急→风控→抽奖→系统
- 先看全部掌握整体，再看紧急优先处理

---

### 3.10 系统垫付看板（1天）

**文件路径**：`lottery-management.html`

**垫付看板布局**：

```
┌─────────────────────────────────────────────────────────┐
│  💳 系统垫付汇总                                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  总垫付金额: ¥12,500                                   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 预设名称  | 垫付类型 | 垫付金额 | 产生时间      │   │
│  │ 新用户首抽| 库存     | ¥5,000  | 2026-02-01    │   │
│  │ 高价值用户| 预算     | ¥7,500  | 2026-02-02    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**数据来源**：
- `preset_inventory_debt`
- `preset_budget_debt`

---

### 3.11 中奖率趋势图（0.5天）

**文件路径**：`lottery-management.html`

**趋势图**：使用ECharts折线图展示

```
┌─────────────────────────────────────────────────────────┐
│  📈 中奖率趋势                    时间范围: [近7天▼]   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [ECharts折线图：按小时/天展示中奖率变化]              │
│                                                         │
│  基准线: 100%                                           │
│  告警线: 110%/50%                                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### 3.12 数据刷新策略实现（1天）

**实现WebSocket推送+轮询降级机制**

**WebSocket事件**：

| 事件名 | 触发场景 | 前端响应 |
|--------|----------|----------|
| `pending.new` | 新增待办 | 更新徽标+Toast |
| `pending.resolved` | 待办已处理 | 更新徽标 |
| `alert.triggered` | 新告警 | 弹窗+更新告警中心 |
| `health.changed` | 健康度变化 | 更新指示灯 |

**降级策略**：
- WebSocket断开时自动切换为30秒轮询
- 显示黄色提示条："实时连接已断开，数据每30秒更新"

---

### 3.13 角色权限矩阵（1天）

**实现前端权限控制**

**页面访问权限检查**：

```javascript
// 权限检查工具
const PermissionManager = {
  canAccess(page) {
    const userRole = getCurrentUserRole();
    const permissions = getPagePermissions(page);
    return permissions.includes(userRole);
  },
  
  canOperate(operation) {
    const userRole = getCurrentUserRole();
    const permissions = getOperationPermissions(operation);
    return permissions.includes(userRole);
  }
};

// 页面加载时检查
if (!PermissionManager.canAccess('lottery-management')) {
  showAccessDenied();
}
```

**权限不足UI**：

```
┌─────────────────────────────────────────────────────────┐
│  🔒 访问受限                                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  您当前的角色（ops）没有访问此页面的权限。              │
│                                                         │
│  如需访问，请联系管理员升级您的权限等级。               │
│                                                         │
│  [返回首页]  [联系管理员]                               │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

### 3.14 空状态正向反馈（0.5天）

**空状态文案设计**：

| 模块 | 图标 | 文案 | 操作 |
|------|------|------|------|
| 待办总览 | 🎉 | "所有待办已处理完毕，休息一下吧！" | [查看历史] |
| 消费审核 | ✅ | "暂无待审核的消费记录" | [查看已审核] |
| 客服工作台 | 😊 | "当前没有等待中的用户会话" | [查看历史] |
| 告警中心 | 🛡️ | "系统运行正常，暂无告警" | [查看历史] |

**健康度满分展示**：

```
┌──────────────────────────────────────────────────────────┐
│  🏆 业务健康度: 100/100  ✨ 状态极佳！                   │
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ 100%     │
│  🎊 恭喜！所有指标都处于最佳状态，继续保持！             │
└──────────────────────────────────────────────────────────┘
```

---

### 3.15 数据下钻路径标准化（1天）

**下钻交互方式**：

| 交互方式 | 使用场景 | 示例 |
|----------|----------|------|
| 点击数字→弹窗列表 | 卡片统计数字 | 点击"待审核:38"→弹出列表 |
| 点击行→侧边抽屉 | 列表行详情 | 点击用户行→用户360°视图 |
| 点击图表点→Tooltip | 图表数据点 | 点击趋势图某天→详情 |
| 点击"查看更多"→跳转 | 需要复杂操作 | 跳转到详情页面 |

**弹窗/抽屉尺寸规范**：

| 类型 | 宽度 | 最大高度 | 场景 |
|------|------|----------|------|
| 小型弹窗 | 480px | 60vh | 简单确认 |
| 中型弹窗 | 640px | 70vh | 列表展示 |
| 大型弹窗 | 800px | 80vh | 复杂详情 |
| 侧边抽屉 | 480px | 100vh | 用户详情 |

---

### 3.16 缓存失效策略（0.5天）

**缓存管理工具**：

```javascript
const CacheManager = {
  invalidateAfterAction(actionType) {
    const invalidateMap = {
      'consumption.approve': ['pending.count', 'pending.list', 'dashboard.stats'],
      'consumption.reject': ['pending.count', 'pending.list', 'dashboard.stats'],
      'alert.resolve': ['alert.count', 'alert.list'],
      'asset.adjust': ['asset.balance', 'asset.flow'],
    };
    
    const keysToInvalidate = invalidateMap[actionType] || [];
    keysToInvalidate.forEach(key => {
      sessionStorage.removeItem(key);
    });
    
    window.dispatchEvent(new CustomEvent('cache-invalidated', { 
      detail: { actionType, keys: keysToInvalidate } 
    }));
  }
};
```

---

### 3.17 决策辅助信息（0.5天）

**审核弹窗顶部辅助信息**：

```
┌─────────────────────────────────────────────────────────┐
│  📊 审核辅助信息                                        │
├─────────────────────────────────────────────────────────┤
│  用户历史审核通过率: 95% (19/20)                       │
│  异常分数: 25 (低风险)                                  │
│  相似记录处理方式: 90%通过                              │
└─────────────────────────────────────────────────────────┘
```

---

### 3.18 智能推荐（0.5天）

**消费审核智能推荐**：

- 异常分数 < 30 的记录自动推荐通过
- 显示"🤖 推荐通过"标签
- 一键"批量通过推荐项"按钮

---

### 3.19 网络超时分阶段提示（0.5天）

**三阶段提示**：

| 阶段 | 时间 | 提示内容 | 样式 |
|------|------|----------|------|
| 加载中 | 0-5秒 | "正在加载..." | 普通loading |
| 加载较慢 | 5-15秒 | "加载较慢，请稍候..." | 黄色提示 |
| 请求超时 | >15秒 | "请求超时，点击重试" | 红色错误+重试按钮 |

---

### 3.20 历史审核率显示（0.5天）

**消费审核列表新增列**：

| 列名 | 数据 | 说明 |
|------|------|------|
| 历史审核率 | 95% | 该用户过去30天审核通过率 |

---

### 3.21 告警中心系统告警Tab（0.5天）

**系统告警Tab内容**：

- DB连接状态
- Redis连接状态
- API健康状态
- 来源：`/health` API

---

### 3.22 客服响应时长指标（0.5天）

**客服工作台新增指标**：

```
┌─────────────────────────────────────────────────────────┐
│  📊 客服效率指标                                        │
├─────────────────────────────────────────────────────────┤
│  平均首次响应时间: 5分钟                               │
│  今日处理会话数: 15个                                   │
│  用户满意度: 4.5/5                                      │
└─────────────────────────────────────────────────────────┘
```

---

## 四、P2 - 中期实施（1月内，15天）

### 4.1 资产流动页面（2天）

**文件路径**：新建 `asset-flow.html` ← 🟡 **需新建页面**

**可复用组件**：
- `stats-cards.js`（资产统计卡片）
- `mini-chart.js`（趋势图基础）
- `filter-bar.js`（时间范围筛选）
- ECharts 桑基图（需额外配置）

**相关现有页面参考**：
- `asset-management.html`（资产管理）
- `asset-adjustment.html`（资产调整）

**页面布局**：

```
┌─────────────────────────────────────────────────────────┐
│  💎 资产流动概览                      时间范围: [今日▼] │
├─────────────────────────────────────────────────────────┤
│  ┌────────────┐ ┌────────────┐ ┌────────────┐          │
│  │ 系统余额   │ │ 用户持有   │ │ 冻结中     │          │
│  │ DIAMOND    │ │ 1,021,361  │ │ 91,825     │          │
│  │ 333,700    │ │ POINTS     │ │ (锁定)     │          │
│  └────────────┘ └────────────┘ └────────────┘          │
├─────────────────────────────────────────────────────────┤
│  📊 今日资产流动                                        │
│  ┌─────────────────────────────────────────────────┐   │
│  │  流入（+）              流出（-）               │   │
│  │  ├── 充值: +10,000     ├── 消费: -5,000       │   │
│  │  ├── 中奖: +8,000      ├── 兑换: -3,000       │   │
│  │  └── 其他: +500        └── 退款: -200         │   │
│  │  净流入: +10,300                               │   │
│  └─────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  📈 资产变化趋势（7天）                                 │
│  [ECharts折线图：各类资产余额变化]                      │
└─────────────────────────────────────────────────────────┘
```

---

### 4.2 数据驾驶舱合并重构（3天）

**合并内容**：
- 运营仪表盘
- 数据分析（统计报表+运营分析）

**新Tab结构**：

```
📊 数据驾驶舱 (6个Tab)
├── 运营大盘     ← 核心健康指标
├── 抽奖分析     ← 抽奖趋势、中奖分布
├── 用户分析     ← 用户行为、活跃度
├── 资产流动     ← 资产进出全貌
├── 转化漏斗     ← P3实现
└── 商户贡献度   ← P3实现
```

---

### 4.3 系统设置菜单精简（1天）

**调整后结构**：

```
⚙️ 系统设置 (3个子分组)
├── 🎁 奖品配置 (3项)
│   ├── 物品模板
│   ├── 物料转换规则
│   └── 资产组合
├── 📊 运营规则 (3项)
│   ├── 定价配置
│   ├── 功能开关
│   └── 提醒规则配置
└── 🔧 系统维护 (5项)
    ├── 内容管理
    ├── 字典管理
    ├── 系统配置
    ├── 会话管理
    └── 高级工具
```

---

### 4.4 操作审计页面（2天）

**文件路径**：新建 `audit-logs.html` ← 🟡 **需新建页面**

**可复用组件**：
- `data-table.js`（日志列表、筛选、分页）
- `filter-bar.js`（多条件筛选）
- `modal.js`（详情弹窗）
- `pagination.js`（分页）

**功能**：
- 操作历史按时间倒序展示
- 筛选：操作类型/操作人/目标用户/时间范围
- 详情：查看before_data/after_data对比
- 导出审计日志报表

---

### 4.5 数据导出报表功能（3天）

**7种导出场景**：

| 场景 | 格式 | 文件名规则 |
|------|------|------------|
| 消费记录 | Excel | `消费记录_2026-02-03.xlsx` |
| 用户列表 | CSV | `用户列表_2026-02-03.csv` |
| 告警历史 | Excel | `告警历史_2026-02.xlsx` |
| 仪表盘报表 | PDF | `运营日报_2026-02-03.pdf` |
| 抽奖记录 | Excel | `抽奖记录_2026-02-03.xlsx` |
| 资产流水 | Excel | `资产流水_2026-02-03.xlsx` |
| 商户贡献度 | Excel | `商户贡献度_2026-02.xlsx` |

**导出弹窗UI**：

```
┌─────────────────────────────────────────────────────────┐
│  📤 导出数据                                            │
├─────────────────────────────────────────────────────────┤
│  导出范围：                                             │
│  ○ 当前页数据 (50条)                                   │
│  ○ 筛选结果 (1,234条)                                  │
│  ● 全部数据 (5,678条)                                  │
│                                                         │
│  导出格式：                                             │
│  ● Excel (.xlsx)    ○ CSV (.csv)    ○ PDF              │
│                                                         │
│  ☑ 包含脱敏数据（推荐）                                │
│                                                         │
│  [取消]                                    [确认导出]   │
└─────────────────────────────────────────────────────────┘
```

**字段脱敏规则**：
- 手机号：`138****1234`
- 身份证号：`310101****1234`
- 银行卡号：`************1234`

---

### 4.6 策略效果对比（1天）

**抽奖管理新增功能**：
- 不同策略的效果对比图表
- A/B策略对比表格

---

### 4.7 用户分层分布（0.5天）

**抽奖管理新增功能**：
- 展示不同分层用户的抽奖情况
- 分层分布饼图

---

### 4.8 告警疲劳预防机制（1天）

**告警合并策略**：
- 同类型告警1小时内只显示1次
- 超过5个同类显示"批量告警"

**告警静默功能**：
- 静默单条/同类/用户

**告警升级机制**：
- 30分钟未处理→升级告警（弹窗+徽标闪烁）
- 1小时未处理→紧急告警（置顶+音效）
- 2小时未处理→通知管理员

---

### 4.9 一键分析功能（0.5天）

**用户管理新增功能**：
- 快速生成用户分析报告
- 导出PDF格式

---

### 4.10 WebSocket实时推送（0.5天）

**消息中心实时推送**：
- 新消息WebSocket推送
- 未读数量实时更新

---

### 4.11 今日核心事件时间线（0.5天）

**仪表盘新增卡片**：

```
┌─────────────────────────────────────────────────────────┐
│  📅 今日核心事件                                        │
├─────────────────────────────────────────────────────────┤
│  10:30 🔴 系统账户余额预警触发                          │
│  09:15 🟡 中奖率偏高告警                                │
│  08:00 🟢 系统启动完成                                  │
└─────────────────────────────────────────────────────────┘
```

---

### 4.12 列表数据预加载下一页（0.5天）

**优化列表翻页体验**：
- 当前页加载完成后预加载下一页
- 翻页时直接显示已缓存数据

---

## 五、P3 - 长期实施（2月内，7.5天）

### 5.1 系统设置三级分组（0.5天）

参见4.3节结构

---

### 5.2 转化漏斗页面（2天）

**文件路径**：新建 `conversion-funnel.html` ← 🟡 **需新建页面**（或作为数据驾驶舱Tab）

**可复用组件**：
- `stats-cards.js`（转化率统计卡片）
- `filter-bar.js`（时间范围筛选）
- ECharts 漏斗图

**漏斗布局**：

```
┌─────────────────────────────────────────────────────────┐
│  📊 用户转化漏斗                   时间范围: [本月▼]    │
├─────────────────────────────────────────────────────────┤
│                    ▼ 注册用户: 55人 (100%)              │
│                  ████████████████████                   │
│                    ▼ 首次抽奖: 48人 (87%)               │
│                  ████████████████                       │
│                    ▼ 首次消费: 32人 (58%)               │
│                  ██████████████                         │
│                    ▼ 复购用户: 15人 (27%)               │
│                  ████████                               │
│                    ▼ 高价值用户: 5人 (9%)               │
│                  ████                                   │
├─────────────────────────────────────────────────────────┤
│  📈 关键转化率：                                        │
│  注册→抽奖 87% | 抽奖→消费 67% | 消费→复购 47%         │
└─────────────────────────────────────────────────────────┘
```

---

### 5.3 商户贡献度页面（2.5天）

**文件路径**：新建 `merchant-contribution.html` ← 🟡 **需新建页面**（或作为数据驾驶舱Tab）

**可复用组件**：
- `data-table.js`（排名列表）
- `stats-cards.js`（统计卡片）
- `mini-chart.js`（趋势图）
- ECharts 饼图/环形图

**相关现有页面参考**：
- `store-management.html`（门店管理）

**页面布局**：

```
┌─────────────────────────────────────────────────────────┐
│  🏪 商户贡献度排行                  时间范围: [本月▼]    │
├─────────────────────────────────────────────────────────┤
│  排名 | 门店名称     | 消费金额  | 笔数 | 客单价 | 占比  │
│  ────────────────────────────────────────────────────── │
│  🥇 1 | 旗舰店       | ¥12,580  | 45   | ¥280  | 42%   │
│  🥈 2 | 中心店       | ¥8,320   | 38   | ¥219  | 28%   │
│  🥉 3 | 大学城店     | ¥4,560   | 25   | ¥182  | 15%   │
├─────────────────────────────────────────────────────────┤
│  📈 商户消费趋势（近7天折线图）                         │
│  [ECharts折线图：各门店消费趋势]                        │
├─────────────────────────────────────────────────────────┤
│  📊 环比对比                                            │
│  门店      | 本周金额 | 上周金额 | 环比变化 | 健康度     │
│  旗舰店    | ¥12,580  | ¥11,200  | +12.3%🟢 | 92分🟢    │
│  中心店    | ¥8,320   | ¥9,100   | -8.6%🔴  | 78分🟡    │
└─────────────────────────────────────────────────────────┘
```

**门店健康度计算**：
```
健康度 = 消费金额得分×40% + 消费频次得分×30% + 客单价得分×20% + 环比增长得分×10%
```

---

### 5.4 抽奖时段热力图（1天）

**抽奖管理新增图表**：
- 按小时/星期展示抽奖热度
- 使用ECharts热力图

---

### 5.5 资产发放/消耗比（0.5天）

**仪表盘新增指标**：

```
资产发放/消耗比: 1.2:1
├── 发放总量: 120,000
└── 消耗总量: 100,000
```

---

### 5.6 系统设置命名优化（0.5天）

**命名调整**：
- 物品配置 → 奖品配置
- 运营配置 → 运营规则

---

## 六、通用规范

### 6.1 错误处理原则

| 场景 | 处理方式 |
|------|----------|
| API请求失败 | Toast提示"请求失败：{具体原因}" |
| 数据加载失败 | 卡片显示"数据加载失败，点击重试" |
| 健康度计算失败 | 显示"--"而非默认值 |
| 批量操作部分失败 | 列出失败项和原因 |

**禁止**：
- ❌ 静默失败
- ❌ 降级到缓存数据
- ❌ 显示占位数据

---

### 6.2 色彩规范

| 状态 | 颜色 | Tailwind Class |
|------|------|----------------|
| 成功/正常 | 绿色 | `text-green-500` / `bg-green-100` |
| 警告/即将超时 | 黄色 | `text-yellow-500` / `bg-yellow-100` |
| 危险/超时 | 红色 | `text-red-500` / `bg-red-100` |
| 信息/中性 | 蓝色 | `text-blue-500` / `bg-blue-100` |
| 禁用 | 灰色 | `text-gray-400` / `bg-gray-100` |

---

### 6.3 加载状态规范

| 组件类型 | 加载态 |
|----------|--------|
| 页面 | 全屏loading遮罩 |
| 卡片 | 骨架屏(Skeleton) |
| 列表 | 表格骨架屏 |
| 按钮 | 按钮内loading图标+禁用 |
| 图表 | 图表区域loading |

---

### 6.4 响应式断点

| 断点 | 宽度 | 说明 |
|------|------|------|
| 最小支持 | 1280px | 低于此宽度显示横向滚动条 |
| 标准 | 1440px | 主要适配目标 |
| 宽屏 | 1920px | 充分利用空间 |

**注意**：本项目仅支持桌面端，不考虑移动端响应式。

---

## 七、验收标准

### 7.1 功能验收

- [ ] 所有功能点按需求实现
- [ ] 数据正确显示，无错乱
- [ ] 操作反馈及时准确
- [ ] 错误处理符合规范

### 7.2 性能验收

- [ ] 页面首屏加载 < 3秒
- [ ] 列表滚动流畅，无卡顿
- [ ] 图表渲染 < 1秒

### 7.3 兼容性验收

- [ ] Chrome 90+ 正常
- [ ] Firefox 88+ 正常
- [ ] Edge 90+ 正常

---

## 八、文件清单

### 8.1 需新建页面（1个）

> **注意**：根据决策3，资产流动/转化漏斗/商户贡献度已改为数据驾驶舱Tab，不再新建独立页面

| 文件名 | 优先级 | 工时 | 可复用组件 |
|--------|--------|------|-----------|
| `audit-logs.html` | P2 | 2天 | data-table, filter-bar, modal, pagination |

### 8.1.1 改为数据驾驶舱Tab的功能（决策3）

| 原计划页面 | 改为Tab | 优先级 | 工时 |
|-----------|---------|--------|------|
| ~~`asset-flow.html`~~ | `dashboard-panel.html?tab=asset-flow` | P2 | 2天 |
| ~~`conversion-funnel.html`~~ | `dashboard-panel.html?tab=funnel` | P3 | 2天 |
| ~~`merchant-contribution.html`~~ | `dashboard-panel.html?tab=merchant` | P3 | 2.5天 |

### 8.2 需增强的现有页面（8个）

| 文件名 | 优先级 | 主要修改 | 现有基础 |
|--------|--------|----------|---------|
| `pending-center.html` | P0 | 健康度条+统计卡片+批量操作 | ✅ 已有列表、筛选、紧急区 |
| `dashboard-panel.html` | P0/P1/P2/P3 | **重构为6Tab数据驾驶舱**（决策3）：运营大盘+抽奖分析+用户分析+资产流动(桑基图)+转化漏斗+商户贡献度 | ✅ 已有指标、图表、告警 |
| `finance-management.html` | P0/P1 | 批量操作+超时高亮+辅助信息 | ✅ 已有审核列表、selectedIds |
| `message-center.html` | P1 | WebSocket推送+更多筛选 | ✅ 已有列表、批量、弹窗 |
| `lottery-management.html` | P1/P2 | 预设可视化+垫付看板+中奖率趋势 | ✅ 已有多Tab结构 |
| `user-management.html` | P1 | 用户360°抽屉 | ✅ 已有用户列表 |
| `risk-alerts.html` + `lottery-alerts.html` | P1/P2 | 分别增强，疲劳预防（决策2：保持两个独立页面） | ✅ 已有告警列表 |
| `src/alpine/components/sidebar-nav.js` | P0/P3 | 健康度指示灯 + **系统设置三级分组**（决策4） | ✅ 已有徽标系统 |

### 8.3 需新建组件（4个）

| 组件名 | 优先级 | 说明 | 可复用基础 |
|--------|--------|------|-----------|
| `src/alpine/components/user-drawer.js` | P1 | 用户360°视图抽屉 | 基于 modal.js 扩展 |
| `src/alpine/components/health-score-card.js` | P0 | 健康度评分卡片 | 基于 stats-cards.js 扩展 |
| `src/alpine/components/batch-action-bar.js` | P0 | 批量操作浮动栏 | 通用组件 |
| `src/alpine/components/export-modal.js` | P2 | 数据导出弹窗 | 基于 modal.js 扩展 |

### 8.4 需扩展的现有组件（2个）

| 组件名 | 优先级 | 扩展内容 | 现有基础 |
|--------|--------|---------|---------|
| `src/alpine/components/keyboard-shortcuts.js` | P1 | 添加 G+P、G+D、Ctrl+Shift+R | ✅ 已有快捷键框架 |
| `src/alpine/components/sidebar-nav.js` | P0 | 添加健康度获取和渲染 | ✅ 已有徽标系统 |

### 8.5 现有24个可复用组件清单

| 组件文件 | 主要用途 | 复用场景 |
|---------|---------|---------|
| `data-table.js` | 数据表格、批量操作 | 消费审核、审计日志、商户排名 |
| `modal.js` | 弹窗/抽屉 | 用户详情、导出配置、确认框 |
| `pagination.js` | 分页 | 所有列表页 |
| `toast.js` | 消息提示 | 操作反馈 |
| `empty-state.js` | 空状态 | 空数据展示 |
| `stats-cards.js` | 统计卡片 | 健康度、待办统计、资产统计 |
| `filter-bar.js` | 筛选栏 | 列表筛选 |
| `notification-center.js` | 通知中心 | 消息中心 |
| `keyboard-shortcuts.js` | 快捷键 | 全局快捷键 |
| `mini-chart.js` | 迷你图表 | 趋势图、卡片内图表 |
| `animated-counter.js` | 动画计数器 | 统计数字动效 |
| `virtual-list.js` | 虚拟滚动 | 大数据列表 |
| `workspace-tabs.js` | Tab管理 | 多Tab页面 |
| `sidebar-nav.js` | 侧边栏导航 | 导航菜单、徽标 |
| `form-validation.js` | 表单验证 | 表单提交 |
| `file-upload.js` | 文件上传 | 导入功能 |
| `image-loader.js` | 图片加载 | 图片展示 |
| `infinite-scroll.js` | 无限滚动 | 时间线 |
| `resizable-columns.js` | 可调整列宽 | 表格列宽 |
| `page-transitions.js` | 页面过渡 | 页面切换动效 |
| `theme-switcher.js` | 主题切换 | 主题功能 |
| `admin-page.js` | 页面基础 | 页面通用逻辑 |
| `function-card.js` | 功能卡片 | 功能入口 |

---

## 九、实施优先级建议（根据决策更新）

### P0 - 第1周（复用度高，见效快）

| 功能 | 页面 | 复用度 | 预计工时 |
|-----|-----|---------|---------|
| 待办总览增强 | `pending-center.html`（决策1） | 80% | 1天 |
| 消费审核批量操作 | `finance-management.html` | 60% | 1.5天 |
| 超时高亮 | `finance-management.html` | 90% | 0.5天 |
| 侧边栏健康指示灯 | `sidebar-nav.js` | 90% | 0.5天 |
| 30秒自动刷新 | `pending-center.html` | 100% | 0.5天 |

### P1 - 第2-3周

| 功能 | 页面 | 复用度 | 预计工时 |
|-----|-----|---------|---------|
| 仪表盘健康度 | `dashboard-panel.html`（运营大盘Tab） | 50% | 2天 |
| 消息中心WebSocket | `message-center.html` | 70% | 1.5天 |
| 快捷键扩展 | `keyboard-shortcuts.js` | 95% | 0.5天 |
| 时间对比功能 | `dashboard-panel.html` | 40% | 2天 |
| 用户360°抽屉 | `user-drawer.js` | 40% | 4天 |
| 告警疲劳预防 | `risk-alerts.html` + `lottery-alerts.html`（决策2：分别增强） | 60% | 1天 |

### P2 - 第4周+

| 功能 | 页面 | 复用度 | 预计工时 |
|-----|-----|---------|---------|
| 资产流动Tab | `dashboard-panel.html?tab=asset-flow`（决策3+5：含桑基图） | 30% | 3天 |
| 操作审计 | `audit-logs.html` **新建** | 50% | 2天 |
| 数据导出 | `export-modal.js` | 40% | 3天 |
| 抽奖分析Tab | `dashboard-panel.html?tab=lottery` | 40% | 2天 |
| 用户分析Tab | `dashboard-panel.html?tab=user` | 40% | 2天 |

### P3 - 第5周+

| 功能 | 页面 | 复用度 | 预计工时 |
|-----|-----|---------|---------|
| 转化漏斗Tab | `dashboard-panel.html?tab=funnel`（决策3） | 30% | 2天 |
| 商户贡献度Tab | `dashboard-panel.html?tab=merchant`（决策3） | 30% | 2.5天 |
| 系统设置三级分组 | `sidebar-nav.js`（决策4） | 80% | 1天 |

---

**文档结束**

> 本文档从《运营后台优化方案.md v1.8》中提取前端相关工作内容，总计51.5天工时，覆盖127项功能点。
> 
> **技术评估结论**：
> - ✅ 技术栈100%兼容（Alpine.js + Vite + Tailwind CSS + ECharts + Socket.IO）
> - ✅ 约65%功能可通过增强现有页面实现
> - ✅ 24个Alpine.js组件可直接复用
> - ✅ 侧边栏结构已符合需求，仅需添加健康指示灯
> 
> **关键决策（2026年2月3日确认）**：
> - ✅ **决策1**：待办页面直接增强 `pending-center.html`，不新建
> - ✅ **决策2**：告警中心保持两个独立页面（`risk-alerts.html` + `lottery-alerts.html`）
> - ✅ **决策3**：数据驾驶舱完全合并为6个Tab，不新建独立页面
> - ✅ **决策4**：系统设置按三级分组结构调整侧边栏
> - ✅ **决策5**：资产流动使用ECharts桑基图
> 
> **决策后文件变化**：
> - 需新建页面：4个 → **1个**（仅 `audit-logs.html`）
> - 数据驾驶舱：1个Tab → **6个Tab**
> - 侧边栏重构：系统设置三级分组

