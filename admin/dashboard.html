<!doctype html>
<html lang="zh-CN">
  <head>
    <%- include('partials/head', { title: '数据仪表盘', pageStyle: '[x-cloak] { display: none !important; } .chart-container { height: 280px; }' }) %>
    <!-- ECharts 已通过 main.js 统一导入，无需 CDN -->
  </head>
  <body class="bg-gray-100 min-h-screen" x-data="dashboardPage()" x-init="init()" x-cloak>
    <!-- 顶部导航 -->
    <nav class="bg-blue-600 text-white shadow-lg">
      <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <span class="text-lg font-semibold">📊 管理后台 - 数据仪表盘</span>
        <div class="flex items-center space-x-4">
          <span x-text="'欢迎，' + (userInfo?.nickname || '管理员')"></span>
          <button
            @click="logout"
            class="px-3 py-1 border border-white/50 rounded hover:bg-white/10 transition-colors"
          >
            退出登录
          </button>
        </div>
      </div>
    </nav>

    <div class="container mx-auto px-4 py-6">
      <h4 class="text-xl font-semibold text-gray-800 mb-4">今日数据概览</h4>

      <!-- 统计卡片 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <!-- 总用户数 -->
        <div class="bg-white rounded-lg shadow p-6 text-center">
          <h6 class="text-gray-500 text-sm mb-2">总用户数</h6>
          <h2 class="text-3xl font-bold text-blue-600" x-text="formatNumber(stats.totalUsers)">
            -
          </h2>
          <small class="text-green-600"
            >今日新增: <span x-text="stats.todayNewUsers">-</span></small
          >
        </div>

        <!-- 今日抽奖 -->
        <div class="bg-white rounded-lg shadow p-6 text-center">
          <h6 class="text-gray-500 text-sm mb-2">今日抽奖</h6>
          <h2 class="text-3xl font-bold text-green-600" x-text="formatNumber(stats.todayDraws)">
            -
          </h2>
          <small class="text-blue-600"
            >中奖: <span x-text="formatNumber(stats.todayWins)">-</span></small
          >
        </div>

        <!-- 中奖率 -->
        <div class="bg-white rounded-lg shadow p-6 text-center">
          <h6 class="text-gray-500 text-sm mb-2">中奖率</h6>
          <h2 class="text-3xl font-bold text-yellow-600" x-text="stats.winRate + '%'">-</h2>
          <small class="text-gray-500"
            >消耗积分: <span x-text="formatNumber(stats.pointsConsumed)">-</span></small
          >
        </div>

        <!-- 客服会话 -->
        <div class="bg-white rounded-lg shadow p-6 text-center">
          <h6 class="text-gray-500 text-sm mb-2">客服会话</h6>
          <h2 class="text-3xl font-bold text-red-600" x-text="formatNumber(stats.sessions)">-</h2>
          <small class="text-gray-400"
            >消息数: <span x-text="formatNumber(stats.messages)">-</span></small
          >
        </div>
      </div>

      <!-- ECharts 数据趋势图表 -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
        <div class="lg:col-span-2 bg-white rounded-lg shadow">
          <div class="px-4 py-3 border-b flex justify-between items-center">
            <h6 class="font-medium">📈 7日抽奖趋势</h6>
            <small class="text-gray-400">每分钟自动刷新</small>
          </div>
          <div class="p-4">
            <div id="lotteryTrendChart" class="chart-container" x-ref="trendChart"></div>
          </div>
        </div>
        <div class="bg-white rounded-lg shadow">
          <div class="px-4 py-3 border-b">
            <h6 class="font-medium">🥧 今日数据分布</h6>
          </div>
          <div class="p-4">
            <div
              id="todayDistributionChart"
              class="chart-container"
              x-ref="distributionChart"
            ></div>
          </div>
        </div>
      </div>

      <!-- 快速导航 -->
      <div class="bg-white rounded-lg shadow">
        <div class="p-6">
          <h5 class="text-lg font-semibold mb-4">⚡ 快速操作</h5>

          <!-- P0 - 核心业务功能 -->
          <div class="mb-6">
            <h6 class="text-gray-500 text-sm mb-3">
              <span class="inline-block px-2 py-1 bg-red-500 text-white text-xs rounded mr-2"
                >P0</span
              >
              核心业务功能
            </h6>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <a
                href="/admin/finance-management.html?page=consumption"
                class="px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50 text-center transition-colors"
              >
                📋 消费记录审核
              </a>
              <a
                href="/admin/lottery-management.html?page=campaigns"
                class="px-4 py-2 border border-yellow-500 text-yellow-600 rounded hover:bg-yellow-50 text-center transition-colors"
              >
                🎁 抽奖活动管理
              </a>
              <a
                href="/admin/lottery-management.html?page=prizes"
                class="px-4 py-2 border border-red-500 text-red-500 rounded hover:bg-red-50 text-center transition-colors"
              >
                🏆 奖品管理
              </a>
              <a
                href="/admin/risk-alerts.html"
                class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-center transition-colors"
              >
                ⚠️ 风控告警
              </a>
            </div>
          </div>

          <!-- P1 - 统一管理中心 -->
          <div class="mb-6">
            <h6 class="text-gray-500 text-sm mb-3">
              <span class="inline-block px-2 py-1 bg-blue-500 text-white text-xs rounded mr-2"
                >P1</span
              >
              统一管理中心
              <span class="inline-block px-2 py-1 bg-green-500 text-white text-xs rounded ml-2"
                >Mixin 架构</span
              >
            </h6>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <a
                href="/admin/asset-management.html"
                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-center transition-colors"
              >
                💎 资产管理中心
              </a>
              <a
                href="/admin/exchange-market.html"
                class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 text-center transition-colors"
              >
                🏪 兑换市场管理
              </a>
              <a
                href="/admin/user-management.html"
                class="px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600 text-center transition-colors"
              >
                👥 用户权限管理
              </a>
              <a
                href="/admin/system-settings.html"
                class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-center transition-colors"
              >
                ⚙️ 系统设置管理
              </a>
              <a
                href="/admin/lottery-management.html"
                class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-center transition-colors"
              >
                🎁 抽奖管理中心
              </a>
              <a
                href="/admin/store-management.html"
                class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 text-center transition-colors"
              >
                🏪 门店管理中心
              </a>
              <a
                href="/admin/finance-management.html"
                class="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-800 text-center transition-colors"
              >
                💰 财务管理中心
              </a>
              <a
                href="/admin/content-management.html"
                class="px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50 text-center transition-colors"
              >
                📄 内容管理中心
              </a>
            </div>
          </div>

          <!-- P2 - 高级功能 -->
          <div class="mb-6">
            <h6 class="text-gray-500 text-sm mb-3">
              <span class="inline-block px-2 py-1 bg-green-500 text-white text-xs rounded mr-2"
                >P2</span
              >
              高级功能
            </h6>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <a
                href="/admin/analytics.html"
                class="px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50 text-center transition-colors"
              >
                📊 数据统计报表
              </a>
              <a
                href="/admin/risk-alerts.html"
                class="px-4 py-2 border border-green-500 text-green-500 rounded hover:bg-green-50 text-center transition-colors"
              >
                🚨 风控告警
              </a>
              <a
                href="/admin/customer-service.html"
                class="px-4 py-2 border border-red-500 text-red-500 rounded hover:bg-red-50 text-center transition-colors"
              >
                💬 客服工作台
              </a>
              <a
                href="/admin/sessions.html"
                class="px-4 py-2 border border-gray-500 text-gray-500 rounded hover:bg-gray-50 text-center transition-colors"
              >
                🔑 会话管理
              </a>
            </div>
          </div>

          <!-- P3 - 系统管理 -->
          <div class="mb-6">
            <h6 class="text-gray-500 text-sm mb-3">
              <span class="inline-block px-2 py-1 bg-cyan-500 text-white text-xs rounded mr-2"
                >P3</span
              >
              系统管理
            </h6>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <a
                href="/admin/system-settings.html"
                class="px-4 py-2 border border-cyan-500 text-cyan-500 rounded hover:bg-cyan-50 text-center transition-colors"
              >
                ⚙️ 系统设置
              </a>
              <a
                href="/admin/config-tools.html"
                class="px-4 py-2 border border-gray-500 text-gray-500 rounded hover:bg-gray-50 text-center transition-colors"
              >
                🔧 配置工具
              </a>
              <a
                href="/admin/item-templates.html"
                class="px-4 py-2 border border-yellow-500 text-yellow-600 rounded hover:bg-yellow-50 text-center transition-colors"
              >
                📦 物品模板
              </a>
              <a
                href="/admin/statistics.html"
                class="px-4 py-2 border border-purple-500 text-purple-500 rounded hover:bg-purple-50 text-center transition-colors"
              >
                📉 统计分析
              </a>
            </div>
          </div>

          <!-- P4 - 资产与交易 -->
          <div>
            <h6 class="text-gray-500 text-sm mb-3">
              <span class="inline-block px-2 py-1 bg-yellow-500 text-white text-xs rounded mr-2"
                >P4</span
              >
              资产与交易
            </h6>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
              <a
                href="/admin/asset-adjustment.html"
                class="px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50 text-center transition-colors"
              >
                ➕➖ 资产调整
              </a>
              <a
                href="/admin/orphan-frozen.html"
                class="px-4 py-2 border border-red-500 text-red-500 rounded hover:bg-red-50 text-center transition-colors"
              >
                ❄️ 孤儿冻结清理
              </a>
              <a
                href="/admin/trade-management.html"
                class="px-4 py-2 border border-yellow-500 text-yellow-600 rounded hover:bg-yellow-50 text-center transition-colors"
              >
                🔄 C2C交易订单
              </a>
              <a
                href="/admin/market-management.html"
                class="px-4 py-2 border border-green-500 text-green-500 rounded hover:bg-green-50 text-center transition-colors"
              >
                🛒 市场管理
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>

    <!-- 页面专属逻辑 -->
    <script type="module" src="./src/modules/analytics/pages/dashboard.js"></script>
  </body>
</html>
