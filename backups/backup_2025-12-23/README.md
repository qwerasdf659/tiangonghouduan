# æ•°æ®åº“å®Œæ•´å¤‡ä»½ - 2025å¹´12æœˆ23æ—¥

## ğŸ“‹ å¤‡ä»½æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**æœ€æ–°çš„ã€å®Œæ•´çš„ã€æ­£ç¡®çš„**æ•°æ®åº“å¤‡ä»½ï¼Œä¸å½“å‰å®é™…æ•°æ®åº“**å®Œå…¨ä¸€è‡´**ã€‚

**å¤‡ä»½æ—¶é—´**: 2025-12-23 23:31:55 (åŒ—äº¬æ—¶é—´)  
**æ•°æ®åº“å**: restaurant_lottery  
**å¤‡ä»½ç±»å‹**: å®Œæ•´å¤‡ä»½ï¼ˆç»“æ„ + æ•°æ® + ç´¢å¼• + å¤–é”®çº¦æŸï¼‰

---

## âœ… å¤‡ä»½å®Œæ•´æ€§ç¡®è®¤

### æ•°æ®åº“ç»Ÿè®¡

- **æ€»è¡¨æ•°**: 43 ä¸ª
- **æœ‰æ•°æ®çš„è¡¨**: 33 ä¸ª
- **ç©ºè¡¨**: 10 ä¸ªï¼ˆå·²å®Œæ•´å¤‡ä»½ç»“æ„ï¼‰
- **æ€»æ•°æ®è¡Œæ•°**: 7,040 è¡Œ
- **å¤‡ä»½æ–‡ä»¶å¤§å°**:
  - SQLæ ¼å¼: 3.7 MB
  - JSONæ ¼å¼: 5.5 MB

### å¤‡ä»½å†…å®¹æ¸…å•

#### âœ… æ‰€æœ‰è¡¨ç»“æ„ï¼ˆ43ä¸ªï¼‰

åŒ…æ‹¬ä½†ä¸é™äºï¼š

- account_asset_balances (è´¦æˆ·èµ„äº§ä½™é¢è¡¨)
- accounts (è´¦æˆ·è¡¨)
- admin_operation_logs (ç®¡ç†å‘˜æ“ä½œæ—¥å¿—)
- asset_transactions (èµ„äº§äº¤æ˜“è®°å½•)
- audit_records (å®¡æ ¸è®°å½•) - **ç©ºè¡¨**
- authentication_sessions (è®¤è¯ä¼šè¯) - **ç©ºè¡¨**
- chat_messages (èŠå¤©æ¶ˆæ¯) - **ç©ºè¡¨**
- consumption_records (æ¶ˆè´¹è®°å½•)
- content_review_records (å†…å®¹å®¡æ ¸è®°å½•)
- customer_service_sessions (å®¢æœä¼šè¯)
- exchange_items (å…‘æ¢å•†å“)
- exchange_records (å…‘æ¢è®°å½•) - **ç©ºè¡¨**
- feedbacks (ç”¨æˆ·åé¦ˆ)
- image_resources (å›¾ç‰‡èµ„æº)
- item_instances (ç‰©å“å®ä¾‹)
- lottery_campaigns (æŠ½å¥–æ´»åŠ¨)
- lottery_draw_quota_rules (æŠ½å¥–é…é¢è§„åˆ™)
- lottery_draws (æŠ½å¥–è®°å½•)
- lottery_management_settings (æŠ½å¥–ç®¡ç†è®¾ç½®)
- lottery_presets (æŠ½å¥–é¢„è®¾)
- lottery_prizes (æŠ½å¥–å¥–å“)
- lottery_user_daily_draw_quota (ç”¨æˆ·æ¯æ—¥æŠ½å¥–é…é¢) - **ç©ºè¡¨**
- market_listings (å¸‚åœºæŒ‚ç‰Œ)
- material_asset_types (ææ–™èµ„äº§ç±»å‹)
- material_conversion_rules (ææ–™è½¬æ¢è§„åˆ™)
- points_transactions (ç§¯åˆ†äº¤æ˜“)
- popup_banners (å¼¹çª—æ¨ªå¹…) - **ç©ºè¡¨**
- products (å•†å“)
- redemption_orders (å…‘æ¢è®¢å•)
- role_change_logs (è§’è‰²å˜æ›´æ—¥å¿—) - **ç©ºè¡¨**
- roles (è§’è‰²)
- sequelizemeta (Sequelizeè¿ç§»è®°å½•)
- stores (å•†åº—) - **ç©ºè¡¨**
- system_announcements (ç³»ç»Ÿå…¬å‘Š)
- system_settings (ç³»ç»Ÿè®¾ç½®)
- trade_orders (äº¤æ˜“è®¢å•) - **ç©ºè¡¨**
- trade_records (äº¤æ˜“è®°å½•)
- user_hierarchy (ç”¨æˆ·å±‚çº§) - **ç©ºè¡¨**
- user_points_accounts (ç”¨æˆ·ç§¯åˆ†è´¦æˆ·)
- user_premium_status (ç”¨æˆ·ä¼šå‘˜çŠ¶æ€)
- user_roles (ç”¨æˆ·è§’è‰²)
- users (ç”¨æˆ·)
- websocket_startup_logs (WebSocketå¯åŠ¨æ—¥å¿—)

#### âœ… æ‰€æœ‰ç´¢å¼•

- ä¸»é”®ç´¢å¼• (PRIMARY KEY)
- å”¯ä¸€ç´¢å¼• (UNIQUE KEY)
- æ™®é€šç´¢å¼• (KEY/INDEX)
- è”åˆç´¢å¼• (Composite Index)

#### âœ… æ‰€æœ‰å¤–é”®çº¦æŸ

- æ‰€æœ‰è¡¨é—´çš„å¤–é”®å…³ç³»å·²å®Œæ•´å¤‡ä»½
- åŒ…æ‹¬ ON DELETE å’Œ ON UPDATE è§„åˆ™
- ç¤ºä¾‹ï¼š
  ```sql
  CONSTRAINT `account_asset_balances_ibfk_1`
  FOREIGN KEY (`account_id`)
  REFERENCES `accounts` (`account_id`)
  ON DELETE RESTRICT ON UPDATE CASCADE
  ```

#### âœ… æ‰€æœ‰æ•°æ®

- **æœ‰æ•°æ®çš„è¡¨**: å®Œæ•´å¤‡ä»½æ‰€æœ‰è¡Œï¼ˆå…±7,040è¡Œï¼‰
- **ç©ºè¡¨**: å®Œæ•´å¤‡ä»½è¡¨ç»“æ„ï¼ˆ10ä¸ªç©ºè¡¨ï¼‰
- æ•°æ®å®Œæ•´æ€§: 100%
- æ•°æ®ä¸€è‡´æ€§: å·²éªŒè¯

---

## ğŸ“ å¤‡ä»½æ–‡ä»¶è¯´æ˜

### 1. SQLæ ¼å¼å¤‡ä»½

**æ–‡ä»¶å**: `full_backup_2025-12-23_2025-12-23T23-31-55.sql`  
**å¤§å°**: 3.7 MB  
**ç”¨é€”**: ç›´æ¥å¯¼å…¥MySQLæ•°æ®åº“

**ç‰¹ç‚¹**:

- æ ‡å‡†SQLæ ¼å¼
- åŒ…å«å®Œæ•´çš„CREATE TABLEè¯­å¥
- åŒ…å«æ‰€æœ‰INSERTè¯­å¥
- å¯ç›´æ¥ä½¿ç”¨mysqlå‘½ä»¤å¯¼å…¥
- åŒ…å«å¤–é”®çº¦æŸå’Œç´¢å¼•å®šä¹‰

**å¯¼å…¥å‘½ä»¤**:

```bash
mysql -h <host> -u <user> -p <database> < full_backup_2025-12-23_2025-12-23T23-31-55.sql
```

### 2. JSONæ ¼å¼å¤‡ä»½

**æ–‡ä»¶å**: `full_backup_2025-12-23_2025-12-23T23-31-55.json`  
**å¤§å°**: 5.5 MB  
**ç”¨é€”**: ç¨‹åºåŒ–å¤„ç†ã€æ•°æ®åˆ†æ

**ç‰¹ç‚¹**:

- ç»“æ„åŒ–JSONæ ¼å¼
- åŒ…å«å…ƒæ•°æ®ä¿¡æ¯
- æ˜“äºç¨‹åºè¯»å–å’Œå¤„ç†
- æ”¯æŒæ•°æ®åˆ†æå’Œè½¬æ¢

**JSONç»“æ„**:

```json
{
  "metadata": {
    "database": "restaurant_lottery",
    "backupTime": "2025-12-23T23:31:55.897Z",
    "tableCount": 43,
    "totalRows": 7040
  },
  "tables": {
    "table_name": {
      "structure": { "createSQL": "..." },
      "data": { "rowCount": 123, "rows": [...] }
    }
  }
}
```

### 3. å¤‡ä»½æ‘˜è¦

**æ–‡ä»¶å**: `BACKUP_SUMMARY.txt`  
**å†…å®¹**: å¤‡ä»½ç»Ÿè®¡ä¿¡æ¯ã€æ–‡ä»¶åˆ—è¡¨ã€é”™è¯¯è®°å½•

### 4. éªŒè¯æŠ¥å‘Š

**æ–‡ä»¶å**: `BACKUP_VERIFICATION_REPORT.md`  
**å†…å®¹**: å®Œæ•´æ€§éªŒè¯ç»“æœã€æ£€æŸ¥é¡¹ç›®

### 5. å®Œæˆç¡®è®¤

**æ–‡ä»¶å**: `BACKUP_COMPLETION_CONFIRMATION.md`  
**å†…å®¹**: å¤‡ä»½å®Œæˆç¡®è®¤ã€ç¡®è®¤äº‹é¡¹æ¸…å•

---

## ğŸ” éªŒè¯ç»“æœ

### éªŒè¯é¡¹ç›® âœ… å…¨éƒ¨é€šè¿‡

| éªŒè¯é¡¹ç›®     | é¢„æœŸå€¼ | å®é™…å€¼ | ç»“æœ    |
| ------------ | ------ | ------ | ------- |
| è¡¨æ•°é‡æ£€æŸ¥   | 43     | 43     | âœ… é€šè¿‡ |
| æ•°æ®è¡Œæ•°æ£€æŸ¥ | 7,040  | 7,040  | âœ… é€šè¿‡ |
| ç©ºè¡¨å¤‡ä»½æ£€æŸ¥ | 10     | 10     | âœ… é€šè¿‡ |

### å®Œæ•´æ€§ç¡®è®¤ âœ…

- [x] æ‰€æœ‰è¡¨çš„ç»“æ„å·²å¤‡ä»½ï¼ˆåŒ…æ‹¬ç´¢å¼•ï¼‰
- [x] æ‰€æœ‰å¤–é”®çº¦æŸå·²å¤‡ä»½
- [x] æ‰€æœ‰æ•°æ®å·²å¤‡ä»½ï¼ˆåŒ…æ‹¬ç©ºè¡¨ï¼‰
- [x] SQLæ ¼å¼å¤‡ä»½å·²ç”Ÿæˆ
- [x] JSONæ ¼å¼å¤‡ä»½å·²ç”Ÿæˆ
- [x] å¤‡ä»½å®Œæ•´æ€§å·²éªŒè¯

---

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

### æ•°æ®åº“ç‰ˆæœ¬

- **MySQLç‰ˆæœ¬**: å…¼å®¹ MySQL 5.7+ / MariaDB 10.2+
- **å­—ç¬¦é›†**: utf8mb4
- **æ’åºè§„åˆ™**: utf8mb4_unicode_ci

### Sequelizeç‰ˆæœ¬

- **Sequelize**: 6.x
- **è¿ç§»è®°å½•**: 178ä¸ªè¿ç§»å·²å®Œæˆï¼ˆsequelizemetaè¡¨ï¼‰

### æ•°æ®æ ¼å¼

- **æ—¥æœŸæ—¶é—´**: åŒ—äº¬æ—¶é—´ (Asia/Shanghai)
- **æ—¶é—´æˆ³æ ¼å¼**: DATETIMEç±»å‹
- **JSONå­—æ®µ**: åŸç”ŸJSONç±»å‹

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡è¯¦æƒ…

### æŒ‰æ•°æ®é‡æ’åºçš„å‰10ä¸ªè¡¨

| è¡¨å                        | è¡Œæ•°  | è¯´æ˜              |
| --------------------------- | ----- | ----------------- |
| lottery_draws               | 2,907 | æŠ½å¥–è®°å½•          |
| admin_operation_logs        | 932   | ç®¡ç†å‘˜æ“ä½œæ—¥å¿—    |
| asset_transactions          | 857   | èµ„äº§äº¤æ˜“è®°å½•      |
| websocket_startup_logs      | 691   | WebSocketå¯åŠ¨æ—¥å¿— |
| item_instances              | 580   | ç‰©å“å®ä¾‹          |
| redemption_orders           | 253   | å…‘æ¢è®¢å•          |
| sequelizemeta               | 178   | Sequelizeè¿ç§»è®°å½• |
| lottery_management_settings | 153   | æŠ½å¥–ç®¡ç†è®¾ç½®      |
| consumption_records         | 127   | æ¶ˆè´¹è®°å½•          |
| content_review_records      | 127   | å†…å®¹å®¡æ ¸è®°å½•      |

### ç©ºè¡¨åˆ—è¡¨ï¼ˆ10ä¸ªï¼‰

1. audit_records (å®¡æ ¸è®°å½•)
2. authentication_sessions (è®¤è¯ä¼šè¯)
3. chat_messages (èŠå¤©æ¶ˆæ¯)
4. exchange_records (å…‘æ¢è®°å½•)
5. lottery_user_daily_draw_quota (ç”¨æˆ·æ¯æ—¥æŠ½å¥–é…é¢)
6. popup_banners (å¼¹çª—æ¨ªå¹…)
7. role_change_logs (è§’è‰²å˜æ›´æ—¥å¿—)
8. stores (å•†åº—)
9. trade_orders (äº¤æ˜“è®¢å•)
10. user_hierarchy (ç”¨æˆ·å±‚çº§)

**æ³¨æ„**: ç©ºè¡¨çš„ç»“æ„å·²å®Œæ•´å¤‡ä»½ï¼ŒåŒ…æ‹¬æ‰€æœ‰å­—æ®µå®šä¹‰ã€ç´¢å¼•å’Œå¤–é”®çº¦æŸã€‚

---

## ğŸ›¡ï¸ æ•°æ®å®‰å…¨æ€§

### å¤‡ä»½ç‰¹ç‚¹

- âœ… å®Œæ•´æ€§: 100%æ•°æ®è¦†ç›–
- âœ… ä¸€è‡´æ€§: äº‹åŠ¡ä¸€è‡´æ€§å¿«ç…§
- âœ… å¯æ¢å¤æ€§: å·²éªŒè¯å¯å®Œæ•´æ¢å¤
- âœ… ç‰ˆæœ¬å…¼å®¹: ä¸å½“å‰æ•°æ®åº“ç‰ˆæœ¬å®Œå…¨å…¼å®¹

### ä½¿ç”¨å»ºè®®

1. **å¦¥å–„ä¿ç®¡**: å¤‡ä»½æ–‡ä»¶åŒ…å«å®Œæ•´ä¸šåŠ¡æ•°æ®
2. **å®šæœŸéªŒè¯**: å»ºè®®å®šæœŸéªŒè¯å¤‡ä»½å¯ç”¨æ€§
3. **å¼‚åœ°å­˜å‚¨**: å»ºè®®å°†å¤‡ä»½æ–‡ä»¶å­˜å‚¨åˆ°å¼‚åœ°
4. **è®¿é—®æ§åˆ¶**: é™åˆ¶å¤‡ä»½æ–‡ä»¶çš„è®¿é—®æƒé™

---

## ğŸ“ å¤‡ä»½è¯´æ˜

### å¤‡ä»½æ–¹æ³•

- ä½¿ç”¨ä¸“ç”¨å¤‡ä»½è„šæœ¬: `scripts/create_complete_backup_20251224.js`
- åŸºäºSequelize ORMç›´æ¥æŸ¥è¯¢æ•°æ®åº“
- é€è¡¨å¤‡ä»½ï¼Œç¡®ä¿å®Œæ•´æ€§

### å¤‡ä»½ç‰¹è‰²

1. **åŒæ ¼å¼å¤‡ä»½**: SQL + JSONä¸¤ç§æ ¼å¼
2. **ç©ºè¡¨ä¿æŠ¤**: ç©ºè¡¨ç»“æ„å®Œæ•´å¤‡ä»½
3. **è‡ªåŠ¨éªŒè¯**: å¤‡ä»½åè‡ªåŠ¨éªŒè¯å®Œæ•´æ€§
4. **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„å¤‡ä»½è¿‡ç¨‹æ—¥å¿—

### æ¢å¤æµ‹è¯•

- âœ… SQLæ ¼å¼å¯ç›´æ¥å¯¼å…¥
- âœ… JSONæ ¼å¼å¯ç¨‹åºåŒ–å¤„ç†
- âœ… è¡¨ç»“æ„å®Œæ•´å¯ç”¨
- âœ… å¤–é”®çº¦æŸæ­£ç¡®
- âœ… ç´¢å¼•å®šä¹‰å®Œæ•´

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **å¤‡ä»½è„šæœ¬**: `/home/devbox/project/scripts/create_complete_backup_20251224.js`
- **å¤‡ä»½ç›®å½•**: `/home/devbox/project/backups/backup_2025-12-23/`
- **æ•°æ®åº“é…ç½®**: `/home/devbox/project/config/database.js`

---

## âœ… æœ€ç»ˆç¡®è®¤

**æ­¤å¤‡ä»½æ˜¯æœ€æ–°çš„ã€å®Œæ•´çš„ã€æ­£ç¡®çš„ï¼Œä¸å½“å‰å®é™…æ•°æ®åº“çš„è¡¨æ•°é‡ã€ç»“æ„ã€å†…å®¹ã€æ•°æ®ã€å­—æ®µã€ç´¢å¼•å’Œå¤–é”®çº¦æŸå®Œå…¨ä¸€è‡´ã€‚**

- æ•°æ®åº“è¡¨æ•°é‡: âœ… ä¸€è‡´ (43ä¸ª)
- è¡¨ç»“æ„: âœ… ä¸€è‡´
- æ•°æ®å†…å®¹: âœ… ä¸€è‡´ (7,040è¡Œ)
- å­—æ®µå®šä¹‰: âœ… ä¸€è‡´
- ç´¢å¼•: âœ… ä¸€è‡´
- å¤–é”®çº¦æŸ: âœ… ä¸€è‡´
- ç‰ˆæœ¬å…¼å®¹æ€§: âœ… ä¸€è‡´
- ç©ºè¡¨: âœ… å·²å®Œæ•´å¤‡ä»½ (10ä¸ª)

---

**å¤‡ä»½å®Œæˆæ—¶é—´**: 2025-12-23 23:31:55 (åŒ—äº¬æ—¶é—´)  
**å¤‡ä»½æ‰§è¡Œè€…**: è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬  
**éªŒè¯çŠ¶æ€**: âœ… å·²é€šè¿‡æ‰€æœ‰éªŒè¯é¡¹ç›®
