# 餐厅积分抽奖系统 - 环境变量配置
# 更新时间：2025年10月14日 - 切换到 test-db-12-mysql 外网地址

# 服务器配置
NODE_ENV=development
PORT=3000
WS_PORT=10081
TZ=Asia/Shanghai

# 🔴 数据库配置 - test-db-12-mysql（使用外网地址）
# 外网地址（当前使用）
DB_HOST=dbconn.sealosbja.site
DB_PORT=42569
DB_USER=root
DB_PASSWORD=mc6r9cgb
DB_NAME=restaurant_points_dev

# 内网地址（备用配置，需要时可切换）
# DB_HOST=test-db-12-mysql.ns-br0za7uc.svc
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=mc6r9cgb
# DB_NAME=restaurant_points_dev

# JWT配置
JWT_SECRET=restaurant_points_jwt_secret_key_development_only_32_chars
JWT_REFRESH_SECRET=restaurant_points_refresh_secret_development_64_chars
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=7d

# 加密配置
ENCRYPTION_KEY=abcdef1234567890abcdef1234567890

# Redis配置

# Sealos对象存储配置
SEALOS_ENDPOINT=https://objectstorageapi.bja.sealos.run
SEALOS_INTERNAL_ENDPOINT=http://object-storage.objectstorage-system.svc.cluster.local
SEALOS_BUCKET=br0za7uc-tiangong
SEALOS_ACCESS_KEY=br0za7uc
SEALOS_SECRET_KEY=skxg8mk5gqfhf9xz
SEALOS_REGION=bja

# OCR服务配置
OCR_PROVIDER=baidu_ocr
OCR_API_KEY=your_baidu_ocr_api_key
OCR_SECRET_KEY=your_baidu_ocr_secret_key

# 短信验证码服务配置
SMS_PROVIDER=aliyun_sms
SMS_ACCESS_KEY=your_aliyun_sms_access_key
SMS_SECRET_KEY=your_aliyun_sms_secret_key
SMS_SIGN_NAME=餐厅积分系统
SMS_TEMPLATE_CODE=SMS_123456789

# 服务器地址配置
INTERNAL_BASE_URL=http://devbox2.ns-br0za7uc.svc.cluster.local:3000
INTERNAL_WS_URL=ws://devbox2.ns-br0za7uc.svc.cluster.local:8080
PUBLIC_BASE_URL=https://omqktqrtntnn.sealosbja.site
PUBLIC_WS_URL=wss://omqktqrtntnn.sealosbja.site/ws

# 系统配置
LOG_LEVEL=info
MAX_FILE_SIZE=10485760
ENABLE_CORS=true
ENABLE_RATE_LIMIT=true

# 抽奖系统配置
LOTTERY_COST_POINTS=100
DAILY_LOTTERY_LIMIT=10
NEW_USER_POINTS=1000

# 积分系统配置  
PHOTO_POINTS_RATE=10
MIN_POINTS_AWARD=50
MAX_POINTS_AWARD=2000

# 微信小程序配置（API#1.2 微信授权一键登录需要）
# 获取方式：登录微信公众平台 https://mp.weixin.qq.com/
#  进入"开发" → "开发管理" → "开发设置"
#  复制AppID和AppSecret
# ⚠️ 注意：以下是示例值，需要替换为实际的微信小程序AppID和AppSecret
WX_APPID=wx0000000000000001
WX_SECRET=00000000000000000000000000000001

# Anthropic API 配置（用于AI功能）
ANTHROPIC_AUTH_TOKEN=sk-nPrEJFnzWkkU9ZRYp2JkJFm7j4w8PIG6FBDzu1RPGN9kS45s
ANTHROPIC_BASE_URL=https://cc.honoursoft.cn

# 平台收款账户（用于收取交易市场手续费） - 2025-12-15新增
PLATFORM_USER_ID=1
REDIS_URL=redis://localhost:6379

# 2025-12-30 添加：CORS 白名单（配置管理三层分离方案）
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080,https://omqktqrtntnn.sealosbja.site

# 决策25: PII数据哈希密钥（手机号等敏感数据脱敏）
PII_HASH_SECRET=7c47e455592b1e8223b9b59fe64d01d4
DISABLE_RATE_LIMITER=true
# V2动态二维码签名密钥 (HMAC-SHA256)
# 要求: 32字节随机值, 不复用JWT_SECRET, 所有后端实例必须一致
# 注意: 更换后旧码5分钟内失效, 建议低峰时段重启
CONSUMPTION_QR_SECRET=5570269d7df7db9e3286dd036e346741eca4368c3e90e1d9d5b0669ccd3db53c

# === 图片占位图配置（2026-01-14 Phase 2 拍板决定） ===
# 缩略图降级开关（生产默认关闭，紧急情况可开启）

# 占位图存储路径（Sealos 对象 key）- 由 13612227930 维护
DEFAULT_PLACEHOLDER_KEY=defaults/placeholder.png
DEFAULT_PRIZE_PLACEHOLDER_KEY=defaults/prize-placeholder.png
DEFAULT_PRODUCT_PLACEHOLDER_KEY=defaults/product-placeholder.png

# 系统定时任务用户ID（用于孤儿冻结检测等后台任务的operator_id）
SYSTEM_DAILY_JOB_USER_ID=11021

# ==================================================
# 抽奖策略引擎配置（2026-01-20 新增）
# 详见 docs/抽奖模块POINTS与BUDGET_POINTS平衡方案.md
# ==================================================

# --- Budget Tier 预算分层阈值 ---
# B3 阈值：预算 >= 此值可抽所有档位（默认 1000）
# BUDGET_TIER_THRESHOLD_HIGH=1000
# B2 阈值：预算 >= 此值可抽 mid + low + fallback（默认 500）
# BUDGET_TIER_THRESHOLD_MID=500
# B1 阈值：预算 >= 此值可抽 low + fallback（默认 100）
# BUDGET_TIER_THRESHOLD_LOW=100

# --- Pity 系统（软保底）---
# 是否启用 Pity 系统（默认 true，设为 false 禁用）
# PITY_ENABLED=true
# 灰度比例（0-100，默认 100 全量开放）
# PITY_GRAYSCALE_PERCENTAGE=100
# 用户 ID 白名单（逗号分隔，强制启用）
# PITY_USER_WHITELIST=

# --- LuckDebt 运气债务 ---
# 是否启用运气债务机制（默认 true）
# LUCK_DEBT_ENABLED=true
# 灰度比例（默认 100 全量开放）
# LUCK_DEBT_GRAYSCALE_PERCENTAGE=100

# --- AntiEmpty 防连空 ---
# 是否启用防连空机制（默认 true）
# ANTI_EMPTY_ENABLED=true
# 强制干预阈值（连续空奖次数，默认 8）
# ANTI_EMPTY_THRESHOLD=8

# --- AntiHigh 防连高 ---
# 是否启用防连高机制（默认 true）
# ANTI_HIGH_ENABLED=true
# 统计窗口大小（最近 N 次抽奖，默认 10）
# ANTI_HIGH_WINDOW=10

# --- 动态配置缓存 ---
# 配置缓存 TTL（毫秒，默认 5 分钟）
# STRATEGY_CONFIG_CACHE_TTL=300000


# 广告系统定时任务开关（true=启用凌晨1/3/4点的自动扣费、标签聚合、报表快照）
ENABLE_AD_CRON_JOBS=true

# 内容过期清理定时任务（弹窗/轮播/公告自动停用）
ENABLE_CONTENT_CRON_JOBS=true
REDEMPTION_QR_SECRET=3ea31b3c53fed6ba1f3df8b52c713c083fc3ae1a20e7bdaf9b3e0bb9da4ac5fd
