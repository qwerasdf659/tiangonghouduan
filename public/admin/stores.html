<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é—¨åº—ç®¡ç† - ç®¡ç†åå°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/admin/css/common.css" rel="stylesheet">
  <style>
    .store-card {
      transition: all 0.3s ease;
      border-left: 4px solid #0d6efd;
    }
    .store-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .store-card.inactive {
      border-left-color: #6c757d;
      opacity: 0.7;
    }
    .address-text {
      font-size: 0.85rem;
      color: #6c757d;
    }
  </style>
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a href="/admin/dashboard.html" class="navbar-brand">
        <i class="bi bi-arrow-left me-2"></i>ğŸª ç®¡ç†åå° - é—¨åº—ç®¡ç†
      </a>
      <div>
        <span class="text-light me-3" id="welcomeText">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">é€€å‡ºç™»å½•</button>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-shop text-primary" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">é—¨åº—æ€»æ•°</h6>
            <h2 id="totalStores" class="text-primary mb-0">-</h2>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">è¥ä¸šä¸­</h6>
            <h2 id="activeStores" class="text-success mb-0">-</h2>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-people text-warning" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">æ€»å‘˜å·¥æ•°</h6>
            <h2 id="totalStaff" class="text-warning mb-0">-</h2>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-geo-alt text-info" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">è¦†ç›–åŸå¸‚</h6>
            <h2 id="totalCities" class="text-info mb-0">-</h2>
          </div>
        </div>
      </div>
    </div>

    <!-- ç­›é€‰å’Œæ“ä½œæ  -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-md-3">
            <label class="form-label">é—¨åº—çŠ¶æ€</label>
            <select class="form-select" id="statusFilter">
              <option value="">å…¨éƒ¨çŠ¶æ€</option>
              <option value="active">è¥ä¸šä¸­</option>
              <option value="inactive">å·²åœä¸š</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">æœç´¢</label>
            <input type="text" class="form-control" id="searchInput" placeholder="æœç´¢é—¨åº—åç§°æˆ–åœ°å€...">
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary me-2" onclick="loadStores()">
              <i class="bi bi-search"></i> æœç´¢
            </button>
            <button class="btn btn-success" onclick="openCreateModal()">
              <i class="bi bi-plus-lg"></i> æ–°å¢é—¨åº—
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- é—¨åº—åˆ—è¡¨ -->
    <div class="row" id="storeList">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <div class="card d-none" id="emptyState">
      <div class="card-body text-center py-5">
        <i class="bi bi-shop text-muted" style="font-size: 4rem;"></i>
        <h5 class="text-muted mt-3">æš‚æ— é—¨åº—</h5>
        <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹"æ–°å¢é—¨åº—"æŒ‰é’®æ·»åŠ </p>
      </div>
    </div>
  </div>

  <!-- é—¨åº—è¡¨å•æ¨¡æ€æ¡† -->
  <div class="modal fade" id="storeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="storeModalTitle"><i class="bi bi-shop"></i> æ–°å¢é—¨åº—</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="storeForm">
            <input type="hidden" id="storeId">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">é—¨åº—åç§° <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="storeName" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">è”ç³»ç”µè¯</label>
                <input type="text" class="form-control" id="storePhone">
              </div>
              <div class="col-md-6">
                <label class="form-label">çœä»½ <span class="text-danger">*</span></label>
                <select class="form-select" id="storeProvince" onchange="loadCities()" required>
                  <option value="">è¯·é€‰æ‹©çœä»½</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">åŸå¸‚ <span class="text-danger">*</span></label>
                <select class="form-select" id="storeCity" onchange="loadDistricts()" required>
                  <option value="">è¯·å…ˆé€‰æ‹©çœä»½</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">åŒºå¿</label>
                <select class="form-select" id="storeDistrict" onchange="loadStreets()">
                  <option value="">è¯·å…ˆé€‰æ‹©åŸå¸‚</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">è¡—é“</label>
                <select class="form-select" id="storeStreet">
                  <option value="">è¯·å…ˆé€‰æ‹©åŒºå¿</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label">è¯¦ç»†åœ°å€ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="storeAddress" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">è¥ä¸šæ—¶é—´</label>
                <input type="text" class="form-control" id="storeHours" placeholder="å¦‚ï¼š09:00-22:00">
              </div>
              <div class="col-md-6">
                <label class="form-label">é—¨åº—çŠ¶æ€</label>
                <select class="form-select" id="storeStatus">
                  <option value="active">è¥ä¸šä¸­</option>
                  <option value="inactive">å·²åœä¸š</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label">å¤‡æ³¨</label>
                <textarea class="form-control" id="storeRemark" rows="2"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" onclick="submitStore()">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>

  <!-- é—¨åº—è¯¦æƒ…æ¨¡æ€æ¡† -->
  <div class="modal fade" id="storeDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-info-circle"></i> é—¨åº—è¯¦æƒ…</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="storeDetailContent">
          <!-- åŠ¨æ€å¡«å…… -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">åŠ è½½ä¸­...</span>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/js/admin-common.js"></script>
  <script src="/admin/js/api-config.js"></script>
  <script>
    let stores = [];
    let provinces = [];

    document.addEventListener('DOMContentLoaded', function() {
      const userInfo = getCurrentUser();
      if (userInfo && userInfo.nickname) {
        document.getElementById('welcomeText').textContent = `æ¬¢è¿ï¼Œ${userInfo.nickname}`;
      }
      document.getElementById('logoutBtn').addEventListener('click', logout);
      
      loadStores();
      loadProvinces();
    });

    async function loadStores() {
      showLoading();
      try {
        const status = document.getElementById('statusFilter').value;
        const search = document.getElementById('searchInput').value;

        const params = new URLSearchParams();
        if (status) params.append('status', status);
        if (search) params.append('search', search);

        const url = API_ENDPOINTS.STORE.LIST + (params.toString() ? `?${params.toString()}` : '');
        const response = await apiRequest(url);

        if (response && response.success) {
          stores = response.data.stores || response.data || [];
          renderStores(stores);
          updateStats(response.data.stats || {});
        } else {
          showError('åŠ è½½å¤±è´¥', response?.message || 'è·å–é—¨åº—åˆ—è¡¨å¤±è´¥');
        }
      } catch (error) {
        console.error('åŠ è½½é—¨åº—å¤±è´¥:', error);
        showError('åŠ è½½å¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    async function loadProvinces() {
      try {
        const response = await apiRequest(API_ENDPOINTS.REGION.PROVINCES);
        if (response && response.success) {
          provinces = response.data.provinces || response.data || [];
          const select = document.getElementById('storeProvince');
          select.innerHTML = '<option value="">è¯·é€‰æ‹©çœä»½</option>' +
            provinces.map(p => `<option value="${p.region_code}">${escapeHtml(p.region_name)}</option>`).join('');
        }
      } catch (error) {
        console.error('åŠ è½½çœä»½å¤±è´¥:', error);
      }
    }

    async function loadCities() {
      const provinceCode = document.getElementById('storeProvince').value;
      const citySelect = document.getElementById('storeCity');
      const districtSelect = document.getElementById('storeDistrict');
      const streetSelect = document.getElementById('storeStreet');

      citySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŸå¸‚</option>';
      districtSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©åŸå¸‚</option>';
      streetSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©åŒºå¿</option>';

      if (!provinceCode) return;

      try {
        const response = await apiRequest(API.buildURL(API_ENDPOINTS.REGION.CHILDREN, { parent_code: provinceCode }));
        if (response && response.success) {
          const cities = response.data.children || response.data || [];
          citySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŸå¸‚</option>' +
            cities.map(c => `<option value="${c.region_code}">${escapeHtml(c.region_name)}</option>`).join('');
        }
      } catch (error) {
        console.error('åŠ è½½åŸå¸‚å¤±è´¥:', error);
      }
    }

    async function loadDistricts() {
      const cityCode = document.getElementById('storeCity').value;
      const districtSelect = document.getElementById('storeDistrict');
      const streetSelect = document.getElementById('storeStreet');

      districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºå¿</option>';
      streetSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©åŒºå¿</option>';

      if (!cityCode) return;

      try {
        const response = await apiRequest(API.buildURL(API_ENDPOINTS.REGION.CHILDREN, { parent_code: cityCode }));
        if (response && response.success) {
          const districts = response.data.children || response.data || [];
          districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºå¿</option>' +
            districts.map(d => `<option value="${d.region_code}">${escapeHtml(d.region_name)}</option>`).join('');
        }
      } catch (error) {
        console.error('åŠ è½½åŒºå¿å¤±è´¥:', error);
      }
    }

    async function loadStreets() {
      const districtCode = document.getElementById('storeDistrict').value;
      const streetSelect = document.getElementById('storeStreet');

      streetSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¡—é“</option>';

      if (!districtCode) return;

      try {
        const response = await apiRequest(API.buildURL(API_ENDPOINTS.REGION.CHILDREN, { parent_code: districtCode }));
        if (response && response.success) {
          const streets = response.data.children || response.data || [];
          streetSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¡—é“</option>' +
            streets.map(s => `<option value="${s.region_code}">${escapeHtml(s.region_name)}</option>`).join('');
        }
      } catch (error) {
        console.error('åŠ è½½è¡—é“å¤±è´¥:', error);
      }
    }

    function renderStores(stores) {
      const container = document.getElementById('storeList');
      const emptyState = document.getElementById('emptyState');

      if (!stores || stores.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('d-none');
        return;
      }

      emptyState.classList.add('d-none');

      container.innerHTML = stores.map(store => `
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card store-card h-100 ${store.status !== 'active' ? 'inactive' : ''}">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0"><i class="bi bi-shop me-2"></i>${escapeHtml(store.name || 'æœªå‘½åé—¨åº—')}</h6>
              <span class="badge ${store.status === 'active' ? 'bg-success' : 'bg-secondary'}">
                ${store.status === 'active' ? 'è¥ä¸šä¸­' : 'å·²åœä¸š'}
              </span>
            </div>
            <div class="card-body">
              <p class="address-text mb-2">
                <i class="bi bi-geo-alt"></i> 
                ${escapeHtml(store.province_name || '')}${escapeHtml(store.city_name || '')}${escapeHtml(store.district_name || '')}
              </p>
              <p class="address-text mb-2">${escapeHtml(store.address || '-')}</p>
              <p class="mb-2">
                <i class="bi bi-telephone text-primary"></i> ${escapeHtml(store.phone || '-')}
              </p>
              <p class="mb-0">
                <i class="bi bi-clock text-warning"></i> ${escapeHtml(store.business_hours || '-')}
              </p>
            </div>
            <div class="card-footer bg-white">
              <button class="btn btn-sm btn-outline-primary me-1" onclick="viewStoreDetail(${store.store_id})">
                <i class="bi bi-eye"></i> è¯¦æƒ…
              </button>
              <button class="btn btn-sm btn-outline-warning me-1" onclick="editStore(${store.store_id})">
                <i class="bi bi-pencil"></i> ç¼–è¾‘
              </button>
              <button class="btn btn-sm btn-outline-${store.status === 'active' ? 'secondary' : 'success'}" 
                      onclick="toggleStoreStatus(${store.store_id}, '${store.status}')">
                <i class="bi bi-${store.status === 'active' ? 'pause' : 'play'}"></i> 
                ${store.status === 'active' ? 'åœä¸š' : 'è¥ä¸š'}
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function updateStats(stats) {
      document.getElementById('totalStores').textContent = stats.total || stores.length;
      document.getElementById('activeStores').textContent = stats.active || stores.filter(s => s.status === 'active').length;
      document.getElementById('totalStaff').textContent = stats.total_staff || '-';
      document.getElementById('totalCities').textContent = stats.cities || '-';
    }

    function openCreateModal() {
      document.getElementById('storeModalTitle').innerHTML = '<i class="bi bi-shop"></i> æ–°å¢é—¨åº—';
      document.getElementById('storeForm').reset();
      document.getElementById('storeId').value = '';
      new bootstrap.Modal(document.getElementById('storeModal')).show();
    }

    async function editStore(storeId) {
      showLoading();
      try {
        const response = await apiRequest(API.buildURL(API_ENDPOINTS.STORE.DETAIL, { store_id: storeId }));
        if (response && response.success) {
          const store = response.data;
          document.getElementById('storeModalTitle').innerHTML = '<i class="bi bi-pencil"></i> ç¼–è¾‘é—¨åº—';
          document.getElementById('storeId').value = store.store_id;
          document.getElementById('storeName').value = store.name || '';
          document.getElementById('storePhone').value = store.phone || '';
          document.getElementById('storeAddress').value = store.address || '';
          document.getElementById('storeHours').value = store.business_hours || '';
          document.getElementById('storeStatus').value = store.status || 'active';
          document.getElementById('storeRemark').value = store.remark || '';
          
          // è®¾ç½®åœ°åŒºé€‰æ‹©ï¼ˆç®€åŒ–å¤„ç†ï¼‰
          if (store.province_code) {
            document.getElementById('storeProvince').value = store.province_code;
            await loadCities();
            if (store.city_code) {
              document.getElementById('storeCity').value = store.city_code;
              await loadDistricts();
              if (store.district_code) {
                document.getElementById('storeDistrict').value = store.district_code;
                await loadStreets();
                if (store.street_code) {
                  document.getElementById('storeStreet').value = store.street_code;
                }
              }
            }
          }
          
          new bootstrap.Modal(document.getElementById('storeModal')).show();
        } else {
          showError('åŠ è½½å¤±è´¥', response?.message || 'è·å–é—¨åº—è¯¦æƒ…å¤±è´¥');
        }
      } catch (error) {
        console.error('åŠ è½½é—¨åº—è¯¦æƒ…å¤±è´¥:', error);
        showError('åŠ è½½å¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    async function submitStore() {
      const storeId = document.getElementById('storeId').value;
      const data = {
        name: document.getElementById('storeName').value,
        phone: document.getElementById('storePhone').value,
        province_code: document.getElementById('storeProvince').value,
        city_code: document.getElementById('storeCity').value,
        district_code: document.getElementById('storeDistrict').value,
        street_code: document.getElementById('storeStreet').value,
        address: document.getElementById('storeAddress').value,
        business_hours: document.getElementById('storeHours').value,
        status: document.getElementById('storeStatus').value,
        remark: document.getElementById('storeRemark').value
      };

      if (!data.name || !data.address) {
        alert('è¯·å¡«å†™é—¨åº—åç§°å’Œè¯¦ç»†åœ°å€');
        return;
      }

      showLoading();
      try {
        const url = storeId 
          ? API.buildURL(API_ENDPOINTS.STORE.UPDATE, { store_id: storeId })
          : API_ENDPOINTS.STORE.CREATE;
        const method = storeId ? 'PUT' : 'POST';

        const response = await apiRequest(url, {
          method: method,
          body: JSON.stringify(data)
        });

        if (response && response.success) {
          bootstrap.Modal.getInstance(document.getElementById('storeModal')).hide();
          alert(`âœ… ${storeId ? 'æ›´æ–°' : 'åˆ›å»º'}æˆåŠŸ`);
          loadStores();
        } else {
          showError('ä¿å­˜å¤±è´¥', response?.message || 'æ“ä½œå¤±è´¥');
        }
      } catch (error) {
        console.error('ä¿å­˜é—¨åº—å¤±è´¥:', error);
        showError('ä¿å­˜å¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    async function viewStoreDetail(storeId) {
      showLoading();
      try {
        const response = await apiRequest(API.buildURL(API_ENDPOINTS.STORE.DETAIL, { store_id: storeId }));
        if (response && response.success) {
          const store = response.data;
          document.getElementById('storeDetailContent').innerHTML = `
            <div class="row">
              <div class="col-md-6">
                <table class="table table-sm">
                  <tr><th style="width:40%">é—¨åº—ID</th><td>${store.store_id}</td></tr>
                  <tr><th>é—¨åº—åç§°</th><td>${escapeHtml(store.name || '-')}</td></tr>
                  <tr><th>è”ç³»ç”µè¯</th><td>${escapeHtml(store.phone || '-')}</td></tr>
                  <tr><th>è¥ä¸šæ—¶é—´</th><td>${escapeHtml(store.business_hours || '-')}</td></tr>
                  <tr><th>çŠ¶æ€</th><td><span class="badge ${store.status === 'active' ? 'bg-success' : 'bg-secondary'}">${store.status === 'active' ? 'è¥ä¸šä¸­' : 'å·²åœä¸š'}</span></td></tr>
                </table>
              </div>
              <div class="col-md-6">
                <table class="table table-sm">
                  <tr><th style="width:40%">çœä»½</th><td>${escapeHtml(store.province_name || '-')}</td></tr>
                  <tr><th>åŸå¸‚</th><td>${escapeHtml(store.city_name || '-')}</td></tr>
                  <tr><th>åŒºå¿</th><td>${escapeHtml(store.district_name || '-')}</td></tr>
                  <tr><th>è¡—é“</th><td>${escapeHtml(store.street_name || '-')}</td></tr>
                  <tr><th>è¯¦ç»†åœ°å€</th><td>${escapeHtml(store.address || '-')}</td></tr>
                </table>
              </div>
            </div>
            <div class="mt-3">
              <h6>å¤‡æ³¨</h6>
              <p class="text-muted">${escapeHtml(store.remark || 'æ— ')}</p>
            </div>
            <div class="row text-muted small">
              <div class="col-6">åˆ›å»ºæ—¶é—´ï¼š${formatDateTime(store.created_at)}</div>
              <div class="col-6">æ›´æ–°æ—¶é—´ï¼š${formatDateTime(store.updated_at)}</div>
            </div>
          `;
          new bootstrap.Modal(document.getElementById('storeDetailModal')).show();
        } else {
          showError('åŠ è½½å¤±è´¥', response?.message || 'è·å–é—¨åº—è¯¦æƒ…å¤±è´¥');
        }
      } catch (error) {
        console.error('åŠ è½½é—¨åº—è¯¦æƒ…å¤±è´¥:', error);
        showError('åŠ è½½å¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    async function toggleStoreStatus(storeId, currentStatus) {
      const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
      const action = newStatus === 'active' ? 'è¥ä¸š' : 'åœä¸š';
      
      if (!confirm(`ç¡®å®šè¦å°†æ­¤é—¨åº—è®¾ä¸º${action}çŠ¶æ€å—ï¼Ÿ`)) return;

      showLoading();
      try {
        const url = newStatus === 'active'
          ? API.buildURL(API_ENDPOINTS.STORE.ACTIVATE, { store_id: storeId })
          : API.buildURL(API_ENDPOINTS.STORE.DEACTIVATE, { store_id: storeId });

        const response = await apiRequest(url, { method: 'POST' });

        if (response && response.success) {
          alert(`âœ… é—¨åº—å·²${action}`);
          loadStores();
        } else {
          showError('æ“ä½œå¤±è´¥', response?.message || 'çŠ¶æ€æ›´æ–°å¤±è´¥');
        }
      } catch (error) {
        console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
        showError('æ“ä½œå¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    function formatDateTime(dateStr) {
      if (!dateStr) return '-';
      return new Date(dateStr).toLocaleString('zh-CN');
    }

    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    function showError(title, message) {
      alert(`âŒ ${title}\n${message}`);
    }
  </script>
</body>
</html>

