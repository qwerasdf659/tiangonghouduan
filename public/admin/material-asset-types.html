<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ææ–™èµ„äº§ç±»å‹ç®¡ç† - ç®¡ç†åå°</title>

  <!-- Bootstrap 5 - UIæ¡†æ¶ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons - å›¾æ ‡åº“ -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

  <!-- å…¬å…±æ ·å¼è¡¨ - ç»Ÿä¸€ä¸»é¢˜å’Œå“åº”å¼è®¾è®¡ -->
  <link href="/admin/css/common.css" rel="stylesheet">

  <style>
    .asset-badge {
      font-size: 0.875rem;
      padding: 0.25rem 0.75rem;
    }
  </style>
</head>
<body class="bg-light">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a href="/admin/dashboard.html" class="navbar-brand">
        <i class="bi bi-arrow-left me-2"></i>ğŸ’ ç®¡ç†åå° - ææ–™èµ„äº§ç±»å‹ç®¡ç†
      </a>
      <div>
        <span class="text-light me-3" id="welcomeText">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">é€€å‡ºç™»å½•</button>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <!-- æ“ä½œåŒºåŸŸ -->
    <div class="card mb-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-0">
              <i class="bi bi-gem"></i> ææ–™èµ„äº§ç±»å‹ç®¡ç†
            </h5>
            <small class="text-muted">é…ç½®ç³»ç»Ÿä¸­çš„ææ–™ç±»å‹ï¼ˆç¢ç‰‡/æ°´æ™¶ï¼‰</small>
          </div>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAssetTypeModal">
            <i class="bi bi-plus-lg"></i> æ·»åŠ èµ„äº§ç±»å‹
          </button>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <div class="card">
          <div class="card-body text-center">
            <h6 class="text-muted">èµ„äº§ç±»å‹æ€»æ•°</h6>
            <h3 class="text-primary" id="totalAssets">-</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body text-center">
            <h6 class="text-muted">å·²å¯ç”¨</h6>
            <h3 class="text-success" id="enabledAssets">-</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body text-center">
            <h6 class="text-muted">å·²ç¦ç”¨</h6>
            <h3 class="text-warning" id="disabledAssets">-</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card">
          <div class="card-body text-center">
            <h6 class="text-muted">ææ–™ç»„æ•°é‡</h6>
            <h3 class="text-info" id="totalGroups">-</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>èµ„äº§ä»£ç </th>
                <th>æ˜¾ç¤ºåç§°</th>
                <th>ææ–™ç»„</th>
                <th>å½¢æ€</th>
                <th>å±‚çº§</th>
                <th>å¯è§ä»·å€¼</th>
                <th>é¢„ç®—ä»·å€¼</th>
                <th>æ’åº</th>
                <th>çŠ¶æ€</th>
                <th style="width: 200px;">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="assetTypesTableBody">
              <tr>
                <td colspan="10" class="text-center py-5">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">åŠ è½½ä¸­...</span>
                  </div>
                  <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½æ•°æ®...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ èµ„äº§ç±»å‹æ¨¡æ€æ¡† -->
  <div class="modal fade" id="addAssetTypeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-plus-circle"></i> æ·»åŠ èµ„äº§ç±»å‹
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addAssetTypeForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">èµ„äº§ä»£ç  <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="assetCode" required placeholder="å¦‚: red_shard">
                <small class="text-muted">å”¯ä¸€æ ‡è¯†ï¼Œå»ºè®®ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">æ˜¾ç¤ºåç§° <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="displayName" required placeholder="å¦‚: ç¢çº¢æ°´æ™¶">
              </div>
              <div class="col-md-4">
                <label class="form-label">ææ–™ç»„ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="groupCode" required placeholder="å¦‚: red">
                <small class="text-muted">ç”¨äºåˆ†ç»„ï¼Œå¦‚: red, orange, purple</small>
              </div>
              <div class="col-md-4">
                <label class="form-label">å½¢æ€ <span class="text-danger">*</span></label>
                <select class="form-select" id="form" required>
                  <option value="">è¯·é€‰æ‹©</option>
                  <option value="shard">ç¢ç‰‡ï¼ˆshardï¼‰</option>
                  <option value="crystal">æ°´æ™¶ï¼ˆcrystalï¼‰</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">å±‚çº§ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="tier" required min="1" placeholder="å¦‚: 1">
                <small class="text-muted">å±‚çº§è¶Šé«˜ä»·å€¼è¶Šå¤§ï¼Œçº¢=1ï¼Œæ©™=2</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">å¯è§ä»·å€¼ï¼ˆç§¯åˆ†ï¼‰ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="visibleValue" required min="0" placeholder="å¦‚: 10">
                <small class="text-muted">ç”¨äºç”¨æˆ·å±•ç¤ºå’Œè¯´æ˜</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">é¢„ç®—ä»·å€¼ï¼ˆç§¯åˆ†ï¼‰ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="budgetValue" required min="0" placeholder="å¦‚: 10">
                <small class="text-muted">ç”¨äºç³»ç»Ÿæˆæœ¬æ§åˆ¶</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">æ’åºæƒé‡</label>
                <input type="number" class="form-control" id="sortOrder" value="0">
              </div>
              <div class="col-md-6">
                <label class="form-label">å¯ç”¨çŠ¶æ€</label>
                <select class="form-select" id="isEnabled">
                  <option value="1">å¯ç”¨</option>
                  <option value="0">ç¦ç”¨</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" id="submitAddBtn">
            <i class="bi bi-check-lg"></i> ç¡®è®¤æ·»åŠ 
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ç¼–è¾‘èµ„äº§ç±»å‹æ¨¡æ€æ¡† -->
  <div class="modal fade" id="editAssetTypeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-pencil"></i> ç¼–è¾‘èµ„äº§ç±»å‹
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editAssetTypeForm">
            <input type="hidden" id="editAssetCode">
            <div class="row g-3">
              <div class="col-md-12">
                <label class="form-label">èµ„äº§ä»£ç </label>
                <input type="text" class="form-control" id="editAssetCodeDisplay" disabled>
                <small class="text-muted">èµ„äº§ä»£ç ä¸å¯ä¿®æ”¹</small>
              </div>
              <div class="col-md-6">
                <label class="form-label">æ˜¾ç¤ºåç§° <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="editDisplayName" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">ææ–™ç»„</label>
                <input type="text" class="form-control" id="editGroupCode" disabled>
                <small class="text-muted">ææ–™ç»„ä¸å¯ä¿®æ”¹</small>
              </div>
              <div class="col-md-4">
                <label class="form-label">å½¢æ€</label>
                <input type="text" class="form-control" id="editForm" disabled>
                <small class="text-muted">å½¢æ€ä¸å¯ä¿®æ”¹</small>
              </div>
              <div class="col-md-4">
                <label class="form-label">å±‚çº§</label>
                <input type="number" class="form-control" id="editTier" disabled>
                <small class="text-muted">å±‚çº§ä¸å¯ä¿®æ”¹</small>
              </div>
              <div class="col-md-4">
                <label class="form-label">æ’åºæƒé‡</label>
                <input type="number" class="form-control" id="editSortOrder">
              </div>
              <div class="col-md-6">
                <label class="form-label">å¯è§ä»·å€¼ï¼ˆç§¯åˆ†ï¼‰ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="editVisibleValue" required min="0">
              </div>
              <div class="col-md-6">
                <label class="form-label">é¢„ç®—ä»·å€¼ï¼ˆç§¯åˆ†ï¼‰ <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="editBudgetValue" required min="0">
              </div>
              <div class="col-md-12">
                <label class="form-label">å¯ç”¨çŠ¶æ€</label>
                <select class="form-select" id="editIsEnabled">
                  <option value="1">å¯ç”¨</option>
                  <option value="0">ç¦ç”¨</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" id="submitEditBtn">
            <i class="bi bi-check-lg"></i> ä¿å­˜æ›´æ–°
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast æç¤ºç»„ä»¶ -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body" id="successToastBody"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
    <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body" id="errorToastBody"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- å…¬å…±å·¥å…·å‡½æ•° -->
  <script src="/admin/js/admin-common.js"></script>

  <!-- é¡µé¢è„šæœ¬ -->
  <script>
    // å…¨å±€å˜é‡
    let currentAssetTypes = [];
    let addAssetTypeModalInstance, editAssetTypeModalInstance;
    let successToastInstance, errorToastInstance;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // æƒé™æ£€æŸ¥
      if (!checkAdminPermission()) {
        return;
      }

      // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
      const user = getCurrentUser();
      if (user) {
        document.getElementById('welcomeText').textContent = `æ¬¢è¿ï¼Œ${user.nickname || user.mobile}`;
      }

      // åˆå§‹åŒ–æ¨¡æ€æ¡†
      addAssetTypeModalInstance = new bootstrap.Modal(document.getElementById('addAssetTypeModal'));
      editAssetTypeModalInstance = new bootstrap.Modal(document.getElementById('editAssetTypeModal'));

      // åˆå§‹åŒ–Toast
      successToastInstance = new bootstrap.Toast(document.getElementById('successToast'));
      errorToastInstance = new bootstrap.Toast(document.getElementById('errorToast'));

      // åŠ è½½æ•°æ®
      loadAssetTypes();

      // é€€å‡ºç™»å½•
      document.getElementById('logoutBtn').addEventListener('click', logout);

      // æäº¤æ·»åŠ 
      document.getElementById('submitAddBtn').addEventListener('click', submitAddAssetType);

      // æäº¤ç¼–è¾‘
      document.getElementById('submitEditBtn').addEventListener('click', submitEditAssetType);

      // è¡¨æ ¼æ“ä½œæŒ‰é’®äº‹ä»¶å§”æ‰˜
      document.getElementById('assetTypesTableBody').addEventListener('click', function(e) {
        // ç¼–è¾‘æŒ‰é’®
        const editBtn = e.target.closest('.edit-btn');
        if (editBtn) {
          const assetCode = editBtn.dataset.assetCode;
          editAssetType(assetCode);
          return;
        }

        // åˆ‡æ¢çŠ¶æ€æŒ‰é’®
        const toggleBtn = e.target.closest('.toggle-btn');
        if (toggleBtn) {
          const assetCode = toggleBtn.dataset.assetCode;
          const currentStatus = toggleBtn.dataset.status === '1';
          toggleAssetTypeStatus(assetCode, currentStatus);
          return;
        }
      });
    });

    /**
     * åŠ è½½èµ„äº§ç±»å‹åˆ—è¡¨
     */
    async function loadAssetTypes() {
      const tbody = document.getElementById('assetTypesTableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="10" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">åŠ è½½ä¸­...</span>
            </div>
            <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½æ•°æ®...</p>
          </td>
        </tr>
      `;

      try {
        const response = await apiRequest('/api/v4/console/material/asset-types');

        if (response && response.success) {
          currentAssetTypes = response.data || [];
          renderAssetTypes(currentAssetTypes);
          updateStatistics(currentAssetTypes);
        } else {
          showErrorToast(response?.message || 'åŠ è½½å¤±è´¥');
          tbody.innerHTML = `
            <tr>
              <td colspan="10" class="text-center py-5 text-danger">
                <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
                <p class="mt-2">åŠ è½½å¤±è´¥ï¼š${response?.message || 'æœªçŸ¥é”™è¯¯'}</p>
              </td>
            </tr>
          `;
        }
      } catch (error) {
        console.error('åŠ è½½èµ„äº§ç±»å‹å¤±è´¥:', error);
        showErrorToast(error.message);
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="text-center py-5 text-danger">
              <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
              <p class="mt-2">åŠ è½½å¤±è´¥ï¼š${error.message}</p>
            </td>
          </tr>
        `;
      }
    }

    /**
     * æ¸²æŸ“èµ„äº§ç±»å‹åˆ—è¡¨
     */
    function renderAssetTypes(assetTypes) {
      const tbody = document.getElementById('assetTypesTableBody');

      if (assetTypes.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="text-center py-5">
              <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
              <p class="mt-2 text-muted">æš‚æ— èµ„äº§ç±»å‹ï¼Œç‚¹å‡»å³ä¸Šè§’æ·»åŠ </p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = assetTypes.map(asset => `
        <tr>
          <td><code>${asset.asset_code}</code></td>
          <td><strong>${asset.display_name}</strong></td>
          <td><span class="badge bg-info">${asset.group_code}</span></td>
          <td><span class="badge ${asset.form === 'shard' ? 'bg-warning' : 'bg-primary'}">${getFormLabel(asset.form)}</span></td>
          <td><span class="badge bg-secondary">Tier ${asset.tier}</span></td>
          <td class="text-primary fw-bold">${asset.visible_value_points}</td>
          <td class="text-success fw-bold">${asset.budget_value_points}</td>
          <td>${asset.sort_order}</td>
          <td>
            <span class="badge ${asset.is_enabled ? 'bg-success' : 'bg-secondary'}">
              ${asset.is_enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}
            </span>
          </td>
          <td>
            <button class="btn btn-sm btn-primary edit-btn" data-asset-code="${asset.asset_code}">
              <i class="bi bi-pencil"></i> ç¼–è¾‘
            </button>
            <button class="btn btn-sm btn-${asset.is_enabled ? 'warning' : 'success'} toggle-btn"
                    data-asset-code="${asset.asset_code}"
                    data-status="${asset.is_enabled ? 1 : 0}">
              <i class="bi bi-${asset.is_enabled ? 'pause' : 'play'}-circle"></i>
              ${asset.is_enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
            </button>
          </td>
        </tr>
      `).join('');
    }

    /**
     * æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
     */
    function updateStatistics(assetTypes) {
      const total = assetTypes.length;
      const enabled = assetTypes.filter(a => a.is_enabled).length;
      const disabled = total - enabled;
      const groups = new Set(assetTypes.map(a => a.group_code)).size;

      document.getElementById('totalAssets').textContent = total;
      document.getElementById('enabledAssets').textContent = enabled;
      document.getElementById('disabledAssets').textContent = disabled;
      document.getElementById('totalGroups').textContent = groups;
    }

    /**
     * æäº¤æ·»åŠ èµ„äº§ç±»å‹
     */
    async function submitAddAssetType() {
      const form = document.getElementById('addAssetTypeForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const data = {
        asset_code: document.getElementById('assetCode').value.trim(),
        display_name: document.getElementById('displayName').value.trim(),
        group_code: document.getElementById('groupCode').value.trim(),
        form: document.getElementById('form').value,
        tier: parseInt(document.getElementById('tier').value),
        visible_value_points: parseInt(document.getElementById('visibleValue').value),
        budget_value_points: parseInt(document.getElementById('budgetValue').value),
        sort_order: parseInt(document.getElementById('sortOrder').value || 0),
        is_enabled: parseInt(document.getElementById('isEnabled').value)
      };

      try {
        const submitBtn = document.getElementById('submitAddBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>æäº¤ä¸­...';

        const response = await apiRequest('/api/v4/console/material/asset-types', {
          method: 'POST',
          body: JSON.stringify(data)
        });

        if (response && response.success) {
          showSuccessToast('æ·»åŠ æˆåŠŸ');
          addAssetTypeModalInstance.hide();
          form.reset();
          loadAssetTypes();
        } else {
          showErrorToast(response?.message || 'æ·»åŠ å¤±è´¥');
        }
      } catch (error) {
        console.error('æ·»åŠ èµ„äº§ç±»å‹å¤±è´¥:', error);
        showErrorToast(error.message);
      } finally {
        const submitBtn = document.getElementById('submitAddBtn');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="bi bi-check-lg"></i> ç¡®è®¤æ·»åŠ ';
      }
    }

    /**
     * ç¼–è¾‘èµ„äº§ç±»å‹
     */
    function editAssetType(assetCode) {
      const asset = currentAssetTypes.find(a => a.asset_code === assetCode);
      if (!asset) return;

      document.getElementById('editAssetCode').value = asset.asset_code;
      document.getElementById('editAssetCodeDisplay').value = asset.asset_code;
      document.getElementById('editDisplayName').value = asset.display_name;
      document.getElementById('editGroupCode').value = asset.group_code;
      document.getElementById('editForm').value = getFormLabel(asset.form);
      document.getElementById('editTier').value = asset.tier;
      document.getElementById('editSortOrder').value = asset.sort_order;
      document.getElementById('editVisibleValue').value = asset.visible_value_points;
      document.getElementById('editBudgetValue').value = asset.budget_value_points;
      document.getElementById('editIsEnabled').value = asset.is_enabled ? '1' : '0';

      editAssetTypeModalInstance.show();
    }

    /**
     * æäº¤ç¼–è¾‘èµ„äº§ç±»å‹
     */
    async function submitEditAssetType() {
      const form = document.getElementById('editAssetTypeForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const assetCode = document.getElementById('editAssetCode').value;
      const data = {
        display_name: document.getElementById('editDisplayName').value.trim(),
        visible_value_points: parseInt(document.getElementById('editVisibleValue').value),
        budget_value_points: parseInt(document.getElementById('editBudgetValue').value),
        sort_order: parseInt(document.getElementById('editSortOrder').value || 0),
        is_enabled: parseInt(document.getElementById('editIsEnabled').value)
      };

      try {
        const submitBtn = document.getElementById('submitEditBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>ä¿å­˜ä¸­...';

        const response = await apiRequest(`/api/v4/console/material/asset-types/${assetCode}`, {
          method: 'PUT',
          body: JSON.stringify(data)
        });

        if (response && response.success) {
          showSuccessToast('æ›´æ–°æˆåŠŸ');
          editAssetTypeModalInstance.hide();
          loadAssetTypes();
        } else {
          showErrorToast(response?.message || 'æ›´æ–°å¤±è´¥');
        }
      } catch (error) {
        console.error('æ›´æ–°èµ„äº§ç±»å‹å¤±è´¥:', error);
        showErrorToast(error.message);
      } finally {
        const submitBtn = document.getElementById('submitEditBtn');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="bi bi-check-lg"></i> ä¿å­˜æ›´æ–°';
      }
    }

    /**
     * åˆ‡æ¢èµ„äº§ç±»å‹çŠ¶æ€
     */
    async function toggleAssetTypeStatus(assetCode, currentStatus) {
      const newStatus = currentStatus ? 0 : 1;
      const action = newStatus ? 'å¯ç”¨' : 'ç¦ç”¨';

      if (!confirm(`ç¡®å®šè¦${action}è¯¥èµ„äº§ç±»å‹å—ï¼Ÿ`)) {
        return;
      }

      try {
        const response = await apiRequest(`/api/v4/console/material/asset-types/${assetCode}`, {
          method: 'PUT',
          body: JSON.stringify({ is_enabled: newStatus })
        });

        if (response && response.success) {
          showSuccessToast(`${action}æˆåŠŸ`);
          loadAssetTypes();
        } else {
          showErrorToast(response?.message || `${action}å¤±è´¥`);
        }
      } catch (error) {
        console.error(`${action}èµ„äº§ç±»å‹å¤±è´¥:`, error);
        showErrorToast(error.message);
      }
    }

    /**
     * è·å–å½¢æ€æ ‡ç­¾
     */
    function getFormLabel(form) {
      const labels = {
        'shard': 'ç¢ç‰‡',
        'crystal': 'æ°´æ™¶'
      };
      return labels[form] || form;
    }

    /**
     * æ˜¾ç¤ºæˆåŠŸæç¤º
     */
    function showSuccessToast(message) {
      document.getElementById('successToastBody').textContent = message;
      successToastInstance.show();
    }

    /**
     * æ˜¾ç¤ºé”™è¯¯æç¤º
     */
    function showErrorToast(message) {
      document.getElementById('errorToastBody').textContent = message;
      errorToastInstance.show();
    }
  </script>
</body>
</html>
