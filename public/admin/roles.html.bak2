<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è§’è‰²ç®¡ç† - ç®¡ç†åå°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/admin/css/common.css" rel="stylesheet">
  <style>
    .role-card {
      border-left: 4px solid #0d6efd;
      transition: all 0.3s ease;
    }
    .role-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .role-level-badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 10px;
    }
    .role-level-high { background: #d4edda; color: #155724; }
    .role-level-medium { background: #fff3cd; color: #856404; }
    .role-level-low { background: #f8d7da; color: #721c24; }
    .info-alert {
      background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
      border: 1px solid #90caf9;
      border-radius: 8px;
    }
  </style>
</head>
<body class="bg-light" x-data="rolesPage()">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a href="/admin/dashboard.html" class="navbar-brand">
        <i class="bi bi-arrow-left me-2"></i>ğŸ›¡ï¸ ç®¡ç†åå° - è§’è‰²ç®¡ç†
      </a>
      <div>
        <span class="text-light me-3" x-text="userInfo ? `æ¬¢è¿ï¼Œ${userInfo.nickname}` : 'æ¬¢è¿ï¼Œç®¡ç†å‘˜'"></span>
        <button class="btn btn-outline-light btn-sm" @click="logout()">é€€å‡ºç™»å½•</button>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <!-- ç³»ç»Ÿè¯´æ˜ -->
    <div class="alert info-alert mb-4">
      <div class="d-flex align-items-center">
        <i class="bi bi-info-circle text-primary me-2" style="font-size: 1.5rem;"></i>
        <div>
          <strong>è§’è‰²ç®¡ç†è¯´æ˜</strong>
          <p class="mb-0 small text-muted">
            ç³»ç»Ÿè§’è‰²ç”±æ•°æ®åº“é¢„è®¾ï¼Œæ­¤é¡µé¢ä»…å±•ç¤ºè§’è‰²åˆ—è¡¨ã€‚å¦‚éœ€ä¿®æ”¹ç”¨æˆ·è§’è‰²ï¼Œè¯·å‰å¾€ 
            <a href="/admin/users.html" class="text-decoration-none">ç”¨æˆ·ç®¡ç†</a> é¡µé¢æ“ä½œã€‚
          </p>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-shield-check text-primary" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">è§’è‰²æ€»æ•°</h6>
            <h2 class="text-primary mb-0" x-text="statistics.totalRoles"></h2>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-award text-success" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">æœ€é«˜æƒé™çº§åˆ«</h6>
            <h2 class="text-success mb-0" x-text="statistics.maxRoleLevel"></h2>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card stat-card">
          <div class="card-body text-center">
            <i class="bi bi-people text-warning" style="font-size: 2rem;"></i>
            <h6 class="text-muted mt-2">è§’è‰²ç±»å‹</h6>
            <h2 class="text-warning mb-0" x-text="statistics.roleTypes"></h2>
          </div>
        </div>
      </div>
    </div>

    <!-- æœç´¢æ  -->
    <div class="card mb-4">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <input 
            type="text" 
            class="form-control" 
            placeholder="æœç´¢è§’è‰²åç§°..." 
            style="width: 300px;"
            x-model="searchKeyword"
            @input="filterRoles()"
          >
        </div>
        <div class="text-muted small">
          <i class="bi bi-clock-history"></i> æ•°æ®åŠ è½½æ—¶é—´ï¼š<span x-text="loadTime"></span>
        </div>
      </div>
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <template x-if="loading">
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">åŠ è½½ä¸­...</span>
        </div>
        <p class="mt-2 text-muted">æ­£åœ¨åŠ è½½è§’è‰²æ•°æ®...</p>
      </div>
    </template>

    <!-- è§’è‰²åˆ—è¡¨ -->
    <div class="row" x-show="!loading">
      <!-- ç©ºçŠ¶æ€ -->
      <template x-if="filteredRoles.length === 0 && !loading">
        <div class="col-12">
          <div class="card">
            <div class="card-body text-center py-5 text-muted">
              <i class="bi bi-shield" style="font-size: 3rem;"></i>
              <p class="mt-2">æš‚æ— è§’è‰²æ•°æ®</p>
            </div>
          </div>
        </div>
      </template>

      <!-- è§’è‰²å¡ç‰‡ -->
      <template x-for="role in filteredRoles" :key="role.id">
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card role-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <i class="bi bi-shield-check text-primary"></i>
                <span x-text="role.role_name"></span>
              </h6>
              <span 
                class="role-level-badge"
                :class="getRoleLevelClass(role.role_level)"
                x-text="'çº§åˆ« ' + (role.role_level || 0)"
              ></span>
            </div>
            <div class="card-body">
              <p class="text-muted small mb-2">
                <i class="bi bi-fingerprint"></i> UUIDï¼š<code class="small" x-text="role.role_uuid || '-'"></code>
              </p>
              <p class="text-muted small mb-2">
                <i class="bi bi-hash"></i> IDï¼š<span x-text="role.id || '-'"></span>
              </p>
              <p class="text-muted small mb-0">
                <i class="bi bi-card-text"></i> <span x-text="role.description || 'æš‚æ— æè¿°'"></span>
              </p>
            </div>
            <div class="card-footer bg-white text-muted small">
              <i class="bi bi-info-circle"></i> 
              <span x-text="getRoleLevelDescription(role.role_level)"></span>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- å…¨å±€åŠ è½½é®ç½© -->
  <div class="loading-overlay" x-show="globalLoading" x-cloak>
    <div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">åŠ è½½ä¸­...</span>
    </div>
  </div>

  <!-- âœ… JavaScript åŠ è½½é¡ºåº -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/js/admin-common.js"></script>
  <script src="/admin/js/api-config.js"></script>
  <script src="/admin/js/pages/roles.js"></script>
  <script defer src="/admin/js/vendor/alpine.min.js"></script>
</body>
</html>
