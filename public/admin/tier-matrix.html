<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>BxPxçŸ©é˜µé…ç½® - ç®¡ç†åå°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/admin/css/common.css" rel="stylesheet">
  <style>
    .matrix-table th, .matrix-table td {
      text-align: center;
      vertical-align: middle;
      min-width: 140px;
    }
    .matrix-cell {
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 8px;
    }
    .matrix-cell:hover {
      background: #e9ecef !important;
    }
    .matrix-cell.editable {
      background: #f8f9fa;
    }
    .matrix-cell input {
      width: 70px;
      text-align: center;
      display: inline-block;
    }
    .cell-values {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .cell-value {
      font-size: 0.85rem;
    }
    .cap-value { color: #0d6efd; }
    .empty-value { color: #198754; }
    .tier-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    .tier-B0 { background: #f8d7da; color: #721c24; }
    .tier-B1 { background: #d4edda; color: #155724; }
    .tier-B2 { background: #cce5ff; color: #004085; }
    .tier-B3 { background: #fff3cd; color: #856404; }
    .tier-P0 { background: #e2e3e5; color: #383d41; }
    .tier-P1 { background: #d1ecf1; color: #0c5460; }
    .tier-P2 { background: #e2d5f1; color: #5a2d82; }
    .forced-empty {
      background: #f8d7da !important;
      color: #721c24;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a href="/admin/dashboard.html" class="navbar-brand">
        <i class="bi bi-arrow-left me-2"></i>ğŸ¯ ç®¡ç†åå° - BxPxçŸ©é˜µé…ç½®
      </a>
      <div>
        <span class="text-light me-3" id="welcomeText">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
        <button class="btn btn-outline-light btn-sm" id="logoutBtn">é€€å‡ºç™»å½•</button>
      </div>
    </div>
  </nav>

  <div class="container-fluid mt-4">
    <!-- è¯´æ˜å¡ç‰‡ -->
    <div class="card mb-4">
      <div class="card-body">
        <h6 class="card-title"><i class="bi bi-info-circle"></i> BxPxçŸ©é˜µè¯´æ˜</h6>
        <div class="row">
          <div class="col-md-4">
            <p class="mb-2"><strong>Bxï¼ˆBudget Tier é¢„ç®—å±‚çº§ï¼‰ï¼š</strong></p>
            <ul class="small mb-0">
              <li><span class="tier-badge tier-B0">B0</span> é¢„ç®—æä½ï¼ˆå¼ºåˆ¶ç©ºå¥–ï¼‰</li>
              <li><span class="tier-badge tier-B1">B1</span> ä½é¢„ç®—æ¡£ä½</li>
              <li><span class="tier-badge tier-B2">B2</span> ä¸­é¢„ç®—æ¡£ä½</li>
              <li><span class="tier-badge tier-B3">B3</span> é«˜é¢„ç®—æ¡£ä½</li>
            </ul>
          </div>
          <div class="col-md-4">
            <p class="mb-2"><strong>Pxï¼ˆPressure Tier æ´»åŠ¨å‹åŠ›å±‚çº§ï¼‰ï¼š</strong></p>
            <ul class="small mb-0">
              <li><span class="tier-badge tier-P0">P0</span> ä½å‹ï¼ˆæ¶ˆè€—æ…¢ï¼Œå¯ä»¥å®½æ¾ï¼‰</li>
              <li><span class="tier-badge tier-P1">P1</span> ä¸­å‹ï¼ˆæ­£å¸¸ï¼‰</li>
              <li><span class="tier-badge tier-P2">P2</span> é«˜å‹ï¼ˆæ¶ˆè€—å¿«ï¼Œéœ€è¦æ”¶ç´§ï¼‰</li>
            </ul>
          </div>
          <div class="col-md-4">
            <p class="mb-2"><strong>é…ç½®å‚æ•°è¯´æ˜ï¼š</strong></p>
            <div class="legend-item">
              <div class="legend-color" style="background: #0d6efd;"></div>
              <span class="small"><strong>Cap</strong>: é¢„ç®—ä¸Šé™ä¹˜æ•°ï¼ˆ0=å¼ºåˆ¶ç©ºå¥–ï¼Œ1=æ­£å¸¸ï¼‰</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #198754;"></div>
              <span class="small"><strong>Empty</strong>: ç©ºå¥–æƒé‡ä¹˜æ•°ï¼ˆ&lt;1æŠ‘åˆ¶ç©ºå¥–ï¼Œ&gt;1å¢å¼ºç©ºå¥–ï¼‰</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <span class="badge bg-info me-2" id="dataStatus">æ•°æ®åŠ è½½ä¸­...</span>
            <span class="text-muted small" id="lastUpdate"></span>
          </div>
          <div>
            <button class="btn btn-primary me-2" onclick="loadMatrixConfig()">
              <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
            </button>
            <button class="btn btn-success" onclick="saveMatrixConfig()">
              <i class="bi bi-save"></i> ä¿å­˜é…ç½®
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- çŸ©é˜µè¡¨æ ¼ -->
    <div class="card">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h6 class="mb-0"><i class="bi bi-grid-3x3"></i> BxPx é…ç½®çŸ©é˜µ</h6>
        <span class="badge bg-secondary">Budget Tier Ã— Pressure Tier</span>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered matrix-table" id="matrixTable">
            <thead class="table-light">
              <tr>
                <th class="bg-secondary text-white">Bx \ Px</th>
                <th><span class="tier-badge tier-P0">P0</span><br><small class="text-muted">ä½å‹</small></th>
                <th><span class="tier-badge tier-P1">P1</span><br><small class="text-muted">ä¸­å‹</small></th>
                <th><span class="tier-badge tier-P2">P2</span><br><small class="text-muted">é«˜å‹</small></th>
              </tr>
            </thead>
            <tbody id="matrixBody">
              <!-- åŠ¨æ€ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
        <div class="mt-3 text-muted small">
          <i class="bi bi-lightbulb"></i> æç¤ºï¼šç‚¹å‡»å•å…ƒæ ¼å¯ç¼–è¾‘æ•°å€¼ï¼Œç¼–è¾‘å®Œæˆåç‚¹å‡»"ä¿å­˜é…ç½®"æŒ‰é’®ç”Ÿæ•ˆã€‚
          <strong>Cap=0</strong> è¡¨ç¤ºå¼ºåˆ¶ç©ºå¥–ï¼ˆB0å±‚çº§ï¼‰ã€‚
        </div>
      </div>
    </div>

    <!-- é…ç½®è¯´æ˜ -->
    <div class="card mt-4">
      <div class="card-header bg-white">
        <h6 class="mb-0"><i class="bi bi-book"></i> é…ç½®é€»è¾‘è¯´æ˜</h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6>é¢„ç®—ä¸Šé™ä¹˜æ•° (cap_multiplier)</h6>
            <ul class="small">
              <li><code>0</code>: å¼ºåˆ¶ç©ºå¥–ï¼ˆç”¨äºB0é¢„ç®—æä½åœºæ™¯ï¼‰</li>
              <li><code>1.0</code>: æ­£å¸¸ï¼ˆå¯ç”¨å…¨éƒ¨æœ‰æ•ˆé¢„ç®—ï¼‰</li>
              <li><code>&lt;1.0</code>: æ”¶ç´§ï¼ˆé™åˆ¶æœ€å¤§æ¶ˆè€—ï¼‰</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6>ç©ºå¥–æƒé‡ä¹˜æ•° (empty_weight_multiplier)</h6>
            <ul class="small">
              <li><code>&lt;1.0</code>: æŠ‘åˆ¶ç©ºå¥–ï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰</li>
              <li><code>=1.0</code>: æ­£å¸¸</li>
              <li><code>&gt;1.0</code>: å¢å¼ºç©ºå¥–ï¼ˆæ§åˆ¶æˆæœ¬ï¼‰</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">åŠ è½½ä¸­...</span>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/js/admin-common.js"></script>
  <script src="/admin/js/api-config.js"></script>
  <script>
    // ========================================
    // ç‰ˆæœ¬: 2026-01-21-v4 - è°ƒè¯• configId é—®é¢˜
    // ========================================
    console.log('ğŸ”„ tier-matrix.html ç‰ˆæœ¬: 2026-01-21-v4');
    
    // åç«¯å®é™…çš„å±‚çº§å®šä¹‰
    const budgetTiers = ['B0', 'B1', 'B2', 'B3'];
    const pressureTiers = ['P0', 'P1', 'P2'];
    
    // å­˜å‚¨çŸ©é˜µé…ç½®ï¼ˆæŒ‰ budget_tier -> pressure_tier ç»„ç»‡ï¼‰
    let matrixConfig = {};
    // å­˜å‚¨åŸå§‹é…ç½®IDæ˜ å°„
    let configIdMap = {};
    let originalConfig = {};
    // è®°å½•è¢«ç¼–è¾‘è¿‡çš„å•å…ƒæ ¼
    let editedCells = new Set();

    document.addEventListener('DOMContentLoaded', function() {
      const userInfo = getCurrentUser();
      if (userInfo && userInfo.nickname) {
        document.getElementById('welcomeText').textContent = `æ¬¢è¿ï¼Œ${userInfo.nickname}`;
      }
      document.getElementById('logoutBtn').addEventListener('click', logout);
      
      // åŠ è½½çŸ©é˜µé…ç½®
      loadMatrixConfig();
    });

    /**
     * åŠ è½½çŸ©é˜µé…ç½®åˆ—è¡¨
     */
    async function loadMatrixConfig() {
      showLoading();
      document.getElementById('dataStatus').textContent = 'åŠ è½½ä¸­...';
      document.getElementById('dataStatus').className = 'badge bg-warning me-2';
      
      try {
        // è°ƒç”¨åç«¯APIè·å–çŸ©é˜µé…ç½®åˆ—è¡¨
        const response = await apiRequest(API_ENDPOINTS.MATRIX.LIST);

        if (response && response.success) {
          const list = response.data.list || response.data || [];
          
          // è°ƒè¯•ï¼šæ‰“å°åç«¯è¿”å›çš„åŸå§‹æ•°æ®
          console.log('åç«¯è¿”å›çš„åŸå§‹æ•°æ®:', list);
          if (list.length > 0) {
            console.log('ç¬¬ä¸€æ¡æ•°æ®çš„å­—æ®µ:', Object.keys(list[0]));
            console.log('ç¬¬ä¸€æ¡æ•°æ®:', list[0]);
          }
          
          // å°†åˆ—è¡¨æ•°æ®è½¬æ¢ä¸ºçŸ©é˜µæ ¼å¼
          matrixConfig = {};
          configIdMap = {};
          
          for (const item of list) {
            const bt = item.budget_tier;
            const pt = item.pressure_tier;
            // å°è¯•å¤šç§å¯èƒ½çš„IDå­—æ®µå
            const configId = item.matrix_config_id || item.id || item.config_id;
            
            console.log(`åŠ è½½é…ç½® ${bt}-${pt}: ID=${configId}`, item);
            
            if (!matrixConfig[bt]) {
              matrixConfig[bt] = {};
            }
            
            matrixConfig[bt][pt] = {
              cap_multiplier: parseFloat(item.cap_multiplier) || 0,
              empty_weight_multiplier: parseFloat(item.empty_weight_multiplier) || 1
            };
            
            // ä¿å­˜é…ç½®IDç”¨äºæ›´æ–°
            if (!configIdMap[bt]) configIdMap[bt] = {};
            configIdMap[bt][pt] = configId;
          }
          
          console.log('configIdMap æœ€ç»ˆç»“æœ:', configIdMap);
          
          originalConfig = JSON.parse(JSON.stringify(matrixConfig));
          editedCells.clear(); // åŠ è½½åæ¸…ç©ºç¼–è¾‘è®°å½•
          renderMatrix();
          
          document.getElementById('dataStatus').textContent = `å·²åŠ è½½ ${list.length} æ¡é…ç½®`;
          document.getElementById('dataStatus').className = 'badge bg-success me-2';
          document.getElementById('lastUpdate').textContent = `æ›´æ–°æ—¶é—´: ${new Date().toLocaleString('zh-CN')}`;
        } else {
          showError('åŠ è½½å¤±è´¥', response?.message || 'æ— æ³•è·å–çŸ©é˜µé…ç½®');
          document.getElementById('dataStatus').textContent = 'åŠ è½½å¤±è´¥';
          document.getElementById('dataStatus').className = 'badge bg-danger me-2';
          renderEmptyMatrix();
        }
      } catch (error) {
        console.error('åŠ è½½çŸ©é˜µé…ç½®å¤±è´¥:', error);
        showError('åŠ è½½å¤±è´¥', error.message);
        document.getElementById('dataStatus').textContent = 'åŠ è½½å¤±è´¥';
        document.getElementById('dataStatus').className = 'badge bg-danger me-2';
        renderEmptyMatrix();
      } finally {
        hideLoading();
      }
    }

    /**
     * æ¸²æŸ“ç©ºçŸ©é˜µï¼ˆæ— æ•°æ®æ—¶ï¼‰
     */
    function renderEmptyMatrix() {
      const tbody = document.getElementById('matrixBody');
      tbody.innerHTML = budgetTiers.map(bTier => `
        <tr>
          <th class="table-light">
            <span class="tier-badge tier-${bTier}">${bTier}</span>
            <br><small class="text-muted">${getBudgetTierLabel(bTier)}</small>
          </th>
          ${pressureTiers.map(pTier => `
            <td class="matrix-cell text-muted">-</td>
          `).join('')}
        </tr>
      `).join('');
    }

    /**
     * æ¸²æŸ“çŸ©é˜µ
     */
    function renderMatrix() {
      const tbody = document.getElementById('matrixBody');

      tbody.innerHTML = budgetTiers.map(bTier => `
        <tr>
          <th class="table-light">
            <span class="tier-badge tier-${bTier}">${bTier}</span>
            <br><small class="text-muted">${getBudgetTierLabel(bTier)}</small>
          </th>
          ${pressureTiers.map(pTier => {
            const config = matrixConfig[bTier]?.[pTier];
            const cap = config?.cap_multiplier ?? '-';
            const empty = config?.empty_weight_multiplier ?? '-';
            const isForcedEmpty = cap === 0;
            
            return `
              <td class="matrix-cell editable ${isForcedEmpty ? 'forced-empty' : ''}" 
                  onclick="editCell(this, '${bTier}', '${pTier}')"
                  data-bt="${bTier}" data-pt="${pTier}">
                <div class="cell-values">
                  <span class="cell-value cap-value"><strong>Cap:</strong> ${cap}</span>
                  <span class="cell-value empty-value"><strong>Empty:</strong> ${empty}</span>
                </div>
              </td>
            `;
          }).join('')}
        </tr>
      `).join('');
    }

    /**
     * è·å–é¢„ç®—å±‚çº§æ ‡ç­¾
     */
    function getBudgetTierLabel(tier) {
      const labels = {
        'B0': 'é¢„ç®—æä½',
        'B1': 'ä½é¢„ç®—',
        'B2': 'ä¸­é¢„ç®—',
        'B3': 'é«˜é¢„ç®—'
      };
      return labels[tier] || tier;
    }

    /**
     * ç¼–è¾‘å•å…ƒæ ¼
     */
    function editCell(cell, bTier, pTier) {
      // å¦‚æœå·²ç»åœ¨ç¼–è¾‘æ¨¡å¼ï¼Œå¿½ç•¥
      if (cell.querySelector('input')) return;

      // è®°å½•è¢«ç¼–è¾‘çš„å•å…ƒæ ¼
      editedCells.add(`${bTier}-${pTier}`);

      const config = matrixConfig[bTier]?.[pTier] || { cap_multiplier: 1, empty_weight_multiplier: 1 };
      const cap = config.cap_multiplier;
      const empty = config.empty_weight_multiplier;

      cell.innerHTML = `
        <div class="cell-values">
          <div class="mb-1">
            <label class="small text-primary">Cap:</label>
            <input type="number" class="form-control form-control-sm cap-input" 
                   value="${cap}" min="0" max="2" step="0.1"
                   onkeypress="if(event.key==='Enter')document.querySelector('.empty-input').focus()">
          </div>
          <div>
            <label class="small text-success">Empty:</label>
            <input type="number" class="form-control form-control-sm empty-input" 
                   value="${empty}" min="0" max="10" step="0.1"
                   onblur="saveCell(this.closest('.matrix-cell'), '${bTier}', '${pTier}')"
                   onkeypress="if(event.key==='Enter')this.blur()">
          </div>
        </div>
      `;
      cell.querySelector('.cap-input').focus();
      cell.querySelector('.cap-input').select();
    }

    /**
     * ä¿å­˜å•å…ƒæ ¼ç¼–è¾‘
     */
    function saveCell(cell, bTier, pTier) {
      const capInput = cell.querySelector('.cap-input');
      const emptyInput = cell.querySelector('.empty-input');
      
      if (!capInput || !emptyInput) return; // é˜²æ­¢é‡å¤è°ƒç”¨
      
      const cap = parseFloat(capInput.value) || 0;
      const empty = parseFloat(emptyInput.value) || 1;

      // æ›´æ–°é…ç½®
      if (!matrixConfig[bTier]) matrixConfig[bTier] = {};
      matrixConfig[bTier][pTier] = {
        cap_multiplier: cap,
        empty_weight_multiplier: empty
      };
      
      // è®°å½•ä¸ºå·²ç¼–è¾‘
      editedCells.add(`${bTier}-${pTier}`);
      console.log(`saveCell: ${bTier}-${pTier} -> Cap:${cap}, Empty:${empty}`);

      // æ›´æ–°æ˜¾ç¤º
      const isForcedEmpty = cap === 0;
      cell.className = `matrix-cell editable ${isForcedEmpty ? 'forced-empty' : ''}`;
      cell.innerHTML = `
        <div class="cell-values">
          <span class="cell-value cap-value"><strong>Cap:</strong> ${cap}</span>
          <span class="cell-value empty-value"><strong>Empty:</strong> ${empty}</span>
        </div>
      `;
    }

    /**
     * æ”¶é›†æ‰€æœ‰æ­£åœ¨ç¼–è¾‘çš„è¾“å…¥æ¡†çš„å€¼
     * åœ¨ä¿å­˜å‰è°ƒç”¨ï¼Œç¡®ä¿æ‰€æœ‰ç¼–è¾‘ä¸­çš„å€¼éƒ½è¢«æ”¶é›†åˆ°matrixConfigä¸­
     */
    function collectEditingValues() {
      const editingCells = document.querySelectorAll('.matrix-cell .cap-input');
      
      editingCells.forEach(capInput => {
        const cell = capInput.closest('.matrix-cell');
        const bTier = cell.dataset.bt;
        const pTier = cell.dataset.pt;
        const emptyInput = cell.querySelector('.empty-input');
        
        if (bTier && pTier && emptyInput) {
          const cap = parseFloat(capInput.value) || 0;
          const empty = parseFloat(emptyInput.value) || 1;
          
          // æ›´æ–°é…ç½®
          if (!matrixConfig[bTier]) matrixConfig[bTier] = {};
          matrixConfig[bTier][pTier] = {
            cap_multiplier: cap,
            empty_weight_multiplier: empty
          };
          
          // ç¡®ä¿è¿™ä¸ªå•å…ƒæ ¼è¢«æ ‡è®°ä¸ºå·²ç¼–è¾‘
          editedCells.add(`${bTier}-${pTier}`);
          
          console.log(`æ”¶é›†ç¼–è¾‘å€¼: ${bTier}-${pTier} -> Cap:${cap}, Empty:${empty}`);
        }
      });
    }

    /**
     * ä¿å­˜çŸ©é˜µé…ç½®åˆ°åç«¯
     */
    async function saveMatrixConfig() {
      // å…ˆæ”¶é›†æ‰€æœ‰æ­£åœ¨ç¼–è¾‘çš„è¾“å…¥æ¡†çš„å€¼
      collectEditingValues();
      
      // æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¾‘è¿‡çš„å•å…ƒæ ¼
      if (editedCells.size === 0) {
        alert('æ²¡æœ‰éœ€è¦ä¿å­˜çš„ä¿®æ”¹');
        return;
      }

      console.log('å‡†å¤‡ä¿å­˜çš„å•å…ƒæ ¼:', Array.from(editedCells));

      showLoading();
      try {
        let successCount = 0;
        let failCount = 0;

        // åªæ›´æ–°è¢«ç¼–è¾‘è¿‡çš„å•å…ƒæ ¼
        for (const cellKey of editedCells) {
          const [bTier, pTier] = cellKey.split('-');
          const configId = configIdMap[bTier]?.[pTier];
          const config = matrixConfig[bTier]?.[pTier];
          
          console.log(`ä¿å­˜ ${cellKey}: configId=${configId}, config=`, config);
          
          if (configId && config) {
            try {
              const url = API.buildURL(API_ENDPOINTS.MATRIX.UPDATE, { id: configId });
              console.log(`å‘é€æ›´æ–°è¯·æ±‚: ${url}`, config);
              
              const response = await apiRequest(url, {
                method: 'PUT',
                body: JSON.stringify({
                  cap_multiplier: config.cap_multiplier,
                  empty_weight_multiplier: config.empty_weight_multiplier
                })
              });

              if (response && response.success) {
                successCount++;
                console.log(`âœ… ${cellKey} æ›´æ–°æˆåŠŸ`);
              } else {
                failCount++;
                console.error(`âŒ ${cellKey} æ›´æ–°å¤±è´¥:`, response?.message);
              }
            } catch (error) {
              failCount++;
              console.error(`âŒ ${cellKey} æ›´æ–°é”™è¯¯:`, error);
            }
          } else {
            console.warn(`âš ï¸ ${cellKey} ç¼ºå°‘ configId æˆ– config`);
          }
        }

        if (failCount === 0 && successCount > 0) {
          originalConfig = JSON.parse(JSON.stringify(matrixConfig));
          editedCells.clear(); // æ¸…ç©ºç¼–è¾‘è®°å½•
          alert(`âœ… ä¿å­˜æˆåŠŸï¼Œæ›´æ–°äº† ${successCount} æ¡é…ç½®`);
          // åˆ·æ–°æ˜¾ç¤º
          renderMatrix();
        } else if (failCount > 0) {
          alert(`âš ï¸ éƒ¨åˆ†ä¿å­˜å¤±è´¥ï¼šæˆåŠŸ ${successCount} æ¡ï¼Œå¤±è´¥ ${failCount} æ¡`);
        } else {
          alert('ä¿å­˜å¤±è´¥ï¼šæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é…ç½®ID');
        }
      } catch (error) {
        console.error('ä¿å­˜çŸ©é˜µé…ç½®å¤±è´¥:', error);
        showError('ä¿å­˜å¤±è´¥', error.message);
      } finally {
        hideLoading();
      }
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }

    function showError(title, message) {
      alert(`âŒ ${title}\n${message}`);
    }
  </script>
</body>
</html>
