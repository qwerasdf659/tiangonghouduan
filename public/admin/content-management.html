<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">å†…å®¹ç®¡ç† - ç®¡ç†åå°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/admin/css/common.css" rel="stylesheet">
  <style>
    .sub-nav { background: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 0.5rem 0; }
    .sub-nav .nav-link { color: #495057; padding: 0.5rem 1rem; border-radius: 0.25rem; margin: 0 0.25rem; }
    .sub-nav .nav-link:hover { background: #e9ecef; }
    .sub-nav .nav-link.active { background: #0d6efd; color: white; }
    [x-cloak] { display: none !important; }
    .stat-card { border: none; box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075); }
    .notification-item { cursor: pointer; transition: background-color 0.2s; }
    .notification-item:hover { background-color: #f8f9fa; }
    .notification-item.unread { background-color: #e8f4fc; }
    .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
    .image-card { position: relative; overflow: hidden; border-radius: 0.5rem; }
    .image-card img { width: 100%; height: 150px; object-fit: cover; }
    .image-card .overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 0.5rem; color: white; }
    .banner-preview { max-width: 100%; max-height: 200px; object-fit: contain; border: 1px solid #dee2e6; border-radius: 0.5rem; }
  </style>

  <!-- Alpine.js -->
  <!-- âœ… Alpine.js Mixin ç³»ç»Ÿ -->
  <script defer src="/admin/js/alpine/mixins-bundle.js"></script>
  <script defer src="/admin/js/alpine/init.js"></script>
  <script defer src="/admin/js/vendor/alpine.min.js"></script>
</head>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a href="/admin/dashboard.html" class="navbar-brand">
        <i class="bi bi-arrow-left me-2"></i>ğŸª ç®¡ç†åå° - å†…å®¹ç®¡ç†
      </a>
      <div>
        <span class="text-light me-3" x-data x-text="$store.auth.user?.nickname ? `æ¬¢è¿ï¼Œ${$store.auth.user.nickname}` : 'æ¬¢è¿ï¼Œç®¡ç†å‘˜'">æ¬¢è¿ï¼Œç®¡ç†å‘˜</span>
        <button class="btn btn-outline-light btn-sm" onclick="logout()">é€€å‡ºç™»å½•</button>
      </div>
    </div>
  </nav>

  <!-- å­æ¨¡å—å¯¼èˆª -->
  <div class="sub-nav" x-data="contentNavigation()" x-cloak>
    <div class="container-fluid">
      <ul class="nav nav-pills">
        <template x-for="page in subPages" :key="page.id">
          <li class="nav-item">
            <a class="nav-link" :class="{ 'active': currentPage === page.id }" :href="'?page=' + page.id" @click.prevent="switchPage(page.id)">
              <i class="bi me-1" :class="page.icon"></i><span x-text="page.title"></span>
            </a>
          </li>
        </template>
      </ul>
    </div>
  </div>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <div class="container-fluid mt-4" x-data="contentPageContent()" x-cloak>
    
    <!-- ==================== å…¬å‘Šç®¡ç† ==================== -->
    <div x-show="currentPage === 'announcements'" x-cloak>
      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-megaphone"></i> å…¬å‘Šç®¡ç†</h5>
          <button class="btn btn-primary btn-sm" @click="openAddAnnouncementModal()">
            <i class="bi bi-plus"></i> å‘å¸ƒå…¬å‘Š
          </button>
        </div>
        <div class="card-body">
          <!-- ç­›é€‰å™¨ -->
          <div class="row mb-3 g-2">
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="announcementFilters.status">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="active">å·²å‘å¸ƒ</option>
                <option value="inactive">å·²ä¸‹çº¿</option>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="announcementFilters.type">
                <option value="">å…¨éƒ¨ç±»å‹</option>
                <option value="system">ç³»ç»Ÿ</option>
                <option value="activity">æ´»åŠ¨</option>
                <option value="maintenance">ç»´æŠ¤</option>
                <option value="notice">é€šçŸ¥</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control form-control-sm" placeholder="æœç´¢æ ‡é¢˜..." x-model="announcementFilters.keyword">
            </div>
            <div class="col-md-2">
              <button class="btn btn-primary btn-sm w-100" @click="loadAnnouncements()">
                <i class="bi bi-search"></i> æœç´¢
              </button>
            </div>
          </div>
          
          <!-- å…¬å‘Šè¡¨æ ¼ -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>æ ‡é¢˜</th>
                  <th>ç±»å‹</th>
                  <th>ä¼˜å…ˆçº§</th>
                  <th>çŠ¶æ€</th>
                  <th>åˆ›å»ºæ—¶é—´</th>
                  <th>è¿‡æœŸæ—¶é—´</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <template x-if="announcements.length === 0">
                  <tr><td colspan="8" class="text-center text-muted py-4">æš‚æ— å…¬å‘Šæ•°æ®</td></tr>
                </template>
                <template x-for="item in announcements" :key="item.announcement_id || item.id">
                  <tr>
                    <td x-text="item.announcement_id || item.id"></td>
                    <td>
                      <div class="fw-medium" x-text="item.title"></div>
                      <small class="text-muted" x-text="(item.content || '').substring(0, 50) + '...'"></small>
                    </td>
                    <td x-html="getAnnouncementTypeBadge(item.type)"></td>
                    <td><span class="badge" :class="item.priority === 'high' ? 'bg-danger' : item.priority === 'medium' ? 'bg-warning' : 'bg-secondary'" x-text="item.priority === 'high' ? 'é«˜' : item.priority === 'medium' ? 'ä¸­' : 'ä½'"></span></td>
                    <td x-html="getAnnouncementStatusBadge(item.is_active)"></td>
                    <td x-text="formatDateSafe(item.created_at)"></td>
                    <td x-text="item.expires_at ? formatDateSafe(item.expires_at) : '-'"></td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary" @click="editAnnouncement(item)"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-sm btn-outline-danger" @click="deleteAnnouncement(item)"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== é€šçŸ¥ç®¡ç† ==================== -->
    <div x-show="currentPage === 'notifications'" x-cloak>
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-bell text-primary" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">æ€»é€šçŸ¥æ•°</h6>
              <h2 x-text="notificationStats.total" class="text-primary mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-envelope text-danger" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">æœªè¯»é€šçŸ¥</h6>
              <h2 x-text="notificationStats.unread" class="text-danger mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-calendar-check text-success" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">ä»Šæ—¥é€šçŸ¥</h6>
              <h2 x-text="notificationStats.today" class="text-success mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-graph-up text-info" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">æœ¬å‘¨é€šçŸ¥</h6>
              <h2 x-text="notificationStats.week" class="text-info mb-0">-</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-bell"></i> é€šçŸ¥åˆ—è¡¨</h5>
          <div>
            <button class="btn btn-outline-secondary btn-sm me-2" @click="markAllNotificationsAsRead()">
              <i class="bi bi-check-all"></i> å…¨éƒ¨å·²è¯»
            </button>
            <button class="btn btn-primary btn-sm" @click="showModal('sendNotificationModal')">
              <i class="bi bi-send"></i> å‘é€é€šçŸ¥
            </button>
          </div>
        </div>
        <div class="card-body">
          <!-- ç­›é€‰å™¨ -->
          <div class="row mb-3 g-2">
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="notificationFilters.type" @change="loadNotifications()">
                <option value="all">å…¨éƒ¨ç±»å‹</option>
                <option value="system">ç³»ç»Ÿ</option>
                <option value="user">ç”¨æˆ·</option>
                <option value="order">è®¢å•</option>
                <option value="alert">è­¦å‘Š</option>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="notificationFilters.status" @change="loadNotifications()">
                <option value="all">å…¨éƒ¨çŠ¶æ€</option>
                <option value="unread">æœªè¯»</option>
                <option value="read">å·²è¯»</option>
              </select>
            </div>
          </div>

          <!-- é€šçŸ¥åˆ—è¡¨ -->
          <div class="list-group">
            <template x-if="notifications.length === 0">
              <div class="text-center text-muted py-4">æš‚æ— é€šçŸ¥</div>
            </template>
            <template x-for="notif in notifications" :key="notif.notification_id || notif.id">
              <a href="#" class="list-group-item list-group-item-action notification-item" :class="{ 'unread': !notif.is_read }" @click.prevent="viewNotification(notif)">
                <div class="d-flex w-100 justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <span x-html="getNotificationIcon(notif.type)" class="me-3"></span>
                    <div>
                      <h6 class="mb-1" x-text="notif.title"></h6>
                      <p class="mb-1 text-muted small" x-text="(notif.content || '').substring(0, 100)"></p>
                    </div>
                  </div>
                  <div class="text-end">
                    <small class="text-muted" x-text="formatRelativeTime(notif.created_at)"></small>
                    <span x-show="!notif.is_read" class="badge bg-danger ms-2">æ–°</span>
                  </div>
                </div>
              </a>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== å¼¹çª—æ¨ªå¹… ==================== -->
    <div x-show="currentPage === 'popup-banners'" x-cloak>
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-images text-primary" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">æ€»æ¨ªå¹…æ•°</h6>
              <h2 x-text="bannerStats.total" class="text-primary mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">å·²å¯ç”¨</h6>
              <h2 x-text="bannerStats.active" class="text-success mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-x-circle text-secondary" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">å·²ç¦ç”¨</h6>
              <h2 x-text="bannerStats.inactive" class="text-secondary mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-house text-info" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">é¦–é¡µæ¨ªå¹…</h6>
              <h2 x-text="bannerStats.home" class="text-info mb-0">-</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-images"></i> å¼¹çª—æ¨ªå¹…ç®¡ç†</h5>
          <button class="btn btn-primary btn-sm" @click="openAddBannerModal()">
            <i class="bi bi-plus"></i> æ·»åŠ æ¨ªå¹…
          </button>
        </div>
        <div class="card-body">
          <!-- ç­›é€‰å™¨ -->
          <div class="row mb-3 g-2">
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="bannerFilters.position">
                <option value="">å…¨éƒ¨ä½ç½®</option>
                <option value="home">é¦–é¡µ</option>
                <option value="profile">ä¸ªäººä¸­å¿ƒ</option>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="bannerFilters.status">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="true">å·²å¯ç”¨</option>
                <option value="false">å·²ç¦ç”¨</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control form-control-sm" placeholder="æœç´¢æ ‡é¢˜..." x-model="bannerFilters.keyword">
            </div>
            <div class="col-md-2">
              <button class="btn btn-primary btn-sm w-100" @click="loadBanners()">
                <i class="bi bi-search"></i> æœç´¢
              </button>
            </div>
          </div>

          <!-- æ¨ªå¹…è¡¨æ ¼ -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>é¢„è§ˆ</th>
                  <th>æ ‡é¢˜</th>
                  <th>ä½ç½®</th>
                  <th>æ’åº</th>
                  <th>çŠ¶æ€</th>
                  <th>æœ‰æ•ˆæœŸ</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <template x-if="banners.length === 0">
                  <tr><td colspan="8" class="text-center text-muted py-4">æš‚æ— æ¨ªå¹…æ•°æ®</td></tr>
                </template>
                <template x-for="banner in banners" :key="banner.banner_id">
                  <tr>
                    <td x-text="banner.banner_id"></td>
                    <td>
                      <img :src="banner.image_url || '/admin/images/placeholder.png'" 
                           class="rounded" style="width: 80px; height: 45px; object-fit: cover;" 
                           :alt="banner.title">
                    </td>
                    <td x-text="banner.title"></td>
                    <td><span class="badge bg-info" x-text="getBannerPositionText(banner.position)"></span></td>
                    <td x-text="banner.display_order"></td>
                    <td><span class="badge" :class="banner.is_active ? 'bg-success' : 'bg-secondary'" x-text="banner.is_active ? 'å¯ç”¨' : 'ç¦ç”¨'"></span></td>
                    <td>
                      <small x-text="banner.start_time ? formatDateSafe(banner.start_time) : '-'"></small>
                      <span class="text-muted">è‡³</span>
                      <small x-text="banner.end_time ? formatDateSafe(banner.end_time) : '-'"></small>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary" @click="editBanner(banner)"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-sm btn-outline-warning" @click="toggleBanner(banner)">
                        <i :class="banner.is_active ? 'bi-eye-slash' : 'bi-eye'"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" @click="deleteBanner(banner)"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== å›¾ç‰‡èµ„æº ==================== -->
    <div x-show="currentPage === 'image-resources'" x-cloak>
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-file-image text-primary" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">å›¾ç‰‡æ€»æ•°</h6>
              <h2 x-text="imageStats.total" class="text-primary mb-0">-</h2>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card stat-card">
            <div class="card-body text-center">
              <i class="bi bi-hdd text-info" style="font-size: 2rem;"></i>
              <h6 class="text-muted mt-2">æ€»å­˜å‚¨</h6>
              <h2 x-text="formatFileSize(imageStats.totalSize)" class="text-info mb-0">-</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-file-image"></i> å›¾ç‰‡èµ„æºç®¡ç†</h5>
          <button class="btn btn-primary btn-sm" @click="showModal('uploadImageModal')">
            <i class="bi bi-cloud-upload"></i> ä¸Šä¼ å›¾ç‰‡
          </button>
        </div>
        <div class="card-body">
          <!-- ç­›é€‰å™¨ -->
          <div class="row mb-3 g-2">
            <div class="col-md-2">
              <select class="form-select form-select-sm" x-model="imageFilters.type">
                <option value="">å…¨éƒ¨ç±»å‹</option>
                <option value="banner">æ¨ªå¹…</option>
                <option value="avatar">å¤´åƒ</option>
                <option value="product">äº§å“</option>
                <option value="other">å…¶ä»–</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control form-control-sm" placeholder="æœç´¢å›¾ç‰‡..." x-model="imageFilters.keyword">
            </div>
            <div class="col-md-2">
              <button class="btn btn-primary btn-sm w-100" @click="loadImages()">
                <i class="bi bi-search"></i> æœç´¢
              </button>
            </div>
          </div>

          <!-- å›¾ç‰‡ç½‘æ ¼ -->
          <div class="image-grid">
            <template x-if="images.length === 0">
              <div class="text-center text-muted py-4" style="grid-column: 1 / -1;">æš‚æ— å›¾ç‰‡èµ„æº</div>
            </template>
            <template x-for="image in images" :key="image.image_id || image.id">
              <div class="image-card shadow-sm">
                <img :src="image.url || image.image_url" :alt="image.filename || image.name" @click="viewImage(image)">
                <div class="overlay">
                  <small x-text="image.filename || image.name" class="d-block text-truncate"></small>
                  <small x-text="formatFileSize(image.size || image.file_size)"></small>
                </div>
                <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1" @click.stop="deleteImage(image)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== æ¨¡æ€æ¡† ==================== -->

  <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
  <div class="modal fade" id="announcementModal" tabindex="-1" x-ref="announcementModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" x-text="editingAnnouncementId ? 'ç¼–è¾‘å…¬å‘Š' : 'å‘å¸ƒå…¬å‘Š'"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">æ ‡é¢˜ <span class="text-danger">*</span></label>
            <input type="text" class="form-control" x-model="announcementForm.title" placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜">
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">ç±»å‹</label>
              <select class="form-select" x-model="announcementForm.type">
                <option value="notice">é€šçŸ¥</option>
                <option value="system">ç³»ç»Ÿ</option>
                <option value="activity">æ´»åŠ¨</option>
                <option value="maintenance">ç»´æŠ¤</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">ä¼˜å…ˆçº§</label>
              <select class="form-select" x-model="announcementForm.priority">
                <option value="low">ä½</option>
                <option value="medium">ä¸­</option>
                <option value="high">é«˜</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">çŠ¶æ€</label>
              <select class="form-select" x-model="announcementForm.status">
                <option value="active">å‘å¸ƒ</option>
                <option value="inactive">è‰ç¨¿</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">å†…å®¹ <span class="text-danger">*</span></label>
            <textarea class="form-control" rows="6" x-model="announcementForm.content" placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰</label>
            <input type="datetime-local" class="form-control" x-model="announcementForm.expiresAt">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" @click="saveAnnouncement()" :disabled="saving">
            <span x-show="saving" class="spinner-border spinner-border-sm me-1"></span>
            <span x-text="saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- é€šçŸ¥è¯¦æƒ…æ¨¡æ€æ¡† -->
  <div class="modal fade" id="notificationDetailModal" tabindex="-1" x-ref="notificationDetailModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">é€šçŸ¥è¯¦æƒ…</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" x-show="currentNotification">
          <div class="text-center mb-4" x-html="getNotificationIcon(currentNotification?.type)"></div>
          <h5 class="text-center mb-3" x-text="currentNotification?.title"></h5>
          <p class="text-muted" x-text="currentNotification?.content"></p>
          <hr>
          <div class="d-flex justify-content-between text-muted small">
            <span>ç±»å‹: <span x-text="currentNotification?.type"></span></span>
            <span x-text="formatDateSafe(currentNotification?.created_at)"></span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
        </div>
      </div>
    </div>
  </div>

  <!-- å‘é€é€šçŸ¥æ¨¡æ€æ¡† -->
  <div class="modal fade" id="sendNotificationModal" tabindex="-1" x-ref="sendNotificationModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">å‘é€é€šçŸ¥</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">é€šçŸ¥ç±»å‹</label>
            <select class="form-select" x-model="sendNotificationForm.type">
              <option value="system">ç³»ç»Ÿé€šçŸ¥</option>
              <option value="user">ç”¨æˆ·é€šçŸ¥</option>
              <option value="alert">è­¦å‘Š</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">æ ‡é¢˜</label>
            <input type="text" class="form-control" x-model="sendNotificationForm.title" placeholder="é€šçŸ¥æ ‡é¢˜">
          </div>
          <div class="mb-3">
            <label class="form-label">å†…å®¹</label>
            <textarea class="form-control" rows="4" x-model="sendNotificationForm.content" placeholder="é€šçŸ¥å†…å®¹"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">å‘é€å¯¹è±¡</label>
            <select class="form-select" x-model="sendNotificationForm.target">
              <option value="all">æ‰€æœ‰ç”¨æˆ·</option>
              <option value="admins">ç®¡ç†å‘˜</option>
              <option value="vip">VIPç”¨æˆ·</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" @click="sendNotification()" :disabled="sending">
            <span x-show="sending" class="spinner-border spinner-border-sm me-1"></span>
            <span x-text="sending ? 'å‘é€ä¸­...' : 'å‘é€'"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- æ¨ªå¹…ç¼–è¾‘æ¨¡æ€æ¡† -->
  <div class="modal fade" id="bannerModal" tabindex="-1" x-ref="bannerModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" x-text="isEditMode ? 'ç¼–è¾‘æ¨ªå¹…' : 'æ·»åŠ æ¨ªå¹…'"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">æ ‡é¢˜</label>
            <input type="text" class="form-control" x-model="bannerForm.title" placeholder="æ¨ªå¹…æ ‡é¢˜">
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">æ˜¾ç¤ºä½ç½®</label>
              <select class="form-select" x-model="bannerForm.position">
                <option value="home">é¦–é¡µ</option>
                <option value="profile">ä¸ªäººä¸­å¿ƒ</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">æ’åº</label>
              <input type="number" class="form-control" x-model.number="bannerForm.display_order" min="0">
            </div>
            <div class="col-md-4">
              <label class="form-label">çŠ¶æ€</label>
              <select class="form-select" x-model="bannerForm.is_active">
                <option :value="true">å¯ç”¨</option>
                <option :value="false">ç¦ç”¨</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">å¼€å§‹æ—¶é—´</label>
              <input type="datetime-local" class="form-control" x-model="bannerForm.start_time">
            </div>
            <div class="col-md-6">
              <label class="form-label">ç»“æŸæ—¶é—´</label>
              <input type="datetime-local" class="form-control" x-model="bannerForm.end_time">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">æ¨ªå¹…å›¾ç‰‡</label>
            <div class="border rounded p-3 text-center" 
                 :class="{ 'border-primary bg-light': isDragging }"
                 @dragover.prevent="isDragging = true"
                 @dragleave="isDragging = false"
                 @drop.prevent="handleImageDrop($event)">
              <template x-if="imagePreview">
                <div>
                  <img :src="imagePreview" class="banner-preview mb-2">
                  <p class="small text-muted mb-0" x-text="imageFileName"></p>
                  <button type="button" class="btn btn-sm btn-outline-danger mt-2" @click="clearImage()">ç§»é™¤å›¾ç‰‡</button>
                </div>
              </template>
              <template x-if="!imagePreview">
                <div>
                  <i class="bi bi-cloud-upload" style="font-size: 3rem;"></i>
                  <p class="mb-2">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
                  <input type="file" class="d-none" id="bannerImageInput" accept="image/*" @change="handleImageSelect($event)">
                  <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('bannerImageInput').click()">
                    é€‰æ‹©å›¾ç‰‡
                  </button>
                </div>
              </template>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-primary" @click="saveBanner()" :disabled="saving">
            <span x-show="saving" class="spinner-border spinner-border-sm me-1"></span>
            <span x-text="saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¸Šä¼ å›¾ç‰‡æ¨¡æ€æ¡† -->
  <div class="modal fade" id="uploadImageModal" tabindex="-1" x-ref="uploadImageModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ä¸Šä¼ å›¾ç‰‡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="border rounded p-4 text-center">
            <i class="bi bi-cloud-upload" style="font-size: 4rem;"></i>
            <p class="mt-2">æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
            <input type="file" class="d-none" id="imageUploadInput" accept="image/*" multiple>
            <button type="button" class="btn btn-primary" onclick="document.getElementById('imageUploadInput').click()">
              é€‰æ‹©å›¾ç‰‡
            </button>
          </div>
          <small class="text-muted d-block mt-2">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå•å¼ æœ€å¤§ 5MB</small>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
        </div>
      </div>
    </div>
  </div>

  <!-- åŠ è½½é®ç½© -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">å¤„ç†ä¸­...</span>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/js/admin-common.js"></script>
  <script src="/admin/js/api-config.js"></script>
  <script src="/admin/js/pages/content-management.js"></script>
</body>
</html>

