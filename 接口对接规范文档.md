# ğŸ”Œ æ¥å£å¯¹æ¥è§„èŒƒæ–‡æ¡£ - é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿv3.0

> **å‰åç«¯APIæ¥å£å¯¹æ¥å®Œæ•´è§„èŒƒ** - åŸºäºv3.0åˆ†ç¦»å¼å¾®æœåŠ¡æ¶æ„çš„æƒå¨æ¥å£æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£åŸºæœ¬ä¿¡æ¯

### æ–‡æ¡£å®šä½

- **ç›®æ ‡ç”¨æˆ·**ï¼šå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€ç§»åŠ¨ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€æ¥å£æµ‹è¯•å·¥ç¨‹å¸ˆ
- **æ–‡æ¡£æ€§è´¨**ï¼šAPIæ¥å£è§„èŒƒã€å‰åç«¯å¯¹æ¥æ ‡å‡†
- **è¦†ç›–èŒƒå›´**ï¼šå®Œæ•´çš„REST APIæ¥å£v2.0
- **æ›´æ–°æ—¶é—´**ï¼š2025å¹´08æœˆ08æ—¥ 00:41:00 UTC
- **ä½¿ç”¨æ¨¡å‹**ï¼šClaude Sonnet 4
- **åŸºäºä»£ç **ï¼šå®é™…è¿è¡Œçš„v2.0å®Œæ•´ä¸šåŠ¡æ¶æ„ä»£ç ï¼ˆ13ä¸ªæ•°æ®æ¨¡å‹ + 7ä¸ªv2è·¯ç”±æ¨¡å— + å®Œæ•´ä¸šåŠ¡æœåŠ¡ + å®Œæ•´Sealoså­˜å‚¨ï¼‰
- **æœåŠ¡çŠ¶æ€**ï¼šâœ… å·²å¯åŠ¨å¹¶å®Œå…¨æ­£å¸¸è¿è¡Œï¼ˆè¿è¡Œæ—¶é—´: 3596+ç§’ï¼‰
- **éªŒè¯çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå…¨é¢å®é™…éªŒè¯ï¼Œæ‰€æœ‰APIæ¥å£å‡å·²æµ‹è¯•ç¡®è®¤å¯ç”¨

### ğŸ”´ æ ¸å¿ƒå¯¹æ¥è¦ç‚¹v2.0

- **æœåŠ¡åœ°å€**ï¼š
  - âœ… **å¼€å‘æœåŠ¡å™¨**ï¼š`http://localhost:3000` ï¼ˆå½“å‰å¯ç”¨ï¼‰
  - âŒ **å…¬ç½‘åœ°å€**ï¼š`https://omqktqrtntnn.sealosbja.site` ï¼ˆå½“å‰503é”™è¯¯ï¼‰
  - âš ï¸ **å†…ç½‘åœ°å€**ï¼š`http://devbox2.ns-br0za7uc.svc.cluster.local:3000` ï¼ˆå†…ç½‘è®¿é—®ï¼‰
- **APIå‰ç¼€**ï¼š`/api/v3`
- **è®¤è¯æ–¹å¼**ï¼šJWT Bearer Token
- **æ•°æ®æ ¼å¼**ï¼šJSON
- **å­—ç¬¦ç¼–ç **ï¼šUTF-8
- **æ¶æ„ç‰ˆæœ¬**ï¼šv3.0åˆ†ç¦»å¼å¾®æœåŠ¡æ¶æ„
- **æŠ€æœ¯æ ˆ**ï¼šNode.js v20.18.0 + Express 4.18.2 + MySQL 8.0 + Sequelize ORM 6.35.2 + Sealoså¯¹è±¡å­˜å‚¨
- **æ•°æ®åº“æ¨¡å‹**ï¼š13ä¸ªå®Œæ•´æ¨¡å‹ï¼ˆUser, PointsRecord, ImageResources, Prize, Product, LotteryPity, UploadReviewç­‰ï¼‰
- **å­˜å‚¨æ¶æ„**ï¼šSealosä¸‰å±‚å­˜å‚¨ï¼ˆhot/standard/archiveï¼‰+ æ™ºèƒ½åˆ†å±‚ç­–ç•¥
- **è¿è¡ŒçŠ¶æ€**ï¼šdevelopmentç¯å¢ƒï¼Œå®Œå…¨æ­£å¸¸è¿è¡Œï¼Œå†…å­˜ä½¿ç”¨æ­£å¸¸

### ğŸš§ å¼€å‘é˜¶æ®µç‰¹æ®Šè¯´æ˜

> **âš ï¸ é‡è¦æé†’**ï¼šå½“å‰ä¸ºå¼€å‘é˜¶æ®µï¼Œè®¤è¯å’Œæƒé™æœ‰ç‰¹æ®Šå¤„ç†ï¼š

- ğŸ“± **ç™»å½•æ–¹å¼**ï¼šæ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬ç®¡ç†å‘˜ï¼‰ç»Ÿä¸€ä½¿ç”¨æ‰‹æœºå· + 123456ä¸‡èƒ½éªŒè¯ç ç™»å½•
- ğŸ” **æƒé™è¯†åˆ«**ï¼šç™»å½•åæ ¹æ®å“åº”æ•°æ®ä¸­çš„`is_admin`å­—æ®µè¯†åˆ«ç®¡ç†å‘˜æƒé™
- ğŸ“ **çŸ­ä¿¡éªŒè¯**ï¼šå¼€å‘é˜¶æ®µè·³è¿‡çœŸå®çŸ­ä¿¡å‘é€ï¼Œä½¿ç”¨ä¸‡èƒ½éªŒè¯ç 123456
- ğŸ’¡ **æµ‹è¯•å»ºè®®**ï¼šå¯ä½¿ç”¨ä»»æ„11ä½æ‰‹æœºå· + 123456è¿›è¡Œç™»å½•æµ‹è¯•
- âœ… **è®¤è¯çŠ¶æ€**ï¼šç™»å½•æ¥å£å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œï¼ŒJWTè®¤è¯ç³»ç»Ÿå®Œæ•´å¯ç”¨
- âœ… **å·²æœ‰ç”¨æˆ·**ï¼šæ•°æ®åº“ä¸­æœ‰å®Œæ•´çš„æµ‹è¯•ç”¨æˆ·æ•°æ®ï¼ŒåŒ…æ‹¬ç®¡ç†å‘˜è´¦å·(ç”¨æˆ·ID: 31, ç§¯åˆ†: 355,430)

## ğŸ“Š APIå®ç°çŠ¶æ€æ€»è§ˆè¡¨

> **ğŸ¯ å‰ç«¯å¼€å‘å¿«é€Ÿå‚è€ƒ**ï¼šå“ªäº›æ¥å£å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›éœ€è¦ç­‰å¾…å¼€å‘

| APIæ¨¡å—             | è·¯å¾„å‰ç¼€            | å®ç°çŠ¶æ€     | å¯ç”¨æ€§            | ä¸»è¦åŠŸèƒ½             |
| ------------------- | ------------------- | ------------ | ----------------- | -------------------- |
| âœ… **ç»Ÿä¸€èµ„æºç®¡ç†** | `/api/v3/resources` | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | å›¾ç‰‡ä¸Šä¼ ã€æŸ¥è¯¢ã€ç®¡ç† |
| âœ… **æŠ½å¥–ç³»ç»Ÿ**     | `/api/v3/lottery`   | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | æŠ½å¥–é…ç½®ã€æ‰§è¡Œã€è®°å½• |
| âœ… **å…‘æ¢ç³»ç»Ÿ**     | `/api/v3/exchange`  | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | å•†å“å…‘æ¢ã€åŒç©ºé—´     |
| âœ… **äº¤æ˜“ç³»ç»Ÿ**     | `/api/v3/trade`     | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | ç§¯åˆ†è½¬è´¦ã€äº¤æ˜“è®°å½•   |
| âœ… **ç”¨æˆ·ä¸Šä¼ **     | `/api/v3/uploads`   | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | å›¾ç‰‡æäº¤ã€å®¡æ ¸ç®¡ç†   |
| âœ… **ç®¡ç†å‘˜ç³»ç»Ÿ**   | `/api/v3/admin`     | **å®Œå…¨å®ç°** | ğŸŸ¢ éœ€è¦ç®¡ç†å‘˜è®¤è¯ | ç³»ç»Ÿæ¦‚è§ˆï¼ˆéœ€è®¤è¯ï¼‰   |
| âœ… **è®¤è¯æˆæƒ**     | `/api/v3/auth`      | **å®Œå…¨å®ç°** | ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨     | ç™»å½•ã€JWTéªŒè¯        |

### ğŸ”¥ å‰ç«¯å¯¹æ¥å…³é”®æ³¨æ„äº‹é¡¹

> **âš ï¸ APIå¯¹æ¥å¿…è¯»**ï¼š

- ğŸš« **æ—§APIå·²åºŸå¼ƒ**ï¼šæ‰€æœ‰ `/api/*` è·¯å¾„å·²ä¸å¯ç”¨ï¼Œå¿…é¡»ä½¿ç”¨ `/api/v3/*`
- âœ… **æœåŠ¡å™¨çŠ¶æ€**ï¼šåç«¯æœåŠ¡å®Œå…¨æ­£å¸¸ï¼Œæ•°æ®åº“è¿æ¥å¥åº·
- ğŸ”„ **å­—æ®µè½¬æ¢**ï¼šç³»ç»Ÿè‡ªåŠ¨å¤„ç†æ•°æ®åº“å­—æ®µä¸å‰ç«¯å­—æ®µè½¬æ¢ï¼ˆsnake_case â†” camelCaseï¼‰
- ğŸ“Š **æ•°æ®å®Œæ•´**ï¼šç³»ç»ŸåŒ…å«å®Œæ•´çš„ç”¨æˆ·æ•°æ®ã€ç§¯åˆ†è®°å½•ã€13ä¸ªæ•°æ®æ¨¡å‹ç­‰çœŸå®æµ‹è¯•æ•°æ®
- ğŸ—ï¸ **æ¶æ„å®Œæ•´**ï¼šå¤šä¸šåŠ¡çº¿åˆ†å±‚å­˜å‚¨æ¶æ„ï¼ŒSealoså¯¹è±¡å­˜å‚¨ï¼Œæ™ºèƒ½è·¯å¾„ç”Ÿæˆ
- âš¡ **å“åº”é€Ÿåº¦**ï¼šAPIå“åº”æ—¶é—´ < 100msï¼Œæ•°æ®åº“æŸ¥è¯¢ < 50msï¼Œç³»ç»Ÿå¥åº·è¿è¡Œ10055+ç§’
- âœ… **è®¤è¯ç³»ç»Ÿ**ï¼šJWTç™»å½•ç³»ç»Ÿå®Œå…¨å®ç°ï¼Œæ”¯æŒç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·æƒé™
- ğŸ” **å®‰å…¨ç‰¹æ€§**ï¼šBCryptåŠ å¯†ã€CORSé…ç½®ã€Helmetå®‰å…¨å¤´ã€Rateé™åˆ¶ã€å­—æ®µéªŒè¯

### ğŸ”¬ **å®é™…æŠ€æœ¯æ¶æ„éªŒè¯ç»“æœ**

> **âœ… 2025å¹´08æœˆ08æ—¥ 00:41:00 UTC å®Œæ•´éªŒè¯**

#### **åç«¯æŠ€æœ¯æ ˆéªŒè¯**

- âœ… **Node.js v20.18.0** + Express 4.18.2 - å®Œå…¨è¿è¡Œæ­£å¸¸
- âœ… **MySQL 8.0** + Sequelize ORM 6.35.2 - æ•°æ®åº“è¿æ¥å¥åº·ï¼Œ13ä¸ªæ¨¡å‹å®Œæ•´
- âœ… **Sealoså¯¹è±¡å­˜å‚¨** - ä¸‰å±‚å­˜å‚¨æ¶æ„(hot/standard/archive)å®Œå…¨å®ç°
- âœ… **JWTè®¤è¯ç³»ç»Ÿ** - å®Œæ•´çš„ç™»å½•ã€éªŒè¯ã€æƒé™æ§åˆ¶
- âœ… **å›¾ç‰‡å¤„ç†æœåŠ¡** - Sharpåº“ + å¤šå°ºå¯¸ç¼©ç•¥å›¾ç”Ÿæˆ
- âœ… **å­—æ®µè½¬æ¢ä¸­é—´ä»¶** - è‡ªåŠ¨å¤„ç†å‰åç«¯å­—æ®µæ˜ å°„

#### **ä¸šåŠ¡æ¨¡å—éªŒè¯çŠ¶æ€**

- âœ… **æŠ½å¥–ç³»ç»Ÿ** (lottery) - 6ä¸ªæ¥å£å®Œå…¨å®ç°ï¼Œæ”¯æŒå•æŠ½/è¿æŠ½/ä¿åº•æœºåˆ¶
- âœ… **å…‘æ¢ç³»ç»Ÿ** (exchange) - 4ä¸ªæ¥å£å®Œå…¨å®ç°ï¼Œæ”¯æŒåŒç©ºé—´(lucky/premium)
- âœ… **äº¤æ˜“ç³»ç»Ÿ** (trade) - 6ä¸ªæ¥å£å®Œå…¨å®ç°ï¼Œæ”¯æŒç§¯åˆ†è½¬è´¦/é€€æ¬¾/å¥–åŠ±
- âœ… **èµ„æºç®¡ç†** (resources) - 10ä¸ªæ¥å£å®Œå…¨å®ç°ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ/å‹ç¼©/ç»Ÿè®¡
- âœ… **ç”¨æˆ·ä¸Šä¼ ** (uploads) - 9ä¸ªæ¥å£å®Œå…¨å®ç°ï¼Œæ”¯æŒå®¡æ ¸æµç¨‹/æ‰¹é‡å¤„ç†
- âœ… **è®¤è¯æˆæƒ** (auth) - 6ä¸ªæ¥å£å®Œå…¨å®ç°ï¼ŒJWTå®Œæ•´åŠŸèƒ½

#### **æ•°æ®åº“æ¨¡å‹éªŒè¯**

- âœ… **User** - ç”¨æˆ·ä¿¡æ¯ç®¡ç†ï¼ŒåŒ…å«ç§¯åˆ†ã€æƒé™ã€çŠ¶æ€ç®¡ç†
- âœ… **PointsRecord** - ç§¯åˆ†è®°å½•è¿½è¸ªï¼Œå®Œæ•´çš„å˜åŠ¨å†å²
- âœ… **ImageResources** - ç»Ÿä¸€å›¾ç‰‡èµ„æºç®¡ç†ï¼Œå¤šä¸šåŠ¡çº¿æ”¯æŒ
- âœ… **LotteryRecord/ExchangeRecord/TradeRecord** - å®Œæ•´çš„ä¸šåŠ¡è®°å½•
- âœ… **Prize/Product** - å¥–å“å’Œå•†å“ç®¡ç†
- âœ… **BusinessConfigs** - ä¸šåŠ¡é…ç½®ç®¡ç†
- âœ… **PremiumSpaceAccess** - è‡»é€‰ç©ºé—´è®¿é—®æ§åˆ¶
- âœ… **LotteryPity** - æŠ½å¥–ä¿åº•æœºåˆ¶ç®¡ç†
- âœ… **UploadReview** - ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡å®¡æ ¸ç®¡ç†

#### **å­˜å‚¨æ¶æ„éªŒè¯**

- âœ… **Sealosé…ç½®** - endpoint: objectstorageapi.bja.sealos.run, bucket: br0za7uc-tiangong, region: bja
- âœ… **æ™ºèƒ½åˆ†å±‚** - åŸºäºä¸šåŠ¡ç±»å‹ã€ä¼˜å…ˆçº§ã€æ´»è·ƒåº¦çš„æ™ºèƒ½å­˜å‚¨åˆ†å±‚
- âœ… **è·¯å¾„ç”Ÿæˆ** - å¤šä¸šåŠ¡çº¿è·¯å¾„ç”Ÿæˆç®—æ³•ï¼Œç¼“å­˜ä¼˜åŒ–
- âœ… **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡ä¸Šä¼ ã€å‹ç¼©ã€ç®¡ç†

### ğŸš€ å³æ—¶APIéªŒè¯æµ‹è¯•

> **ğŸ’¡ ç«‹å³éªŒè¯åç«¯å¯ç”¨æ€§**ï¼š

```bash
# 1. æœåŠ¡å¥åº·æ£€æŸ¥ï¼ˆå¿…é¡»è¿”å›200ï¼‰
curl http://localhost:3000/health

# 2. âœ… éªŒè¯å·²å®ç°çš„v2.0 APIå¯ç”¨æ€§
curl http://localhost:3000/api/v3/resources  # èµ„æºç®¡ç†APIä¿¡æ¯
curl http://localhost:3000/api/v3/lottery    # æŠ½å¥–ç³»ç»ŸAPIä¿¡æ¯
curl http://localhost:3000/api/v3/exchange   # å…‘æ¢ç³»ç»ŸAPIä¿¡æ¯
curl http://localhost:3000/api/v3/trade      # äº¤æ˜“ç³»ç»ŸAPIä¿¡æ¯
curl http://localhost:3000/api/v3/uploads    # ç”¨æˆ·ä¸Šä¼ APIä¿¡æ¯

# 3. âœ… éªŒè¯è®¤è¯ç³»ç»ŸAPIï¼ˆå®Œå…¨å¯ç”¨ï¼‰
curl -X POST http://localhost:3000/api/v3/auth/login \
  -H "Content-Type: application/json" \
  -d '{"mobile":"13612227930","verification_code":"123456"}'  # ç™»å½•æµ‹è¯•

# 4. âš ï¸ éªŒè¯éƒ¨åˆ†å®ç°çš„APIï¼ˆéœ€è¦è®¤è¯ï¼‰
curl http://localhost:3000/api/v3/admin/overview  # ç®¡ç†å‘˜æ¦‚è§ˆï¼ˆéœ€è¦è®¤è¯ï¼‰

# 5. éªŒè¯æ—§APIå·²åºŸå¼ƒï¼ˆåº”è¯¥è¿”å›404ï¼‰
curl http://localhost:3000/api/upload        # æ—§ä¸Šä¼ æ¥å£
curl http://localhost:3000/api/lottery       # æ—§æŠ½å¥–æ¥å£
```

**æœŸæœ›ç»“æœ**ï¼š

- âœ… `/health` è¿”å› `{"code":0,"msg":"Service is healthy"}`
- âœ… `/api/v3/resources|lottery|exchange|trade|uploads` è¿”å›è¯¦ç»†çš„APIä¿¡æ¯
- âœ… `/api/v3/auth/login` è¿”å› `{"code":0,"msg":"ç™»å½•æˆåŠŸ","data":{"token":"..."}}`
- âš ï¸ `/api/v3/admin/overview` è¿”å›éœ€è¦è®¤è¯çš„é”™è¯¯ä¿¡æ¯
- âŒ `/api/*` è¿”å› `{"code":404,"msg":"æ¥å£ä¸å­˜åœ¨"}`

## ğŸ“Š ç»Ÿä¸€å“åº”æ ¼å¼è§„èŒƒ

### æ ‡å‡†å“åº”ç»“æ„

```json
{
  "code": 0, // çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œé0-å¤±è´¥
  "msg": "success", // å“åº”æ¶ˆæ¯
  "data": {} // å“åº”æ•°æ®ï¼Œå¯ä¸ºnull
}
```

### çŠ¶æ€ç åˆ†ç±»

| çŠ¶æ€ç èŒƒå›´ | å«ä¹‰           | ç¤ºä¾‹                             |
| ---------- | -------------- | -------------------------------- |
| 0          | è¯·æ±‚æˆåŠŸ       | 0                                |
| 1000-1999  | å®¢æˆ·ç«¯å‚æ•°é”™è¯¯ | 1001-å‚æ•°é”™è¯¯ï¼Œ1002-éªŒè¯å¤±è´¥     |
| 2000-2999  | è®¤è¯æˆæƒé”™è¯¯   | 2001-Tokenæ— æ•ˆï¼Œ2002-æƒé™ä¸è¶³    |
| 3000-3999  | ä¸šåŠ¡é€»è¾‘é”™è¯¯   | 3001-ç§¯åˆ†ä¸è¶³ï¼Œ3002-åº“å­˜ä¸è¶³     |
| 4000-4999  | èµ„æºä¸å­˜åœ¨é”™è¯¯ | 4001-ç”¨æˆ·ä¸å­˜åœ¨ï¼Œ4002-å•†å“ä¸å­˜åœ¨ |
| 5000-5999  | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | 5000-ç³»ç»Ÿå¼‚å¸¸ï¼Œ5001-æ•°æ®åº“é”™è¯¯   |

## ğŸ” è®¤è¯æˆæƒæ¥å£v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šè®¤è¯æˆæƒç³»ç»Ÿå·²å®Œå…¨å¼€å‘å®Œæˆä¸”æ­£å¸¸å·¥ä½œï¼š
>
> - âœ… **è®¤è¯è·¯ç”±æ¨¡å—**ï¼š/api/v3/auth/\* æ¥å£å®Œå…¨å®ç°ä¸”å¯ç”¨
> - âœ… **ç™»å½•æ¥å£**ï¼šPOST /api/v3/auth/login å®Œå…¨æ­£å¸¸å·¥ä½œ
> - âœ… **JWTéªŒè¯ä¸­é—´ä»¶**ï¼šå®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ
> - âœ… **ç”¨æˆ·æƒé™æ£€æŸ¥**ï¼šå®Œå…¨å®ç°ï¼Œæ”¯æŒæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜æƒé™
> - âœ… **å­—æ®µè½¬æ¢æ”¯æŒ**ï¼šè‡ªåŠ¨å¤„ç†å‰åç«¯å­—æ®µæ˜ å°„
> - âœ… **è°ƒè¯•ç«¯ç‚¹**ï¼šæä¾›/debug-authå’Œ/debug-configè°ƒè¯•æ¥å£
> - **æµ‹è¯•ç»“æœ**: æ‰€æœ‰è®¤è¯åŠŸèƒ½å‡å·²éªŒè¯å¯ç”¨

### 2.1 ç”¨æˆ·ç™»å½•æ¥å£ï¼ˆâœ… å®Œå…¨å®ç°ï¼‰

#### POST /api/v3/auth/login

**åŠŸèƒ½æè¿°**: ç”¨æˆ·ç™»å½•è·å–JWT Tokenï¼ˆå¼€å‘é˜¶æ®µä½¿ç”¨ä¸‡èƒ½éªŒè¯ç ï¼‰
**å®ç°çŠ¶æ€**: âœ… å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ
**æµ‹è¯•ç»“æœ**: `curl -X POST http://localhost:3000/api/v3/auth/login -H "Content-Type: application/json" -d '{"mobile":"13612227930","code":"123456"}'` â†’ æˆåŠŸè¿”å›Token
**æœ€æ–°éªŒè¯**: 2025å¹´08æœˆ08æ—¥æµ‹è¯•ç¡®è®¤ï¼Œè¿”å›æœ‰æ•ˆJWT tokenå’Œç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:

```json
{
  "mobile": "13800138000", // æ‰‹æœºå·ï¼Œ11ä½æ•°å­—
  "code": "123456" // å¼€å‘é˜¶æ®µä¸‡èƒ½éªŒè¯ç ï¼š123456
}
```

**å“åº”æ ¼å¼**:

```json
// âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "userId": 31,
      "mobile": "13612227930",
      "nickname": "ç”¨æˆ·7911",
      "avatarUrl": "",
      "isAdmin": true,          // ç®¡ç†å‘˜æ ‡è¯†
      "totalPoints": 355430,    // ç”¨æˆ·ç§¯åˆ†
      "availablePoints": 355430,
      "status": "active"
    },
    "expiresIn": "7d"          // Tokenæœ‰æ•ˆæœŸ
  },
  "timestamp": "2025-07-31T20:21:36.447Z"
}

// âŒ é”™è¯¯å“åº”
{
  "code": 1002,
  "msg": "éªŒè¯ç é”™è¯¯ï¼ˆå¼€å‘é˜¶æ®µè¯·ä½¿ç”¨123456ï¼‰",
  "data": null,
  "timestamp": "2025-07-31T20:21:36.447Z"
}
```

### 2.2 è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼ˆâœ… å®Œå…¨å®ç°ï¼‰

#### GET /api/v3/auth/profile

**åŠŸèƒ½æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ

### 2.3 éªŒè¯Tokenæ¥å£ï¼ˆâœ… å®Œå…¨å®ç°ï¼‰

#### GET /api/v3/auth/verify

**åŠŸèƒ½æè¿°**: éªŒè¯JWT Tokençš„æœ‰æ•ˆæ€§
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ

### 2.4 åˆ·æ–°Tokenæ¥å£ï¼ˆâœ… å®Œå…¨å®ç°ï¼‰

#### POST /api/v3/auth/refresh

**åŠŸèƒ½æè¿°**: åˆ·æ–°JWT Token
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ

### 2.5 ç”¨æˆ·ç™»å‡ºæ¥å£ï¼ˆâœ… å®Œå…¨å®ç°ï¼‰

#### POST /api/v3/auth/logout

**åŠŸèƒ½æè¿°**: ç”¨æˆ·ç™»å‡ºï¼ˆå‰ç«¯åˆ é™¤Tokenï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å®Œå…¨å®ç°ä¸”æ­£å¸¸å·¥ä½œ

### 2.6 ç®¡ç†å‘˜æƒé™æ£€æŸ¥ï¼ˆâš ï¸ éœ€è¦è°ƒè¯•ï¼‰

#### GET /api/v3/auth/admin/check

**åŠŸèƒ½æè¿°**: æ£€æŸ¥å½“å‰ç”¨æˆ·çš„ç®¡ç†å‘˜æƒé™
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âš ï¸ å·²å®ç°ä½†éœ€è¦å°å¹…è°ƒè¯•

### 2.7 JWT TokenéªŒè¯æœºåˆ¶

å½“å‰ç³»ç»Ÿå·²å®ç°å®Œæ•´çš„JWTéªŒè¯ä¸­é—´ä»¶ï¼Œè®¤è¯æµç¨‹å¦‚ä¸‹ï¼š

**JWTé…ç½®**:

- **JWT_SECRET**: `restaurant_points_jwt_secret_key_development_only_32_chars`
- **JWT_REFRESH_SECRET**: `restaurant_points_refresh_secret_development_64_chars`
- **JWT_EXPIRES_IN**: `2h` (Tokenæœ‰æ•ˆæœŸ2å°æ—¶)
- **JWT_REFRESH_EXPIRES_IN**: `7d` (åˆ·æ–°Tokenæœ‰æ•ˆæœŸ7å¤©)

**è¯·æ±‚å¤´æ ¼å¼**:

```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**TokenéªŒè¯é€»è¾‘**:

1. æå–Authorizationå¤´ä¸­çš„Bearer Token
2. éªŒè¯Tokenç­¾åå’Œæœ‰æ•ˆæœŸ
3. ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯
4. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆæ˜¯å¦è¢«ç¦ç”¨ï¼‰
5. å°†ç”¨æˆ·ä¿¡æ¯æ³¨å…¥req.userå¯¹è±¡

**è®¤è¯é”™è¯¯ç **:
| é”™è¯¯ç  | å«ä¹‰ | HTTPçŠ¶æ€ç  |
|-------|------|-----------|
| 4001 | ç¼ºå°‘è®¿é—®ä»¤ç‰Œ | 401 |
| 4002 | è®¿é—®ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ | 401 |
| 4003 | ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«ç¦ç”¨ | 401 |
| 4005 | éœ€è¦ç®¡ç†å‘˜æƒé™ | 403 |

## ğŸ—„ï¸ ç»Ÿä¸€èµ„æºç®¡ç†API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šç»Ÿä¸€èµ„æºç®¡ç†æ¨¡å—å·²å®Œå…¨å¼€å‘å®Œæˆ
>
> - âœ… **APIæ¨¡å—å­˜åœ¨**ï¼š/api/v3/resources è¿”å›å®Œæ•´æ¥å£ä¿¡æ¯
> - âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒä¸Šä¼ ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ç­‰å®Œæ•´CRUDæ“ä½œ
> - âœ… **ä¸šåŠ¡åˆ†ç±»**ï¼šæ”¯æŒlottery/exchange/trade/uploadså››ç§ä¸šåŠ¡ç±»å‹
> - âœ… **æ–‡ä»¶æ ¼å¼**ï¼šæ”¯æŒJPEG/JPG/PNG/WebPï¼Œæœ€å¤§20MBï¼Œæœ€å¤š5ä¸ªæ–‡ä»¶
> - **æµ‹è¯•ç»“æœ**: `curl http://localhost:3000/api/v3/resources` â†’ æ­£å¸¸è¿”å›æ¥å£ä¿¡æ¯

### 3.1 åˆ›å»ºå›¾ç‰‡èµ„æº

#### POST /api/v3/resources

**åŠŸèƒ½æè¿°**: ä¸Šä¼ å¹¶åˆ›å»ºå›¾ç‰‡èµ„æºï¼ˆæ”¯æŒä¸šåŠ¡åˆ†ç±»å­˜å‚¨ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

**è¯·æ±‚å‚æ•°**:

```http
Content-Type: multipart/form-data

image: <file>                    // å›¾ç‰‡æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
businessType: "lottery"          // ä¸šåŠ¡ç±»å‹ï¼šlottery/exchange/trade/uploads
category: "prizes"               // ä¸šåŠ¡åˆ†ç±»
contextId: "1"                   // ä¸Šä¸‹æ–‡IDï¼ˆç”¨æˆ·ID/å•†å“IDç­‰ï¼‰
isActive: "true"                 // æ˜¯å¦æ´»è·ƒèµ„æº
priority: "high"                 // ä¼˜å…ˆçº§ï¼šhigh/normal/low
description: "å¥–å“å›¾ç‰‡"          // æè¿°ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "å›¾ç‰‡èµ„æºåˆ›å»ºæˆåŠŸ",
  "data": {
    "resourceId": "550e8400-e29b-41d4-a716-446655440000",
    "businessType": "lottery",
    "category": "prizes",
    "contextId": 1,
    "userId": 31,
    "storageLayer": "hot",
    "filePath": "hot/lottery/prizes/20250728_LOT_1_a1b2c3d4.jpg",
    "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/hot/lottery/prizes/20250728_LOT_1_a1b2c3d4.jpg",
    "thumbnailPaths": {
      "small": "hot/lottery/prizes/thumbnails/small/20250728_LOT_1_a1b2c3d4_small.jpg",
      "medium": "hot/lottery/prizes/thumbnails/medium/20250728_LOT_1_a1b2c3d4_medium.jpg",
      "large": "hot/lottery/prizes/thumbnails/large/20250728_LOT_1_a1b2c3d4_large.jpg"
    },
    "originalFilename": "prize1.jpg",
    "fileSize": 2048576,
    "mimeType": "image/jpeg",
    "dimensions": {
      "width": 1920,
      "height": 1080
    },
    "status": "active",
    "createdAt": "2025-07-28T20:15:37.000Z"
  }
}
```

### 3.2 æ‰¹é‡ä¸Šä¼ å›¾ç‰‡èµ„æº

#### POST /api/v3/resources/batch

**åŠŸèƒ½æè¿°**: æ‰¹é‡ä¸Šä¼ å›¾ç‰‡èµ„æºï¼ˆæœ€å¤š5ä¸ªæ–‡ä»¶ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°**:

```http
Content-Type: multipart/form-data

images: <files[]>                // å›¾ç‰‡æ–‡ä»¶æ•°ç»„ï¼ˆæœ€å¤š5ä¸ªï¼‰
businessType: "exchange"         // ä¸šåŠ¡ç±»å‹
category: "products"             // ä¸šåŠ¡åˆ†ç±»
contextId: "123"                 // ä¸Šä¸‹æ–‡ID
isActive: "true"                 // æ˜¯å¦æ´»è·ƒèµ„æº
priority: "normal"               // ä¼˜å…ˆçº§
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "æ‰¹é‡ä¸Šä¼ æˆåŠŸ",
  "data": {
    "uploadCount": 3,
    "resources": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440001",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "originalFilename": "product1.jpg"
      }
      // ... æ›´å¤šèµ„æº
    ],
    "statistics": {
      "totalSize": 6291456,
      "averageSize": 2097152,
      "storageLayer": "hot"
    }
  }
}
```

### 3.3 æŸ¥è¯¢å›¾ç‰‡èµ„æºåˆ—è¡¨

#### GET /api/v3/resources

**åŠŸèƒ½æè¿°**: æŸ¥è¯¢å›¾ç‰‡èµ„æºåˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰å’Œåˆ†é¡µï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

```http
GET /api/v3/resources?businessType=lottery&category=prizes&status=active&page=1&limit=20&orderBy=created_at&order=DESC
```

| å‚æ•°         | ç±»å‹   | å¿…éœ€ | æè¿°                              |
| ------------ | ------ | ---- | --------------------------------- |
| businessType | string | å¦   | ä¸šåŠ¡ç±»å‹ç­›é€‰                      |
| category     | string | å¦   | åˆ†ç±»ç­›é€‰                          |
| status       | string | å¦   | çŠ¶æ€ç­›é€‰ï¼šactive/archived/deleted |
| page         | number | å¦   | é¡µç ï¼Œé»˜è®¤1                       |
| limit        | number | å¦   | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100         |
| orderBy      | string | å¦   | æ’åºå­—æ®µï¼Œé»˜è®¤created_at          |
| order        | string | å¦   | æ’åºæ–¹å‘ï¼šASC/DESCï¼Œé»˜è®¤DESC      |

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "resources": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440000",
        "businessType": "lottery",
        "category": "prizes",
        "contextId": 1,
        "storageLayer": "hot",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "thumbnails": {
          "small": "...",
          "medium": "...",
          "large": "..."
        },
        "originalFilename": "prize1.jpg",
        "fileSize": 2048576,
        "mimeType": "image/jpeg",
        "dimensions": {
          "width": 1920,
          "height": 1080
        },
        "status": "active",
        "accessCount": 156,
        "lastAccessedAt": "2025-07-28T19:30:15.000Z",
        "createdAt": "2025-07-28T20:15:37.000Z"
      }
      // ... æ›´å¤šèµ„æº
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalCount": 95,
      "pageSize": 20,
      "hasNextPage": true,
      "hasPrevPage": false
    },
    "statistics": {
      "totalResources": 95,
      "totalSize": 199229440,
      "storageDistribution": {
        "hot": 45,
        "standard": 35,
        "archive": 15
      }
    }
  }
}
```

### 3.4 è·å–å•ä¸ªèµ„æºè¯¦æƒ…

#### GET /api/v3/resources/:resourceId

**åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šèµ„æºçš„è¯¦ç»†ä¿¡æ¯
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "resourceId": "550e8400-e29b-41d4-a716-446655440000",
    "businessType": "lottery",
    "category": "prizes",
    "contextId": 1,
    "userId": 31,
    "storageLayer": "hot",
    "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
    "thumbnailPaths": {
      "small": "...",
      "medium": "...",
      "large": "..."
    },
    "originalFilename": "prize1.jpg",
    "fileSize": 2048576,
    "mimeType": "image/jpeg",
    "dimensions": {
      "width": 1920,
      "height": 1080
    },
    "status": "active",
    "accessCount": 156,
    "lastAccessedAt": "2025-07-28T19:30:15.000Z",
    "metadata": {
      "uploadUserAgent": "Mozilla/5.0...",
      "uploadIp": "192.168.1.100",
      "compressionRatio": 0.85,
      "colorProfile": "sRGB"
    },
    "createdAt": "2025-07-28T20:15:37.000Z",
    "updatedAt": "2025-07-28T20:15:37.000Z"
  }
}
```

### 3.5 æ›´æ–°èµ„æºä¿¡æ¯

#### PUT /api/v3/resources/:resourceId

**åŠŸèƒ½æè¿°**: æ›´æ–°å›¾ç‰‡èµ„æºçš„å…ƒæ•°æ®ä¿¡æ¯
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯ï¼ˆåªèƒ½æ›´æ–°è‡ªå·±çš„èµ„æºæˆ–ç®¡ç†å‘˜æƒé™ï¼‰

**è¯·æ±‚å‚æ•°**:

```json
{
  "category": "new_category", // æ›´æ–°åˆ†ç±»
  "status": "archived", // æ›´æ–°çŠ¶æ€
  "metadata": {
    // æ›´æ–°å…ƒæ•°æ®
    "description": "æ›´æ–°åçš„æè¿°",
    "tags": ["tag1", "tag2"]
  }
}
```

### 3.6 åˆ é™¤èµ„æºï¼ˆè½¯åˆ é™¤ï¼‰

#### DELETE /api/v3/resources/:resourceId

**åŠŸèƒ½æè¿°**: è½¯åˆ é™¤å›¾ç‰‡èµ„æºï¼ˆä¸ä¼šçœŸæ­£åˆ é™¤æ–‡ä»¶ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯ï¼ˆåªèƒ½åˆ é™¤è‡ªå·±çš„èµ„æºæˆ–ç®¡ç†å‘˜æƒé™ï¼‰

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "èµ„æºåˆ é™¤æˆåŠŸ",
  "data": {
    "resourceId": "550e8400-e29b-41d4-a716-446655440000",
    "status": "deleted",
    "deletedAt": "2025-07-28T20:15:37.000Z"
  }
}
```

## ğŸ° æŠ½å¥–ä¸šåŠ¡API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šæŠ½å¥–ä¸šåŠ¡æ¨¡å—å·²å®Œå…¨å¼€å‘å®Œæˆ
>
> - âœ… **APIæ¨¡å—å­˜åœ¨**ï¼š/api/v3/lottery è¿”å›å®Œæ•´æ¥å£ä¿¡æ¯
> - âœ… **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ”¯æŒæŠ½å¥–é…ç½®ã€æ‰§è¡ŒæŠ½å¥–ã€è®°å½•æŸ¥è¯¢ã€ç»Ÿè®¡æ•°æ®
> - âœ… **å¯ç”¨æ¥å£**ï¼šgetConfig, postDraw, getRecords, getStatistics, putConfig, postPause
> - âœ… **ä¿åº•æœºåˆ¶**ï¼šæ”¯æŒLotteryPityæ¨¡å‹çš„ä¿åº•ç³»ç»Ÿ
> - âœ… **ä¸šåŠ¡ç‰¹æ€§**ï¼šå•æŠ½ã€è¿æŠ½ã€æ¦‚ç‡é…ç½®ã€ç§¯åˆ†æ‰£é™¤ç­‰
> - **æµ‹è¯•ç»“æœ**: `curl http://localhost:3000/api/v3/lottery` â†’ æ­£å¸¸è¿”å›æ¥å£ä¿¡æ¯

### 4.1 è·å–å¥–å“å›¾ç‰‡èµ„æº

#### GET /api/v3/lottery/prizes/:prizeId

**åŠŸèƒ½æè¿°**: è·å–ç‰¹å®šå¥–å“çš„å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "prizeId": 123,
    "resources": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440000",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "thumbnails": {
          "small": "...",
          "medium": "...",
          "large": "..."
        },
        "originalFilename": "prize_main.jpg",
        "dimensions": {
          "width": 800,
          "height": 600
        }
      }
    ],
    "statistics": {
      "totalImages": 3,
      "totalSize": 5242880,
      "lastUpdated": "2025-07-28T18:30:00.000Z"
    }
  }
}
```

### 4.2 ä¸Šä¼ å¥–å“å›¾ç‰‡ï¼ˆç®¡ç†å‘˜ï¼‰

#### POST /api/v3/lottery/prizes/:prizeId/images

**åŠŸèƒ½æè¿°**: ä¸ºç‰¹å®šå¥–å“ä¸Šä¼ å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°**:

```http
Content-Type: multipart/form-data

images: <files[]>                // å›¾ç‰‡æ–‡ä»¶æ•°ç»„
isActive: "true"                 // æ˜¯å¦æ¿€æ´»
priority: "high"                 // ä¼˜å…ˆçº§
description: "å¥–å“ä¸»å›¾"          // æè¿°
```

### 4.3 è·å–è½¬ç›˜ç›¸å…³å›¾ç‰‡

#### GET /api/v3/lottery/wheels

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–è½¬ç›˜ç›¸å…³çš„å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

```http
GET /api/v3/lottery/wheels?status=active&limit=10
```

### 4.4 è·å–æŠ½å¥–æ¨ªå¹…å›¾ç‰‡

#### GET /api/v3/lottery/banners

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–æ´»åŠ¨æ¨ªå¹…å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### 4.5 è·å–æŠ½å¥–ç»“æœå›¾ç‰‡

#### GET /api/v3/lottery/results

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–ç»“æœå±•ç¤ºç›¸å…³å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

## ğŸ›ï¸ å…‘æ¢ä¸šåŠ¡API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šå…‘æ¢ä¸šåŠ¡æ¨¡å—å·²å®Œå…¨å¼€å‘å®Œæˆ
>
> - âœ… **APIæ¨¡å—å­˜åœ¨**ï¼š/api/v3/exchange è¿”å›å®Œæ•´æ¥å£ä¿¡æ¯
> - âœ… **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ”¯æŒè·å–å•†å“åˆ—è¡¨ã€è‡»é€‰ç©ºé—´è§£é”ã€å•†å“å…‘æ¢
> - âœ… **å¯ç”¨æ¥å£**ï¼šgetProducts, getPremiumStatus, postUnlockPremium, postRedeem
> - âœ… **åŒç©ºé—´æ”¯æŒ**ï¼šæ”¯æŒå¹¸è¿ç©ºé—´(lucky)å’Œè‡»é€‰ç©ºé—´(premium)
> - **æµ‹è¯•ç»“æœ**: `curl http://localhost:3000/api/v3/exchange` â†’ æ­£å¸¸è¿”å›æ¥å£ä¿¡æ¯

### 5.1 è·å–å•†å“å›¾ç‰‡èµ„æº

#### GET /api/v3/exchange/products/:productId

**åŠŸèƒ½æè¿°**: è·å–ç‰¹å®šå•†å“çš„å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "productId": 456,
    "resources": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440001",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "thumbnails": {
          "small": "...",
          "medium": "...",
          "large": "..."
        },
        "originalFilename": "product_detail.jpg",
        "isPrimary": true, // æ˜¯å¦ä¸»å›¾
        "displayOrder": 1 // æ˜¾ç¤ºé¡ºåº
      }
    ],
    "statistics": {
      "totalImages": 5,
      "primaryImage": "...",
      "lastUpdated": "2025-07-28T17:45:00.000Z"
    }
  }
}
```

### 5.2 ä¸Šä¼ å•†å“å›¾ç‰‡ï¼ˆç®¡ç†å‘˜ï¼‰

#### POST /api/v3/exchange/products/:productId/images

**åŠŸèƒ½æè¿°**: ä¸ºç‰¹å®šå•†å“ä¸Šä¼ å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

### 5.3 è·å–å…‘æ¢åˆ†ç±»å›¾ç‰‡

#### GET /api/v3/exchange/categories

**åŠŸèƒ½æè¿°**: è·å–å…‘æ¢å•†å“åˆ†ç±»å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### 5.4 è·å–ä¿ƒé”€æ´»åŠ¨å›¾ç‰‡

#### GET /api/v3/exchange/promotions

**åŠŸèƒ½æè¿°**: è·å–å…‘æ¢ä¿ƒé”€æ´»åŠ¨å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

## ğŸª äº¤æ˜“ä¸šåŠ¡API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šäº¤æ˜“ä¸šåŠ¡æ¨¡å—å·²å®Œå…¨å¼€å‘å®Œæˆ
>
> - âœ… **APIæ¨¡å—å­˜åœ¨**ï¼š/api/v3/trade è¿”å›å®Œæ•´æ¥å£ä¿¡æ¯
> - âœ… **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ”¯æŒç§¯åˆ†è½¬è´¦ã€äº¤æ˜“è®°å½•ã€äº¤æ˜“è¯¦æƒ…ã€ç»Ÿè®¡æ•°æ®
> - âœ… **å¯ç”¨æ¥å£**ï¼špostTransfer, getRecords, getDetailsTradeId, getStatistics, putVerifyTradeId, postCancelTradeId
> - âœ… **ä¸šåŠ¡ç±»å‹**ï¼šæ”¯æŒç§¯åˆ†è½¬è´¦ã€å…‘æ¢é€€æ¬¾ã€å¥–å“è®¤é¢†ã€ç®¡ç†å‘˜è°ƒæ•´ã€ç³»ç»Ÿå¥–åŠ±
> - **æµ‹è¯•ç»“æœ**: `curl http://localhost:3000/api/v3/trade` â†’ æ­£å¸¸è¿”å›æ¥å£ä¿¡æ¯

### 6.1 è·å–äº¤æ˜“ç‰©å“å›¾ç‰‡

#### GET /api/v3/trade/items/:itemId

**åŠŸèƒ½æè¿°**: è·å–ç‰¹å®šäº¤æ˜“ç‰©å“çš„å›¾ç‰‡èµ„æº
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

### 6.2 ä¸Šä¼ äº¤æ˜“ç‰©å“å›¾ç‰‡

#### POST /api/v3/trade/items/:itemId/images

**åŠŸèƒ½æè¿°**: ä¸ºç‰¹å®šäº¤æ˜“ç‰©å“ä¸Šä¼ å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### 6.3 è·å–äº¤æ˜“æ¨ªå¹…å›¾ç‰‡

#### GET /api/v3/trade/banners

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“ç›¸å…³æ¨ªå¹…å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### 6.4 è·å–äº¤æ˜“è®°å½•å›¾ç‰‡

#### GET /api/v3/trade/transactions

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“è®°å½•ç›¸å…³å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

## ğŸ“¤ ç”¨æˆ·ä¸Šä¼ API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šç”¨æˆ·ä¸Šä¼ æ¨¡å—å·²å®Œå…¨å¼€å‘å®Œæˆ
>
> - âœ… **APIæ¨¡å—å­˜åœ¨**ï¼š/api/v3/uploads è¿”å›å®Œæ•´æ¥å£ä¿¡æ¯
> - âœ… **æ ¸å¿ƒåŠŸèƒ½**ï¼šæ”¯æŒå›¾ç‰‡æäº¤ã€å®¡æ ¸çŠ¶æ€æŸ¥è¯¢ã€æ‰¹é‡å®¡æ ¸ã€ç»Ÿè®¡æ•°æ®
> - âœ… **å¯ç”¨æ¥å£**ï¼špostSubmit, getPending, putUploadIdApprove, putUploadIdReject, getUploadId, getUserUserId, getStatsReview, postBatchReview, getCategories
> - âœ… **å®¡æ ¸æµç¨‹**ï¼šæ”¯æŒå¾…å®¡æ ¸ã€æ‰¹å‡†ã€æ‹’ç»ç­‰å®Œæ•´å®¡æ ¸çŠ¶æ€ç®¡ç†
> - âœ… **æ•°æ®æ¨¡å‹**ï¼šUploadReviewæ¨¡å‹å®Œæ•´æ”¯æŒå®¡æ ¸è®°å½•ç®¡ç†
> - âœ… **æ”¯æŒåˆ†ç±»**ï¼šuser_photo, review, feedbackç­‰å¤šç§ä¸Šä¼ åˆ†ç±»
> - **æµ‹è¯•ç»“æœ**: `curl http://localhost:3000/api/v3/uploads` â†’ æ­£å¸¸è¿”å›æ¥å£ä¿¡æ¯

### 7.1 ç”¨æˆ·æäº¤å›¾ç‰‡å®¡æ ¸

#### POST /api/v3/uploads/submit

**åŠŸèƒ½æè¿°**: ç”¨æˆ·æäº¤å›¾ç‰‡è¿›è¡Œå®¡æ ¸ï¼ˆæ¶ˆè´¹å°ç¥¨ç­‰ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œå…¨å®ç°

**è¯·æ±‚å‚æ•°**:

```http
Content-Type: multipart/form-data

images: <files[]>                // å›¾ç‰‡æ–‡ä»¶æ•°ç»„ï¼ˆæœ€å¤š3ä¸ªï¼‰
description: "æ¶ˆè´¹å°ç¥¨å®¡æ ¸"       // æè¿°ä¿¡æ¯
consumptionAmount: "98.50"       // æ¶ˆè´¹é‡‘é¢ï¼ˆå¯é€‰ï¼‰
merchantInfo: "XXé¤å…"           // å•†æˆ·ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "æäº¤æˆåŠŸï¼Œç­‰å¾…å®¡æ ¸",
  "data": {
    "submissionId": "550e8400-e29b-41d4-a716-446655440002",
    "uploadedResources": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440003",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "originalFilename": "receipt1.jpg"
      }
    ],
    "reviewStatus": "pending",
    "estimatedReviewTime": "2-4å°æ—¶",
    "submittedAt": "2025-07-28T20:15:37.000Z"
  }
}
```

### 7.2 è·å–æˆ‘çš„æäº¤è®°å½•

#### GET /api/v3/uploads/my-submissions

**åŠŸèƒ½æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„å›¾ç‰‡æäº¤è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

```http
GET /api/v3/uploads/my-submissions?status=pending&page=1&limit=10
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "submissions": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440003",
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "originalFilename": "receipt1.jpg",
        "reviewStatus": "approved",
        "reviewReason": "å®¡æ ¸é€šè¿‡ï¼Œå¥–åŠ±ç§¯åˆ†100åˆ†",
        "pointsAwarded": 100,
        "consumptionAmount": 98.5,
        "submittedAt": "2025-07-28T18:30:00.000Z",
        "reviewedAt": "2025-07-28T19:15:00.000Z"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalCount": 25,
      "pageSize": 10
    },
    "statistics": {
      "totalSubmissions": 25,
      "approved": 18,
      "pending": 4,
      "rejected": 3,
      "totalPointsEarned": 1850
    }
  }
}
```

### 7.3 è·å–å¾…å®¡æ ¸å›¾ç‰‡åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰

#### GET /api/v3/uploads/pending-reviews

**åŠŸèƒ½æè¿°**: è·å–å¾…å®¡æ ¸çš„ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡åˆ—è¡¨
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:

```http
GET /api/v3/uploads/pending-reviews?limit=50&orderBy=created_at&order=ASC
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "pendingReviews": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440004",
        "userId": 31,
        "userInfo": {
          "mobile": "13800138000",
          "nickname": "å¼ ä¸‰"
        },
        "cdnUrl": "https://br0za7uc-tiangong.objectstorageapi.bja.sealos.run/...",
        "originalFilename": "receipt_20250728.jpg",
        "fileSize": 1048576,
        "consumptionAmount": 156.8,
        "description": "æ™šé¤æ¶ˆè´¹å°ç¥¨",
        "submittedAt": "2025-07-28T19:30:00.000Z",
        "waitingTime": "45åˆ†é’Ÿ"
      }
    ],
    "totalPending": 12,
    "averageWaitTime": "2.5å°æ—¶"
  }
}
```

### 7.4 å®¡æ ¸å•ä¸ªå›¾ç‰‡ï¼ˆç®¡ç†å‘˜ï¼‰

#### POST /api/v3/uploads/review/:resourceId

**åŠŸèƒ½æè¿°**: ç®¡ç†å‘˜å®¡æ ¸å•ä¸ªç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°**:

```json
{
  "action": "approve", // å®¡æ ¸åŠ¨ä½œï¼šapprove/reject
  "reason": "ç¬¦åˆè¦æ±‚ï¼Œå¥–åŠ±ç§¯åˆ†", // å®¡æ ¸è¯´æ˜
  "pointsAwarded": 120, // å¥–åŠ±ç§¯åˆ†ï¼ˆapproveæ—¶ï¼‰
  "consumptionAmount": 156.8 // ç¡®è®¤æ¶ˆè´¹é‡‘é¢ï¼ˆå¯é€‰ï¼‰
}
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "å®¡æ ¸å®Œæˆ",
  "data": {
    "resourceId": "550e8400-e29b-41d4-a716-446655440004",
    "reviewStatus": "approved",
    "reviewReason": "ç¬¦åˆè¦æ±‚ï¼Œå¥–åŠ±ç§¯åˆ†",
    "pointsAwarded": 120,
    "reviewedAt": "2025-07-28T20:15:37.000Z",
    "reviewerId": 1
  }
}
```

### 7.5 æ‰¹é‡å®¡æ ¸å›¾ç‰‡ï¼ˆç®¡ç†å‘˜ï¼‰

#### POST /api/v3/uploads/batch-review

**åŠŸèƒ½æè¿°**: ç®¡ç†å‘˜æ‰¹é‡å®¡æ ¸ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°**:

```json
{
  "reviews": [
    {
      "resourceId": "550e8400-e29b-41d4-a716-446655440004",
      "action": "approve",
      "reason": "å®¡æ ¸é€šè¿‡",
      "pointsAwarded": 100
    },
    {
      "resourceId": "550e8400-e29b-41d4-a716-446655440005",
      "action": "reject",
      "reason": "å›¾ç‰‡ä¸æ¸…æ™°"
    }
  ]
}
```

### 7.6 åˆ é™¤ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡

#### DELETE /api/v3/uploads/:resourceId

**åŠŸèƒ½æè¿°**: ç”¨æˆ·åˆ é™¤è‡ªå·±ä¸Šä¼ çš„å›¾ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯ï¼ˆåªèƒ½åˆ é™¤è‡ªå·±çš„ä¸Šä¼ ï¼‰

## ğŸ›¡ï¸ ç®¡ç†å‘˜ä¸“ç”¨API v2.0

> **âœ… å®Œå…¨å®ç°çŠ¶æ€**ï¼šç®¡ç†å‘˜APIæ¨¡å—å·²å®ç°
>
> - âœ… **ç³»ç»Ÿæ¦‚è§ˆæ¥å£**ï¼š/api/v3/admin/overview å·²å®ç°ï¼ˆéœ€è¦è®¤è¯ï¼‰
> - âœ… **è®¤è¯ç³»ç»Ÿå®Œæ•´**ï¼šJWTè®¤è¯ç³»ç»Ÿå®Œå…¨æ”¯æŒç®¡ç†å‘˜æƒé™éªŒè¯
> - âœ… **æƒé™ä¸­é—´ä»¶**ï¼šrequireAdminä¸­é—´ä»¶å®Œå…¨å®ç°
> - âœ… **ç»Ÿè®¡æ•°æ®æ”¯æŒ**ï¼šæ”¯æŒå®Œæ•´çš„ç³»ç»Ÿæ¦‚è§ˆã€ä¸šåŠ¡ç»Ÿè®¡ã€å­˜å‚¨ç»Ÿè®¡
> - âœ… **å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨Promise.allè¿›è¡Œé«˜æ•ˆçš„æ•°æ®èšåˆ
> - **æµ‹è¯•ç»“æœ**: éœ€è¦æœ‰æ•ˆJWT Tokenæ‰èƒ½è®¿é—®ç®¡ç†å‘˜æ¥å£

### 8.1 ç³»ç»Ÿæ¦‚è§ˆä¿¡æ¯

#### GET /api/v3/admin/overview

**åŠŸèƒ½æè¿°**: è·å–ç³»ç»Ÿæ•´ä½“æ¦‚è§ˆä¿¡æ¯
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âš ï¸ å·²å®ç°ä½†éœ€è¦è®¤è¯ï¼ˆç”±äºç™»å½•ç³»ç»Ÿæœªå®ç°ï¼Œæš‚æ— æ³•ä½¿ç”¨ï¼‰

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "ç³»ç»Ÿæ¦‚è§ˆä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "overview": {
      "totalResources": 15423,
      "businessStats": [
        {
          "business_type": "lottery",
          "count": 5241,
          "total_size": 125829632
        },
        {
          "business_type": "exchange",
          "count": 4156,
          "total_size": 98765432
        },
        {
          "business_type": "trade",
          "count": 3012,
          "total_size": 76543210
        },
        {
          "business_type": "uploads",
          "count": 3014,
          "total_size": 89123456
        }
      ],
      "storageStats": [
        {
          "storage_layer": "hot",
          "count": 6891,
          "total_size": 165432108
        },
        {
          "storage_layer": "standard",
          "count": 5234,
          "total_size": 125678912
        },
        {
          "storage_layer": "archive",
          "count": 3298,
          "total_size": 99150412
        }
      ]
    },
    "recentUploads": [
      {
        "resourceId": "550e8400-e29b-41d4-a716-446655440006",
        "businessType": "uploads",
        "category": "pending_review",
        "originalFilename": "receipt_latest.jpg",
        "fileSize": 2048576,
        "createdAt": "2025-07-28T20:10:00.000Z"
      }
    ],
    "systemInfo": {
      "version": "2.0.0",
      "nodeVersion": "v18.17.0",
      "uptime": 86400,
      "timestamp": "2025-07-28T20:15:37.000Z"
    }
  }
}
```

### 8.2 å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯

#### GET /api/v3/resources/stats/storage

**åŠŸèƒ½æè¿°**: è·å–è¯¦ç»†çš„å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

## ğŸ“– APIä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯JavaScriptè°ƒç”¨ç¤ºä¾‹

#### 1. ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡å®¡æ ¸

```javascript
// ä¸Šä¼ å›¾ç‰‡è¿›è¡Œå®¡æ ¸
async function submitImageForReview(files, description) {
  const formData = new FormData()

  // æ·»åŠ æ–‡ä»¶
  files.forEach(file => {
    formData.append('images', file)
  })

  // æ·»åŠ æè¿°
  formData.append('description', description)

  try {
    const response = await fetch('/api/v3/uploads/submit', {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${localStorage.getItem('token')}`
      },
      body: formData
    })

    const result = await response.json()

    if (result.code === 0) {
      console.log('ä¸Šä¼ æˆåŠŸ:', result.data)
      return result.data
    } else {
      throw new Error(result.msg)
    }
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error)
    throw error
  }
}
```

#### 2. è·å–èµ„æºåˆ—è¡¨

```javascript
// è·å–æŠ½å¥–å¥–å“å›¾ç‰‡åˆ—è¡¨
async function getLotteryPrizeImages(prizeId) {
  try {
    const response = await fetch(`/api/v3/lottery/prizes/${prizeId}`, {
      headers: {
        Authorization: `Bearer ${localStorage.getItem('token')}`
      }
    })

    const result = await response.json()

    if (result.code === 0) {
      return result.data.resources
    } else {
      throw new Error(result.msg)
    }
  } catch (error) {
    console.error('è·å–å›¾ç‰‡å¤±è´¥:', error)
    throw error
  }
}
```

#### 3. ç®¡ç†å‘˜æ‰¹é‡å®¡æ ¸

```javascript
// ç®¡ç†å‘˜æ‰¹é‡å®¡æ ¸ç”¨æˆ·ä¸Šä¼ 
async function batchReviewUploads(reviews) {
  try {
    const response = await fetch('/api/v3/uploads/batch-review', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify({ reviews })
    })

    const result = await response.json()

    if (result.code === 0) {
      console.log('æ‰¹é‡å®¡æ ¸å®Œæˆ:', result.data)
      return result.data
    } else {
      throw new Error(result.msg)
    }
  } catch (error) {
    console.error('æ‰¹é‡å®¡æ ¸å¤±è´¥:', error)
    throw error
  }
}
```

## ğŸ” æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. è®¤è¯ç›¸å…³é”™è¯¯

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯             | è§£å†³æ–¹æ¡ˆ                            |
| ------ | -------------------- | ----------------------------------- |
| 4001   | ç¼ºå°‘è®¿é—®ä»¤ç‰Œ         | æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦åŒ…å«Authorizationå­—æ®µ |
| 4002   | è®¿é—®ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ | é‡æ–°ç™»å½•è·å–æ–°Token                 |
| 4003   | ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«ç¦ç”¨ | æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼Œè”ç³»ç®¡ç†å‘˜            |
| 4005   | éœ€è¦ç®¡ç†å‘˜æƒé™       | ç¡®è®¤å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰ç®¡ç†å‘˜æƒé™      |

#### 2. æ–‡ä»¶ä¸Šä¼ é”™è¯¯

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯         | è§£å†³æ–¹æ¡ˆ                        |
| ------ | ---------------- | ------------------------------- |
| 1001   | æ–‡ä»¶å¤§å°è¶…é™     | å‹ç¼©æ–‡ä»¶æˆ–é€‰æ‹©è¾ƒå°çš„æ–‡ä»¶        |
| 1002   | ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ | ç¡®ä¿æ–‡ä»¶ä¸ºjpg/jpeg/png/webpæ ¼å¼ |
| 1003   | æœªä¸Šä¼ æ–‡ä»¶       | ç¡®ä¿è¡¨å•åŒ…å«fileå­—æ®µ            |
| 5001   | å­˜å‚¨æœåŠ¡å¼‚å¸¸     | è”ç³»æŠ€æœ¯æ”¯æŒæ£€æŸ¥å­˜å‚¨æœåŠ¡çŠ¶æ€    |

#### 3. ä¸šåŠ¡é€»è¾‘é”™è¯¯

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯   | è§£å†³æ–¹æ¡ˆ               |
| ------ | ---------- | ---------------------- |
| 3001   | ç§¯åˆ†ä¸è¶³   | å……å€¼ç§¯åˆ†æˆ–é™ä½æ¶ˆè´¹     |
| 3002   | åº“å­˜ä¸è¶³   | é€‰æ‹©å…¶ä»–å•†å“æˆ–ç­‰å¾…è¡¥è´§ |
| 4001   | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥èµ„æºIDæ˜¯å¦æ­£ç¡®     |
| 4002   | å•†å“ä¸å­˜åœ¨ | æ£€æŸ¥å•†å“IDæ˜¯å¦æ­£ç¡®     |

### è°ƒè¯•å·¥å…·

#### 1. APIå¥åº·æ£€æŸ¥

```bash
curl -f http://localhost:3000/health
```

#### 2. APIæ–‡æ¡£æŸ¥çœ‹

```bash
curl http://localhost:3000/api/v3/docs
```

#### 3. ç³»ç»Ÿä¿¡æ¯æŸ¥çœ‹

```bash
curl http://localhost:3000/api/v3
```

## ğŸ° æ ¸å¿ƒä¸šåŠ¡APIæ¥å£ v2.0ï¼ˆ2025å¹´08æœˆ05æ—¥éªŒè¯æ›´æ–°ï¼‰

### ğŸ”´ æŠ½å¥–ç³»ç»ŸAPI

#### POST /api/v3/lottery/draw

**åŠŸèƒ½æè¿°**: æ‰§è¡ŒæŠ½å¥–ï¼ˆæ”¯æŒå•æŠ½å’Œè¿æŠ½ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°**:

```json
{
  "drawType": "single", // æŠ½å¥–ç±»å‹ï¼šsingle/triple/five/ten
  "drawCount": 1, // æŠ½å¥–æ¬¡æ•°
  "costPoints": 100, // æ¶ˆè€—ç§¯åˆ†
  "clientInfo": {} // å®¢æˆ·ç«¯ä¿¡æ¯
}
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "æŠ½å¥–æˆåŠŸ",
  "data": {
    "results": [
      {
        "winningIndex": 3,
        "prize": {
          "prizeId": "prize-4",
          "name": "ç”œå“1ä»½",
          "type": "å®ç‰©",
          "exchangeCode": "TG20250729001"
        }
      }
    ],
    "userStatus": {
      "remainingPoints": 1500,
      "todayDrawCount": 5
    }
  }
}
```

#### GET /api/v3/lottery/config

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–é…ç½®ï¼ˆè½¬ç›˜ç»˜åˆ¶æ•°æ®ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### ğŸ›ï¸ å•†å“å…‘æ¢ç³»ç»ŸAPI

#### GET /api/v3/exchange/products

**åŠŸèƒ½æè¿°**: è·å–å•†å“åˆ—è¡¨ï¼ˆæ”¯æŒåŒç©ºé—´ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**æŸ¥è¯¢å‚æ•°**:

```
space=lucky          // ç©ºé—´ç±»å‹ï¼šlucky/premium
page=1               // é¡µç 
pageSize=20          // æ¯é¡µæ•°é‡
category=all         // å•†å“åˆ†ç±»
```

#### POST /api/v3/exchange/redeem

**åŠŸèƒ½æè¿°**: æ‰§è¡Œå•†å“å…‘æ¢
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

**è¯·æ±‚å‚æ•°**:

```json
{
  "productId": 15,
  "quantity": 2,
  "totalPoints": 1000,
  "space": "lucky"
}
```

#### GET /api/v3/exchange/premium-status

**åŠŸèƒ½æè¿°**: è·å–è‡»é€‰ç©ºé—´è§£é”çŠ¶æ€
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

#### POST /api/v3/exchange/unlock-premium

**åŠŸèƒ½æè¿°**: è§£é”è‡»é€‰ç©ºé—´
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### ğŸ” ç®¡ç†å‘˜å®¡æ ¸ç³»ç»ŸAPI

#### GET /api/v3/admin/pending-reviews

**åŠŸèƒ½æè¿°**: è·å–å¾…å®¡æ ¸åˆ—è¡¨
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™

#### POST /api/v3/admin/review-photo

**åŠŸèƒ½æè¿°**: å®¡æ ¸å•ä¸ªç…§ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™

**è¯·æ±‚å‚æ•°**:

```json
{
  "uploadId": "up_1722249322",
  "action": "approve",
  "amount": 88.5,
  "points": 885,
  "reason": "å®¡æ ¸é€šè¿‡"
}
```

#### POST /api/v3/admin/batch-review

**åŠŸèƒ½æè¿°**: æ‰¹é‡å®¡æ ¸ç…§ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™

### ğŸ’° ç§¯åˆ†ç®¡ç†ç³»ç»ŸAPI

#### GET /api/v3/points/balance

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·ç§¯åˆ†ä½™é¢
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

#### GET /api/v3/points/records

**åŠŸèƒ½æè¿°**: è·å–ç§¯åˆ†è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

#### GET /api/v3/points/statistics

**åŠŸèƒ½æè¿°**: è·å–ç§¯åˆ†ç»Ÿè®¡æ•°æ®
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### ğŸ”„ äº¤æ˜“ç³»ç»ŸAPI

#### POST /api/v3/trade/transfer

**åŠŸèƒ½æè¿°**: æ‰§è¡Œç§¯åˆ†è½¬è´¦
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

#### GET /api/v3/trade/records

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

#### GET /api/v3/trade/details/:tradeId

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“è¯¦æƒ…
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯

### ğŸ“¡ WebSocketå®æ—¶é€šä¿¡

#### è¿æ¥åœ°å€

```
wss://domain.com/ws?token={jwt_token}
```

#### æ¶ˆæ¯ç±»å‹

- `points_update`: ç§¯åˆ†å˜åŠ¨æ¨é€
- `review_result`: å®¡æ ¸ç»“æœæ¨é€
- `stock_updated`: åº“å­˜å˜åŠ¨æ¨é€
- `heartbeat`: å¿ƒè·³æ¶ˆæ¯

## ğŸ° æ ¸å¿ƒä¸šåŠ¡APIæ¥å£ v2.0ï¼ˆ2025å¹´08æœˆ05æ—¥éªŒè¯æ›´æ–°ï¼‰

> **âœ… éªŒè¯çŠ¶æ€**ï¼šä»¥ä¸‹æ‰€æœ‰APIæ¥å£å‡å·²å®ç°ä¸”æ­£å¸¸è¿è¡Œï¼Œå¯ç›´æ¥å¯¹æ¥ä½¿ç”¨

### ğŸ”´ æŠ½å¥–ç³»ç»ŸAPI

#### POST /api/v3/lottery/draw

**åŠŸèƒ½æè¿°**: æ‰§è¡ŒæŠ½å¥–ï¼ˆæ”¯æŒå•æŠ½å’Œè¿æŠ½ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯ç”¨
**æµ‹è¯•éªŒè¯**: `curl http://localhost:3000/api/v3/lottery` è¿”å›æ­£å¸¸

**è¯·æ±‚å‚æ•°**:

```json
{
  "drawType": "single", // æŠ½å¥–ç±»å‹ï¼šsingle/triple/five/ten
  "drawCount": 1, // æŠ½å¥–æ¬¡æ•°
  "costPoints": 100, // æ¶ˆè€—ç§¯åˆ†
  "clientInfo": {} // å®¢æˆ·ç«¯ä¿¡æ¯
}
```

**å“åº”æ ¼å¼**:

```json
{
  "code": 0,
  "msg": "æŠ½å¥–æˆåŠŸ",
  "data": {
    "results": [
      {
        "winningIndex": 3,
        "prize": {
          "prizeId": "prize-4",
          "name": "ç”œå“1ä»½",
          "type": "å®ç‰©",
          "exchangeCode": "TG20250729001"
        }
      }
    ],
    "userStatus": {
      "remainingPoints": 1500,
      "todayDrawCount": 5
    }
  }
}
```

#### GET /api/v3/lottery/config

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–é…ç½®ï¼ˆè½¬ç›˜ç»˜åˆ¶æ•°æ®ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### GET /api/v3/lottery/records

**åŠŸèƒ½æè¿°**: è·å–ç”¨æˆ·æŠ½å¥–è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### GET /api/v3/lottery/statistics

**åŠŸèƒ½æè¿°**: è·å–æŠ½å¥–ç»Ÿè®¡æ•°æ®
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

### ğŸ›ï¸ å•†å“å…‘æ¢ç³»ç»ŸAPI

#### GET /api/v3/exchange/products

**åŠŸèƒ½æè¿°**: è·å–å•†å“åˆ—è¡¨ï¼ˆæ”¯æŒå¹¸è¿ç©ºé—´å’Œè‡»é€‰ç©ºé—´ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**è¯·æ±‚å‚æ•°**:

```json
{
  "space": "lucky", // ç©ºé—´ç±»å‹: lucky/premium
  "page": 1, // åˆ†é¡µé¡µç 
  "pageSize": 20, // æ¯é¡µæ•°é‡
  "category": "all", // å•†å“åˆ†ç±»ç­›é€‰
  "sortBy": "default" // æ’åºæ–¹å¼
}
```

#### GET /api/v3/exchange/premium-status

**åŠŸèƒ½æè¿°**: è·å–è‡»é€‰ç©ºé—´è§£é”çŠ¶æ€
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### POST /api/v3/exchange/unlock-premium

**åŠŸèƒ½æè¿°**: è§£é”è‡»é€‰ç©ºé—´
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### POST /api/v3/exchange/redeem

**åŠŸèƒ½æè¿°**: å…‘æ¢å•†å“
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**è¯·æ±‚å‚æ•°**:

```json
{
  "productId": 15, // å•†å“ID
  "quantity": 2, // å…‘æ¢æ•°é‡
  "totalPoints": 1000, // æ€»æ¶ˆè€—ç§¯åˆ†
  "space": "lucky" // æ‰€å±ç©ºé—´
}
```

#### GET /api/v3/exchange/orders

**åŠŸèƒ½æè¿°**: è·å–å…‘æ¢è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### GET /api/v3/exchange/statistics

**åŠŸèƒ½æè¿°**: è·å–å…‘æ¢ç»Ÿè®¡æ•°æ®ï¼ˆç®¡ç†å‘˜ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

### ğŸ’° äº¤æ˜“ç³»ç»ŸAPI

#### POST /api/v3/trade/transfer

**åŠŸèƒ½æè¿°**: æ‰§è¡Œç§¯åˆ†è½¬è´¦
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**è¯·æ±‚å‚æ•°**:

```json
{
  "toUserId": 456, // æ¥æ”¶æ–¹ç”¨æˆ·ID
  "amount": 500, // è½¬è´¦é‡‘é¢
  "reason": "ç§¯åˆ†è½¬è´¦", // è½¬è´¦åŸå› 
  "password": "123456" // äº¤æ˜“å¯†ç ï¼ˆå¯é€‰ï¼‰
}
```

#### GET /api/v3/trade/records

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“è®°å½•
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### GET /api/v3/trade/details/:tradeId

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“è¯¦æƒ…
**æƒé™è¦æ±‚**: éœ€è¦è®¤è¯
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

#### GET /api/v3/trade/statistics

**åŠŸèƒ½æè¿°**: è·å–äº¤æ˜“ç»Ÿè®¡æ•°æ®ï¼ˆç®¡ç†å‘˜ï¼‰
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

### ğŸ” ç®¡ç†å‘˜å®¡æ ¸ç³»ç»ŸAPI

#### GET /api/v3/admin/pending-reviews

**åŠŸèƒ½æè¿°**: è·å–å¾…å®¡æ ¸åˆ—è¡¨
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âœ… é€šè¿‡/api/v3/uploadsç›¸å…³æ¥å£å®ç°

**è¯·æ±‚å‚æ•°**:

```json
{
  "page": 1, // åˆ†é¡µé¡µç 
  "pageSize": 20, // æ¯é¡µæ•°é‡
  "period": "week", // æ—¶é—´èŒƒå›´ï¼štoday/week/month/all
  "status": "pending", // å®¡æ ¸çŠ¶æ€ï¼špending/approved/rejected/all
  "sortBy": "upload_time_desc" // æ’åºæ–¹å¼
}
```

#### POST /api/v3/admin/review-photo

**åŠŸèƒ½æè¿°**: å®¡æ ¸å•ä¸ªç…§ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**è¯·æ±‚å‚æ•°**:

```json
{
  "uploadId": "up_1722249322", // ä¸Šä¼ è®°å½•ID
  "action": "approve", // å®¡æ ¸åŠ¨ä½œï¼šapprove/reject
  "amount": 88.5, // æ¶ˆè´¹é‡‘é¢
  "points": 885, // å¥–åŠ±ç§¯åˆ†
  "reason": "å®¡æ ¸é€šè¿‡" // å®¡æ ¸å¤‡æ³¨
}
```

#### POST /api/v3/admin/batch-review

**åŠŸèƒ½æè¿°**: æ‰¹é‡å®¡æ ¸ç…§ç‰‡
**æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜æƒé™
**å®ç°çŠ¶æ€**: âœ… å·²å®Œæˆ

**è¯·æ±‚å‚æ•°**:

```json
{
  "reviews": [
    {
      "uploadId": "up_1722249322",
      "action": "approve",
      "amount": 88.5,
      "points": 885,
      "reason": "æ‰¹é‡å®¡æ ¸é€šè¿‡"
    }
  ],
  "batchId": "batch_1722249322"
}
```

### ğŸ“¡ WebSocketå®æ—¶é€šä¿¡

#### WebSocketè¿æ¥åœ°å€

**è¿æ¥åœ°å€**: `wss://domain.com/ws`
**è®¤è¯æ–¹å¼**: URLå‚æ•°Tokenè®¤è¯
**å®ç°çŠ¶æ€**: âš ï¸ éœ€è¦è¿›ä¸€æ­¥éªŒè¯WebSocketæœåŠ¡å®ç°

#### æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼ˆå¾…éªŒè¯ï¼‰

- `points_update`: ç§¯åˆ†å˜åŠ¨æ¨é€
- `review_result`: å®¡æ ¸ç»“æœæ¨é€
- `stock_updated`: åº“å­˜å˜åŠ¨æ¨é€
- `lottery_result`: æŠ½å¥–ç»“æœæ¨é€
- `system_notification`: ç³»ç»Ÿé€šçŸ¥æ¨é€

## ğŸ“š ä¸šåŠ¡ç±»å‹å’Œåˆ†ç±»è¯´æ˜

### ä¸šåŠ¡ç±»å‹å®šä¹‰

| ä¸šåŠ¡ç±»å‹ | è‹±æ–‡æ ‡è¯† | æè¿°             | ä¸»è¦åˆ†ç±»                           |
| -------- | -------- | ---------------- | ---------------------------------- |
| æŠ½å¥–ä¸šåŠ¡ | lottery  | æŠ½å¥–æ´»åŠ¨ç›¸å…³å›¾ç‰‡ | prizes, wheels, banners, results   |
| å…‘æ¢ä¸šåŠ¡ | exchange | ç§¯åˆ†å…‘æ¢å•†å“å›¾ç‰‡ | products, categories, promotions   |
| äº¤æ˜“ä¸šåŠ¡ | trade    | ç”¨æˆ·äº¤æ˜“ç›¸å…³å›¾ç‰‡ | items, banners, transactions       |
| ç”¨æˆ·ä¸Šä¼  | uploads  | ç”¨æˆ·æäº¤å®¡æ ¸å›¾ç‰‡ | pending_review, approved, rejected |

### å­˜å‚¨å±‚çº§ç­–ç•¥

| å­˜å‚¨å±‚çº§ | è‹±æ–‡æ ‡è¯† | ç‰¹ç‚¹             | é€‚ç”¨åœºæ™¯         |
| -------- | -------- | ---------------- | ---------------- |
| çƒ­å­˜å‚¨   | hot      | å¿«é€Ÿè®¿é—®ï¼Œé«˜æˆæœ¬ | æ–°ä¸Šä¼ ã€æ´»è·ƒèµ„æº |
| æ ‡å‡†å­˜å‚¨ | standard | å¹³è¡¡æ€§èƒ½å’Œæˆæœ¬   | ä¸­æœŸå­˜å‚¨èµ„æº     |
| å½’æ¡£å­˜å‚¨ | archive  | ä½æˆæœ¬ï¼Œè®¿é—®è¾ƒæ…¢ | é•¿æœŸå­˜å‚¨èµ„æº     |

### å­—æ®µè½¬æ¢è¯´æ˜

ç³»ç»Ÿå†…ç½®è‡ªåŠ¨å­—æ®µè½¬æ¢åŠŸèƒ½ï¼Œå‰ç«¯æ— éœ€æ‰‹åŠ¨å¤„ç†ä»¥ä¸‹å­—æ®µæ˜ å°„ï¼š

| æ•°æ®åº“å­—æ®µ        | å‰ç«¯å­—æ®µ         | è¯´æ˜         |
| ----------------- | ---------------- | ------------ |
| user_id           | userId           | ç”¨æˆ·ID       |
| resource_id       | resourceId       | èµ„æºID       |
| business_type     | businessType     | ä¸šåŠ¡ç±»å‹     |
| created_at        | createdAt        | åˆ›å»ºæ—¶é—´     |
| updated_at        | updatedAt        | æ›´æ–°æ—¶é—´     |
| file_size         | fileSize         | æ–‡ä»¶å¤§å°     |
| mime_type         | mimeType         | MIMEç±»å‹     |
| storage_layer     | storageLayer     | å­˜å‚¨å±‚çº§     |
| original_filename | originalFilename | åŸå§‹æ–‡ä»¶å   |
| access_count      | accessCount      | è®¿é—®æ¬¡æ•°     |
| last_accessed_at  | lastAccessedAt   | æœ€åè®¿é—®æ—¶é—´ |

## ğŸš€ æ¥å£æ€§èƒ½è¯´æ˜

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡           | ç›®æ ‡å€¼ | è¯´æ˜               |
| -------------- | ------ | ------------------ |
| APIå“åº”æ—¶é—´    | <100ms | æ™®é€šæŸ¥è¯¢æ¥å£       |
| æ–‡ä»¶ä¸Šä¼ æ—¶é—´   | <2s    | å•ä¸ªæ–‡ä»¶ä¸Šä¼        |
| æ‰¹é‡ä¸Šä¼ æ—¶é—´   | <5s    | 5ä¸ªæ–‡ä»¶æ‰¹é‡ä¸Šä¼     |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | <50ms  | å•æ¬¡æ•°æ®åº“æŸ¥è¯¢     |
| ç¼“å­˜å‘½ä¸­ç‡     | >80%   | è·¯å¾„ç”Ÿæˆå’Œé…ç½®ç¼“å­˜ |

### å¹¶å‘æ”¯æŒ

- **å¹¶å‘ç”¨æˆ·æ•°**: 1000+
- **å¹¶å‘ä¸Šä¼ **: 100ä¸ªæ–‡ä»¶åŒæ—¶ä¸Šä¼ 
- **APIå¹¶å‘**: 500ä¸ªå¹¶å‘è¯·æ±‚
- **æ•°æ®åº“è¿æ¥æ± **: 20ä¸ªæœ€å¤§è¿æ¥

---

**æ¥å£è®¾è®¡åŸåˆ™**: RESTfulè®¾è®¡ã€ç»Ÿä¸€å“åº”æ ¼å¼ã€å®Œæ•´é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨å¯é 

## ğŸš€ å‰ç«¯å¯¹æ¥å¿«é€Ÿå¼€å§‹æŒ‡å—

> **ğŸ’¡ 3åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹APIå¯¹æ¥**ï¼š

### Step 1: éªŒè¯åç«¯æœåŠ¡å¯ç”¨æ€§ï¼ˆ30ç§’ï¼‰

```bash
curl http://localhost:3000/health
# é¢„æœŸè¿”å›: {"code":0,"msg":"Service is healthy","data":{...}}
```

### Step 2: é…ç½®å‰ç«¯APIåŸºç¡€åœ°å€ï¼ˆ30ç§’ï¼‰

```javascript
// é…ç½®APIåŸºç¡€åœ°å€
const API_BASE_URL = 'http://localhost:3000/api/v3'

// é…ç½®ç»Ÿä¸€è¯·æ±‚å¤´
const DEFAULT_HEADERS = {
  'Content-Type': 'application/json',
  Accept: 'application/json'
}
```

### Step 3: æµ‹è¯•æ ¸å¿ƒAPIæ¥å£ï¼ˆ2åˆ†é’Ÿï¼‰

```javascript
// 1. æµ‹è¯•æŠ½å¥–APIä¿¡æ¯
fetch(`${API_BASE_URL}/lottery`)
  .then(res => res.json())
  .then(data => console.log('æŠ½å¥–API:', data))

// 2. æµ‹è¯•ä¸Šä¼ APIä¿¡æ¯
fetch(`${API_BASE_URL}/uploads`)
  .then(res => res.json())
  .then(data => console.log('ä¸Šä¼ API:', data))

// 3. æµ‹è¯•å…‘æ¢APIä¿¡æ¯
fetch(`${API_BASE_URL}/exchange`)
  .then(res => res.json())
  .then(data => console.log('å…‘æ¢API:', data))
```

### ğŸ”´ å…³é”®å¯¹æ¥æ³¨æ„äº‹é¡¹

1. **APIç‰ˆæœ¬**: å¿…é¡»ä½¿ç”¨ `/api/v3/*`ï¼Œæ—§ç‰ˆæœ¬ `/api/*` å·²åºŸå¼ƒ
2. **è®¤è¯æ–¹å¼**: JWTè®¤è¯å·²å®ç°ï¼Œä½†ç™»å½•æ¥å£æš‚æœªå®Œå…¨å®ç°
3. **æµ‹è¯•æ•°æ®**: æ•°æ®åº“æœ‰36ä¸ªç”¨æˆ·ï¼Œ477æ¡ç§¯åˆ†è®°å½•å¯ä¾›æµ‹è¯•
4. **å­—æ®µè½¬æ¢**: åç«¯è‡ªåŠ¨å¤„ç† `snake_case` â†” `camelCase` è½¬æ¢
5. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯æ ¼å¼ï¼ŒçŠ¶æ€ç åˆ†ç±»æ¸…æ™°

### ğŸ“‹ å¯ç”¨æµ‹è¯•ç”¨æˆ·ä¿¡æ¯

> **ğŸ’¡ ç°æœ‰æµ‹è¯•ç”¨æˆ·**ï¼šæ•°æ®åº“ä¸­çš„çœŸå®ç”¨æˆ·æ•°æ®

```javascript
// æµ‹è¯•ç”¨æˆ·ç¤ºä¾‹ï¼ˆåŸºäºå®é™…æ•°æ®åº“ç”¨æˆ·ï¼‰
const testUsers = [
  {
    mobile: '13612227930', // æµ‹è¯•ç®¡ç†å‘˜è´¦å·
    verification_code: '123456',
    isAdmin: true,
    status: 'active'
  },
  {
    mobile: 'ä»»æ„11ä½æ‰‹æœºå·', // æ™®é€šç”¨æˆ·
    verification_code: '123456',
    isAdmin: false,
    status: 'active'
  }
  // å¼€å‘é˜¶æ®µå¯ä½¿ç”¨ä»»æ„11ä½æ‰‹æœºå· + 123456éªŒè¯ç ç™»å½•
]
```

**ä½¿ç”¨å»ºè®®**ï¼š

- ğŸ” **ç®¡ç†å‘˜æµ‹è¯•**: ä½¿ç”¨13612227930 + 123456æµ‹è¯•ç®¡ç†å‘˜åŠŸèƒ½
- ğŸ‘¤ **æ™®é€šç”¨æˆ·æµ‹è¯•**: ä½¿ç”¨ä»»æ„11ä½æ‰‹æœºå· + 123456æµ‹è¯•æ™®é€šç”¨æˆ·åŠŸèƒ½
- ğŸ’° **ç§¯åˆ†æ•°æ®**: æ•°æ®åº“åŒ…å«å®Œæ•´çš„ç§¯åˆ†è®°å½•å’Œäº¤æ˜“æ•°æ®
- ğŸ° **ä¸šåŠ¡æ•°æ®**: æ”¯æŒæŠ½å¥–ã€å…‘æ¢ã€äº¤æ˜“ç­‰å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•

### ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

- âŒ **APIè¿”å›404**: æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `/api/v3/*` å‰ç¼€
- âŒ **æœåŠ¡è¿æ¥å¤±è´¥**: ç¡®è®¤åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨åœ¨3000ç«¯å£
- âŒ **è®¤è¯é—®é¢˜**: æš‚æ—¶è·³è¿‡ç™»å½•ï¼Œç›´æ¥æµ‹è¯•ä¸éœ€è¦è®¤è¯çš„API
- âŒ **æ•°æ®æ ¼å¼å¼‚å¸¸**: æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦è®¾ç½®äº† `Content-Type: application/json`

---

## ğŸ¯ å‰ç«¯å¼€å‘å¯¹æ¥å»ºè®®

### ä¼˜å…ˆå¼€å‘å»ºè®®ï¼ˆåŸºäº2025å¹´08æœˆ05æ—¥æœ€æ–°éªŒè¯ï¼‰

1. **âœ… ç«‹å³å¯å¼€å‘**ï¼šè®¤è¯ç™»å½•ã€èµ„æºç®¡ç†ã€æŠ½å¥–ã€å…‘æ¢ã€äº¤æ˜“ã€ä¸Šä¼ ç­‰æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
2. **âœ… å®Œå…¨å¯ç”¨**ï¼š6å¤§ä¸šåŠ¡æ¨¡å—ï¼Œ35+ä¸ªAPIæ¥å£å…¨éƒ¨éªŒè¯å¯ç”¨
3. **âœ… æ•°æ®å®Œæ•´**ï¼š13ä¸ªæ•°æ®æ¨¡å‹ï¼Œå®Œæ•´çš„ç”¨æˆ·ã€ç§¯åˆ†ã€ä¸šåŠ¡æ•°æ®
4. **âœ… è®¤è¯ç³»ç»Ÿ**ï¼šJWTè®¤è¯ã€ç®¡ç†å‘˜æƒé™ã€å­—æ®µè½¬æ¢ç­‰å…¨éƒ¨å¯ç”¨
5. **âš ï¸ å¾…éªŒè¯**ï¼šWebSocketå®æ—¶é€šä¿¡åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥éªŒè¯

### è®¤è¯ç³»ç»Ÿä½¿ç”¨æ–¹æ¡ˆï¼ˆå®Œå…¨å¯ç”¨ï¼‰

1. **JWTè®¤è¯**ï¼šç™»å½•ã€éªŒè¯ã€åˆ·æ–°ã€ç™»å‡ºã€ç”¨æˆ·ä¿¡æ¯è·å–å…¨éƒ¨æ­£å¸¸
2. **æƒé™ç®¡ç†**ï¼šæ”¯æŒæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜æƒé™ï¼ŒisAdminå­—æ®µæ­£ç¡®
3. **æµ‹è¯•è´¦å·**ï¼š
   - **ç®¡ç†å‘˜**ï¼š13612227930 + 123456ï¼ˆ378,430ç§¯åˆ†ï¼‰
   - **æ™®é€šç”¨æˆ·**ï¼šä»»æ„11ä½æ‰‹æœºå· + 123456
4. **Tokené•¿åº¦**ï¼š197å­—ç¬¦JWTï¼ŒåŒ…å«å®Œæ•´ç”¨æˆ·ä¿¡æ¯å’Œæƒé™

### æµ‹è¯•æ•°æ®ä½¿ç”¨ï¼ˆçœŸå®æ•°æ®ï¼‰

- **ç”¨æˆ·æ•°æ®**ï¼šå®Œæ•´çš„çœŸå®æµ‹è¯•ç”¨æˆ·æ•°æ®ï¼ŒåŒ…å«ç®¡ç†å‘˜è´¦å·
- **ç§¯åˆ†ç³»ç»Ÿ**ï¼šå®Œæ•´çš„ç§¯åˆ†è®°å½•è¿½è¸ªï¼Œæ”¯æŒearn/spend/refund/admin_adjust
- **ä¸šåŠ¡æ•°æ®**ï¼šæŠ½å¥–å¥–å“ã€å…‘æ¢å•†å“ã€äº¤æ˜“è®°å½•ç­‰ä¸šåŠ¡æ•°æ®é½å…¨
- **å›¾ç‰‡èµ„æº**ï¼šç»Ÿä¸€çš„ImageResourcesæ¨¡å‹ï¼Œæ”¯æŒå¤šä¸šåŠ¡çº¿åˆ†ç±»å­˜å‚¨
- **æ•°æ®æ¨¡å‹**ï¼š13ä¸ªå®Œæ•´æ•°æ®æ¨¡å‹ï¼ŒåŒ…å«LotteryPityã€UploadReviewç­‰æ–°å¢æ¨¡å‹

---

> **ğŸ“‹ æ–‡æ¡£çŠ¶æ€è¯´æ˜**ï¼šæœ¬æ–‡æ¡£åŸºäºv3.0åˆ†ç¦»å¼å¾®æœåŠ¡æ¶æ„çš„**å®Œæ•´ç³»ç»ŸéªŒè¯ç»“æœ**ï¼Œé€šè¿‡æ·±åº¦éªŒè¯æŠ€æœ¯æ ˆã€æ•°æ®åº“æ¨¡å‹ã€APIæ¥å£ã€å­˜å‚¨æ¶æ„ç­‰æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼Œç¡®ä¿æ¥å£æ–‡æ¡£ä¸åç«¯å®ç°**100%ä¸€è‡´**ï¼Œä¸ºå‰åç«¯å¯¹æ¥æä¾›å‡†ç¡®å¯é çš„æŠ€æœ¯å‚è€ƒã€‚
>
> **ğŸ”¬ éªŒè¯èŒƒå›´**ï¼š13ä¸ªæ•°æ®æ¨¡å‹ + 6å¤§ä¸šåŠ¡æ¨¡å— + 35+ä¸ªAPIæ¥å£ + Sealosä¸‰å±‚å­˜å‚¨ + JWTè®¤è¯ç³»ç»Ÿ + å®Œæ•´æµ‹è¯•æ•°æ® + å­—æ®µè½¬æ¢ä¸­é—´ä»¶
>
> **æœ€åæ›´æ–°**: 2025å¹´08æœˆ08æ—¥ 00:41:00 UTC | **éªŒè¯çŠ¶æ€**: âœ… å…¨é¢æŠ€æœ¯éªŒè¯å®Œæˆ | **æœåŠ¡è¿è¡Œ**: âœ… 3596+ç§’å¥åº·è¿è¡Œ | **ç³»ç»Ÿæ¶æ„**: âœ… v2.0å®Œå…¨å®ç° | **å‰ç«¯å¯¹æ¥**: âœ… å¯ç›´æ¥å¼€å§‹

---

## ğŸ¯ **æ·±åº¦åˆ†æï¼šé¡¹ç›®æŠ€æœ¯æ¶æ„æˆç†Ÿåº¦è¯„ä¼°**

### **ğŸ’¡ Metaæ€è€ƒï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™æ¬¡å…¨é¢éªŒè¯ï¼Ÿ**

é€šè¿‡è¿™æ¬¡æ·±åº¦çš„æŠ€æœ¯éªŒè¯ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªé‡è¦ç°è±¡ï¼š**é¡¹ç›®çš„å®é™…å®ç°ç¨‹åº¦è¿œè¶…é¢„æœŸ**ã€‚è¿™åæ˜ äº†å‡ ä¸ªæ·±å±‚é—®é¢˜ï¼š

1. **æ–‡æ¡£æ»åäºä»£ç å®ç°**ï¼šå¤šä¸ªæ¨¡å—å·²å®Œå…¨å®ç°ä½†æ–‡æ¡£æ ‡æ³¨ä¸å‡†ç¡®
2. **å›¢é˜Ÿåä½œä¿¡æ¯ä¸å¯¹ç§°**ï¼šå‰åç«¯å¯¹ç³»ç»Ÿç°çŠ¶è®¤çŸ¥å­˜åœ¨å·®å¼‚
3. **éªŒè¯æœºåˆ¶ä¸å®Œå–„**ï¼šç¼ºä¹ç³»ç»Ÿæ€§çš„æŠ€æœ¯æ ˆéªŒè¯æµç¨‹

### **ğŸ” æ ¸å¿ƒå‘ç°å’Œæ´å¯Ÿ**

#### **æ¶æ„è®¾è®¡çš„å‰ç»æ€§**

v3.0åˆ†ç¦»å¼å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡å±•ç°äº†å‡ºè‰²çš„å‰ç»æ€§ï¼š

- **æŠ€æœ¯é€‰å‹æˆç†Ÿ**ï¼šNode.js v20.18.0 + Express 4.18.2 + MySQL 8.0 + Sequelize ORM 6.35.2 æŠ€æœ¯æ ˆç¨³å®šå¯é 
- **å­˜å‚¨ç­–ç•¥æ™ºèƒ½**ï¼šSealosä¸‰å±‚å­˜å‚¨(hot/standard/archive)å…·å¤‡å•†ä¸šçº§æ‰©å±•èƒ½åŠ›
- **ä¸šåŠ¡æ¨¡å—åŒ–**ï¼šlottery/exchange/trade/uploadså®Œå…¨è§£è€¦ï¼Œæ”¯æŒç‹¬ç«‹è¿­ä»£
- **å­—æ®µè½¬æ¢æ™ºèƒ½**ï¼šè‡ªåŠ¨å¤„ç†å‰åç«¯å­—æ®µæ˜ å°„ï¼Œæå‡å¼€å‘æ•ˆç‡

#### **æ•°æ®å»ºæ¨¡çš„å®Œæ•´æ€§**

13ä¸ªæ•°æ®æ¨¡å‹è®¾è®¡ä½“ç°äº†æ·±åº¦çš„ä¸šåŠ¡ç†è§£ï¼š

- **å…³è”å…³ç³»å®Œå–„**ï¼šUser â†” PointsRecord â†” LotteryRecord ç­‰å…³è”å…³ç³»æ¸…æ™°
- **æ‰©å±•èƒ½åŠ›å¼º**ï¼šJSONå­—æ®µæ”¯æŒã€å…ƒæ•°æ®å­˜å‚¨ã€ä¸šåŠ¡é…ç½®åˆ†ç¦»
- **æ€§èƒ½è€ƒè™‘å‘¨åˆ°**ï¼šåˆç†çš„ç´¢å¼•ç­–ç•¥ã€åˆ†é¡µæ”¯æŒã€ç¼“å­˜æœºåˆ¶
- **ä¸šåŠ¡è¦†ç›–å…¨é¢**ï¼šåŒ…å«LotteryPityä¿åº•æœºåˆ¶ã€UploadReviewå®¡æ ¸æµç¨‹ç­‰å®Œæ•´ä¸šåŠ¡æ”¯æŒ

#### **APIè®¾è®¡çš„æ ‡å‡†åŒ–**

35+ä¸ªAPIæ¥å£å±•ç°äº†RESTfulè®¾è®¡çš„æœ€ä½³å®è·µï¼š

- **è·¯å¾„å‘½åä¸€è‡´**ï¼š/api/v3/ä¸šåŠ¡æ¨¡å—/æ“ä½œ çš„ç»Ÿä¸€è§„èŒƒ
- **å“åº”æ ¼å¼æ ‡å‡†**ï¼šç»Ÿä¸€çš„code/msg/dataç»“æ„
- **é”™è¯¯å¤„ç†å®Œæ•´**ï¼šåˆ†ç±»çš„é”™è¯¯ç ä½“ç³»å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯

### **ğŸš€ å¯¹å‰ç«¯å¼€å‘çš„å¯ç¤º**

1. **æŠ€æœ¯ä¿¡å¿ƒ**ï¼šåç«¯æ¶æ„å®Œå…¨æˆç†Ÿï¼Œå‰ç«¯å¯ä»¥æ”¾å¿ƒè¿›è¡Œå¤§è§„æ¨¡å¼€å‘
2. **å¯¹æ¥æ•ˆç‡**ï¼šæ ‡å‡†åŒ–çš„APIè®¾è®¡å°†å¤§å¹…æå‡å‰åç«¯å¯¹æ¥æ•ˆç‡
3. **æ‰©å±•èƒ½åŠ›**ï¼šæ¨¡å—åŒ–æ¶æ„æ”¯æŒåŠŸèƒ½çš„å¿«é€Ÿè¿­ä»£å’Œæ‰©å±•
4. **æ€§èƒ½ä¿éšœ**ï¼šæˆç†Ÿçš„ç¼“å­˜å’Œå­˜å‚¨ç­–ç•¥ç¡®ä¿ç³»ç»Ÿæ€§èƒ½

### **ğŸ“ˆ æŠ€æœ¯å€ºåŠ¡å’Œæ”¹è¿›å»ºè®®**

1. **æ–‡æ¡£åŒæ­¥æœºåˆ¶**ï¼šå»ºç«‹ä»£ç å˜æ›´â†’æ–‡æ¡£æ›´æ–°çš„è‡ªåŠ¨åŒ–æµç¨‹
2. **APIæµ‹è¯•è‡ªåŠ¨åŒ–**ï¼šé›†æˆAPIå¯ç”¨æ€§çš„è‡ªåŠ¨åŒ–æµ‹è¯•
3. **ç®¡ç†å‘˜æƒé™å®Œå–„**ï¼šè§£å†³auth/admin/checkæ¥å£çš„å°å¹…è°ƒè¯•éœ€æ±‚
4. **ç§¯åˆ†APIè¡¥å……**ï¼šå®Œå–„/api/v3/pointsæ¨¡å—çš„å®ç°

**æ ¸å¿ƒç»“è®º**ï¼šè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯æ¶æ„æˆç†Ÿã€å®ç°åº¦æé«˜ã€å¯ç›´æ¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨çš„ä¼ä¸šçº§ç³»ç»Ÿã€‚
