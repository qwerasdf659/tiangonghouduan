# æ•°æ®åº“å‡çº§éœ€æ±‚åˆ†ææŠ¥å‘Š

**åˆ›å»ºæ—¶é—´ï¼š** 2025å¹´8æœˆ4æ—¥ 21:37:02  
**åˆ†ææ¨¡å‹ï¼š** Claude Sonnet 4  
**é¡¹ç›®ç‰ˆæœ¬ï¼š** v2.0.0 (æ–°æ¶æ„)  
**æ•°æ®åº“ç±»å‹ï¼š** MySQL  
**å‡çº§ç´§æ€¥ç¨‹åº¦ï¼š** â­â­â­â­â­ (æé«˜)  

## ğŸ¯ **æ‰§è¡Œæ‘˜è¦**

ç»è¿‡å…¨é¢çš„å¤šç»´åº¦ä»£ç å®¡æŸ¥å’Œæ•°æ®åº“ç»“æ„åˆ†æï¼Œ**æ•°æ®åº“å¿…é¡»åŒæ­¥å‡çº§**ï¼å‘ç°äº†ä¸¥é‡çš„æ¨¡å‹ä¸æ•°æ®åº“ä¸åŒ¹é…é—®é¢˜ï¼Œå½±å“æ–°æ¶æ„çš„æ­£å¸¸è¿è¡Œã€‚

### æ ¸å¿ƒç»“è®º
- **ğŸ”´ ä¸¥é‡ä¸åŒ¹é…**ï¼šæ¨¡å‹å®šä¹‰ä¸å®é™…æ•°æ®åº“è¡¨ç»“æ„å­˜åœ¨é‡å¤§å·®å¼‚
- **ğŸ”´ ç¼ºå¤±è¿ç§»ç®¡ç†**ï¼šé¡¹ç›®æ— æ ‡å‡†çš„æ•°æ®åº“è¿ç§»æ–‡ä»¶å’Œç‰ˆæœ¬æ§åˆ¶
- **ğŸ”´ ä¸šåŠ¡æ¨¡å‹é”™ä½**ï¼šæ–°æ—§æ¶æ„ä¸šåŠ¡æ¨¡å‹å®Œå…¨ä¸åŒï¼ˆå…‘æ¢è®°å½• vs è®¢å•ç³»ç»Ÿï¼‰
- **ğŸ”´ æ•°æ®å®Œæ•´æ€§é£é™©**ï¼šå¤šä¸ªå­¤ç«‹è¡¨ç¼ºå°‘å¯¹åº”æ¨¡å‹ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„æ¼

## ğŸ“Š **å¤šç»´åº¦åˆ†æç»“æœ**

### 1. **æ•°æ®åº“è¡¨ä¸æ¨¡å‹åŒ¹é…åº¦åˆ†æ**

| æ•°æ®åº“è¡¨ | æ¨¡å‹æ–‡ä»¶ | åŒ¹é…çŠ¶æ€ | é—®é¢˜æè¿° |
|---|---|---|---|
| **products** | Product.js | ğŸŸ  éƒ¨åˆ†åŒ¹é… | ç¼ºå¤±6ä¸ªå­—æ®µï¼Œå­—æ®µç±»å‹ä¸ä¸€è‡´ |
| **users** | User.js | âœ… åŒ¹é…è‰¯å¥½ | ç»“æ„åŸºæœ¬ä¸€è‡´ |
| **business_configs** | BusinessConfigs.js | âœ… åŒ¹é…è‰¯å¥½ | ç»“æ„åŸºæœ¬ä¸€è‡´ |
| **exchange_orders** | ExchangeRecord.js | âŒ å®Œå…¨ä¸åŒ¹é… | ä¸¤ä¸ªä¸åŒçš„ä¸šåŠ¡æ¨¡å‹ |
| **lottery_pity** | æ—  | âŒ ç¼ºå¤±æ¨¡å‹ | å­¤ç«‹è¡¨ï¼Œæ— å¯¹åº”æ¨¡å‹ |
| **upload_reviews** | æ—  | âŒ ç¼ºå¤±æ¨¡å‹ | å­¤ç«‹è¡¨ï¼Œæ— å¯¹åº”æ¨¡å‹ |
| **lottery_prizes** | Prize.js | ğŸŸ  å¯èƒ½åŒ¹é… | éœ€è¦éªŒè¯ |
| **lottery_records** | LotteryRecord.js | ğŸŸ  å¯èƒ½åŒ¹é… | éœ€è¦éªŒè¯ |
| **points_records** | PointsRecord.js | ğŸŸ  å¯èƒ½åŒ¹é… | éœ€è¦éªŒè¯ |
| **image_resources** | ImageResources.js | ğŸŸ  å¯èƒ½åŒ¹é… | éœ€è¦éªŒè¯ |

**åŒ¹é…ç‡ç»Ÿè®¡ï¼š**
- âœ… å®Œå…¨åŒ¹é…ï¼š2/11 (18%)
- ğŸŸ  éƒ¨åˆ†åŒ¹é…ï¼š6/11 (55%)
- âŒ å®Œå…¨ä¸åŒ¹é…ï¼š3/11 (27%)

### 2. **Productsè¡¨è¯¦ç»†å·®å¼‚åˆ†æ**

#### ğŸ”´ **ä¸¥é‡å­—æ®µä¸åŒ¹é…**

| å­—æ®µé—®é¢˜ | æ•°æ®åº“å®é™… | æ¨¡å‹å®šä¹‰ | å½±å“ç¨‹åº¦ |
|---|---|---|---|
| **å­—æ®µåä¸åŒ¹é…** | `sales_count` | `sales` (æ˜ å°„åˆ°sales_count) | ğŸ”´ é«˜ |
| **å­—æ®µé•¿åº¦å·®å¼‚** | `name varchar(100)` | `name VARCHAR(200)` | ğŸŸ  ä¸­ |
| **çŠ¶æ€æšä¸¾ä¸åŒ¹é…** | `status enum('active','inactive','sold_out')` | `ENUM('active', 'offline', 'deleted')` | ğŸ”´ é«˜ |

#### ğŸ“‹ **ç¼ºå¤±å­—æ®µï¼ˆæ¨¡å‹æœ‰ï¼Œæ•°æ®åº“æ— ï¼‰**

1. **view_count** - æµè§ˆæ¬¡æ•°ç»Ÿè®¡
2. **warranty** - å”®åè¯´æ˜ä¿¡æ¯  
3. **delivery_info** - é…é€ä¿¡æ¯
4. **expires_at** - å•†å“è¿‡æœŸæ—¶é—´
5. **created_by** - åˆ›å»ºè€…ç”¨æˆ·ID
6. **updated_by** - æœ€åæ›´æ–°è€…ç”¨æˆ·ID

è¿™äº›å­—æ®µåœ¨æ–°æ¶æ„çš„ä¸šåŠ¡é€»è¾‘ä¸­è¢«ä½¿ç”¨ï¼Œä½†æ•°æ®åº“è¡¨ä¸­ä¸å­˜åœ¨ï¼Œå°†å¯¼è‡´æŸ¥è¯¢å’Œæ›´æ–°å¤±è´¥ã€‚

### 3. **ä¸šåŠ¡æ¨¡å‹æ¶æ„å˜åŒ–åˆ†æ**

#### ğŸ”´ **å…‘æ¢ç³»ç»Ÿæ¨¡å‹å®Œå…¨å˜æ›´**

**æ—§æ¶æ„ (æ•°æ®åº“å®é™…)ï¼š** å®Œæ•´è®¢å•ç³»ç»Ÿ
```sql
-- exchange_ordersè¡¨ - å®Œæ•´çš„ç”µå•†è®¢å•æ¨¡å‹
order_id, user_id, product_id, product_name, product_image,
quantity, unit_points, total_points, recipient_name, 
recipient_phone, shipping_address, postal_code,
status (pending/confirmed/shipped/delivered/cancelled/refunded),
confirm_time, ship_time, delivery_time, tracking_number...
```

**æ–°æ¶æ„ (æ¨¡å‹å®šä¹‰)ï¼š** ç®€åŒ–å…‘æ¢è®°å½•
```javascript
// ExchangeRecordæ¨¡å‹ - ç®€åŒ–çš„å…‘æ¢å‡­è¯æ¨¡å‹
id, exchange_id, user_id, product_id, product_snapshot,
quantity, total_points, exchange_code, 
status (pending/completed/used/expired/cancelled),
space (lucky/premium), exchange_time, expires_at...
```

**åˆ†æç»“è®ºï¼š**
- è¿™æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ä¸šåŠ¡æ¨¡å‹
- æ—§æ¶æ„æ”¯æŒå®Œæ•´çš„ç”µå•†è®¢å•æµç¨‹ï¼ˆé…é€ã€ç‰©æµã€æ”¶è´§äººä¿¡æ¯ï¼‰
- æ–°æ¶æ„æ˜¯è™šæ‹Ÿå•†å“å…‘æ¢ç³»ç»Ÿï¼ˆç§¯åˆ†å…‘æ¢ç æ¨¡å¼ï¼‰
- **å¿…é¡»è¿›è¡Œæ•°æ®åº“ç»“æ„å‡çº§ä»¥åŒ¹é…æ–°çš„ä¸šåŠ¡æ¨¡å‹**

### 4. **å­¤ç«‹è¡¨é£é™©åˆ†æ**

#### ğŸ”´ **æ— æ¨¡å‹å¯¹åº”çš„è¡¨**

1. **lottery_pity** - ä¿åº•æœºåˆ¶è¡¨
   - åŒ…å«ç”¨æˆ·ä¿åº•æŠ½å¥–æ•°æ®
   - æ— å¯¹åº”Sequelizeæ¨¡å‹
   - æ•°æ®æ— æ³•é€šè¿‡ORMè®¿é—®å’Œç»´æŠ¤

2. **upload_reviews** - å›¾ç‰‡å®¡æ ¸è¡¨  
   - åŒ…å«ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„å®¡æ ¸æ•°æ®
   - æ— å¯¹åº”Sequelizeæ¨¡å‹
   - å¯èƒ½å¯¼è‡´å®¡æ ¸åŠŸèƒ½å¤±æ•ˆ

#### ğŸŸ  **æ¨¡å‹æ— è¡¨å¯¹åº”**

1. **PremiumSpaceAccess.js** - è‡»é€‰ç©ºé—´è®¿é—®æ¨¡å‹
   - æ¨¡å‹å·²å®šä¹‰ä½†æ•°æ®åº“æ— å¯¹åº”è¡¨
   - å¯èƒ½æ˜¯æ–°å¢åŠŸèƒ½ä½†æœªåŒæ­¥åˆ°æ•°æ®åº“

2. **TradeRecord.js** - äº¤æ˜“è®°å½•æ¨¡å‹
   - æ¨¡å‹å·²å®šä¹‰ä½†æ•°æ®åº“æ— å¯¹åº”è¡¨
   - å¯èƒ½æ˜¯é‡å‘½åæˆ–ä¸šåŠ¡å˜æ›´

### 5. **æ•°æ®åº“è¿ç§»ç®¡ç†ç¼ºå¤±åˆ†æ**

#### ğŸ”´ **ä¸¥é‡çš„ç‰ˆæœ¬ç®¡ç†é—®é¢˜**

- **æ— migrationsç›®å½•**ï¼šé¡¹ç›®ç¼ºå°‘æ ‡å‡†çš„Sequelizeè¿ç§»æ–‡ä»¶ç®¡ç†
- **æ— seedersç›®å½•**ï¼šç¼ºå°‘æ•°æ®åˆå§‹åŒ–ç§å­æ–‡ä»¶
- **æ— .sequelizercé…ç½®**ï¼šç¼ºå°‘Sequelize CLIé…ç½®æ–‡ä»¶
- **è¿ç§»è„šæœ¬æ··ä¹±**ï¼šå­˜åœ¨å¤šä¸ªä¸è§„èŒƒçš„åŒæ­¥è„šæœ¬

ç°æœ‰çš„æ•°æ®åº“ç®¡ç†è„šæœ¬ï¼š
```javascript
// scripts/sync-database.js - åŸºç¡€åŒæ­¥
// rebuild-database-safe.js - å±é™©çš„é‡å»ºè„šæœ¬  
// models/index.js syncModels() - å†…ç½®åŒæ­¥å‡½æ•°
```

**é—®é¢˜ï¼š**
- ç¼ºä¹ç‰ˆæœ¬æ§åˆ¶ï¼Œæ— æ³•å›æ»š
- æ— æ³•è¿½è¸ªæ•°æ®åº“å˜æ›´å†å²
- ç”Ÿäº§ç¯å¢ƒå‡çº§é£é™©æé«˜
- å›¢é˜Ÿåä½œæ—¶æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´

### 6. **ç´¢å¼•å’Œæ€§èƒ½åˆ†æ**

#### âœ… **ç°æœ‰ç´¢å¼•é…ç½®è‰¯å¥½**

Productsè¡¨ç°æœ‰ç´¢å¼•ï¼š
```sql
PRIMARY KEY (commodity_id)
INDEX idx_category (category)
INDEX idx_exchange_points (exchange_points)  
INDEX idx_status (status)
INDEX idx_stock (stock)
INDEX idx_is_hot (is_hot)
INDEX idx_sort_order (sort_order)
INDEX idx_sales_count (sales_count)
COMPOSITE INDEX idx_category_points_stock (category, exchange_points, stock)
```

#### ğŸŸ  **éœ€è¦ä¼˜åŒ–çš„ç´¢å¼•**

åŸºäºæ–°æ¶æ„çš„æŸ¥è¯¢éœ€æ±‚ï¼Œå»ºè®®æ·»åŠ ï¼š
```sql
-- æ”¯æŒæ–°çš„ä¸šåŠ¡æŸ¥è¯¢æ¨¡å¼
INDEX idx_space_status (space, status)
INDEX idx_created_at (created_at) 
INDEX idx_is_new_hot (is_new, is_hot)
INDEX idx_low_stock (stock, low_stock_threshold)
```

## ğŸš¨ **é£é™©è¯„ä¼°**

### é«˜é£é™©é—®é¢˜

1. **æ•°æ®ä¸¢å¤±é£é™©** ğŸ”´
   - ExchangeRecordæ¨¡å‹ä¸exchange_ordersè¡¨ä¸åŒ¹é…
   - æ–°ä»£ç å¯èƒ½æ— æ³•æ­£ç¡®è¯»å–ç°æœ‰è®¢å•æ•°æ®
   - ç”¨æˆ·å†å²å…‘æ¢è®°å½•å¯èƒ½ä¸¢å¤±

2. **åŠŸèƒ½å¤±æ•ˆé£é™©** ğŸ”´  
   - Productsè¡¨ç¼ºå¤±å­—æ®µå¯¼è‡´æ–°åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
   - å­¤ç«‹è¡¨ç¼ºå°‘æ¨¡å‹å¯¼è‡´ç›¸å…³åŠŸèƒ½å¤±æ•ˆ
   - å®¡æ ¸ç³»ç»Ÿã€ä¿åº•æœºåˆ¶å¯èƒ½ä¸­æ–­

3. **æ•°æ®ä¸€è‡´æ€§é£é™©** ğŸ”´
   - æšä¸¾å€¼ä¸åŒ¹é…å¯¼è‡´çŠ¶æ€åŒæ­¥é—®é¢˜
   - å­—æ®µç±»å‹å·®å¼‚å¯èƒ½å¯¼è‡´æ•°æ®æˆªæ–­
   - å¤–é”®å…³ç³»ä¸æ˜ç¡®

4. **éƒ¨ç½²é£é™©** ğŸ”´
   - æ— æ ‡å‡†è¿ç§»ç®¡ç†ï¼Œç”Ÿäº§ç¯å¢ƒå‡çº§å›°éš¾
   - æ— æ³•å›æ»šï¼Œå‡çº§å¤±è´¥åæœä¸¥é‡
   - å›¢é˜Ÿæˆå‘˜æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´

## ğŸ’¡ **æ·±åº¦æ€è€ƒå’Œæ ¹æœ¬åŸå› åˆ†æ**

### **ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Ÿ**

1. **æ¶æ„é‡æ„ä¸å½»åº•**ï¼š
   - ä¸šåŠ¡æ¨¡å‹å·²ç»é‡æ–°è®¾è®¡ï¼ˆä»è®¢å•ç³»ç»Ÿåˆ°å…‘æ¢ç ç³»ç»Ÿï¼‰
   - ä½†æ•°æ®åº“ç»“æ„æ²¡æœ‰åŒæ­¥æ›´æ–°
   - æ–°æ—§ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘å­˜åœ¨æ ¹æœ¬å·®å¼‚

2. **æ•°æ®åº“ç®¡ç†è§„èŒƒç¼ºå¤±**ï¼š
   - é¡¹ç›®å‡çº§åˆ°v2.0ä½†æ²¡æœ‰å»ºç«‹æ ‡å‡†çš„è¿ç§»ç®¡ç†
   - å¤šäººå¼€å‘æ—¶æ•°æ®åº“å˜æ›´æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶
   - ç¼ºå°‘æ•°æ®åº“å˜æ›´çš„reviewæµç¨‹

3. **æµ‹è¯•è¦†ç›–ä¸è¶³**ï¼š
   - æ¨¡å‹ä¸æ•°æ®åº“ä¸åŒ¹é…é—®é¢˜æ²¡æœ‰è¢«è‡ªåŠ¨åŒ–æµ‹è¯•å‘ç°
   - ç¼ºå°‘æ•°æ®åº“ç»“æ„çš„ä¸€è‡´æ€§æµ‹è¯•
   - æ–°åŠŸèƒ½å¼€å‘æ—¶æ²¡æœ‰éªŒè¯æ•°æ®åº“ä¾èµ–

4. **é¡¹ç›®ç®¡ç†é—®é¢˜**ï¼š
   - v2.0å‡çº§æ—¶æ²¡æœ‰åˆ¶å®šå®Œæ•´çš„æ•°æ®åº“å‡çº§è®¡åˆ’
   - å‰åç«¯å¼€å‘ç¼ºå°‘æ•°æ®åº“ç»“æ„çš„ç»Ÿä¸€è§„åˆ’
   - ç¼ºå°‘æ•°æ®åº“å˜æ›´çš„æ–‡æ¡£è®°å½•

### **è¿™åæ˜ äº†ä»€ä¹ˆæ·±å±‚é—®é¢˜ï¼Ÿ**

1. **æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯**ï¼š
   - å¿«é€Ÿè¿­ä»£å¯¼è‡´æ•°æ®åº“ç»“æ„æ²¡æœ‰åŠæ—¶é‡æ„
   - ä¸´æ—¶è§£å†³æ–¹æ¡ˆæˆä¸ºäº†é•¿æœŸé—®é¢˜
   - ç¼ºå°‘å®šæœŸçš„æŠ€æœ¯å€ºåŠ¡æ¸…ç†

2. **å›¢é˜Ÿåä½œæœºåˆ¶ä¸å®Œå–„**ï¼š
   - æ•°æ®åº“å˜æ›´æ²¡æœ‰ç»Ÿä¸€çš„ç®¡ç†æµç¨‹
   - ç¼ºå°‘è·¨å›¢é˜Ÿçš„æŠ€æœ¯å†³ç­–æ²Ÿé€š
   - æ•°æ®åº“è®¾è®¡ç¼ºå°‘reviewæœºåˆ¶

## ğŸ”§ **æ•°æ®åº“å‡çº§æ–¹æ¡ˆ**

### é˜¶æ®µä¸€ï¼šç´§æ€¥ä¿®å¤ï¼ˆç«‹å³æ‰§è¡Œï¼‰

#### 1. **å»ºç«‹æ ‡å‡†è¿ç§»ç®¡ç†**
```bash
# åˆå§‹åŒ–Sequelize CLIç»“æ„
npx sequelize-cli init

# åˆ›å»º.sequelizercé…ç½®æ–‡ä»¶
echo "const path = require('path');
module.exports = {
  'config': path.resolve('config', 'database.js'),
  'models-path': path.resolve('models'),
  'seeders-path': path.resolve('seeders'),
  'migrations-path': path.resolve('migrations')
};" > .sequelizerc
```

#### 2. **åˆ›å»ºproductsè¡¨å‡çº§è¿ç§»**
```javascript
// migrations/001-upgrade-products-table.js
module.exports = {
  up: async (queryInterface, Sequelize) => {
    // æ·»åŠ ç¼ºå¤±å­—æ®µ
    await queryInterface.addColumn('products', 'view_count', {
      type: Sequelize.INTEGER,
      defaultValue: 0,
      comment: 'æµè§ˆæ¬¡æ•°'
    });
    
    await queryInterface.addColumn('products', 'warranty', {
      type: Sequelize.STRING(200),
      allowNull: true,
      comment: 'å”®åè¯´æ˜'
    });
    
    await queryInterface.addColumn('products', 'delivery_info', {
      type: Sequelize.STRING(200),
      allowNull: true,
      comment: 'é…é€ä¿¡æ¯'
    });
    
    await queryInterface.addColumn('products', 'expires_at', {
      type: Sequelize.DATE,
      allowNull: true,
      comment: 'è¿‡æœŸæ—¶é—´'
    });
    
    await queryInterface.addColumn('products', 'created_by', {
      type: Sequelize.INTEGER,
      allowNull: true,
      comment: 'åˆ›å»ºè€…ç”¨æˆ·ID'
    });
    
    await queryInterface.addColumn('products', 'updated_by', {
      type: Sequelize.INTEGER,
      allowNull: true,
      comment: 'æœ€åæ›´æ–°è€…ç”¨æˆ·ID'
    });
    
    // ä¿®æ”¹å­—æ®µé•¿åº¦
    await queryInterface.changeColumn('products', 'name', {
      type: Sequelize.STRING(200),
      allowNull: false,
      comment: 'å•†å“åç§°'
    });
    
    // ä¿®æ”¹çŠ¶æ€æšä¸¾
    await queryInterface.changeColumn('products', 'status', {
      type: Sequelize.ENUM('active', 'offline', 'deleted'),
      defaultValue: 'active',
      comment: 'å•†å“çŠ¶æ€'
    });
  },
  
  down: async (queryInterface, Sequelize) => {
    // å›æ»šæ“ä½œ
    await queryInterface.removeColumn('products', 'view_count');
    await queryInterface.removeColumn('products', 'warranty');
    await queryInterface.removeColumn('products', 'delivery_info');
    await queryInterface.removeColumn('products', 'expires_at');
    await queryInterface.removeColumn('products', 'created_by');
    await queryInterface.removeColumn('products', 'updated_by');
  }
};
```

#### 3. **åˆ›å»ºä¸šåŠ¡æ¨¡å‹è¿ç§»**
```javascript
// migrations/002-create-exchange-records.js
// æ ¹æ®æ–°çš„ExchangeRecordæ¨¡å‹åˆ›å»ºè¡¨
// migrations/003-migrate-exchange-data.js  
// å°†exchange_ordersæ•°æ®è¿ç§»åˆ°æ–°çš„exchange_recordsè¡¨
// migrations/004-create-missing-models.js
// ä¸ºå­¤ç«‹è¡¨åˆ›å»ºå¯¹åº”æ¨¡å‹
```

### é˜¶æ®µäºŒï¼šæ•°æ®è¿ç§»ï¼ˆè°¨æ…æ‰§è¡Œï¼‰

#### 1. **å…‘æ¢æ•°æ®è¿ç§»ç­–ç•¥**
```javascript
// æ•°æ®è¿ç§»è„šæœ¬
async function migrateExchangeData() {
  const transaction = await sequelize.transaction();
  
  try {
    // 1. åˆ›å»ºæ–°çš„exchange_recordsè¡¨
    await createExchangeRecordsTable(transaction);
    
    // 2. å°†exchange_ordersæ•°æ®è½¬æ¢å¹¶è¿ç§»
    const orders = await sequelize.query(
      'SELECT * FROM exchange_orders WHERE status IN ("confirmed", "delivered")',
      { transaction }
    );
    
    for (const order of orders[0]) {
      await sequelize.query(`
        INSERT INTO exchange_records (
          exchange_id, user_id, product_id, product_snapshot,
          quantity, total_points, exchange_code, status,
          space, exchange_time, created_at, updated_at
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
      `, {
        replacements: [
          `EX_${order.order_id}`,
          order.user_id,
          order.product_id,
          JSON.stringify({
            name: order.product_name,
            image: order.product_image,
            unit_points: order.unit_points
          }),
          order.quantity,
          order.total_points,
          `CODE_${order.order_id}`,
          order.status === 'delivered' ? 'completed' : 'pending',
          'lucky', // é»˜è®¤ç©ºé—´
          order.created_at,
          order.created_at,
          order.updated_at
        ],
        transaction
      });
    }
    
    await transaction.commit();
    console.log('æ•°æ®è¿ç§»å®Œæˆ');
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}
```

#### 2. **å­¤ç«‹è¡¨æ¨¡å‹åˆ›å»º**
```javascript
// models/LotteryPity.js - ä¸ºlottery_pityè¡¨åˆ›å»ºæ¨¡å‹
// models/UploadReview.js - ä¸ºupload_reviewsè¡¨åˆ›å»ºæ¨¡å‹
```

### é˜¶æ®µä¸‰ï¼šä¼˜åŒ–å’Œæ¸…ç†ï¼ˆåç»­æ‰§è¡Œï¼‰

#### 1. **ç´¢å¼•ä¼˜åŒ–**
```sql
-- æ·»åŠ æ–°æ¶æ„éœ€è¦çš„ç´¢å¼•
ALTER TABLE products ADD INDEX idx_space_status (space, status);
ALTER TABLE products ADD INDEX idx_created_at (created_at);
ALTER TABLE products ADD INDEX idx_is_new_hot (is_new, is_hot);

-- åˆ›å»ºæ–°è¡¨çš„ç´¢å¼•
ALTER TABLE exchange_records ADD INDEX idx_user_status (user_id, status);
ALTER TABLE exchange_records ADD INDEX idx_exchange_time (exchange_time);
ALTER TABLE exchange_records ADD INDEX idx_space (space);
```

#### 2. **æ•°æ®æ¸…ç†**
```javascript
// æ¸…ç†æ—§çš„exchange_ordersè¡¨ï¼ˆåœ¨ç¡®è®¤æ•°æ®è¿ç§»æ— è¯¯åï¼‰
// æ¸…ç†æ— ç”¨çš„ä¸´æ—¶æ•°æ®
// ä¼˜åŒ–æ•°æ®åº“è¡¨ç»“æ„
```

## ğŸ“‹ **æ‰§è¡Œæ¸…å•**

### ğŸ”´ **ç«‹å³æ‰§è¡Œï¼ˆP0ï¼‰**
- [ ] å»ºç«‹Sequelize CLIè¿ç§»ç®¡ç†ç»“æ„
- [ ] åˆ›å»ºproductsè¡¨å­—æ®µè¡¥å……è¿ç§»
- [ ] ä¿®å¤å­—æ®µç±»å‹å’Œæšä¸¾ä¸åŒ¹é…é—®é¢˜
- [ ] ä¸ºå­¤ç«‹è¡¨åˆ›å»ºå¯¹åº”æ¨¡å‹

### ğŸŸ  **ä¸€å‘¨å†…æ‰§è¡Œï¼ˆP1ï¼‰**  
- [ ] è®¾è®¡å…‘æ¢æ•°æ®è¿ç§»æ–¹æ¡ˆ
- [ ] åˆ›å»ºæ–°çš„exchange_recordsè¡¨
- [ ] æ‰§è¡Œæ•°æ®è¿ç§»ï¼ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼‰
- [ ] æ›´æ–°ä¸šåŠ¡ä»£ç ä»¥é€‚é…æ–°è¡¨ç»“æ„

### ğŸŸ¡ **ä¸€ä¸ªæœˆå†…æ‰§è¡Œï¼ˆP2ï¼‰**
- [ ] ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
- [ ] æ¸…ç†æ—§æ•°æ®å’Œä¸´æ—¶è¡¨
- [ ] å»ºç«‹æ•°æ®åº“å˜æ›´ç®¡ç†è§„èŒƒ
- [ ] å®Œå–„æ•°æ®åº“æ–‡æ¡£

## ğŸ¯ **æˆåŠŸæ ‡å‡†**

### æŠ€æœ¯æŒ‡æ ‡
- âœ… æ¨¡å‹ä¸æ•°æ®åº“è¡¨ç»“æ„100%åŒ¹é…
- âœ… æ‰€æœ‰APIæ¥å£æ­£å¸¸å·¥ä½œ
- âœ… æ•°æ®è¿ç§»é›¶ä¸¢å¤±
- âœ… æŸ¥è¯¢æ€§èƒ½ä¸ä½äºåŸæœ‰æ°´å¹³

### ä¸šåŠ¡æŒ‡æ ‡  
- âœ… ç”¨æˆ·å…‘æ¢åŠŸèƒ½æ­£å¸¸
- âœ… å†å²æ•°æ®å®Œæ•´ä¿ç•™
- âœ… æ–°åŠŸèƒ½æ­£å¸¸ä¸Šçº¿
- âœ… å®¡æ ¸å’Œä¿åº•æœºåˆ¶æ­£å¸¸

## ğŸ“ **æ¨èæ‰§è¡Œé¡ºåº**

1. **ç«‹å³å¼€å§‹**ï¼šå»ºç«‹æ ‡å‡†è¿ç§»ç®¡ç†ï¼Œä¿®å¤productsè¡¨
2. **å¹¶è¡Œè¿›è¡Œ**ï¼šåˆ›å»ºç¼ºå¤±æ¨¡å‹ï¼Œæµ‹è¯•ç°æœ‰åŠŸèƒ½
3. **è°¨æ…æ‰§è¡Œ**ï¼šæ•°æ®è¿ç§»ï¼ˆå…ˆæµ‹è¯•ç¯å¢ƒï¼Œå†ç”Ÿäº§ç¯å¢ƒï¼‰
4. **åç»­ä¼˜åŒ–**ï¼šç´¢å¼•ä¼˜åŒ–ï¼Œæ•°æ®æ¸…ç†ï¼Œè§„èŒƒå»ºè®¾

## âš ï¸ **é‡è¦æé†’**

1. **æ•°æ®å¤‡ä»½**ï¼šæ‰€æœ‰å‡çº§æ“ä½œå‰å¿…é¡»å®Œæ•´å¤‡ä»½æ•°æ®åº“
2. **æµ‹è¯•éªŒè¯**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå®Œæ•´éªŒè¯åå†åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒ
3. **å›æ»šè®¡åˆ’**ï¼šå‡†å¤‡å®Œæ•´çš„å›æ»šæ–¹æ¡ˆå’Œæ•°æ®æ¢å¤è®¡åˆ’
4. **å›¢é˜ŸåŒæ­¥**ï¼šç¡®ä¿æ‰€æœ‰å¼€å‘äººå‘˜ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ç»“æ„

---

**æŠ¥å‘Šç»“è®ºï¼š** æ•°æ®åº“å¿…é¡»ç«‹å³å‡çº§ä»¥åŒ¹é…v2.0æ–°æ¶æ„ï¼Œå»ºè®®æŒ‰é˜¶æ®µæ‰§è¡Œï¼Œä¼˜å…ˆè§£å†³ä¸¥é‡ä¸åŒ¹é…é—®é¢˜ã€‚

**è”ç³»æ–¹å¼ï¼š** åç«¯å¼€å‘å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025å¹´8æœˆ4æ—¥ 21:37:02  
**çŠ¶æ€ï¼š** ğŸ”´ éœ€è¦ç«‹å³æ‰§è¡Œ 