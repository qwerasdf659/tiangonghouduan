# ğŸ§ª Playwright E2E æµ‹è¯•è§„èŒƒ - æ•°æ®éªŒè¯ç¯‡

## ğŸ“‹ è§„èŒƒæ¦‚è¿°

æœ¬æ–‡æ¡£æ˜¯ Playwright E2E æµ‹è¯•è§„èŒƒçš„**æ•°æ®éªŒè¯ç¯‡**ï¼ŒåŒ…å« API å“åº”éªŒè¯ã€å­—æ®µæ˜ å°„æ£€æŸ¥ã€å‰ç«¯ Bug æ£€æµ‹ç­‰ä¸“é¡¹è§„åˆ™ã€‚

**é…å¥—æ–‡æ¡£**ï¼š`09-Playwright-åŸºç¡€è§„èŒƒ.mdc`ï¼ˆæ ¸å¿ƒè§„åˆ™ + ç”¨æˆ·è¡Œä¸ºæµ‹è¯•ï¼‰

**æµ‹è¯•ç›®æ ‡ç¯å¢ƒ**ï¼šhttps://omqktqrtntnn.sealosbja.site/admin/workspace.htmlï¼ˆçº¿ä¸Šéƒ¨ç½²ï¼‰

---

## ğŸ”´ è§„åˆ™ E2E-DATA-001ï¼šAPIå“åº”å­—æ®µå®Œæ•´æ€§éªŒè¯ï¼ˆå¿…é¡»ï¼‰

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼šåç«¯è¿”å› `audit_id: undefined`ï¼Œä½†å‰ç«¯æµ‹è¯•åªæ£€æŸ¥ `response.ok`ï¼Œæ²¡æœ‰å‘ç°è¿™ä¸ªå…³é”®å­—æ®µç¼ºå¤±é—®é¢˜ã€‚

**åŸå› **ï¼šæµ‹è¯•åªéªŒè¯äº†"APIè¿”å›æˆåŠŸ"ï¼Œæ²¡æœ‰éªŒè¯"APIè¿”å›çš„å­—æ®µæ˜¯å¦å®Œæ•´ä¸”æœ‰å€¼"ã€‚

### å¼ºåˆ¶è¦æ±‚

**æ¯ä¸ªAPIå“åº”å¿…é¡»éªŒè¯**ï¼š
1. å…³é”®ä¸šåŠ¡å­—æ®µå­˜åœ¨ï¼ˆnot undefinedï¼‰
2. å…³é”®ä¸šåŠ¡å­—æ®µæœ‰å€¼ï¼ˆnot null, not emptyï¼‰
3. å­—æ®µç±»å‹æ­£ç¡®

```javascript
// âŒ ç¦æ­¢ï¼šåªæ£€æŸ¥å“åº”æˆåŠŸ
test('è·å–åˆ—è¡¨', async ({ page }) => {
  const response = await page.waitForResponse('**/merchant-points')
  expect(response.ok()).toBe(true)  // âŒ åªæ£€æŸ¥HTTPçŠ¶æ€
})

// âœ… æ­£ç¡®ï¼šéªŒè¯å­—æ®µå®Œæ•´æ€§
test('è·å–åˆ—è¡¨ - éªŒè¯å­—æ®µå®Œæ•´æ€§', async ({ page }) => {
  const response = await page.waitForResponse('**/merchant-points')
  expect(response.ok()).toBe(true)
  
  const json = await response.json()
  expect(json.success).toBe(true)
  
  // âœ… å…³é”®ï¼šéªŒè¯ä¸šåŠ¡å­—æ®µå­˜åœ¨ä¸”æœ‰å€¼
  if (json.data.rows.length > 0) {
    const firstItem = json.data.rows[0]
    
    // å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥
    expect(firstItem).toHaveProperty('audit_id')
    expect(firstItem).toHaveProperty('user_id')
    expect(firstItem).toHaveProperty('status')
    
    // å­—æ®µå€¼æœ‰æ•ˆæ€§æ£€æŸ¥
    expect(firstItem.audit_id).toBeDefined()
    expect(firstItem.audit_id).not.toBeNull()
    expect(firstItem.audit_id).not.toBeUndefined()
    
    // å­—æ®µç±»å‹æ£€æŸ¥
    expect(typeof firstItem.audit_id).toBe('number')
  }
})
```

### å­—æ®µæ£€æŸ¥å·¥å…·å‡½æ•°

```javascript
/**
 * éªŒè¯APIå“åº”å­—æ®µå®Œæ•´æ€§
 * @param {object} item - APIè¿”å›çš„æ•°æ®é¡¹
 * @param {string[]} requiredFields - å¿…éœ€çš„å­—æ®µåˆ—è¡¨
 */
function assertFieldsExist(item, requiredFields) {
  requiredFields.forEach(field => {
    expect(item, `å“åº”ç¼ºå°‘å­—æ®µ: ${field}`).toHaveProperty(field)
    expect(item[field], `å­—æ®µ${field}å€¼ä¸ºundefined`).toBeDefined()
    expect(item[field], `å­—æ®µ${field}å€¼ä¸ºnull`).not.toBeNull()
  })
}

// ä½¿ç”¨ç¤ºä¾‹
test('å•†æˆ·ç§¯åˆ†åˆ—è¡¨å­—æ®µå®Œæ•´æ€§', async ({ page }) => {
  const response = await page.waitForResponse('**/merchant-points')
  const json = await response.json()
  
  if (json.data.rows.length > 0) {
    const requiredFields = ['audit_id', 'user_id', 'status', 'points_amount', 'created_at']
    assertFieldsExist(json.data.rows[0], requiredFields)
  }
})
```

---

## ğŸ”´ è§„åˆ™ E2E-DATA-002ï¼šå¤šAPIæ•°æ®ä¸€è‡´æ€§éªŒè¯ï¼ˆå¿…é¡»ï¼‰

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼šç»Ÿè®¡APIè¿”å› `pending_count: 10`ï¼Œä½†åˆ—è¡¨APIè¿”å› `rows: []`ã€‚æµ‹è¯•åˆ†åˆ«éªŒè¯ä¸¤ä¸ªAPIéƒ½æˆåŠŸï¼Œä½†æ²¡æœ‰äº¤å‰éªŒè¯æ•°æ®ä¸€è‡´æ€§ã€‚

**åŸå› **ï¼šæµ‹è¯•æ²¡æœ‰åŒæ—¶ç›‘å¬å¤šä¸ªAPIï¼Œå¹¶éªŒè¯å®ƒä»¬è¿”å›çš„æ•°æ®é€»è¾‘ä¸€è‡´ã€‚

### å¼ºåˆ¶è¦æ±‚

**å½“é¡µé¢åŒæ—¶è°ƒç”¨å¤šä¸ªç›¸å…³APIæ—¶ï¼Œå¿…é¡»éªŒè¯**ï¼š
1. ç»Ÿè®¡æ•° ä¸ åˆ—è¡¨æ•° åŒ¹é…
2. ç­›é€‰æ¡ä»¶å½±å“æ‰€æœ‰API
3. æ•°æ®çŠ¶æ€åœ¨æ‰€æœ‰è§†å›¾ä¸€è‡´

```javascript
// âŒ ç¦æ­¢ï¼šåˆ†åˆ«éªŒè¯ï¼Œä¸äº¤å‰æ£€æŸ¥
test('åˆ†åˆ«éªŒè¯ç»Ÿè®¡å’Œåˆ—è¡¨', async ({ page }) => {
  // éªŒè¯ç»Ÿè®¡
  const statsRes = await page.waitForResponse('**/stats/pending')
  const stats = await statsRes.json()
  expect(stats.data.pending_count).toBeGreaterThan(0)  // âœ… æœ‰å¾…å¤„ç†
  
  // éªŒè¯åˆ—è¡¨
  const listRes = await page.waitForResponse('**/merchant-points')
  const list = await listRes.json()
  expect(list.success).toBe(true)  // âŒ æ²¡æœ‰éªŒè¯åˆ—è¡¨æ•°é‡ä¸ç»Ÿè®¡åŒ¹é…
})

// âœ… æ­£ç¡®ï¼šåŒæ—¶ç›‘å¬ï¼Œäº¤å‰éªŒè¯
test('ç»Ÿè®¡æ•°æ®ä¸åˆ—è¡¨æ•°æ®ä¸€è‡´æ€§', async ({ page }) => {
  // åŒæ—¶ç›‘å¬ä¸¤ä¸ªAPI
  const [statsRes, listRes] = await Promise.all([
    page.waitForResponse('**/stats/pending'),
    page.waitForResponse(resp => 
      resp.url().includes('/merchant-points') && 
      !resp.url().includes('/stats')
    )
  ])
  
  const stats = await statsRes.json()
  const list = await listRes.json()
  
  // âœ… å…³é”®ï¼šäº¤å‰éªŒè¯æ•°æ®ä¸€è‡´æ€§
  const pendingCount = stats.data.pending_count || 0
  const listCount = list.data.rows?.length || 0
  const totalFromPagination = list.data.total || 0
  
  // å¦‚æœç»Ÿè®¡æ˜¾ç¤ºæœ‰å¾…å¤„ç†ï¼Œåˆ—è¡¨ä¸èƒ½ä¸ºç©º
  if (pendingCount > 0) {
    expect(listCount, 'ç»Ÿè®¡æ˜¾ç¤ºæœ‰å¾…å¤„ç†ï¼Œä½†åˆ—è¡¨ä¸ºç©º').toBeGreaterThan(0)
  }
  
  // å¦‚æœç­›é€‰æ¡ä»¶æ˜¯"å¾…å¤„ç†"ï¼Œæ•°é‡åº”è¯¥åŒ¹é…
  // ï¼ˆè€ƒè™‘åˆ†é¡µï¼šåˆ—è¡¨count <= totalï¼Œtotalåº”ä¸ç»Ÿè®¡ä¸€è‡´ï¼‰
  if (pendingCount > 0 && list.data.status === 'pending') {
    expect(totalFromPagination, 'åˆ—è¡¨æ€»æ•°åº”ä¸ç»Ÿè®¡çš„å¾…å¤„ç†æ•°ä¸€è‡´').toBe(pendingCount)
  }
})
```

### æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æ¸…å•

| åœºæ™¯ | å¿…é¡»éªŒè¯ |
|------|---------|
| ç»Ÿè®¡å¡ç‰‡ + åˆ—è¡¨ | ç»Ÿè®¡æ•° >= å½“å‰é¡µæ•°é‡ï¼Œæ€»æ•° = ç»Ÿè®¡æ•° |
| ç­›é€‰æ¡ä»¶å˜æ›´ | æ‰€æœ‰APIä½¿ç”¨ç›¸åŒç­›é€‰å‚æ•° |
| çŠ¶æ€å˜æ›´å | ç»Ÿè®¡æ•°å’Œåˆ—è¡¨åŒæ­¥æ›´æ–° |
| åˆ†é¡µåˆ‡æ¢ | æ€»æ•°ä¸å˜ï¼Œå½“å‰é¡µæ•°æ®æ­£ç¡® |

```javascript
// âœ… å®Œæ•´çš„æ•°æ®ä¸€è‡´æ€§æµ‹è¯•æ¨¡æ¿
test('é¡µé¢æ•°æ®ä¸€è‡´æ€§éªŒè¯', async ({ page }) => {
  await page.goto('/finance-management.html')
  
  // æ”¶é›†æ‰€æœ‰APIå“åº”
  const apiResponses = {}
  
  page.on('response', async response => {
    const url = response.url()
    if (url.includes('/stats/pending')) {
      apiResponses.stats = await response.json().catch(() => null)
    }
    if (url.includes('/merchant-points') && !url.includes('/stats')) {
      apiResponses.list = await response.json().catch(() => null)
    }
  })
  
  // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
  await page.waitForLoadState('networkidle')
  await page.waitForTimeout(2000)  // ç­‰å¾…æ‰€æœ‰APIå®Œæˆ
  
  // âœ… ä¸€è‡´æ€§æ–­è¨€
  if (apiResponses.stats && apiResponses.list) {
    const stats = apiResponses.stats.data
    const list = apiResponses.list.data
    
    console.log(`ğŸ“Š ç»Ÿè®¡: pending=${stats.pending_count}`)
    console.log(`ğŸ“‹ åˆ—è¡¨: rows=${list.rows?.length}, total=${list.total}`)
    
    // æ ¸å¿ƒä¸€è‡´æ€§æ£€æŸ¥
    if (stats.pending_count > 0) {
      expect(list.rows?.length, 'ç»Ÿè®¡æœ‰æ•°æ®æ—¶åˆ—è¡¨ä¸èƒ½ä¸ºç©º').toBeGreaterThan(0)
    }
    
    if (stats.pending_count === 0) {
      expect(list.total, 'ç»Ÿè®¡ä¸º0æ—¶åˆ—è¡¨æ€»æ•°ä¹Ÿåº”ä¸º0').toBe(0)
    }
  }
})
```

---

## ğŸ”´ è§„åˆ™ E2E-DATA-003ï¼šå‰åç«¯å­—æ®µæ˜ å°„éªŒè¯ï¼ˆå¿…é¡»ï¼‰

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼š
- å‰ç«¯ä»£ç ä½¿ç”¨ `merchantStats.totalMerchants`
- åç«¯APIè¿”å› `pending_count`
- å‰ç«¯æ˜¾ç¤º `undefined` æˆ– `0`

**åŸå› **ï¼šå‰åç«¯å­—æ®µåä¸ä¸€è‡´ï¼Œä½†æµ‹è¯•æ²¡æœ‰éªŒè¯"å‰ç«¯ç»‘å®šçš„å­—æ®µåœ¨APIå“åº”ä¸­å­˜åœ¨"ã€‚

### å¼ºåˆ¶è¦æ±‚

**æµ‹è¯•å¿…é¡»éªŒè¯**ï¼š
1. å‰ç«¯ä½¿ç”¨çš„å­—æ®µååœ¨APIå“åº”ä¸­å­˜åœ¨
2. UIæ˜¾ç¤ºçš„å€¼ä¸APIè¿”å›çš„å€¼ä¸€è‡´
3. å­—æ®µæ˜ å°„å…³ç³»æ­£ç¡®

```javascript
// âœ… å­—æ®µæ˜ å°„éªŒè¯æµ‹è¯•
test('å‰åç«¯å­—æ®µæ˜ å°„æ­£ç¡®æ€§', async ({ page }) => {
  // 1. è·å–APIå“åº”
  const response = await page.waitForResponse('**/stats/pending')
  const apiData = (await response.json()).data
  
  console.log('ğŸ“¡ APIè¿”å›å­—æ®µ:', Object.keys(apiData))
  
  // 2. è·å–UIæ˜¾ç¤ºçš„å€¼
  const uiValues = await page.evaluate(() => {
    // å‡è®¾ç»Ÿè®¡å¡ç‰‡çš„ç»“æ„
    const cards = document.querySelectorAll('.stat-card')
    const values = {}
    cards.forEach(card => {
      const label = card.querySelector('.label')?.textContent
      const value = card.querySelector('.value')?.textContent
      if (label) values[label] = value
    })
    return values
  })
  
  console.log('ğŸ–¥ï¸ UIæ˜¾ç¤ºå€¼:', uiValues)
  
  // 3. éªŒè¯æ˜ å°„å…³ç³»
  // å‰ç«¯ä½¿ç”¨çš„å­—æ®µå¿…é¡»åœ¨APIå“åº”ä¸­å­˜åœ¨
  const expectedMappings = {
    'å¾…å®¡æ ¸': 'pending_count',
    'å·²é€šè¿‡': 'approved_count',
    'å·²æ‹’ç»': 'rejected_count',
    'ä»Šæ—¥ç§¯åˆ†': 'today_points'
  }
  
  Object.entries(expectedMappings).forEach(([uiLabel, apiField]) => {
    // éªŒè¯APIå­—æ®µå­˜åœ¨
    expect(apiData, `APIç¼ºå°‘å­—æ®µ: ${apiField}`).toHaveProperty(apiField)
    
    // éªŒè¯UIå€¼ä¸APIå€¼ä¸€è‡´ï¼ˆå¦‚æœUIæœ‰æ˜¾ç¤ºï¼‰
    if (uiValues[uiLabel]) {
      const apiValue = String(apiData[apiField])
      const uiValue = uiValues[uiLabel].replace(/[,ï¼Œ]/g, '')  // ç§»é™¤åƒåˆ†ä½
      expect(uiValue, `${uiLabel}çš„UIå€¼ä¸APIå€¼ä¸ä¸€è‡´`).toBe(apiValue)
    }
  })
})
```

### å‰ç«¯ç»„ä»¶å­—æ®µæ£€æŸ¥

```javascript
// âœ… æ£€æŸ¥Alpine.jsç»„ä»¶ä½¿ç”¨çš„å­—æ®µæ˜¯å¦åœ¨APIå“åº”ä¸­å­˜åœ¨
test('Alpineç»„ä»¶å­—æ®µä¸APIå“åº”åŒ¹é…', async ({ page }) => {
  // è·å–Alpineç»„ä»¶ä¸­å®šä¹‰çš„å­—æ®µ
  const componentFields = await page.evaluate(() => {
    const el = document.querySelector('[x-data*="merchantStats"]')
    if (!el) return null
    
    const data = window.Alpine.$data(el)
    return data.merchantStats ? Object.keys(data.merchantStats) : null
  })
  
  console.log('ğŸ”§ ç»„ä»¶å®šä¹‰çš„å­—æ®µ:', componentFields)
  
  // è·å–APIå“åº”çš„å­—æ®µ
  const response = await page.waitForResponse('**/stats/pending')
  const apiFields = Object.keys((await response.json()).data)
  
  console.log('ğŸ“¡ APIè¿”å›çš„å­—æ®µ:', apiFields)
  
  // éªŒè¯ç»„ä»¶ä½¿ç”¨çš„å­—æ®µåœ¨APIå“åº”ä¸­å­˜åœ¨
  if (componentFields) {
    componentFields.forEach(field => {
      const found = apiFields.includes(field) || 
                   apiFields.some(af => af.toLowerCase() === field.toLowerCase())
      expect(found, `ç»„ä»¶å­—æ®µ "${field}" åœ¨APIå“åº”ä¸­ä¸å­˜åœ¨ï¼ŒAPIå­—æ®µ: ${apiFields.join(', ')}`).toBe(true)
    })
  }
})
```

### ğŸ”´ æ ¸å¿ƒè¦ç‚¹ï¼šå­—æ®µå­˜åœ¨æ€§æ–­è¨€ï¼ˆå¼ºåˆ¶ï¼‰

**é—®é¢˜å¤ç›˜**ï¼ˆcampaign_id vs lottery_campaign_idï¼‰ï¼š
- åç«¯ API è¿”å›ï¼š`lottery_campaign_id`
- å‰ç«¯ä»£ç ä½¿ç”¨ï¼š`campaign_id`
- æµ‹è¯•ä»£ç ä¹Ÿä½¿ç”¨ï¼š`campaign_id`ï¼ˆå¤åˆ¶äº†å‰ç«¯çš„é”™è¯¯å‡è®¾ï¼‰
- ç»“æœï¼šæµ‹è¯•æ¯”è¾ƒ `undefined === undefined`ï¼Œæµ‹è¯•é€šè¿‡ä½†é¡µé¢æ˜¾ç¤ºå¼‚å¸¸

**å¼ºåˆ¶è¦æ±‚**ï¼šä½¿ç”¨ API è¿”å›æ•°æ®å‰ï¼Œå¿…é¡»å…ˆæ–­è¨€å…³é”®å­—æ®µå­˜åœ¨ä¸”ä¸ä¸º undefinedã€‚

```javascript
// âŒ ç¦æ­¢ï¼šç›´æ¥ä½¿ç”¨å­—æ®µï¼Œä¸æ£€æŸ¥æ˜¯å¦å­˜åœ¨
const firstId = campaigns[0].campaign_id  // å¯èƒ½æ˜¯ undefinedï¼

// âœ… æ­£ç¡®ï¼šå…ˆæ–­è¨€å­—æ®µå­˜åœ¨
expect(campaigns[0].lottery_campaign_id, 'lottery_campaign_id å­—æ®µä¸å­˜åœ¨').toBeDefined()
expect(campaigns[0].lottery_campaign_id, 'lottery_campaign_id ä¸èƒ½ä¸º undefined').not.toBe(undefined)
const apiId = String(campaigns[0].lottery_campaign_id)
```

### ğŸ”´ ç¼–å†™æµ‹è¯•å‰å¿…é¡»æ£€æŸ¥ API å®é™…å“åº”

```javascript
// æµ‹è¯•å‰æ£€æŸ¥è„šæœ¬ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰
if (data.data.campaigns?.length > 0) {
  console.log('ğŸ“Š å•æ¡è®°å½•çš„æ‰€æœ‰å­—æ®µ:', Object.keys(data.data.campaigns[0]))
}
// è¾“å‡ºï¼š['lottery_campaign_id', 'campaign_name', ...] - æ³¨æ„æ˜¯ lottery_campaign_id
```

| æ£€æŸ¥é¡¹ | æ–¹æ³• |
|--------|------|
| API è¿”å›çš„ ID å­—æ®µå | æ‰“å° `Object.keys(item)` |
| å‰ç«¯ HTML ä½¿ç”¨çš„å­—æ®µå | æ£€æŸ¥ `:key="budget.xxx"` |
| å‰ç«¯ JS ä½¿ç”¨çš„å­—æ®µå | æ£€æŸ¥ `filters.xxx` |
| **ä¸‰è€…å¿…é¡»å®Œå…¨ç›¸åŒ** | ä»»ä½•ä¸ä¸€è‡´éƒ½ä¼šå¯¼è‡´ x-for æ¸²æŸ“å¤±è´¥ |

---

## ğŸ”´ è§„åˆ™ E2E-DATA-004ï¼šé˜²æ­¢"å‡é€šè¿‡"æµ‹è¯•

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼šæµ‹è¯•æ˜¾ç¤º"âœ“ passed"ï¼Œä½†å®é™…ä¸Šï¼š
- UIæ˜¾ç¤º"æš‚æ— æ•°æ®"ï¼ˆç©ºåˆ—è¡¨ï¼‰
- ç»Ÿè®¡æ•°å­—æ˜¾ç¤º 0
- åŠŸèƒ½æ ¹æœ¬æ²¡æœ‰å·¥ä½œ

**åŸå› **ï¼šæµ‹è¯•æŠŠ"é¡µé¢æ­£å¸¸åŠ è½½"ç­‰åŒäº"åŠŸèƒ½æ­£å¸¸å·¥ä½œ"

### å¼ºåˆ¶è¦æ±‚

**æµ‹è¯•å¿…é¡»åŒºåˆ†**ï¼š
1. é¡µé¢åŠ è½½æˆåŠŸ â‰  åŠŸèƒ½æ­£å¸¸
2. APIè¿”å›æˆåŠŸ â‰  æ•°æ®æ­£ç¡®
3. å…ƒç´ å­˜åœ¨ â‰  å†…å®¹æ­£ç¡®
4. æ— JSé”™è¯¯ â‰  é€»è¾‘æ­£ç¡®

```javascript
// âŒ "å‡é€šè¿‡"æµ‹è¯• - ç¦æ­¢
test('å•†æˆ·ç§¯åˆ†é¡µé¢æ­£å¸¸', async ({ page }) => {
  await page.goto('/finance-management.html')
  await page.waitForLoadState('networkidle')
  
  // âŒ åªæ£€æŸ¥é¡µé¢åŠ è½½
  await expect(page.locator('table')).toBeVisible()
  // æµ‹è¯•é€šè¿‡ï¼Œä½†è¡¨æ ¼å¯èƒ½æ˜¯ç©ºçš„ï¼
})

// âœ… çœŸæ­£éªŒè¯åŠŸèƒ½
test('å•†æˆ·ç§¯åˆ†åˆ—è¡¨æ˜¾ç¤ºæ­£ç¡®æ•°æ®', async ({ page }) => {
  const response = await page.waitForResponse('**/merchant-points')
  const json = await response.json()
  
  // éªŒè¯APIè¿”å›æ•°æ®
  if (json.data.total > 0) {
    // æœ‰æ•°æ®æ—¶ï¼Œè¡¨æ ¼å¿…é¡»æ˜¾ç¤ºæ•°æ®
    const rowCount = await page.locator('tbody tr').count()
    expect(rowCount, 'æœ‰æ•°æ®ä½†è¡¨æ ¼ä¸ºç©º').toBeGreaterThan(0)
    
    // æ¯è¡Œå¿…é¡»æœ‰å†…å®¹
    const firstRowText = await page.locator('tbody tr:first-child').textContent()
    expect(firstRowText, 'è¡¨æ ¼è¡Œå†…å®¹ä¸ºç©º').not.toBe('')
    
    // å…³é”®å­—æ®µä¸èƒ½æ˜¾ç¤ºundefined
    expect(firstRowText, 'æ˜¾ç¤ºäº†undefined').not.toContain('undefined')
    expect(firstRowText, 'æ˜¾ç¤ºäº†null').not.toContain('null')
  } else {
    // æ— æ•°æ®æ—¶ï¼Œå¿…é¡»æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
    const emptyState = page.locator('text=/æš‚æ— |æ²¡æœ‰.*è®°å½•/')
    await expect(emptyState.first(), 'æ— æ•°æ®æ—¶åº”æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º').toBeVisible()
  }
})
```

### é˜²æ­¢å‡é€šè¿‡æ£€æŸ¥æ¸…å•

| æ£€æŸ¥ç‚¹ | é”™è¯¯åšæ³• | æ­£ç¡®åšæ³• |
|-------|---------|---------|
| è¡¨æ ¼ | åªæ£€æŸ¥`<table>`å­˜åœ¨ | æ£€æŸ¥`<tbody tr>`æ•°é‡ä¸APIä¸€è‡´ |
| ç»Ÿè®¡æ•°å­— | åªæ£€æŸ¥å…ƒç´ å­˜åœ¨ | æ£€æŸ¥æ•°å­— > 0 æˆ–ä¸APIä¸€è‡´ |
| ç©ºçŠ¶æ€ | ä¸æ£€æŸ¥ | æœ‰æ•°æ®æ—¶ä¸åº”å‡ºç°ï¼Œæ— æ•°æ®æ—¶å¿…é¡»å‡ºç° |
| å­—æ®µæ˜¾ç¤º | åªæ£€æŸ¥å…ƒç´ å­˜åœ¨ | æ£€æŸ¥ä¸å«undefined/null |

---

## ğŸ”´ è§„åˆ™ E2E-DATA-005ï¼šæ¨¡æ€æ¡†/å¼¹çª—æ˜¾ç¤ºéªŒè¯ï¼ˆå¿…é¡»ï¼‰

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼šç‚¹å‡»"è¯¦æƒ…"æŒ‰é’®åæ²¡æœ‰ä»»ä½•ååº”ï¼Œä½†æµ‹è¯•é€šè¿‡äº†ã€‚

**åŸå› **ï¼š
- JSä»£ç è°ƒç”¨ `showModal('merchantDetailModal')`
- HTMLä¸­æ¨¡æ€æ¡†åç§°æ˜¯ `merchantPointDetailModal`
- åç§°ä¸åŒ¹é…ï¼Œæ¨¡æ€æ¡†æ— æ³•æ˜¾ç¤ºï¼Œä½†æ²¡æœ‰ä»»ä½•æŠ¥é”™

**æ ¹æœ¬é—®é¢˜**ï¼šæµ‹è¯•åªéªŒè¯äº†"æŒ‰é’®èƒ½ç‚¹å‡»"ï¼Œæ²¡æœ‰éªŒè¯"ç‚¹å‡»åæ¨¡æ€æ¡†æ˜¯å¦çœŸçš„æ˜¾ç¤º"ã€‚

### å¼ºåˆ¶è¦æ±‚

**ç‚¹å‡»è§¦å‘å¼¹çª—çš„æŒ‰é’®åï¼Œå¿…é¡»éªŒè¯**ï¼š
1. æ¨¡æ€æ¡†æ˜¯å¦å¯è§
2. æ¨¡æ€æ¡†å†…å®¹æ˜¯å¦æ­£ç¡®åŠ è½½
3. æ§åˆ¶å°æ˜¯å¦æœ‰å…ƒç´ æ‰¾ä¸åˆ°çš„è­¦å‘Š

```javascript
// âŒ ç¦æ­¢ï¼šåªç‚¹å‡»ä¸éªŒè¯å¼¹çª—
test('ç‚¹å‡»è¯¦æƒ…æŒ‰é’®', async ({ page }) => {
  await page.click('button:has-text("è¯¦æƒ…")')
  // âŒ æµ‹è¯•ç»“æŸï¼Œä½†æ¨¡æ€æ¡†å¯èƒ½æ ¹æœ¬æ²¡æ˜¾ç¤ºï¼
})

// âœ… æ­£ç¡®ï¼šç‚¹å‡»åå¿…é¡»éªŒè¯æ¨¡æ€æ¡†æ˜¾ç¤º
test('ç‚¹å‡»è¯¦æƒ…æŒ‰é’®æ˜¾ç¤ºæ¨¡æ€æ¡†', async ({ page }) => {
  // æ”¶é›†æ§åˆ¶å°è­¦å‘Š
  const consoleMessages = []
  page.on('console', msg => {
    if (msg.type() === 'warning' || msg.type() === 'error') {
      consoleMessages.push(msg.text())
    }
  })
  
  // ç‚¹å‡»è¯¦æƒ…æŒ‰é’®
  await page.click('button:has-text("è¯¦æƒ…")')
  
  // âœ… å…³é”®ï¼šéªŒè¯æ¨¡æ€æ¡†å¯è§
  const modal = page.locator('.modal, [role="dialog"], [x-ref*="Modal"]')
  await expect(modal.first(), 'ç‚¹å‡»è¯¦æƒ…åæ¨¡æ€æ¡†åº”è¯¥æ˜¾ç¤º').toBeVisible({ timeout: 5000 })
  
  // âœ… éªŒè¯æ¨¡æ€æ¡†å†…å®¹åŠ è½½
  const modalContent = await modal.first().textContent()
  expect(modalContent, 'æ¨¡æ€æ¡†åº”è¯¥æœ‰å†…å®¹').not.toBe('')
  expect(modalContent, 'æ¨¡æ€æ¡†ä¸åº”æ˜¾ç¤ºundefined').not.toContain('undefined')
  
  // âœ… æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰è­¦å‘Š
  const elementNotFound = consoleMessages.some(msg => 
    msg.includes('æ‰¾ä¸åˆ°') || msg.includes('not found') || msg.includes('undefined')
  )
  expect(elementNotFound, 'ä¸åº”æœ‰å…ƒç´ æ‰¾ä¸åˆ°çš„è­¦å‘Š').toBe(false)
})
```

### æ¨¡æ€æ¡†æµ‹è¯•æ£€æŸ¥æ¸…å•

| æ£€æŸ¥ç‚¹ | å¿…é¡»éªŒè¯ |
|-------|---------|
| ç‚¹å‡»æŒ‰é’®å | æ¨¡æ€æ¡†æ˜¯å¦å¯è§ |
| æ¨¡æ€æ¡†å†…å®¹ | æ˜¯å¦æœ‰å†…å®¹ã€ä¸å«undefined |
| APIæ•°æ® | æ˜¯å¦æ­£ç¡®åŠ è½½åˆ°æ¨¡æ€æ¡†ä¸­ |
| å…³é—­æŒ‰é’® | ç‚¹å‡»åæ¨¡æ€æ¡†æ˜¯å¦éšè— |
| æ§åˆ¶å° | æ˜¯å¦æœ‰å…ƒç´ æ‰¾ä¸åˆ°çš„è­¦å‘Š |

### Alpine.js æ¨¡æ€æ¡†ç‰¹æ®ŠéªŒè¯

```javascript
// âœ… Alpine.js æ¨¡æ€æ¡†éªŒè¯ï¼ˆæ£€æŸ¥ x-ref å’Œ x-showï¼‰
test('Alpine.js æ¨¡æ€æ¡†æ­£ç¡®æ˜¾ç¤º', async ({ page }) => {
  // ç‚¹å‡»è§¦å‘æŒ‰é’®
  await page.click('button:has-text("è¯¦æƒ…")')
  await page.waitForTimeout(500)  // ç­‰å¾… Alpine çŠ¶æ€æ›´æ–°
  
  // æ–¹æ³•1ï¼šé€šè¿‡ x-ref å®šä½
  const modalByRef = page.locator('[x-ref="merchantPointDetailModal"]')
  
  // æ–¹æ³•2ï¼šé€šè¿‡å¯è§æ€§å®šä½ï¼ˆx-show ä¼šæ§åˆ¶ displayï¼‰
  const visibleModal = page.locator('.modal:visible, [role="dialog"]:visible')
  
  // éªŒè¯è‡³å°‘ä¸€ç§æ–¹å¼èƒ½æ‰¾åˆ°å¯è§çš„æ¨¡æ€æ¡†
  const isModalVisible = await modalByRef.isVisible().catch(() => false) ||
                        await visibleModal.count() > 0
  
  expect(isModalVisible, 'æ¨¡æ€æ¡†åº”è¯¥å¯è§ï¼ˆæ£€æŸ¥ JS ä¸­çš„ showModal åç§°æ˜¯å¦ä¸ HTML x-ref åŒ¹é…ï¼‰').toBe(true)
  
  // å¦‚æœå¤±è´¥ï¼Œè¾“å‡ºè°ƒè¯•ä¿¡æ¯
  if (!isModalVisible) {
    const allModals = await page.locator('[x-ref*="Modal"]').all()
    console.log('é¡µé¢ä¸­çš„æ¨¡æ€æ¡† x-ref:', await Promise.all(
      allModals.map(async m => await m.getAttribute('x-ref'))
    ))
  }
})
```

### å¸¸è§æ¨¡æ€æ¡†åç§°ä¸åŒ¹é…é—®é¢˜

| JSè°ƒç”¨ | HTMLå®šä¹‰ | é—®é¢˜ |
|--------|----------|------|
| `showModal('merchantDetailModal')` | `x-ref="merchantPointDetailModal"` | å°‘äº† `Point` |
| `showModal('userModal')` | `x-ref="userDetailModal"` | å°‘äº† `Detail` |
| `hideModal('editModal')` | `x-ref="itemEditModal"` | å°‘äº†å‰ç¼€ |

**é¢„é˜²æªæ–½**ï¼š
1. æ¨¡æ€æ¡†å‘½åç»Ÿä¸€ä½¿ç”¨ `{åŠŸèƒ½}DetailModal` æ ¼å¼
2. JS å’Œ HTML åŒæ—¶ä¿®æ”¹æ—¶ï¼Œæœç´¢ç¡®è®¤åç§°ä¸€è‡´
3. æµ‹è¯•å¿…é¡»éªŒè¯å¼¹çª—æ˜¾ç¤ºï¼Œè€Œä¸åªæ˜¯æŒ‰é’®ç‚¹å‡»

---

## ğŸ“‹ å®Œæ•´æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### æ ‡å‡†å®¡æ ¸æ“ä½œæµ‹è¯•æ¨¡æ¿

```javascript
import { test, expect } from '@playwright/test'

// æµ‹è¯•é…ç½®
const BASE_URL = 'https://omqktqrtntnn.sealosbja.site/admin/'
const TEST_PHONE = '13612227930'
const TEST_CODE = '123456'

test.describe('æ¶ˆè´¹è®°å½•å®¡æ ¸ - å®Œæ•´éªŒè¯', () => {
  // JS é”™è¯¯æ”¶é›†
  let jsErrors = []
  
  test.beforeEach(async ({ page }) => {
    jsErrors = []
    
    // ç›‘å¬ JS é”™è¯¯
    page.on('console', msg => {
      if (msg.type() === 'error') jsErrors.push(msg.text())
    })
    page.on('pageerror', error => jsErrors.push(error.message))
    
    // ç™»å½•
    await page.goto(BASE_URL + 'login.html')
    await page.fill('input[type="tel"]', TEST_PHONE)
    await page.fill('input[x-model="code"]', TEST_CODE)
    await page.click('button[type="submit"]')
    await expect(page).toHaveURL(/workspace/, { timeout: 15000 })
    
    // å¯¼èˆªåˆ°ç›®æ ‡é¡µé¢
    await page.goto(BASE_URL + 'finance-management.html')
    await page.waitForLoadState('networkidle')
  })

  test.afterEach(async ({ page }) => {
    // è‡ªåŠ¨æŠ¥å‘Š JS é”™è¯¯
    expect(jsErrors, `å‘ç° ${jsErrors.length} ä¸ª JS é”™è¯¯: ${jsErrors.join(', ')}`).toHaveLength(0)
  })

  test('å®¡æ ¸é€šè¿‡ - å®Œæ•´ç”¨æˆ·æµç¨‹', async ({ page }) => {
    // 1. ç­‰å¾…æ•°æ®åŠ è½½
    await expect(page.locator('tbody tr').first()).toBeVisible({ timeout: 10000 })
    
    // 2. è®°å½•åˆå§‹çŠ¶æ€
    const initialCount = await page.locator('tbody tr').count()
    const initialStatus = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
    
    // å¦‚æœæ²¡æœ‰å¾…å®¡æ ¸è®°å½•ï¼Œè·³è¿‡æµ‹è¯•
    if (!initialStatus?.includes('å¾…å®¡æ ¸')) {
      test.skip()
      return
    }
    
    // 3. è®¾ç½® API ç›‘å¬
    const responsePromise = page.waitForResponse(resp => 
      resp.url().includes('/consumption/approve') && resp.status() === 200
    )
    
    // 4. å¤„ç†ç¡®è®¤å¯¹è¯æ¡†
    page.once('dialog', dialog => {
      expect(dialog.message()).toContain('ç¡®å®š')
      dialog.accept()
    })
    
    // 5. ç‚¹å‡»é€šè¿‡æŒ‰é’®
    await page.click('tbody tr:first-child button:has-text("é€šè¿‡")')
    
    // 6. ç­‰å¾… API å“åº”
    const response = await responsePromise
    const json = await response.json()
    expect(json.success, 'API åº”è¯¥è¿”å›æˆåŠŸ').toBe(true)
    
    // 7. éªŒè¯ UI æ›´æ–°
    await page.waitForTimeout(1500)
    const newStatus = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
    expect(newStatus, 'UI çŠ¶æ€åº”è¯¥æ›´æ–°').toContain('å·²é€šè¿‡')
  })
})
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•ï¼ˆæ¯æ¬¡ç¼–å†™æµ‹è¯•å¿…é¡»æ ¸å¯¹ï¼‰

### æµ‹è¯•å‰å‡†å¤‡
- [ ] åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ
- [ ] æ˜¯å¦é˜…è¯»äº†å‰ç«¯ä»£ç äº†è§£å…ƒç´ å®šä½å™¨ï¼Ÿ
- [ ] æ˜¯å¦æ£€æŸ¥äº†ç°æœ‰æµ‹è¯•æ–‡ä»¶é¿å…é‡å¤ï¼Ÿ

### æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¿…é¡»åŒ…å«
- [ ] è‡³å°‘ä¸€ä¸ª `expect()` æ–­è¨€ï¼ˆç¦æ­¢åªç”¨ console.logï¼‰
- [ ] ç›‘å¬ JS é”™è¯¯å¹¶æ–­è¨€æ— é”™è¯¯
- [ ] ç­‰å¾… API å“åº”åå†æ–­è¨€ UI
- [ ] éªŒè¯ä¸šåŠ¡ç»“æœï¼ˆä¸åªæ˜¯å…ƒç´ å­˜åœ¨ï¼‰

### äº¤äº’æ“ä½œéªŒè¯
- [ ] æŒ‰é’®çœŸæ­£è¢«ç‚¹å‡»ï¼ˆä¸åªæ˜¯æ£€æŸ¥å­˜åœ¨ï¼‰
- [ ] API è¯·æ±‚è¢«å‘é€å¹¶éªŒè¯å‚æ•°
- [ ] API å“åº”è¢«éªŒè¯ï¼ˆçŠ¶æ€ç  + è¿”å›æ•°æ®ï¼‰
- [ ] UI çŠ¶æ€æ­£ç¡®æ›´æ–°

### ç”¨æˆ·è¡Œä¸ºéªŒè¯
- [ ] æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œæµç¨‹
- [ ] æµ‹è¯•çŠ¶æ€æ¢å¤ï¼ˆé‡ç½®/å–æ¶ˆ/æ’¤é”€ï¼‰
- [ ] æµ‹è¯•è¾¹ç•Œæ¡ä»¶ï¼ˆç©ºå€¼/æç«¯å€¼ï¼‰
- [ ] æµ‹è¯•é˜²å‘†æœºåˆ¶ï¼ˆç¡®è®¤å¯¹è¯æ¡†/é”™è¯¯æç¤ºï¼‰

### ğŸ”´ å­—æ®µæ˜ å°„ä¸æ•°æ®ä¸€è‡´æ€§éªŒè¯ï¼ˆæ–°å¢ï¼‰
- [ ] APIå“åº”å…³é”®å­—æ®µå­˜åœ¨ä¸”æœ‰å€¼ï¼ˆnot undefined/nullï¼‰
- [ ] å¤šä¸ªç›¸å…³APIæ•°æ®äº¤å‰éªŒè¯ï¼ˆç»Ÿè®¡æ•° = åˆ—è¡¨æ€»æ•°ï¼‰
- [ ] å‰ç«¯ç»‘å®šçš„å­—æ®µååœ¨APIå“åº”ä¸­å­˜åœ¨
- [ ] UIæ˜¾ç¤ºå€¼ä¸APIè¿”å›å€¼ä¸€è‡´
- [ ] ä¸æ˜¾ç¤ºundefined/null/ç©ºå€¼

### ğŸ”´ æ¨¡æ€æ¡†/å¼¹çª—éªŒè¯ï¼ˆæ–°å¢ï¼‰
- [ ] ç‚¹å‡»æŒ‰é’®åæ¨¡æ€æ¡†æ˜¯å¦å¯è§ï¼Ÿ
- [ ] æ¨¡æ€æ¡†å†…å®¹æ˜¯å¦æ­£ç¡®åŠ è½½ï¼ˆä¸ä¸ºç©ºã€ä¸å«undefinedï¼‰ï¼Ÿ
- [ ] JSä¸­showModalåç§°ä¸HTMLä¸­x-refåç§°æ˜¯å¦ä¸€è‡´ï¼Ÿ
- [ ] å…³é—­æŒ‰é’®æ˜¯å¦èƒ½æ­£å¸¸å…³é—­æ¨¡æ€æ¡†ï¼Ÿ
- [ ] æ§åˆ¶å°æ˜¯å¦æœ‰å…ƒç´ æ‰¾ä¸åˆ°çš„è­¦å‘Šï¼Ÿ

### æ•°æ®ä¸€è‡´æ€§éªŒè¯
- [ ] æ“ä½œå UI å’Œæ•°æ®åŒæ­¥
- [ ] åˆ·æ–°é¡µé¢åæ•°æ®æŒä¹…åŒ–
- [ ] åˆ†é¡µåŠŸèƒ½å…è®¸æŸ¥çœ‹å…¨éƒ¨æ•°æ®
- [ ] ç»Ÿè®¡æ•°æ®ä¸åˆ—è¡¨æ•°æ®åŒ¹é…

---

## ğŸš« ç¦æ­¢çš„æµ‹è¯•æ¨¡å¼

| ç¦æ­¢æ¨¡å¼ | æ­£ç¡®æ›¿ä»£ |
|---------|---------|
| `console.log('è­¦å‘Š')` + æµ‹è¯•é€šè¿‡ | `expect().toBe()` æ–­è¨€å¤±è´¥ |
| åªæ£€æŸ¥å…ƒç´ å­˜åœ¨ | ç‚¹å‡»å…ƒç´ å¹¶éªŒè¯æ•ˆæœ |
| ä¸ç­‰å¾… API å“åº” | `waitForResponse()` åæ–­è¨€ |
| å¿½ç•¥ JS é”™è¯¯ | `page.on('pageerror')` æ•è· |
| ç¡¬ç¼–ç ç­‰å¾… `waitForTimeout(5000)` | `waitForResponse/waitForSelector` |
| æµ‹è¯•æŠ€æœ¯å®ç° | æµ‹è¯•ä¸šåŠ¡ç»“æœ |

---

**æ ¸å¿ƒåŸåˆ™**ï¼š

1. **E2E æµ‹è¯•çš„ä»·å€¼åœ¨äºæ–­è¨€éªŒè¯**ï¼Œä¸åœ¨äº"è·‘äº†ä¸€é"ã€‚æ²¡æœ‰æ–­è¨€çš„æµ‹è¯•ç­‰äºæ²¡æœ‰æµ‹è¯•ã€‚
2. **æµ‹è¯•åº”è¯¥æ¨¡æ‹ŸçœŸå®ç”¨æˆ·**ï¼Œè€Œä¸æ˜¯æœºæ¢°éªŒè¯æŠ€æœ¯å®ç°ã€‚
3. **æ¯ä¸ªæ“ä½œéƒ½è¦æµ‹è¯•"æ’¤é”€/æ¢å¤"**ï¼Œç”¨æˆ·æ€»æ˜¯éœ€è¦"å›åˆ°æœ€åˆ"çš„èƒ½åŠ›ã€‚
4. **åˆ†é¡µæ˜¯éšè—çš„é™·é˜±**ï¼Œå¿…é¡»éªŒè¯ç”¨æˆ·èƒ½çœ‹åˆ°å®Œæ•´æ•°æ®æˆ–çŸ¥é“å¦‚ä½•æŸ¥çœ‹æ›´å¤šã€‚
5. **å…ˆé—®"ç”¨æˆ·æƒ³åšä»€ä¹ˆ"**ï¼Œå†è®¾è®¡æµ‹è¯•ç”¨ä¾‹ã€‚
6. **ç”¨ expect() è‡ªåŠ¨æŠ¥å‘Šé”™è¯¯**ï¼Œä¸è¦è®©äººå·¥æŸ¥çœ‹æ—¥å¿—ã€‚
7. **æµ‹è¯•å‰å¿…é¡»æ£€æŸ¥åç«¯æœåŠ¡**ï¼Œå¹¶é˜…è¯»å‰ç«¯ä»£ç ã€‚
8. **å¤ç”¨ç°æœ‰æµ‹è¯•**ï¼Œå‡å°‘æŠ€æœ¯å€ºåŠ¡ã€‚
9. **ğŸ”´ APIå­—æ®µå®Œæ•´æ€§æ˜¯åŸºç¡€**ï¼Œå…³é”®å­—æ®µä¸èƒ½æ˜¯undefined/nullï¼Œå¦åˆ™æµ‹è¯•å¿…é¡»å¤±è´¥ã€‚
10. **ğŸ”´ å¤šAPIå¿…é¡»äº¤å‰éªŒè¯**ï¼Œç»Ÿè®¡æ•°ä¸åˆ—è¡¨æ•°ä¸ä¸€è‡´æ—¶ï¼Œæµ‹è¯•å¿…é¡»å¤±è´¥ã€‚
11. **ğŸ”´ å‰åç«¯å­—æ®µæ˜ å°„å¿…é¡»éªŒè¯**ï¼Œå‰ç«¯ä½¿ç”¨çš„å­—æ®µåå¿…é¡»åœ¨APIå“åº”ä¸­å­˜åœ¨ã€‚
12. **ğŸ”´ é˜²æ­¢"å‡é€šè¿‡"**ï¼Œé¡µé¢åŠ è½½æˆåŠŸâ‰ åŠŸèƒ½æ­£å¸¸ï¼ŒAPIæˆåŠŸâ‰ æ•°æ®æ­£ç¡®ã€‚
13. **ğŸ”´ æ¨¡æ€æ¡†å¿…é¡»éªŒè¯æ˜¾ç¤º**ï¼Œç‚¹å‡»æŒ‰é’®åå¿…é¡»æ–­è¨€æ¨¡æ€æ¡†å¯è§ï¼ŒJSè°ƒç”¨åä¸HTMLå®šä¹‰åå¿…é¡»ä¸€è‡´ã€‚
14. **ğŸ”´ æ•°æ®å¯å‘ç°æ€§æµ‹è¯•**ï¼Œæ‰€æœ‰éœ€è¦ç”¨æˆ·è¾“å…¥ID/ç¼–ç çš„å­—æ®µï¼Œå¿…é¡»éªŒè¯ç”¨æˆ·æ˜¯å¦èƒ½ä»ç³»ç»Ÿä¸­è·å–è¯¥å€¼ã€‚
15. **ğŸ”´ ä¸šåŠ¡å¯ç”¨æ€§æµ‹è¯•**ï¼Œä¸åªæµ‹è¯•æŠ€æœ¯å¯è¡Œæ€§ï¼Œè¿˜è¦æµ‹è¯•"è¿è¥äººå‘˜èƒ½å¦å®Œæˆå·¥ä½œ"ã€‚

---

## ğŸ”´ ä¸šåŠ¡å¯ç”¨æ€§æµ‹è¯•è§„èŒƒï¼ˆé‡è¦ - é˜²æ­¢é—æ¼UXé—®é¢˜ï¼‰

### æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”

| é—®é¢˜å±‚é¢ | ä¼ ç»ŸæŠ€æœ¯æµ‹è¯• | ä¸šåŠ¡å¯ç”¨æ€§æµ‹è¯• |
|---------|------------|--------------|
| **æµ‹è¯•è§†è§’** | å¼€å‘è€…è§†è§’ | è¿è¥äººå‘˜è§†è§’ |
| **å…³æ³¨ç‚¹** | å…ƒç´ å­˜åœ¨ã€APIè°ƒç”¨æ­£ç¡® | ç”¨æˆ·èƒ½å¦å®Œæˆå·¥ä½œ |
| **IDè¾“å…¥æ¡†** | âœ… èƒ½è¾“å…¥ã€èƒ½æœç´¢ | âŒ è¿è¥ä¸çŸ¥é“è¾“å…¥ä»€ä¹ˆ |
| **æœ¬è´¨å·®å¼‚** | éªŒè¯"æŠ€æœ¯å¯è¡Œæ€§" | éªŒè¯"ä¸šåŠ¡å¯ç”¨æ€§" |

### é—®é¢˜èƒŒæ™¯

**æ¡ˆä¾‹**ï¼šå€ºåŠ¡ç®¡ç†é¡µé¢çš„"æ´»åŠ¨ID"è¾“å…¥æ¡†
- âŒ æŠ€æœ¯æµ‹è¯•ç»“æœï¼šè¾“å…¥æ¡†å­˜åœ¨ âœ…ï¼Œè¾“å…¥å€¼èƒ½æœç´¢ âœ…ï¼ŒAPIæ­£å¸¸è°ƒç”¨ âœ…
- âŒ å®é™…é—®é¢˜ï¼šè¿è¥äººå‘˜ä¸çŸ¥é“æ´»åŠ¨IDæ˜¯ä»€ä¹ˆï¼Œæ— æ³•å®Œæˆå·¥ä½œ
- âŒ æµ‹è¯•ç›²åŒºï¼šæµ‹è¯•åªéªŒè¯äº†"èƒ½è¾“å…¥"ï¼Œæ²¡éªŒè¯"èƒ½çŸ¥é“è¾“å…¥ä»€ä¹ˆ"

### æ•°æ®å¯å‘ç°æ€§æµ‹è¯•è§„åˆ™

**æ ¸å¿ƒé—®é¢˜**ï¼šç”¨æˆ·èƒ½å¦ä»ç³»ç»Ÿä¸­è·å–éœ€è¦è¾“å…¥çš„å€¼ï¼Ÿ

| å­—æ®µç±»å‹ | é”™è¯¯åšæ³• | æ­£ç¡®åšæ³• |
|---------|---------|---------|
| IDå­—æ®µï¼ˆæ´»åŠ¨IDã€ç”¨æˆ·IDç­‰ï¼‰ | è®©ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ | æä¾›ä¸‹æ‹‰æ¡†/æœç´¢æ¡† |
| ç¼–ç å­—æ®µï¼ˆæ´»åŠ¨ç ã€å•†å“ç ç­‰ï¼‰ | è®©ç”¨æˆ·è®°ä½ç¼–ç  | æä¾›é€‰æ‹©åˆ—è¡¨æˆ–æ¨¡ç³Šæœç´¢ |
| å…³è”å­—æ®µï¼ˆå•†æˆ·ã€é—¨åº—ç­‰ï¼‰ | åªæ˜¾ç¤ºID | æ˜¾ç¤ºåç§°ï¼Œå€¼ä¼ ID |

### å¼ºåˆ¶æµ‹è¯•æ¸…å• - ç­›é€‰/æœç´¢è¡¨å•

æ¯ä¸ªåŒ…å«ç­›é€‰æ¡ä»¶çš„é¡µé¢ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

```javascript
test.describe('ç­›é€‰è¡¨å• - æ•°æ®å¯å‘ç°æ€§æµ‹è¯•', () => {
  
  /**
   * ğŸ”´ è§„åˆ™1ï¼šIDç±»å­—æ®µå¿…é¡»æœ‰æ•°æ®æ¥æº
   * æ£€æµ‹æ–¹æ³•ï¼šæŸ¥æ‰¾æ‰€æœ‰åŒ…å«"ID"ã€"ç¼–ç "ã€"code"çš„è¾“å…¥æ¡†
   * éªŒè¯æ ‡å‡†ï¼šå¿…é¡»æ˜¯ä¸‹æ‹‰æ¡†/æœç´¢æ¡†ï¼Œæˆ–æœ‰å…³è”çš„æ•°æ®é€‰æ‹©å™¨
   */
  test('IDç±»ç­›é€‰å­—æ®µå¿…é¡»æä¾›é€‰æ‹©æ–¹å¼', async ({ page }) => {
    // æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„IDè¾“å…¥æ¡†
    const idInputs = page.locator('input[placeholder*="ID"], input[placeholder*="ç¼–ç "], input[placeholder*="code"]')
    const idInputCount = await idInputs.count()
    
    // ğŸ”´ æ–­è¨€ï¼šIDå­—æ®µä¸åº”è¯¥æ˜¯çº¯æ–‡æœ¬è¾“å…¥æ¡†
    // å¦‚æœå­˜åœ¨ï¼Œåº”è¯¥æ”¹ä¸º select ä¸‹æ‹‰æ¡†æˆ–å¸¦æœç´¢çš„é€‰æ‹©å™¨
    for (let i = 0; i < idInputCount; i++) {
      const placeholder = await idInputs.nth(i).getAttribute('placeholder')
      console.error(`âš ï¸ UXé—®é¢˜: å‘ç°IDç±»è¾“å…¥æ¡† "${placeholder}"ï¼Œå»ºè®®æ”¹ä¸ºä¸‹æ‹‰é€‰æ‹©æ¡†`)
    }
    
    // å¯é€‰ï¼šå¼ºåˆ¶å¤±è´¥ï¼ˆå–æ¶ˆæ³¨é‡Šå¯ç”¨ï¼‰
    // expect(idInputCount, 'IDå­—æ®µåº”è¯¥ç”¨ä¸‹æ‹‰æ¡†è€Œéè¾“å…¥æ¡†').toBe(0)
  })

  /**
   * ğŸ”´ è§„åˆ™2ï¼šä¸‹æ‹‰æ¡†å¿…é¡»æœ‰å¯é€‰é¡¹
   * éªŒè¯æ ‡å‡†ï¼šselectå…ƒç´ å¿…é¡»æœ‰é™¤"å…¨éƒ¨/è¯·é€‰æ‹©"å¤–çš„å®é™…é€‰é¡¹
   */
  test('ä¸‹æ‹‰æ¡†å¿…é¡»åŠ è½½å®é™…é€‰é¡¹æ•°æ®', async ({ page }) => {
    await page.waitForTimeout(3000) // ç­‰å¾…å¼‚æ­¥æ•°æ®åŠ è½½
    
    const selects = page.locator('select')
    const selectCount = await selects.count()
    
    for (let i = 0; i < selectCount; i++) {
      const select = selects.nth(i)
      const options = await select.locator('option').allTextContents()
      
      // è¿‡æ»¤å ä½é€‰é¡¹
      const actualOptions = options.filter(opt => 
        !opt.includes('å…¨éƒ¨') && !opt.includes('è¯·é€‰æ‹©') && opt.trim() !== ''
      )
      
      const selectModel = await select.getAttribute('x-model') || 'æœªçŸ¥'
      
      if (actualOptions.length === 0) {
        console.warn(`âš ï¸ ä¸‹æ‹‰æ¡† [${selectModel}] æ²¡æœ‰å¯é€‰é¡¹ï¼Œè¿è¥æ— æ³•ä½¿ç”¨`)
      }
    }
  })

  /**
   * ğŸ”´ è§„åˆ™3ï¼šè¿è¥å®Œæ•´å·¥ä½œæµæµ‹è¯•
   */
  test('è¿è¥äººå‘˜èƒ½å¦ä»…é€šè¿‡ç•Œé¢å®Œæˆç­›é€‰æ“ä½œ', async ({ page }) => {
    // æ£€æŸ¥ç­›é€‰åŒºåŸŸ
    const filterSection = page.locator('.p-4.border-b, [class*="filter"]')
    await expect(filterSection.first()).toBeVisible()
    
    // éªŒè¯ä¸‹æ‹‰æ¡†å¯é€‰æ‹©ï¼ˆä¸éœ€è¦å¤–éƒ¨ä¿¡æ¯ï¼‰
    const selects = filterSection.locator('select')
    const selectCount = await selects.count()
    
    for (let i = 0; i < selectCount; i++) {
      const options = await selects.nth(i).locator('option').count()
      expect(options, 'ä¸‹æ‹‰æ¡†å¿…é¡»æœ‰é€‰é¡¹').toBeGreaterThan(1)
    }
    
    // æ£€æµ‹IDè¾“å…¥æ¡†ï¼ˆUXé—®é¢˜ï¼‰
    const idInputs = filterSection.locator('input[placeholder*="ID"]')
    if (await idInputs.count() > 0) {
      console.warn('âš ï¸ å­˜åœ¨IDè¾“å…¥æ¡†ï¼Œè¿è¥éœ€è¦çŸ¥é“IDæ‰èƒ½ä½¿ç”¨ï¼Œå»ºè®®æ”¹ä¸ºä¸‹æ‹‰æ¡†')
    }
  })
})
```

### UXé—®é¢˜æ£€æµ‹è§„åˆ™

| æ£€æµ‹é¡¹ | æ£€æµ‹æ–¹æ³• | æœŸæœ›ç»“æœ |
|-------|---------|---------|
| IDè¾“å…¥æ¡† | `input[placeholder*="ID"]` | åº”è¯¥æ˜¯ `select` æˆ–å¸¦æœç´¢çš„é€‰æ‹©å™¨ |
| ç¼–ç è¾“å…¥æ¡† | `input[placeholder*="ç¼–ç "]` | åº”è¯¥æœ‰è‡ªåŠ¨å®Œæˆæˆ–é€‰æ‹©åˆ—è¡¨ |
| å…³è”å­—æ®µ | æ˜¾ç¤ºçš„æ˜¯IDä½†åº”è¯¥æ˜¾ç¤ºåç§° | æ˜¾ç¤ºåç§°ï¼Œä¼ å€¼ID |
| ç©ºä¸‹æ‹‰æ¡† | `select` åªæœ‰å ä½é€‰é¡¹ | å¿…é¡»æœ‰å®é™…å¯é€‰æ•°æ® |
| æ— æç¤ºçš„è¾“å…¥æ¡† | `input` æ²¡æœ‰ placeholder | å¿…é¡»æœ‰æ“ä½œæç¤º |

### æµ‹è¯•æ£€æŸ¥æ¸…å•è¡¥å……

**æ¯ä¸ªç­›é€‰/è¡¨å•é¡µé¢å¿…é¡»é¢å¤–éªŒè¯**ï¼š

- [ ] **æ•°æ®æ¥æºå¯å‘ç°æ€§**ï¼šç”¨æˆ·éœ€è¦è¾“å…¥çš„å€¼ï¼Œèƒ½å¦ä»ç³»ç»Ÿä¸­è·å–ï¼Ÿ
- [ ] **IDå­—æ®µå¤„ç†**ï¼šæ‰€æœ‰IDå­—æ®µæ˜¯å¦æœ‰ä¸‹æ‹‰æ¡†æˆ–æœç´¢é€‰æ‹©å™¨ï¼Ÿ
- [ ] **ä¸‹æ‹‰æ¡†æœ‰æ•ˆæ€§**ï¼šä¸‹æ‹‰æ¡†æ˜¯å¦åŠ è½½äº†å®é™…æ•°æ®ï¼ˆä¸åªæ˜¯"å…¨éƒ¨"é€‰é¡¹ï¼‰ï¼Ÿ
- [ ] **è¿è¥å®Œæ•´æµç¨‹**ï¼šè¿è¥èƒ½å¦ä¸å€ŸåŠ©å¤–éƒ¨ä¿¡æ¯å®Œæˆç­›é€‰æ“ä½œï¼Ÿ
- [ ] **å…³è”æ•°æ®æ˜¾ç¤º**ï¼šIDå­—æ®µæ˜¯å¦åŒæ—¶æ˜¾ç¤ºåç§°ä¾¿äºè¯†åˆ«ï¼Ÿ

### å¸¸è§æµ‹è¯•ç›²åŒºåŠé¢„é˜²

| ç›²åŒº | æŠ€æœ¯æµ‹è¯•ç»“æœ | å®é™…é—®é¢˜ | é¢„é˜²æªæ–½ |
|-----|------------|---------|---------|
| IDè¾“å…¥æ¡† | è¾“å…¥å€¼èƒ½æœç´¢ âœ… | è¿è¥ä¸çŸ¥é“ID | éªŒè¯æ˜¯å¦æœ‰é€‰æ‹©å™¨ |
| ç©ºä¸‹æ‹‰æ¡† | å…ƒç´ å­˜åœ¨ âœ… | æ²¡æœ‰å¯é€‰é¡¹ | éªŒè¯optionæ•°é‡ |
| å…³è”æ˜¾ç¤º | æ•°æ®æ­£ç¡® âœ… | åªæ˜¾ç¤ºIDä¸æ˜¾ç¤ºåç§° | éªŒè¯æ˜¾ç¤ºå†…å®¹ |
| åˆ†é¡µæ•°æ® | ç¬¬ä¸€é¡µæ­£å¸¸ âœ… | åé¢çš„é¡µçœ‹ä¸åˆ° | éªŒè¯åˆ†é¡µåŠŸèƒ½ |
| ç­›é€‰é‡ç½® | å­—æ®µæ¸…ç©º âœ… | æ•°æ®æ²¡åˆ·æ–° | éªŒè¯æ•°æ®é‡æ–°åŠ è½½ |

### ğŸ”´ å¼ºåˆ¶æ‰§è¡Œè§„åˆ™

1. **å‘ç°IDè¾“å…¥æ¡†å¿…é¡»æŠ¥å‘Š**ï¼šæµ‹è¯•ä¸­å‘ç° `input[placeholder*="ID"]` å¿…é¡»è®°å½•ä¸ºå¾…ä¼˜åŒ–é¡¹
2. **ä¸‹æ‹‰æ¡†å¿…é¡»æœ‰æ•°æ®**ï¼šç©ºçš„ selectï¼ˆåªæœ‰å ä½é€‰é¡¹ï¼‰å¿…é¡»æŠ¥å‘Šä¸ºé—®é¢˜
3. **è¿è¥è§†è§’æµ‹è¯•**ï¼šæ¯ä¸ªç­›é€‰é¡µé¢å¿…é¡»åŒ…å«"è¿è¥èƒ½å¦å®Œæˆå·¥ä½œ"çš„æµ‹è¯•ç”¨ä¾‹
4. **UXé—®é¢˜ä¸å¿½ç•¥**ï¼šæŠ€æœ¯ä¸Šå¯è¡Œä½†è¿è¥æ— æ³•ä½¿ç”¨çš„åŠŸèƒ½ï¼Œæµ‹è¯•åº”è¯¥æ ‡è®°è­¦å‘Š

---

## ğŸš¨ å‰ç«¯ Bug æ£€æµ‹å¼ºåŒ–è§„åˆ™ï¼ˆ2026-02-03 æ›´æ–°ï¼‰

### é—®é¢˜èƒŒæ™¯

ä»¥ä¸‹æ˜¯ä¸€ä¸ªçœŸå®æ¡ˆä¾‹ï¼šPlaywright æµ‹è¯•é€šè¿‡ï¼Œä½†å®é™…å­˜åœ¨ä¸¥é‡çš„å‰ç«¯ Bugï¼š

```javascript
// âŒ HTML æ¨¡æ¿ä½¿ç”¨ sessionsï¼Œä½† JS å®šä¹‰çš„æ˜¯ allSessions
// HTML: <template x-for="session in sessions">
// JS:   allSessions: []  â† å˜é‡åä¸åŒ¹é…ï¼

// ç»“æœï¼šAlpine.js æŠ¥é”™ "sessions is not defined"ï¼Œé¡µé¢ä¸æ¸²æŸ“
```

**æµ‹è¯•ä¸ºä»€ä¹ˆæ²¡å‘ç°ï¼Ÿ**
1. æµ‹è¯•é¢„å…ˆ"åŸè°…"äº† JS é”™è¯¯
2. æµ‹è¯•åªéªŒè¯ API è¿”å›æ•°æ®ï¼Œæ²¡éªŒè¯é¡µé¢æ˜¯å¦çœŸæ­£æ¸²æŸ“
3. æµ‹è¯•ä½¿ç”¨è¿‡å¤š "å¦‚æœå­˜åœ¨åˆ™æµ‹è¯•" çš„å®½å®¹é€»è¾‘

### ğŸ”´ è§„åˆ™1ï¼šJavaScript é”™è¯¯é›¶å®¹å¿åŸåˆ™

**ç¦æ­¢åœ¨æµ‹è¯•ä¸­é¢„å…ˆå¿½ç•¥ä»»ä½• JS é”™è¯¯**

```javascript
// âŒ é”™è¯¯åšæ³•ï¼šé¢„å…ˆ"åŸè°…"æŸäº›é”™è¯¯
page.on('pageerror', error => {
  if (error.message.includes('sessions is not defined')) {
    console.warn('å·²çŸ¥ Bugï¼Œå¿½ç•¥')  // âŒ ç¦æ­¢ï¼
    return
  }
  jsErrors.push(error.message)
})

// âœ… æ­£ç¡®åšæ³•ï¼šæ‰€æœ‰ JS é”™è¯¯éƒ½å¿…é¡»è®°å½•ï¼Œæµ‹è¯•ç»“æŸåç»Ÿä¸€åˆ¤æ–­
const jsErrors = []
page.on('pageerror', error => {
  console.error(`âŒ JS Error: ${error.message}`)
  jsErrors.push(error.message)
})

// æµ‹è¯•ç»“æŸæ—¶æ–­è¨€
test.afterEach(async () => {
  expect(jsErrors, `æ£€æµ‹åˆ° ${jsErrors.length} ä¸ª JS é”™è¯¯`).toHaveLength(0)
})
```

### ğŸ”´ è§„åˆ™2ï¼šæ•°æ®æ¸²æŸ“å¼ºåˆ¶éªŒè¯åŸåˆ™

**API è¿”å›æ•°æ®åï¼Œå¿…é¡»éªŒè¯æ•°æ®ç¡®å®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š**

```javascript
// âŒ é”™è¯¯åšæ³•ï¼šåªéªŒè¯ APIï¼Œä¸éªŒè¯æ¸²æŸ“
const response = await page.waitForResponse('**/sessions')
const data = await response.json()
expect(data.data.sessions.length).toBeGreaterThan(0)  // API æœ‰æ•°æ®
// ä½†æ²¡éªŒè¯é¡µé¢æ˜¯å¦æ˜¾ç¤ºï¼

// âœ… æ­£ç¡®åšæ³•ï¼šAPI æ•°æ® + é¡µé¢æ¸²æŸ“ åŒé‡éªŒè¯
const response = await page.waitForResponse('**/sessions')
const data = await response.json()
const apiCount = data.data.sessions.length
expect(apiCount).toBeGreaterThan(0)

// å¿…é¡»éªŒè¯é¡µé¢æ¸²æŸ“æ•°é‡
await page.waitForTimeout(1000)  // ç­‰å¾… Alpine.js æ¸²æŸ“
const renderedItems = await page.locator('[x-for] > div').count()

// å…³é”®æ–­è¨€ï¼šæ¸²æŸ“æ•°é‡å¿…é¡»ä¸ API æ•°é‡ä¸€è‡´
expect(renderedItems, 
  `API è¿”å› ${apiCount} æ¡æ•°æ®ï¼Œä½†é¡µé¢åªæ¸²æŸ“äº† ${renderedItems} æ¡`
).toBe(apiCount)
```

### ğŸ”´ è§„åˆ™3ï¼šAlpine.js å˜é‡åä¸€è‡´æ€§æ£€æŸ¥

**æµ‹è¯•å‰å¿…é¡»éªŒè¯ HTML æ¨¡æ¿å˜é‡ä¸ JS ç»„ä»¶æ•°æ®å®šä¹‰ä¸€è‡´**

```javascript
// âœ… æ¨èï¼šåœ¨æµ‹è¯•ä¸­æ·»åŠ å˜é‡ä¸€è‡´æ€§æ£€æŸ¥
test('Alpine.js ç»„ä»¶å˜é‡åä¸€è‡´æ€§æ£€æŸ¥', async ({ page }) => {
  // è·å– HTML ä¸­ä½¿ç”¨çš„ Alpine.js å˜é‡
  const htmlVariables = await page.evaluate(() => {
    const xForElements = document.querySelectorAll('[x-for]')
    const variables = new Set()
    xForElements.forEach(el => {
      const match = el.getAttribute('x-for').match(/(\w+)\s+in\s+(\w+)/)
      if (match) variables.add(match[2])  // æ•°ç»„å˜é‡å
    })
    return Array.from(variables)
  })

  // è·å– Alpine.js ç»„ä»¶å®é™…å®šä¹‰çš„æ•°æ®
  const componentData = await page.evaluate(() => {
    const component = document.querySelector('[x-data]')
    if (!component || !component._x_dataStack) return null
    return Object.keys(component._x_dataStack[0])
  })

  // éªŒè¯æ‰€æœ‰ HTML å˜é‡åœ¨ç»„ä»¶ä¸­éƒ½æœ‰å®šä¹‰
  for (const variable of htmlVariables) {
    expect(componentData, 
      `HTML æ¨¡æ¿ä½¿ç”¨å˜é‡ "${variable}"ï¼Œä½† JS ç»„ä»¶æœªå®šä¹‰ï¼`
    ).toContain(variable)
  }
})
```

### ğŸ”´ è§„åˆ™4ï¼šç¦æ­¢è¿‡åº¦å®½å®¹çš„æµ‹è¯•è®¾è®¡

**ç¦æ­¢ä½¿ç”¨ "å¦‚æœå­˜åœ¨åˆ™æµ‹è¯•" çš„é€»è¾‘æ©ç›–é—®é¢˜**

```javascript
// âŒ é”™è¯¯åšæ³•ï¼šå…ƒç´ ä¸å­˜åœ¨å°±è·³è¿‡
const sessions = await page.locator('.session-item').all()
if (sessions.length === 0) {
  console.log('æ²¡æœ‰ä¼šè¯ï¼Œè·³è¿‡æµ‹è¯•')  // âŒ å¯èƒ½æ˜¯ Bug å¯¼è‡´ä¸æ¸²æŸ“ï¼
  return
}

// âœ… æ­£ç¡®åšæ³•ï¼šæ˜ç¡®æ–­è¨€é¢„æœŸçŠ¶æ€
const sessions = await page.locator('.session-item').all()
if (sessions.length === 0) {
  // æ£€æŸ¥æ˜¯å¦çœŸçš„æ²¡æœ‰æ•°æ®ï¼Œè¿˜æ˜¯æ¸²æŸ“å¤±è´¥
  const apiHasData = await checkApiHasData()
  if (apiHasData) {
    throw new Error('API æœ‰æ•°æ®ä½†é¡µé¢æœªæ¸²æŸ“ï¼Œå¯èƒ½æ˜¯å‰ç«¯ Bugï¼')
  } else {
    test.skip('æµ‹è¯•ç¯å¢ƒæ— æ•°æ®')
  }
}
```

### ğŸ”´ è§„åˆ™5ï¼šå‰åç«¯å­—æ®µåä¸€è‡´æ€§éªŒè¯

**API è¿”å›å­—æ®µåå¿…é¡»ä¸å‰ç«¯ä½¿ç”¨çš„å­—æ®µåä¸€è‡´**

```javascript
// âœ… æ¨èï¼šéªŒè¯å…³é”®å­—æ®µåä¸€è‡´æ€§
test('API å“åº”å­—æ®µåä¸å‰ç«¯æ¨¡æ¿ä¸€è‡´', async ({ page }) => {
  const response = await page.waitForResponse('**/sessions')
  const data = await response.json()
  const session = data.data.sessions[0]

  // æ£€æŸ¥å‰ç«¯æœŸæœ›çš„å­—æ®µæ˜¯å¦å­˜åœ¨
  const expectedFields = [
    'customer_service_session_id',  // ä¸æ˜¯ session_id
    'user',
    'status',
    'created_at'
  ]

  for (const field of expectedFields) {
    expect(session, 
      `API å“åº”ç¼ºå°‘å­—æ®µ "${field}"ï¼Œå‰ç«¯æ¨¡æ¿å¯èƒ½æ— æ³•æ­£ç¡®æ¸²æŸ“`
    ).toHaveProperty(field)
  }

  // æ£€æŸ¥æ˜¯å¦æœ‰å­—æ®µåä¸åŒ¹é…çš„é—®é¢˜
  if (session.session_id && !session.customer_service_session_id) {
    throw new Error('å­—æ®µåä¸åŒ¹é…ï¼šAPI è¿”å› session_idï¼Œä½†å‰ç«¯æœŸæœ› customer_service_session_id')
  }
})
```

### ğŸ”´ è§„åˆ™6ï¼šå¼ºåˆ¶æ¸²æŸ“ç­‰å¾…å’ŒéªŒè¯

**Alpine.js é¡µé¢å¿…é¡»ç­‰å¾…æ¸²æŸ“å®Œæˆåå†éªŒè¯**

```javascript
// âœ… æ¨èï¼šAlpine.js æ¸²æŸ“å®Œæˆæ£€æµ‹
async function waitForAlpineRender(page, selector, timeout = 5000) {
  const startTime = Date.now()
  
  while (Date.now() - startTime < timeout) {
    const count = await page.locator(selector).count()
    const hasXCloak = await page.locator('[x-cloak]').count()
    
    // x-cloak æ¶ˆå¤±ä¸”æœ‰å†…å®¹æ—¶ï¼Œè®¤ä¸ºæ¸²æŸ“å®Œæˆ
    if (count > 0 && hasXCloak === 0) {
      return count
    }
    
    await page.waitForTimeout(100)
  }
  
  // è¶…æ—¶åæ£€æŸ¥æ˜¯å¦æœ‰ JS é”™è¯¯
  const consoleErrors = await page.evaluate(() => window.__consoleErrors || [])
  if (consoleErrors.length > 0) {
    throw new Error(`Alpine.js æ¸²æŸ“è¶…æ—¶ï¼Œæ§åˆ¶å°é”™è¯¯: ${consoleErrors.join(', ')}`)
  }
  
  throw new Error(`Alpine.js æ¸²æŸ“è¶…æ—¶ï¼š${selector} æœªå‡ºç°å†…å®¹`)
}

// ä½¿ç”¨ç¤ºä¾‹
const sessionCount = await waitForAlpineRender(page, '.session-item')
expect(sessionCount).toBeGreaterThan(0)
```

### ğŸ“‹ å‰ç«¯ Bug æ£€æµ‹æ£€æŸ¥æ¸…å•

**æ¯ä¸ªæµ‹è¯•æ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹æ£€æŸ¥ï¼š**

- [ ] **JS é”™è¯¯æ”¶é›†**ï¼š`page.on('pageerror')` æ”¶é›†æ‰€æœ‰é”™è¯¯ï¼Œæµ‹è¯•ç»“æŸæ—¶æ–­è¨€ä¸ºç©º
- [ ] **æ¸²æŸ“éªŒè¯**ï¼šAPI è¿”å›æ•°æ®åï¼ŒéªŒè¯é¡µé¢æ¸²æŸ“æ•°é‡ä¸ API æ•°é‡ä¸€è‡´
- [ ] **å­—æ®µåæ£€æŸ¥**ï¼šéªŒè¯ API å“åº”å­—æ®µåä¸å‰ç«¯æ¨¡æ¿ä½¿ç”¨çš„å­—æ®µåä¸€è‡´
- [ ] **å˜é‡åæ£€æŸ¥**ï¼šéªŒè¯ HTML x-for å˜é‡åœ¨ JS ç»„ä»¶ä¸­æœ‰å®šä¹‰
- [ ] **ç¦æ­¢é™é»˜è·³è¿‡**ï¼šå…ƒç´ ä¸å­˜åœ¨æ—¶ï¼Œå…ˆæ£€æŸ¥æ˜¯ Bug è¿˜æ˜¯çœŸçš„æ— æ•°æ®
- [ ] **Alpine.js ç‰¹å®šæ£€æŸ¥**ï¼šç­‰å¾… x-cloak æ¶ˆå¤±ï¼ŒéªŒè¯ç»„ä»¶åˆå§‹åŒ–æˆåŠŸ

### ğŸ“ æµ‹è¯•æ¨¡æ¿ï¼šå‰ç«¯æ¸²æŸ“éªŒè¯

```javascript
/**
 * æ ‡å‡†å‰ç«¯æ¸²æŸ“éªŒè¯æµ‹è¯•æ¨¡æ¿
 * 
 * è§£å†³çš„é—®é¢˜ï¼š
 * 1. API è¿”å›æ•°æ®ä½†é¡µé¢ä¸æ¸²æŸ“ï¼ˆå˜é‡åä¸åŒ¹é…ï¼‰
 * 2. JS é”™è¯¯è¢«å¿½ç•¥
 * 3. å­—æ®µåä¸åŒ¹é…å¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸
 */
test.describe('XXé¡µé¢ - å‰ç«¯æ¸²æŸ“éªŒè¯', () => {
  const jsErrors = []
  const consoleErrors = []

  test.beforeEach(async ({ page }) => {
    // æ”¶é›†æ‰€æœ‰ JS é”™è¯¯ï¼ˆä¸å¿½ç•¥ä»»ä½•é”™è¯¯ï¼‰
    page.on('pageerror', error => {
      console.error(`âŒ JS Error: ${error.message}`)
      jsErrors.push(error.message)
    })
    
    page.on('console', msg => {
      if (msg.type() === 'error') {
        consoleErrors.push(msg.text())
      }
    })
  })

  test.afterEach(async () => {
    // å¼ºåˆ¶æ–­è¨€ï¼šä¸å…è®¸æœ‰ä»»ä½• JS é”™è¯¯
    expect(jsErrors, 
      `æ£€æµ‹åˆ° ${jsErrors.length} ä¸ª JS é”™è¯¯:\n${jsErrors.join('\n')}`
    ).toHaveLength(0)
  })

  test('API æ•°æ®æ­£ç¡®æ¸²æŸ“åˆ°é¡µé¢', async ({ page }) => {
    // 1. ç›‘å¬ API å“åº”
    const responsePromise = page.waitForResponse('**/api/endpoint')
    await page.goto('/page')
    const response = await responsePromise
    const data = await response.json()
    
    // 2. éªŒè¯ API æœ‰æ•°æ®
    const apiCount = data.data.list.length
    expect(apiCount, 'API åº”è¿”å›æ•°æ®').toBeGreaterThan(0)
    
    // 3. ç­‰å¾… Alpine.js æ¸²æŸ“
    await page.waitForTimeout(1000)
    await page.waitForSelector('[x-cloak]', { state: 'hidden', timeout: 5000 })
      .catch(() => {}) // x-cloak å¯èƒ½å·²ç»ç§»é™¤
    
    // 4. éªŒè¯é¡µé¢æ¸²æŸ“æ•°é‡ä¸ API ä¸€è‡´
    const renderedCount = await page.locator('.list-item').count()
    expect(renderedCount, 
      `API è¿”å› ${apiCount} æ¡ï¼Œé¡µé¢æ¸²æŸ“ ${renderedCount} æ¡ï¼Œæ•°é‡ä¸ä¸€è‡´ï¼`
    ).toBe(apiCount)
    
    // 5. éªŒè¯å…³é”®å­—æ®µæ˜¾ç¤º
    const firstItem = page.locator('.list-item').first()
    await expect(firstItem).toContainText(data.data.list[0].name || data.data.list[0].title)
  })
})
```

### âš ï¸ å¸¸è§å‰ç«¯ Bug æ¨¡å¼åŠæ£€æµ‹æ–¹æ³•

| Bug æ¨¡å¼ | ç—‡çŠ¶ | æ£€æµ‹æ–¹æ³• |
|---------|------|---------|
| **å˜é‡åä¸åŒ¹é…** | `x is not defined` é”™è¯¯ | `page.on('pageerror')` æ•è· |
| **å­—æ®µåä¸åŒ¹é…** | é¡µé¢æ˜¾ç¤ºç©ºç™½æˆ– undefined | æ¯”è¾ƒ API å­—æ®µä¸ HTML æ¨¡æ¿å­—æ®µ |
| **ç»„ä»¶æœªåˆå§‹åŒ–** | x-cloak æ°¸è¿œä¸æ¶ˆå¤± | ç­‰å¾… x-cloak ç§»é™¤è¶…æ—¶æ£€æµ‹ |
| **å¼‚æ­¥æ¸²æŸ“å¤±è´¥** | API æœ‰æ•°æ®ä½†åˆ—è¡¨ä¸ºç©º | æ¯”è¾ƒ API count ä¸ DOM count |
| **æ¨¡æ¿è¯­æ³•é”™è¯¯** | æ•´ä¸ªç»„ä»¶ä¸æ¸²æŸ“ | æ£€æŸ¥ Alpine.js åˆå§‹åŒ–çŠ¶æ€ |

### ğŸ›‘ æµ‹è¯•ä¸­ç»å¯¹ç¦æ­¢çš„åšæ³•

```javascript
// âŒ ç¦æ­¢1ï¼šé¢„å…ˆ"åŸè°…"ç‰¹å®šé”™è¯¯
if (error.message.includes('xxx is not defined')) {
  return  // å¿½ç•¥
}

// âŒ ç¦æ­¢2ï¼šå…ƒç´ ä¸å­˜åœ¨å°±é™é»˜è·³è¿‡
if (items.length === 0) {
  console.log('æ— æ•°æ®ï¼Œè·³è¿‡')
  return
}

// âŒ ç¦æ­¢3ï¼šåªæ£€æŸ¥ API ä¸æ£€æŸ¥æ¸²æŸ“
expect(apiData.length).toBeGreaterThan(0)  // åªæ£€æŸ¥è¿™ä¸ªæ˜¯ä¸å¤Ÿçš„ï¼

// âŒ ç¦æ­¢4ï¼šä½¿ç”¨è¿‡é•¿çš„å›ºå®šç­‰å¾…ä»£æ›¿æ­£ç¡®çš„ç­‰å¾…æ¡ä»¶
await page.waitForTimeout(5000)  // ä¸å¦‚ç­‰å¾…å…·ä½“æ¡ä»¶

// âŒ ç¦æ­¢5ï¼šcatch æ‰€æœ‰é”™è¯¯ä¸æŠ¥å‘Š
try { await something() } catch (e) { /* é™é»˜ */ }
```

---

## ğŸš¨ å‰åç«¯å‚æ•°å¥‘çº¦éªŒè¯è§„åˆ™ï¼ˆ2026-02-03 æ–°å¢ï¼‰

### é—®é¢˜èƒŒæ™¯

ä»¥ä¸‹æ˜¯ä¸€ä¸ªçœŸå®æ¡ˆä¾‹ï¼šPlaywright æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ22ä¸ªæµ‹è¯•ï¼‰ï¼Œä½†æ—¥æœŸç­›é€‰åŠŸèƒ½å®é™…ä¸å·¥ä½œï¼š

```javascript
// âŒ å‰ç«¯å‘é€çš„å‚æ•°å
logFilters: {
  start_date: '',  // å‰ç«¯ä½¿ç”¨ start_date
  end_date: ''     // å‰ç«¯ä½¿ç”¨ end_date
}

// âŒ åç«¯æœŸæœ›çš„å‚æ•°å
queryLogs(filters) {
  const { start_time, end_time } = filters  // åç«¯æœŸæœ› start_time/end_time
}

// ç»“æœï¼šå‚æ•°åä¸åŒ¹é…ï¼Œåç«¯æ”¶ä¸åˆ°æ—¥æœŸç­›é€‰å‚æ•°ï¼Œè¿”å›å…¨éƒ¨æ•°æ®
```

**æµ‹è¯•ä¸ºä»€ä¹ˆæ²¡å‘ç°ï¼Ÿ**
1. æµ‹è¯•åªéªŒè¯äº†"API è¯·æ±‚è¢«å‘é€"ï¼Œæ²¡æœ‰éªŒè¯"å‚æ•°åæ˜¯å¦æ­£ç¡®"
2. æµ‹è¯•åªéªŒè¯äº†"è¾“å…¥æ¡†å­˜åœ¨"ï¼Œæ²¡æœ‰éªŒè¯"ç­›é€‰æ˜¯å¦çœŸæ­£ç”Ÿæ•ˆ"
3. æµ‹è¯•æ²¡æœ‰äº¤å‰éªŒè¯"è¿”å›æ•°æ®æ˜¯å¦åœ¨æŒ‡å®šæ—¥æœŸèŒƒå›´å†…"

### ğŸ”´ è§„åˆ™1ï¼šå‰åç«¯å‚æ•°åä¸€è‡´æ€§éªŒè¯ï¼ˆå¼ºåˆ¶ï¼‰

**æ¯ä¸ªç­›é€‰åŠŸèƒ½å¿…é¡»éªŒè¯å‰ç«¯å‚æ•°åä¸åç«¯ API å‚æ•°åä¸€è‡´**

```javascript
// âœ… æ­£ç¡®ï¼šæµ‹è¯•å‰å…ˆæ£€æŸ¥åç«¯ API æœŸæœ›çš„å‚æ•°å
test.beforeAll(async () => {
  // ä»åç«¯è·¯ç”±æ–‡ä»¶æˆ– API æ–‡æ¡£ç¡®è®¤å‚æ•°å
  // åç«¯è·¯ç”±: routes/v4/console/audit-logs.js
  // @query {string} [start_time] - å¼€å§‹æ—¶é—´
  // @query {string} [end_time] - ç»“æŸæ—¶é—´
  
  const BACKEND_EXPECTED_PARAMS = {
    dateStart: 'start_time',  // åç«¯æœŸæœ›çš„å¼€å§‹æ—¶é—´å‚æ•°å
    dateEnd: 'end_time',      // åç«¯æœŸæœ›çš„ç»“æŸæ—¶é—´å‚æ•°å
    merchantId: 'store_id',   // åç«¯æœŸæœ›çš„å•†æˆ·å‚æ•°å
  }
})

test('æ—¥æœŸç­›é€‰å‚æ•°åå¿…é¡»ä¸åç«¯ä¸€è‡´', async ({ page }) => {
  let capturedUrl = null
  page.on('request', req => {
    if (req.url().includes('audit-logs')) capturedUrl = req.url()
  })
  
  // æ“ä½œæ—¥æœŸç­›é€‰
  await page.fill('input[type="date"]', '2026-01-28')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1000)
  
  // ğŸ”´ å¼ºåˆ¶éªŒè¯ï¼šå‚æ•°åå¿…é¡»ä¸åç«¯ä¸€è‡´
  expect(capturedUrl, 'å‰ç«¯å¿…é¡»ä½¿ç”¨åç«¯æœŸæœ›çš„å‚æ•°å start_time')
    .toContain('start_time=')  // ä¸æ˜¯ start_date=
  expect(capturedUrl, 'å‰ç«¯å¿…é¡»ä½¿ç”¨åç«¯æœŸæœ›çš„å‚æ•°å end_time')
    .toContain('end_time=')    // ä¸æ˜¯ end_date=
})

// âŒ é”™è¯¯ï¼šåªéªŒè¯"æœ‰æ—¥æœŸå‚æ•°"ï¼Œä¸éªŒè¯å‚æ•°å
test('æ—¥æœŸç­›é€‰è§¦å‘ API è¯·æ±‚', async ({ page }) => {
  // è¿™æ ·çš„æµ‹è¯•æ— æ³•å‘ç°å‚æ•°åä¸åŒ¹é…é—®é¢˜ï¼
  expect(url).toMatch(/start/)  // âŒ å¤ªå®½æ¾ï¼Œstart_date ä¹Ÿä¼šåŒ¹é…
})
```

### ğŸ”´ è§„åˆ™2ï¼šæ—¥æœŸæ—¶é—´æ ¼å¼å®Œæ•´æ€§éªŒè¯ï¼ˆå¼ºåˆ¶ï¼‰

**æ—¥æœŸç­›é€‰å¿…é¡»éªŒè¯æ—¶é—´éƒ¨åˆ†æ˜¯å¦æ­£ç¡®è¡¥å…¨**

```javascript
// åœºæ™¯ï¼šç”¨æˆ·é€‰æ‹© 2026-01-28ï¼ŒæœŸæœ›æŸ¥è¯¢è¯¥å¤©å…¨éƒ¨æ•°æ®
// 
// âŒ é”™è¯¯å®ç°ï¼ˆåªå‘é€æ—¥æœŸï¼‰
// start_time=2026-01-28 â†’ è§£æä¸º 00:00:00
// end_time=2026-01-28   â†’ è§£æä¸º 00:00:00ï¼ˆä¸æ˜¯ 23:59:59ï¼ï¼‰
// ç»“æœï¼šåªèƒ½æŸ¥åˆ° 00:00:00 é‚£ä¸€ç§’çš„æ•°æ®
//
// âœ… æ­£ç¡®å®ç°ï¼ˆè¡¥å…¨æ—¶é—´éƒ¨åˆ†ï¼‰
// start_time=2026-01-28 00:00:00
// end_time=2026-01-28 23:59:59

test('ã€å¼ºåˆ¶ã€‘æ—¥æœŸç­›é€‰å¿…é¡»åŒ…å«å®Œæ•´æ—¶é—´æ ¼å¼', async ({ page }) => {
  let capturedUrl = null
  page.on('request', req => {
    if (req.url().includes('audit-logs')) capturedUrl = req.url()
  })
  
  // è®¾ç½®å¼€å§‹å’Œç»“æŸæ—¥æœŸä¸ºåŒä¸€å¤©
  await page.fill('input[x-model*="start"]', '2026-01-28')
  await page.fill('input[x-model*="end"]', '2026-01-28')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1000)
  
  // ğŸ”´ å¼ºåˆ¶éªŒè¯ï¼šæ—¶é—´éƒ¨åˆ†å¿…é¡»æ­£ç¡®
  // URLç¼–ç åï¼š00:00:00 â†’ 00%3A00%3A00ï¼Œ23:59:59 â†’ 23%3A59%3A59
  expect(capturedUrl, 'start_time å¿…é¡»è¡¥å…¨ä¸º 00:00:00')
    .toMatch(/start_time=2026-01-28[+%20]00%3A00%3A00/)
  expect(capturedUrl, 'end_time å¿…é¡»è¡¥å…¨ä¸º 23:59:59')
    .toMatch(/end_time=2026-01-28[+%20]23%3A59%3A59/)
})
```

### ğŸ”´ è§„åˆ™3ï¼šç­›é€‰ç»“æœæ•°æ®äº¤å‰éªŒè¯ï¼ˆå¼ºåˆ¶ï¼‰

**ç­›é€‰åå¿…é¡»éªŒè¯è¿”å›æ•°æ®ç¡®å®åœ¨æŒ‡å®šèŒƒå›´å†…**

```javascript
test('ã€å¼ºåˆ¶ã€‘ç­›é€‰ç»“æœå¿…é¡»åœ¨æŒ‡å®šèŒƒå›´å†…', async ({ page }) => {
  const filterDate = '2026-01-28'
  let apiData = null
  
  page.on('response', async res => {
    if (res.url().includes('audit-logs') && res.request().method() === 'GET') {
      const body = await res.json().catch(() => null)
      if (body?.success) apiData = body.data
    }
  })
  
  // æ‰§è¡Œæ—¥æœŸç­›é€‰
  await page.fill('input[x-model*="start"]', filterDate)
  await page.fill('input[x-model*="end"]', filterDate)
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(2000)
  
  // ğŸ”´ å¼ºåˆ¶éªŒè¯ï¼šè¿”å›æ•°æ®å¿…é¡»åœ¨æŒ‡å®šæ—¥æœŸèŒƒå›´å†…
  if (apiData?.items?.length > 0) {
    for (const item of apiData.items) {
      const itemDate = item.created_at?.split(' ')[0] || 
                       item.created_at?.beijing?.split(' ')[0]
      
      expect(itemDate, `æ•°æ®æ—¥æœŸ ${itemDate} åº”è¯¥ç­‰äºç­›é€‰æ—¥æœŸ ${filterDate}`)
        .toBe(filterDate)
    }
    console.log(`âœ… æ‰€æœ‰ ${apiData.items.length} æ¡æ•°æ®éƒ½åœ¨ ${filterDate} èŒƒå›´å†…`)
  }
})

// âŒ é”™è¯¯ï¼šåªéªŒè¯"æœ‰æ•°æ®è¿”å›"ï¼Œä¸éªŒè¯æ•°æ®æ˜¯å¦ç¬¦åˆç­›é€‰æ¡ä»¶
test('æ—¥æœŸç­›é€‰è¿”å›æ•°æ®', async ({ page }) => {
  expect(apiData.items.length).toBeGreaterThan(0)  // âŒ ä¸å¤Ÿï¼
  // å¯èƒ½è¿”å›çš„æ˜¯å…¨éƒ¨æ•°æ®è€Œä¸æ˜¯ç­›é€‰åçš„æ•°æ®
})
```

### ğŸ”´ è§„åˆ™4ï¼šHTML-JS å˜é‡ç»‘å®šä¸€è‡´æ€§æ£€æŸ¥ï¼ˆå¼ºåˆ¶ï¼‰

**HTML æ¨¡æ¿ä¸­çš„ x-model ç»‘å®šå¿…é¡»ä¸ JS å®šä¹‰çš„å˜é‡åä¸€è‡´**

```javascript
test.beforeAll('æ£€æŸ¥ HTML ä¸ JS å˜é‡ç»‘å®šä¸€è‡´æ€§', async () => {
  // ä» HTML æå– x-model ç»‘å®šçš„å˜é‡å
  const htmlContent = fs.readFileSync('finance-management.html', 'utf-8')
  const xModelMatches = htmlContent.match(/x-model="([^"]+)"/g)
  const htmlVariables = xModelMatches.map(m => m.match(/x-model="([^"]+)"/)[1])
  
  // ä» JS æå–å®šä¹‰çš„å˜é‡å
  const jsContent = fs.readFileSync('composables/merchant-logs.js', 'utf-8')
  
  // æ£€æŸ¥æ¯ä¸ª HTML ç»‘å®šçš„å˜é‡æ˜¯å¦åœ¨ JS ä¸­å®šä¹‰
  for (const variable of htmlVariables) {
    const varName = variable.split('.').pop()  // logFilters.start_time â†’ start_time
    expect(jsContent, `HTML ä½¿ç”¨äº† ${variable}ï¼Œä½† JS ä¸­æœªå®šä¹‰`).toContain(varName)
  }
})
```

### ğŸ“‹ ç­›é€‰åŠŸèƒ½æµ‹è¯•æ£€æŸ¥æ¸…å•ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

åœ¨ç¼–å†™ä»»ä½•ç­›é€‰åŠŸèƒ½æµ‹è¯•å‰ï¼Œå¿…é¡»å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

| # | æ£€æŸ¥é¡¹ | æ£€æŸ¥æ–¹æ³• | ç¤ºä¾‹ |
|---|--------|---------|------|
| 1 | **åç«¯å‚æ•°å** | è¯»å–åç«¯è·¯ç”±æ–‡ä»¶æ³¨é‡Š | `@query {string} [start_time]` |
| 2 | **å‰ç«¯å‚æ•°å** | è¯»å–å‰ç«¯ JS æ–‡ä»¶ | `logFilters.start_date` |
| 3 | **å‚æ•°åæ˜¯å¦ä¸€è‡´** | æ¯”è¾ƒä¸Šè¿°ä¸¤è€… | `start_date` â‰  `start_time` âŒ |
| 4 | **æ—¥æœŸæ ¼å¼è¦æ±‚** | æ£€æŸ¥åç«¯è§£æé€»è¾‘ | æ˜¯å¦éœ€è¦å®Œæ•´æ—¶é—´ `HH:mm:ss` |
| 5 | **HTML ç»‘å®šå˜é‡** | æ£€æŸ¥ `x-model` å±æ€§ | `x-model="logFilters.start_date"` |
| 6 | **JS å˜é‡å®šä¹‰** | æ£€æŸ¥ state å®šä¹‰ | `logFilters: { start_date: '' }` |

### âš ï¸ å¸¸è§ç­›é€‰åŠŸèƒ½ Bug æ¨¡å¼

| Bug æ¨¡å¼ | è¡¨ç° | æ ¹æœ¬åŸå›  | æ£€æµ‹æ–¹æ³• |
|---------|------|---------|---------|
| **å‚æ•°åä¸åŒ¹é…** | ç­›é€‰ä¸ç”Ÿæ•ˆï¼Œè¿”å›å…¨éƒ¨æ•°æ® | å‰ç«¯ `start_date`ï¼Œåç«¯æœŸæœ› `start_time` | æŠ“å– API URL æ£€æŸ¥å‚æ•°å |
| **æ—¶é—´æ ¼å¼ä¸å®Œæ•´** | æ—¥æœŸç­›é€‰ç»“æœä¸ç²¾ç¡® | åªå‘é€æ—¥æœŸæ²¡æœ‰æ—¶é—´éƒ¨åˆ† | æ£€æŸ¥ URL æ˜¯å¦åŒ…å« `HH:mm:ss` |
| **ç¼ºå°‘è¾“å…¥æ¡†** | æ— æ³•ç²¾ç¡®ç­›é€‰ | HTML æ¨¡æ¿é—æ¼è¾“å…¥å…ƒç´  | æ£€æŸ¥ç­›é€‰åŒºåŸŸå…ƒç´ å®Œæ•´æ€§ |
| **HTML-JS å˜é‡ä¸åŒ¹é…** | è¾“å…¥æ— æ•ˆæˆ–æŠ¥é”™ | `x-model` ç»‘å®šäº†æœªå®šä¹‰çš„å˜é‡ | æ¯”è¾ƒ HTML å’Œ JS çš„å˜é‡å |

### ğŸ›‘ æµ‹è¯•ä¸­ç»å¯¹ç¦æ­¢çš„åšæ³•ï¼ˆç­›é€‰åŠŸèƒ½ï¼‰

```javascript
// âŒ ç¦æ­¢1ï¼šåªéªŒè¯ API è¢«è°ƒç”¨ï¼Œä¸éªŒè¯å‚æ•°æ­£ç¡®
expect(apiCalled).toBe(true)  // ä¸å¤Ÿï¼

// âŒ ç¦æ­¢2ï¼šä½¿ç”¨è¿‡äºå®½æ¾çš„æ­£åˆ™åŒ¹é…å‚æ•°å
expect(url).toMatch(/date/)  // start_date å’Œ start_time éƒ½èƒ½åŒ¹é…ï¼

// âŒ ç¦æ­¢3ï¼šåªéªŒè¯"æœ‰æ•°æ®"ï¼Œä¸éªŒè¯æ•°æ®ç¬¦åˆç­›é€‰æ¡ä»¶
expect(data.length).toBeGreaterThan(0)  // å¯èƒ½æ˜¯æœªç­›é€‰çš„å…¨éƒ¨æ•°æ®

// âŒ ç¦æ­¢4ï¼šå‡è®¾æ—¥æœŸæ ¼å¼ä¸éœ€è¦æ—¶é—´éƒ¨åˆ†
params.append('start_time', '2026-01-28')  // ç¼ºå°‘ 00:00:00

// âŒ ç¦æ­¢5ï¼šä¸è¯»åç«¯ä»£ç å°±å†™æµ‹è¯•
// å¿…é¡»å…ˆç¡®è®¤åç«¯æœŸæœ›çš„å‚æ•°åå’Œæ ¼å¼ï¼
```

### âœ… æ­£ç¡®çš„ç­›é€‰åŠŸèƒ½æµ‹è¯•æµç¨‹

```javascript
test.describe('ç­›é€‰åŠŸèƒ½æµ‹è¯•ï¼ˆå®Œæ•´æµç¨‹ï¼‰', () => {
  // æ­¥éª¤1ï¼šå…ˆè¯»åç«¯ä»£ç ç¡®è®¤å‚æ•°å¥‘çº¦
  const BACKEND_CONTRACT = {
    endpoint: '/api/v4/console/audit-logs',
    params: {
      start_time: 'YYYY-MM-DD HH:mm:ss',  // åç«¯æœŸæœ›æ ¼å¼
      end_time: 'YYYY-MM-DD HH:mm:ss',
      store_id: 'number'
    }
  }
  
  test('1. éªŒè¯å‰ç«¯ä½¿ç”¨æ­£ç¡®çš„å‚æ•°å', async ({ page }) => {
    // æŠ“å–å®é™…å‘é€çš„è¯·æ±‚
    // æ¯”å¯¹å‚æ•°åæ˜¯å¦ä¸ BACKEND_CONTRACT ä¸€è‡´
  })
  
  test('2. éªŒè¯æ—¥æœŸæ ¼å¼åŒ…å«æ—¶é—´éƒ¨åˆ†', async ({ page }) => {
    // æ£€æŸ¥ URL æ˜¯å¦åŒ…å« 00:00:00 å’Œ 23:59:59
  })
  
  test('3. éªŒè¯ç­›é€‰ç»“æœæ•°æ®åœ¨æŒ‡å®šèŒƒå›´å†…', async ({ page }) => {
    // éå†è¿”å›æ•°æ®ï¼Œæ£€æŸ¥æ—¥æœŸæ˜¯å¦åœ¨ç­›é€‰èŒƒå›´å†…
  })
  
  test('4. éªŒè¯ç­›é€‰åæ¸…é™¤èƒ½æ¢å¤å…¨éƒ¨æ•°æ®', async ({ page }) => {
    // æ¸…é™¤ç­›é€‰åæ•°æ®é‡åº”è¯¥å¢åŠ 
  })
})
```

