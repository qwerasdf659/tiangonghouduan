# ğŸ§ª Playwright E2E æµ‹è¯•è§„èŒƒ - åŸºç¡€ç¯‡

## ğŸ“‹ è§„èŒƒæ¦‚è¿°

æœ¬æ–‡æ¡£æ˜¯ Playwright E2E æµ‹è¯•è§„èŒƒçš„**åŸºç¡€ç¯‡**ï¼ŒåŒ…å«æ ¸å¿ƒè§„åˆ™ã€ç”¨æˆ·è¡Œä¸ºæµ‹è¯•ã€çŠ¶æ€ä¸€è‡´æ€§éªŒè¯ç­‰åŸºç¡€å†…å®¹ã€‚

**é…å¥—æ–‡æ¡£**ï¼š`09-Playwright-æ•°æ®éªŒè¯è§„èŒƒ.mdc`ï¼ˆæ•°æ®ä¸€è‡´æ€§ + å­—æ®µæ˜ å°„ + å‰ç«¯Bugæ£€æµ‹ï¼‰

**æµ‹è¯•ç›®æ ‡ç¯å¢ƒ**ï¼šhttps://omqktqrtntnn.sealosbja.site/admin/workspace.htmlï¼ˆçº¿ä¸Šéƒ¨ç½²ï¼‰

---

## ğŸš¨ æµ‹è¯•å‰å‡†å¤‡ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

### è§„åˆ™ E2E-PREPARE-001ï¼šæµ‹è¯•å‰æ£€æŸ¥åç«¯æœåŠ¡

**å¼ºåˆ¶è¦æ±‚**ï¼šç¼–å†™æˆ–è¿è¡Œ Playwright æµ‹è¯•å‰ï¼Œå¿…é¡»å…ˆç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

```bash
# æµ‹è¯•å‰æ£€æŸ¥è„šæœ¬
#!/bin/bash
echo "ğŸ” æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€..."

# 1. æ£€æŸ¥ API å¥åº·çŠ¶æ€
API_HEALTH=$(curl -s -o /dev/null -w "%{http_code}" https://omqktqrtntnn.sealosbja.site/api/v4/health)
if [ "$API_HEALTH" != "200" ]; then
  echo "âŒ åç«¯ API ä¸å¯ç”¨ (HTTP $API_HEALTH)"
  exit 1
fi
echo "âœ… åç«¯ API æ­£å¸¸"

# 2. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼ˆé€šè¿‡ APIï¼‰
DB_CHECK=$(curl -s https://omqktqrtntnn.sealosbja.site/api/v4/health | grep -o '"database":"[^"]*"')
echo "ğŸ“Š æ•°æ®åº“çŠ¶æ€: $DB_CHECK"

echo "âœ… å¯ä»¥å¼€å§‹ Playwright æµ‹è¯•"
```

### è§„åˆ™ E2E-PREPARE-002ï¼šæµ‹è¯•å‰æŸ¥çœ‹å®é™…ä»£ç 

**å¼ºåˆ¶è¦æ±‚**ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹å‰ï¼Œå¿…é¡»å…ˆé˜…è¯»å‰ç«¯ä»£ç äº†è§£ï¼š
1. HTML ç»“æ„å’Œå…ƒç´ å®šä½å™¨
2. Alpine.js ç»„ä»¶å’Œæ–¹æ³•å
3. API è°ƒç”¨è·¯å¾„å’Œå‚æ•°
4. é¢„æœŸçš„äº¤äº’è¡Œä¸º

```javascript
// âŒ ç¦æ­¢ï¼šä¸çœ‹ä»£ç ç›´æ¥çŒœæµ‹
await page.click('button.submit')  // å¯èƒ½ä¸å­˜åœ¨

// âœ… æ­£ç¡®ï¼šåŸºäºå®é™…ä»£ç 
// å…ˆé˜…è¯» finance-management.htmlï¼Œå‘ç°æŒ‰é’®æ˜¯ï¼š
// <button @click="approveConsumption(record)">é€šè¿‡</button>
await page.click('button:has-text("é€šè¿‡")')
```

### è§„åˆ™ E2E-PREPARE-003ï¼šå¤ç”¨ç°æœ‰æµ‹è¯•ï¼Œå‡å°‘æŠ€æœ¯å€ºåŠ¡

**å¼ºåˆ¶è¦æ±‚**ï¼šåˆ›å»ºæ–°æµ‹è¯•æ–‡ä»¶å‰ï¼Œå¿…é¡»ï¼š
1. æ£€æŸ¥ `tests/e2e/` ç›®å½•æ˜¯å¦å·²æœ‰ç›¸å…³æµ‹è¯•
2. èƒ½å¤ç”¨çš„æµ‹è¯•ç”¨ä¾‹è¦å¤ç”¨
3. èƒ½å¢å¼ºçš„æµ‹è¯•ç”¨ä¾‹è¦å¢å¼ºï¼Œè€Œä¸æ˜¯æ–°å»ºé‡å¤æ–‡ä»¶

```bash
# æ£€æŸ¥ç°æœ‰æµ‹è¯•æ–‡ä»¶
ls -la admin/tests/e2e/*.spec.js

# æœç´¢ç›¸å…³æµ‹è¯•
grep -r "consumption" admin/tests/e2e/
```

---

## ğŸ”´ æ ¸å¿ƒè§„åˆ™ï¼šçœŸå®äº¤äº’éªŒè¯ï¼ˆéå…ƒç´ å­˜åœ¨æ€§éªŒè¯ï¼‰

### è§„åˆ™ E2E-REAL-001ï¼šå¿…é¡»è§¦å‘çœŸå® API è°ƒç”¨

**é—®é¢˜èƒŒæ™¯**ï¼šæµ‹è¯•åªéªŒè¯"æŒ‰é’®å­˜åœ¨"ï¼Œæ²¡æœ‰å®é™…ç‚¹å‡»è§¦å‘ APIã€‚

**ç¦æ­¢æ¨¡å¼** âŒ
```javascript
test('å®¡æ ¸æŒ‰é’®å­˜åœ¨', async ({ page }) => {
  // âŒ åªæ£€æŸ¥å…ƒç´ å­˜åœ¨
  await expect(page.locator('button:has-text("é€šè¿‡")')).toBeVisible()
  // æµ‹è¯•é€šè¿‡äº†ï¼Œä½†æŒ‰é’®å¯èƒ½ç‚¹å‡»åæŠ¥é”™ï¼
})
```

**æ­£ç¡®æ¨¡å¼** âœ…
```javascript
test('ç‚¹å‡»é€šè¿‡æŒ‰é’®è§¦å‘å®¡æ ¸ API', async ({ page }) => {
  // 1. è®¾ç½® API è¯·æ±‚æ‹¦æˆª
  const apiPromise = page.waitForRequest(req => 
    req.url().includes('/consumption/approve') && req.method() === 'POST'
  )
  
  // 2. è®¾ç½®å“åº”æ‹¦æˆª
  const responsePromise = page.waitForResponse(resp =>
    resp.url().includes('/consumption/approve')
  )
  
  // 3. å¤„ç†ç¡®è®¤å¯¹è¯æ¡†
  page.once('dialog', dialog => dialog.accept())
  
  // 4. çœŸæ­£ç‚¹å‡»æŒ‰é’®
  await page.click('button:has-text("é€šè¿‡")')
  
  // 5. éªŒè¯ API è¢«è°ƒç”¨
  const request = await apiPromise
  expect(request.method()).toBe('POST')
  
  // 6. éªŒè¯ API å“åº”
  const response = await responsePromise
  expect(response.status()).toBe(200)
  const json = await response.json()
  expect(json.success).toBe(true)
  
  // 7. éªŒè¯ UI çŠ¶æ€å˜åŒ–
  await expect(page.locator('tbody tr:first-child')).toContainText('å·²é€šè¿‡')
})
```

### è§„åˆ™ E2E-REAL-002ï¼šå¿…é¡»æ•è· JavaScript é”™è¯¯

**å¼ºåˆ¶è¦æ±‚**ï¼šæ¯ä¸ªæµ‹è¯•å¿…é¡»ç›‘å¬ Console é”™è¯¯ï¼Œå‘ç°å‰ç«¯ JS é—®é¢˜ã€‚

```javascript
test.beforeEach(async ({ page }) => {
  // æ”¶é›† JS é”™è¯¯
  const jsErrors = []
  
  page.on('console', msg => {
    if (msg.type() === 'error') {
      jsErrors.push(msg.text())
    }
  })
  
  page.on('pageerror', error => {
    jsErrors.push(error.message)
  })
  
  // åœ¨æµ‹è¯•ç»“æŸæ—¶æ–­è¨€æ—  JS é”™è¯¯
  page.jsErrors = jsErrors
})

test.afterEach(async ({ page }) => {
  // âœ… è‡ªåŠ¨æŠ¥å‘Šé”™è¯¯ï¼Œä¸éœ€è¦äººå·¥æŸ¥çœ‹æ—¥å¿—
  expect(page.jsErrors, `å‘ç° ${page.jsErrors.length} ä¸ª JS é”™è¯¯`).toHaveLength(0)
})
```

### è§„åˆ™ E2E-REAL-003ï¼šå¿…é¡»éªŒè¯å®Œæ•´ç”¨æˆ·æµç¨‹

**é—®é¢˜èƒŒæ™¯**ï¼šæ­»æ¿æµ‹è¯•åªéªŒè¯æŠ€æœ¯å±‚é¢ï¼Œæ²¡æœ‰éªŒè¯ä¸šåŠ¡ç»“æœã€‚

| æ­»æ¿æµ‹è¯•ï¼ˆç¦æ­¢ï¼‰| ä¸šåŠ¡éªŒè¯ï¼ˆå¿…é¡»ï¼‰|
|---------------|---------------|
| è¾“å…¥æ¡†è¢«æ¸…ç©º | ç”¨æˆ·èƒ½çœ‹åˆ°æƒ³è¦çš„æ•°æ® |
| æŒ‰é’®å¯ç‚¹å‡» | ç‚¹å‡»åä¸šåŠ¡çŠ¶æ€æ­£ç¡®å˜åŒ– |
| API è¢«è°ƒç”¨ | API è¿”å›æ­£ç¡®ç»“æœä¸” UI æ›´æ–° |
| å…ƒç´ å­˜åœ¨ | å…ƒç´ å†…å®¹æ­£ç¡® |

```javascript
// âŒ æ­»æ¿æµ‹è¯•
test('é‡ç½®æŒ‰é’®', async ({ page }) => {
  await page.click('button:has-text("é‡ç½®")')
  await expect(page.locator('input')).toHaveValue('')  // åªéªŒè¯æŠ€æœ¯å±‚é¢
})

// âœ… ä¸šåŠ¡éªŒè¯
test('é‡ç½®åç”¨æˆ·èƒ½æŸ¥çœ‹å…¨éƒ¨æ•°æ®', async ({ page }) => {
  // å…ˆè®¾ç½®ç­›é€‰æ¡ä»¶
  await page.fill('input[type="date"]', '2026-02-01')
  await page.click('button:has-text("æœç´¢")')
  const filteredCount = await page.locator('tbody tr').count()
  
  // ç‚¹å‡»é‡ç½®
  await page.click('button:has-text("é‡ç½®")')
  await page.waitForTimeout(1500)
  
  // éªŒè¯ä¸šåŠ¡ç»“æœï¼šæ•°æ®æ¢å¤
  const restoredCount = await page.locator('tbody tr').count()
  expect(restoredCount).toBeGreaterThanOrEqual(filteredCount)
  
  // éªŒè¯åˆ†é¡µä¿¡æ¯æ›´æ–°
  const totalInfo = await page.locator('text=/å…±.*æ¡/').textContent()
  expect(totalInfo).toMatch(/å…± \d+ æ¡/)
})
```

---

## ğŸ”´ æ ¸å¿ƒè§„åˆ™ï¼šæ–­è¨€å¼ºåˆ¶è¦æ±‚

### è§„åˆ™ E2E-ASSERT-001ï¼šæ¯ä¸ªæµ‹è¯•å¿…é¡»åŒ…å«æ–­è¨€

**å¼ºåˆ¶è¦æ±‚**ï¼šæ¯ä¸ª `test()` ç”¨ä¾‹å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ª `expect()` æ–­è¨€æ¥éªŒè¯ä¸šåŠ¡é€»è¾‘ç»“æœã€‚

**é—®é¢˜èƒŒæ™¯**ï¼š
```
æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼š
âš ï¸ æ—¥æœŸç­›é€‰ä¼¼ä¹æ²¡æœ‰ç”Ÿæ•ˆï¼Œç»“æœæ•°é‡ç›¸åŒ  â† å‘ç°äº†é—®é¢˜
âœ“ 1 passed  â† ä½†æµ‹è¯•å´é€šè¿‡äº†ï¼
```

**ç¦æ­¢æ¨¡å¼** âŒ
```javascript
test('éªŒè¯æ—¥æœŸç­›é€‰åŠŸèƒ½', async ({ page }) => {
  await page.fill('input[type="date"]', '2026-02-01')
  await page.click('button:has-text("æœç´¢")')
  
  const count = await page.locator('tbody tr').count()
  
  // âŒ ç¦æ­¢ï¼šåªæ‰“å°ç»“æœï¼Œä¸æ–­è¨€
  console.log(`ç»“æœ: ${count} æ¡`)
  
  // âŒ ç¦æ­¢ï¼šç”¨ if åˆ¤æ–­æ‰“å°è­¦å‘Šï¼Œä½†æµ‹è¯•ä»ç„¶é€šè¿‡
  if (count === 20) {
    console.log('âš ï¸ ç­›é€‰å¯èƒ½æ²¡ç”Ÿæ•ˆ')
  }
})
```

**æ­£ç¡®æ¨¡å¼** âœ…
```javascript
test('éªŒè¯æ—¥æœŸç­›é€‰åŠŸèƒ½', async ({ page }) => {
  await page.fill('input[type="date"]', '2026-02-01')
  await page.click('button:has-text("æœç´¢")')
  
  const count = await page.locator('tbody tr').count()
  
  // âœ… æ­£ç¡®ï¼šä½¿ç”¨ expect() æ–­è¨€éªŒè¯ç»“æœ
  expect(count, 'æ—¥æœŸç­›é€‰ååº”è¯¥è¿”å›æ›´å°‘çš„è®°å½•').toBeLessThan(20)
})
```

---

## ğŸ¯ æ–­è¨€è¦†ç›–è¦æ±‚

### 1. API è°ƒç”¨æ–­è¨€

**å¿…é¡»éªŒè¯**ï¼š
- API æ˜¯å¦è¢«è°ƒç”¨
- è¯·æ±‚å‚æ•°æ˜¯å¦æ­£ç¡®
- å“åº”çŠ¶æ€æ˜¯å¦æˆåŠŸ

```javascript
test('ç‚¹å‡»æŒ‰é’®è§¦å‘ API è°ƒç”¨', async ({ page }) => {
  // è®¾ç½® API æ‹¦æˆª
  const apiPromise = page.waitForRequest(req => 
    req.url().includes('/api/v4/console/consumption')
  )
  
  await page.click('button:has-text("é€šè¿‡")')
  
  // âœ… æ–­è¨€ï¼šAPI è¢«è°ƒç”¨
  const request = await apiPromise
  expect(request.url()).toContain('start_date=2026-02-01')
  
  // âœ… æ–­è¨€ï¼šå“åº”æˆåŠŸ
  const response = await page.waitForResponse(resp => 
    resp.url().includes('/consumption') && resp.status() === 200
  )
  const json = await response.json()
  expect(json.success).toBe(true)
})
```

### 2. æ•°æ®å˜åŒ–æ–­è¨€

**å¿…é¡»éªŒè¯**ï¼šç­›é€‰/æ“ä½œåæ•°æ®æ˜¯å¦æŒ‰é¢„æœŸå˜åŒ–

```javascript
test('çŠ¶æ€ç­›é€‰åŠŸèƒ½', async ({ page }) => {
  // è·å–åˆå§‹æ•°æ®
  const initialCount = await page.locator('tbody tr').count()
  
  // æ‰§è¡Œç­›é€‰æ“ä½œ
  await page.selectOption('select', 'pending')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1000)
  
  // âœ… æ–­è¨€ï¼šæ•°æ®å‘ç”Ÿå˜åŒ–æˆ–ç¬¦åˆé¢„æœŸ
  const filteredCount = await page.locator('tbody tr').count()
  expect(filteredCount).toBeLessThanOrEqual(initialCount)
  
  // âœ… æ–­è¨€ï¼šæ‰€æœ‰è®°å½•çŠ¶æ€æ­£ç¡®
  const statuses = await page.locator('tbody tr td:nth-child(3)').allTextContents()
  statuses.forEach(status => {
    expect(status).toContain('å¾…å®¡æ ¸')
  })
})
```

### 3. UI çŠ¶æ€æ–­è¨€

**å¿…é¡»éªŒè¯**ï¼šUI å…ƒç´ çŠ¶æ€æ˜¯å¦æ­£ç¡®æ›´æ–°

```javascript
test('å®¡æ ¸åçŠ¶æ€æ›´æ–°', async ({ page }) => {
  // ç‚¹å‡»å®¡æ ¸æŒ‰é’®
  page.once('dialog', dialog => dialog.accept())
  await page.click('button:has-text("é€šè¿‡")')
  
  await page.waitForTimeout(2000)
  
  // âœ… æ–­è¨€ï¼šçŠ¶æ€æ ‡ç­¾æ›´æ–°
  const statusBadge = page.locator('tbody tr:first-child .status-badge')
  await expect(statusBadge).toHaveText('å·²é€šè¿‡')
  
  // âœ… æ–­è¨€ï¼šæŒ‰é’®çŠ¶æ€å˜åŒ–
  const approveBtn = page.locator('tbody tr:first-child button:has-text("é€šè¿‡")')
  await expect(approveBtn).toBeDisabled()
})
```

---

## ğŸŒ ç½‘ç»œè¯·æ±‚ç›‘å¬å’Œ API éªŒè¯è§„èŒƒ

### è§„åˆ™ E2E-API-001ï¼šå¿…é¡»æ‹¦æˆªå’ŒéªŒè¯ç½‘ç»œè¯·æ±‚

**å¼ºåˆ¶è¦æ±‚**ï¼šå…³é”®æ“ä½œå¿…é¡»éªŒè¯ API è¯·æ±‚å’Œå“åº”ã€‚

```javascript
test('å®¡æ ¸æ“ä½œå®Œæ•´éªŒè¯', async ({ page }) => {
  // 1. è®¾ç½®è¯·æ±‚æ‹¦æˆªå™¨
  const requests = []
  page.on('request', request => {
    if (request.url().includes('/api/v4/console/consumption')) {
      requests.push({
        url: request.url(),
        method: request.method(),
        postData: request.postData()
      })
    }
  })

  // 2. è®¾ç½®å“åº”æ‹¦æˆªå™¨
  const responses = []
  page.on('response', async response => {
    if (response.url().includes('/api/v4/console/consumption')) {
      try {
        const json = await response.json()
        responses.push({
          url: response.url(),
          status: response.status(),
          body: json
        })
      } catch {}
    }
  })

  // 3. æ‰§è¡Œæ“ä½œ
  page.once('dialog', dialog => dialog.accept())
  await page.click('button:has-text("é€šè¿‡")')
  await page.waitForTimeout(3000)

  // 4. éªŒè¯è¯·æ±‚è¢«å‘é€
  expect(requests.length, 'åº”è¯¥å‘é€å®¡æ ¸è¯·æ±‚').toBeGreaterThan(0)
  
  // 5. éªŒè¯å“åº”æ­£ç¡®
  const approveResponse = responses.find(r => r.url.includes('approve'))
  expect(approveResponse, 'åº”è¯¥æ”¶åˆ°å®¡æ ¸å“åº”').toBeDefined()
  expect(approveResponse.status).toBe(200)
  expect(approveResponse.body.success).toBe(true)
})
```

### è§„åˆ™ E2E-API-002ï¼šç­‰å¾… API å“åº”åå†æ–­è¨€

**ç¦æ­¢æ¨¡å¼** âŒ
```javascript
await page.click('button:has-text("ä¿å­˜")')
// âŒ ç«‹å³æ–­è¨€ï¼ŒAPI è¿˜æ²¡è¿”å›
await expect(page.locator('.success')).toBeVisible()
```

**æ­£ç¡®æ¨¡å¼** âœ…
```javascript
await page.click('button:has-text("ä¿å­˜")')

// âœ… ç­‰å¾… API å“åº”
const response = await page.waitForResponse(
  resp => resp.url().includes('/save') && resp.status() === 200,
  { timeout: 10000 }
)

// âœ… éªŒè¯å“åº”åå†æ–­è¨€ UI
const json = await response.json()
expect(json.success).toBe(true)
await expect(page.locator('.success')).toBeVisible()
```

---

## ğŸ”§ Alpine.js ç»„ä»¶æµ‹è¯•è§„èŒƒ

### è§„åˆ™ E2E-ALPINE-001ï¼šæ­£ç¡®æŸ¥æ‰¾åµŒå¥—ç»„ä»¶

**é—®é¢˜èƒŒæ™¯**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šåªè·å–ç¬¬ä¸€ä¸ª x-data å…ƒç´ 
const el = document.querySelector('[x-data]')
// ç»“æœï¼šæ‰¾åˆ°å¤–å±‚ç»„ä»¶ï¼Œä½†æ–¹æ³•åœ¨å†…å±‚ç»„ä»¶ä¸­
```

**æ­£ç¡®æ¨¡å¼** âœ…
```javascript
// âœ… æ­£ç¡®ï¼šéå†æ‰€æœ‰ç»„ä»¶ï¼Œæ‰¾åˆ°åŒ…å«ç›®æ ‡æ–¹æ³•çš„ç»„ä»¶
async function findAlpineComponentWithMethod(page, methodName) {
  return page.evaluate(async (methodName) => {
    const alpineElements = document.querySelectorAll('[x-data]')
    
    for (const el of alpineElements) {
      const data = window.Alpine.$data(el)
      if (data && typeof data[methodName] === 'function') {
        return { found: true, componentName: el.getAttribute('x-data') }
      }
    }
    
    return { found: false, error: `${methodName} not found` }
  }, methodName)
}
```

---

## ğŸ”„ confirm() å¯¹è¯æ¡†å¤„ç†è§„èŒƒ

### è§„åˆ™ E2E-DIALOG-001ï¼šå¿…é¡»å¤„ç†åŸç”Ÿå¯¹è¯æ¡†

**é—®é¢˜èƒŒæ™¯**ï¼š`confirm()` å¯¹è¯æ¡†ä¼šé˜»å¡ Playwright æ‰§è¡Œ

**æ­£ç¡®æ¨¡å¼** âœ…
```javascript
test('å¤„ç†ç¡®è®¤å¯¹è¯æ¡†', async ({ page }) => {
  // âœ… åœ¨ç‚¹å‡»å‰è®¾ç½®å¯¹è¯æ¡†å¤„ç†å™¨
  page.once('dialog', async dialog => {
    expect(dialog.type()).toBe('confirm')
    expect(dialog.message()).toContain('ç¡®å®š')
    await dialog.accept()  // æˆ– dialog.dismiss() å–æ¶ˆ
  })
  
  await page.click('button:has-text("åˆ é™¤")')
})
```

---

## ğŸ“Š æµ‹è¯•ç»“æ„æ¨¡æ¿

### æ ‡å‡†æµ‹è¯•æ–‡ä»¶ç»“æ„

```javascript
import { test, expect } from '@playwright/test'

// ç™»å½•å‡½æ•°ï¼ˆå¤ç”¨ï¼‰
async function login(page) {
  await page.goto('login.html')
  await page.fill('input[type="tel"]', '13612227930')
  await page.fill('input[x-model="code"]', '123456')
  await page.click('button[type="submit"]')
  await expect(page).toHaveURL(/workspace/, { timeout: 15000 })
}

test.describe('åŠŸèƒ½æ¨¡å—åç§°', () => {
  test.beforeEach(async ({ page }) => {
    await login(page)
  })

  test('æµ‹è¯•ç”¨ä¾‹1ï¼šéªŒè¯XXXåŠŸèƒ½', async ({ page }) => {
    // 1. å‡†å¤‡ï¼šå¯¼èˆªåˆ°ç›®æ ‡é¡µé¢
    await page.goto('target-page.html')
    await page.waitForLoadState('networkidle')
    
    // 2. æ‰§è¡Œï¼šè¿›è¡Œæ“ä½œ
    await page.click('button')
    
    // 3. æ–­è¨€ï¼šéªŒè¯ç»“æœï¼ˆå¿…é¡»æœ‰ï¼ï¼‰
    await expect(page.locator('.result')).toBeVisible()
    expect(await page.locator('.count').textContent()).toBe('10')
  })
})
```

---

## ğŸš« å¸¸è§é”™è¯¯æ¨¡å¼

### 1. åªéªŒè¯å…ƒç´ å­˜åœ¨ï¼Œä¸éªŒè¯å†…å®¹

```javascript
// âŒ é”™è¯¯ï¼šåªéªŒè¯æŒ‰é’®å­˜åœ¨
await expect(page.locator('button')).toBeVisible()

// âœ… æ­£ç¡®ï¼šéªŒè¯æŒ‰é’®æ–‡æœ¬å’ŒçŠ¶æ€
await expect(page.locator('button')).toHaveText('æäº¤')
await expect(page.locator('button')).toBeEnabled()
```

### 2. ç­‰å¾…å›ºå®šæ—¶é—´è€Œä¸æ˜¯æ¡ä»¶

```javascript
// âŒ é”™è¯¯ï¼šç­‰å¾…å›ºå®šæ—¶é—´
await page.waitForTimeout(5000)
expect(something).toBe(true)

// âœ… æ­£ç¡®ï¼šç­‰å¾…æ¡ä»¶æ»¡è¶³
await expect(page.locator('.loading')).toBeHidden({ timeout: 5000 })
await expect(page.locator('.data')).toBeVisible()
```

### 3. ä¸éªŒè¯ API å“åº”

```javascript
// âŒ é”™è¯¯ï¼šåªéªŒè¯è¯·æ±‚å‘å‡º
const request = await page.waitForRequest('/api/save')
// æ²¡æœ‰éªŒè¯å“åº”ï¼

// âœ… æ­£ç¡®ï¼šéªŒè¯è¯·æ±‚å’Œå“åº”
const responsePromise = page.waitForResponse('/api/save')
await page.click('button')
const response = await responsePromise
expect(response.status()).toBe(200)
const json = await response.json()
expect(json.success).toBe(true)
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

éµå¾ªæœ¬è§„èŒƒåï¼š
- **é—®é¢˜å‘ç°ç‡**ï¼šä»"å¯èƒ½æ¼æ‰"æå‡åˆ°"å¿…å®šæ•è·"
- **æµ‹è¯•å¯é æ€§**ï¼šæµ‹è¯•é€šè¿‡ = åŠŸèƒ½æ­£å¸¸ï¼Œæµ‹è¯•å¤±è´¥ = å‘ç°é—®é¢˜
- **è°ƒè¯•æ•ˆç‡**ï¼šæ–­è¨€å¤±è´¥ä¿¡æ¯æ˜ç¡®æŒ‡å‡ºé—®é¢˜æ‰€åœ¨

---

## ğŸ§‘â€ğŸ’¼ ç”¨æˆ·è¡Œä¸ºå¯¼å‘æµ‹è¯•è§„èŒƒ

### è§„åˆ™ E2E-USER-001ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œæµç¨‹

**æ ¸å¿ƒç†å¿µ**ï¼šæµ‹è¯•åº”è¯¥æ¨¡æ‹Ÿè¿è¥äººå‘˜çš„**å®Œæ•´æ“ä½œè·¯å¾„**ï¼Œè€Œä¸æ˜¯å•ç‹¬éªŒè¯æŸä¸ªåŠŸèƒ½ç‚¹ã€‚

**æ­»æ¿æµ‹è¯•** âŒ
```javascript
// âŒ åªæµ‹è¯•"èƒ½å¡«å…¥æ—¥æœŸ"
test('æ—¥æœŸç­›é€‰', async ({ page }) => {
  await page.fill('input[type="date"]', '2026-02-01')
  await expect(page.locator('input[type="date"]')).toHaveValue('2026-02-01')
  // æµ‹è¯•ç»“æŸï¼Œæ²¡æœ‰éªŒè¯å®é™…æ•ˆæœ
})
```

**ç”¨æˆ·è¡Œä¸ºæµ‹è¯•** âœ…
```javascript
// âœ… æ¨¡æ‹Ÿå®Œæ•´æ“ä½œæµç¨‹ï¼šé€‰æ‹©æ—¥æœŸ â†’ æŸ¥çœ‹ç»“æœ â†’ æ¸…é™¤æ—¥æœŸ â†’ æ¢å¤å…¨éƒ¨
test('æ—¥æœŸç­›é€‰å®Œæ•´æµç¨‹', async ({ page }) => {
  const initialCount = await page.locator('tbody tr').count()
  
  // 1. é€‰æ‹©æ—¥æœŸç­›é€‰
  await page.fill('input[type="date"]', '2026-02-01')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1500)
  const filteredCount = await page.locator('tbody tr').count()
  expect(filteredCount).toBeLessThanOrEqual(initialCount)
  
  // 2. æ¸…é™¤æ—¥æœŸï¼Œåº”è¯¥èƒ½æ¢å¤å…¨éƒ¨æ•°æ® â† è¿™æ˜¯ç”¨æˆ·çš„çœŸå®éœ€æ±‚ï¼
  await page.fill('input[type="date"]', '')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1500)
  const restoredCount = await page.locator('tbody tr').count()
  expect(restoredCount).toBeGreaterThanOrEqual(filteredCount)
})
```

---

### è§„åˆ™ E2E-USER-002ï¼šå¿…é¡»æµ‹è¯•"æ¢å¤/é‡ç½®"æ“ä½œ

**é—®é¢˜èƒŒæ™¯**ï¼šç”¨æˆ·ç»å¸¸éœ€è¦"å–æ¶ˆç­›é€‰"ã€"æ¸…é™¤æ¡ä»¶"ã€"æ¢å¤é»˜è®¤"ï¼Œä½†è¿™äº›å¾€å¾€è¢«å¿½ç•¥ã€‚

**å¿…é¡»æµ‹è¯•çš„æ¢å¤åœºæ™¯**ï¼š

| æ“ä½œç±»å‹ | å¿…é¡»éªŒè¯çš„æ¢å¤åœºæ™¯ |
|---------|-------------------|
| ç­›é€‰æ¡ä»¶ | æ¸…é™¤åèƒ½æŸ¥çœ‹å…¨éƒ¨æ•°æ® |
| è¡¨å•è¾“å…¥ | å–æ¶ˆ/é‡ç½®åå­—æ®µæ¸…ç©º |
| å¼¹çª—/æ¨¡æ€æ¡† | å…³é—­åä¸å½±å“åŸæ•°æ® |
| æ‰¹é‡é€‰æ‹© | å–æ¶ˆå…¨é€‰åçŠ¶æ€æ­£ç¡® |
| æ—¥æœŸé€‰æ‹© | æ¸…é™¤åä¸æ®‹ç•™å€¼ |

```javascript
// âœ… é‡ç½®/æ¢å¤æµ‹è¯•æ¨¡æ¿
test('ç­›é€‰é‡ç½®åŠŸèƒ½', async ({ page }) => {
  // 1. è®¾ç½®å¤šä¸ªç­›é€‰æ¡ä»¶
  await page.fill('input[placeholder="ç”¨æˆ·ID"]', '31')
  await page.selectOption('select.status', 'pending')
  await page.fill('input[type="date"]', '2026-02-01')
  
  // 2. ç‚¹å‡»é‡ç½®æŒ‰é’®
  await page.click('button:has-text("é‡ç½®")')
  
  // 3. éªŒè¯æ‰€æœ‰æ¡ä»¶å·²æ¸…ç©º
  await expect(page.locator('input[placeholder="ç”¨æˆ·ID"]')).toHaveValue('')
  await expect(page.locator('select.status')).toHaveValue('')
  await expect(page.locator('input[type="date"]')).toHaveValue('')
  
  // 4. éªŒè¯æ•°æ®å·²æ¢å¤å…¨éƒ¨
  const count = await page.locator('tbody tr').count()
  expect(count).toBeGreaterThan(0)
})
```

---

### è§„åˆ™ E2E-USER-003ï¼šè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸è¾“å…¥æµ‹è¯•

**å¿…é¡»è¦†ç›–çš„è¾¹ç•Œåœºæ™¯**ï¼š

| åœºæ™¯ç±»å‹ | æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ |
|---------|-------------|
| ç©ºå€¼ | ä¸å¡«ä»»ä½•æ¡ä»¶ç›´æ¥æœç´¢ |
| æç«¯å€¼ | æ—¥æœŸè®¾ä¸ºæœªæ¥/è¿‡å»å¾ˆä¹… |
| æ— ç»“æœ | æœç´¢ä¸å­˜åœ¨çš„ç”¨æˆ·ID |
| å¿«é€Ÿæ“ä½œ | è¿ç»­ç‚¹å‡»å¤šæ¬¡æäº¤ |
| å¹¶å‘ | åŒæ—¶é€‰æ‹©å¤šä¸ªç­›é€‰æ¡ä»¶ |

```javascript
// âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•æ¨¡æ¿
test('æ— ç»“æœæ—¶æ˜¾ç¤ºå‹å¥½æç¤º', async ({ page }) => {
  await page.fill('input[placeholder="ç”¨æˆ·ID"]', '99999999')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1500)
  
  // åº”è¯¥æ˜¾ç¤º"æš‚æ— æ•°æ®"è€Œä¸æ˜¯å´©æºƒ
  const emptyState = page.locator('text=æš‚æ— æ•°æ®, text=æ²¡æœ‰è®°å½•')
  const tableRows = page.locator('tbody tr')
  
  const hasEmpty = await emptyState.first().isVisible().catch(() => false)
  const rowCount = await tableRows.count()
  
  expect(hasEmpty || rowCount === 0).toBe(true)
})

test('æœªæ¥æ—¥æœŸåº”è¯¥è¿”å›ç©ºç»“æœ', async ({ page }) => {
  await page.fill('input[type="date"]', '2030-12-31')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1500)
  
  const count = await page.locator('tbody tr').count()
  expect(count).toBeLessThan(5)  // æœªæ¥æ—¥æœŸä¸åº”è¯¥æœ‰æ•°æ®
})
```

---

### è§„åˆ™ E2E-USER-004ï¼šåŸºäºçœŸå®ä¸šåŠ¡åœºæ™¯çš„æµ‹è¯•

**æ€è€ƒæ–¹å¼**ï¼šé—®è‡ªå·±"è¿è¥äººå‘˜æ¯å¤©ä¼šæ€ä¹ˆç”¨è¿™ä¸ªé¡µé¢ï¼Ÿ"

**è¿è¥äººå‘˜çš„å…¸å‹å·¥ä½œæµç¨‹**ï¼š

```javascript
// âœ… æ¨¡æ‹Ÿè¿è¥äººå‘˜æ—¥å¸¸å®¡æ ¸æµç¨‹
test('è¿è¥äººå‘˜å®¡æ ¸å·¥ä½œæµç¨‹', async ({ page }) => {
  // 1. è¿è¥äººå‘˜é¦–å…ˆç­›é€‰"å¾…å®¡æ ¸"è®°å½•
  await page.selectOption('select.status', 'pending')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(1500)
  
  const pendingCount = await page.locator('tbody tr').count()
  console.log(`ğŸ“Š ä»Šæ—¥å¾…å®¡æ ¸: ${pendingCount} æ¡`)
  
  if (pendingCount === 0) {
    console.log('âœ… æ²¡æœ‰å¾…å®¡æ ¸è®°å½•ï¼Œå·¥ä½œå®Œæˆ')
    return
  }
  
  // 2. è¿è¥äººå‘˜ä¼šæŸ¥çœ‹ç¬¬ä¸€æ¡è®°å½•è¯¦æƒ…
  await page.click('tbody tr:first-child button:has-text("è¯¦æƒ…")')
  await page.waitForTimeout(500)
  
  // 3. ç¡®è®¤è¯¦æƒ…å¼¹çª—æ­£ç¡®æ˜¾ç¤º
  const modal = page.locator('.modal, [role="dialog"]')
  await expect(modal.first()).toBeVisible({ timeout: 3000 })
  
  // 4. å…³é—­è¯¦æƒ…ï¼Œè¿›è¡Œå®¡æ ¸
  await page.click('button:has-text("å…³é—­"), .modal-close')
  
  // 5. è¿è¥äººå‘˜å¤„ç†å®Œä¸€æ¡åï¼Œå¯èƒ½æƒ³çœ‹"ä»Šå¤©è¿˜å‰©å¤šå°‘"
  //    è¿™æ—¶å€™éœ€è¦èƒ½æ–¹ä¾¿åœ°åˆ·æ–°/é‡æ–°ç­›é€‰
})
```

---

### è§„åˆ™ E2E-USER-005ï¼šé˜²å‘†æµ‹è¯•ï¼ˆç”¨æˆ·è¯¯æ“ä½œå®¹é”™ï¼‰

**æ ¸å¿ƒç†å¿µ**ï¼šæµ‹è¯•ç”¨æˆ·è¯¯æ“ä½œæ—¶ç³»ç»Ÿæ˜¯å¦æœ‰å®¹é”™å¤„ç†ã€‚

**å¿…é¡»éªŒè¯çš„é˜²å‘†åœºæ™¯**ï¼š

```javascript
// âœ… é˜²æ­¢è¯¯æ“ä½œçš„æµ‹è¯•
test('å®¡æ ¸å‰æœ‰ç¡®è®¤æç¤º', async ({ page }) => {
  let dialogShown = false
  
  page.once('dialog', async dialog => {
    dialogShown = true
    expect(dialog.message()).toContain('ç¡®å®š')  // å¿…é¡»æœ‰ç¡®è®¤æç¤º
    await dialog.dismiss()  // ç”¨æˆ·å–æ¶ˆ
  })
  
  await page.click('button:has-text("é€šè¿‡")')
  await page.waitForTimeout(1000)
  
  // âœ… æ–­è¨€ï¼šç¡®è®¤å¯¹è¯æ¡†åº”è¯¥å¼¹å‡ºï¼ˆä¸æ˜¯ console.logï¼‰
  expect(dialogShown, 'å±é™©æ“ä½œåº”è¯¥æœ‰ç¡®è®¤å¯¹è¯æ¡†').toBe(true)
  
  // âœ… æ–­è¨€ï¼šå–æ¶ˆåè®°å½•çŠ¶æ€ä¸å˜
  const status = await page.locator('tbody tr:first-child .status').textContent()
  expect(status).toContain('å¾…å®¡æ ¸')
})

test('æ‰¹é‡æ“ä½œæœ‰äºŒæ¬¡ç¡®è®¤', async ({ page }) => {
  // é€‰æ‹©å¤šæ¡è®°å½•
  await page.click('thead input[type="checkbox"]')
  
  let confirmMessage = ''
  page.once('dialog', async dialog => {
    confirmMessage = dialog.message()
    await dialog.dismiss()
  })
  
  await page.click('button:has-text("æ‰¹é‡é€šè¿‡")')
  
  // âœ… æ‰¹é‡æ“ä½œåº”è¯¥æ˜ç¡®å‘ŠçŸ¥å½±å“èŒƒå›´
  expect(confirmMessage, 'æ‰¹é‡æ“ä½œåº”æ˜ç¡®å‘ŠçŸ¥å½±å“æ•°é‡').toMatch(/\d+.*æ¡|ç¡®å®š.*æ‰¹é‡/)
})
```

---

## ğŸ”„ çŠ¶æ€ä¸€è‡´æ€§æµ‹è¯•è§„èŒƒ

### è§„åˆ™ E2E-STATE-001ï¼šæ“ä½œå UI å’Œæ•°æ®å¿…é¡»åŒæ­¥

**é—®é¢˜èƒŒæ™¯**ï¼šAPI æˆåŠŸä½† UI æ²¡æ›´æ–°ï¼Œæˆ– UI æ›´æ–°ä½†æ•°æ®æ²¡å˜ã€‚

```javascript
test('å®¡æ ¸é€šè¿‡åçŠ¶æ€åŒæ­¥æ›´æ–°', async ({ page }) => {
  // 1. è®°å½•åˆå§‹çŠ¶æ€
  const initialStatus = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
  expect(initialStatus).toContain('å¾…å®¡æ ¸')
  
  // 2. æ‰§è¡Œæ“ä½œ
  page.once('dialog', d => d.accept())
  
  const responsePromise = page.waitForResponse(r => 
    r.url().includes('/approve') && r.status() === 200
  )
  
  await page.click('tbody tr:first-child button:has-text("é€šè¿‡")')
  await responsePromise
  await page.waitForTimeout(1500)
  
  // 3. éªŒè¯ UI çŠ¶æ€æ›´æ–°ï¼ˆå¿…é¡»ç”¨ expectï¼Œä¸èƒ½ç”¨ console.logï¼‰
  const newStatus = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
  expect(newStatus, 'UI çŠ¶æ€åº”è¯¥æ›´æ–°ä¸ºå·²é€šè¿‡').toContain('å·²é€šè¿‡')
  
  // 4. åˆ·æ–°é¡µé¢éªŒè¯æ•°æ®æŒä¹…åŒ–
  await page.reload()
  await page.waitForLoadState('networkidle')
  
  const persistedStatus = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
  expect(persistedStatus, 'åˆ·æ–°åçŠ¶æ€åº”è¯¥ä¿æŒ').toContain('å·²é€šè¿‡')
})
```

### è§„åˆ™ E2E-STATE-002ï¼šé”™è¯¯æ¢å¤æµ‹è¯•

**å¼ºåˆ¶è¦æ±‚**ï¼šæµ‹è¯•å‡ºé”™åç”¨æˆ·å¦‚ä½•æ¢å¤ã€‚

```javascript
test('API å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶å…è®¸é‡è¯•', async ({ page }) => {
  // æ¨¡æ‹Ÿ API å¤±è´¥
  await page.route('**/consumption/approve/**', route => {
    route.fulfill({
      status: 500,
      body: JSON.stringify({ success: false, message: 'æœåŠ¡å™¨é”™è¯¯' })
    })
  })
  
  page.once('dialog', d => d.accept())
  await page.click('button:has-text("é€šè¿‡")')
  await page.waitForTimeout(2000)
  
  // éªŒè¯æ˜¾ç¤ºé”™è¯¯æç¤º
  const errorMessage = page.locator('text=/å¤±è´¥|é”™è¯¯|Error/')
  await expect(errorMessage, 'åº”è¯¥æ˜¾ç¤ºé”™è¯¯æç¤º').toBeVisible({ timeout: 5000 })
  
  // éªŒè¯æ•°æ®æ²¡æœ‰è¢«é”™è¯¯ä¿®æ”¹
  const status = await page.locator('tbody tr:first-child td:nth-child(6)').textContent()
  expect(status, 'å¤±è´¥åçŠ¶æ€åº”ä¿æŒä¸å˜').toContain('å¾…å®¡æ ¸')
})
```

---

## ğŸ“‹ ç”¨æˆ·è¡Œä¸ºæµ‹è¯•æ£€æŸ¥æ¸…å•

### æ¯ä¸ªåŠŸèƒ½æ¨¡å—å¿…é¡»åŒ…å«çš„æµ‹è¯•

- [ ] **æ­£å‘æµç¨‹æµ‹è¯•**ï¼šå®Œæ•´çš„æ“ä½œè·¯å¾„ï¼ˆä»å¼€å§‹åˆ°ç»“æŸï¼‰
- [ ] **æ¢å¤/é‡ç½®æµ‹è¯•**ï¼šæ¸…é™¤æ¡ä»¶åèƒ½æ¢å¤åˆå§‹çŠ¶æ€
- [ ] **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼šç©ºå€¼ã€æç«¯å€¼ã€æ— ç»“æœåœºæ™¯
- [ ] **é˜²å‘†æµ‹è¯•**ï¼šè¯¯æ“ä½œæ—¶æœ‰æç¤ºã€å¯å–æ¶ˆ
- [ ] **çŠ¶æ€ä¸€è‡´æ€§æµ‹è¯•**ï¼šæ“ä½œå UI å’Œæ•°æ®ä¿æŒåŒæ­¥

### ç­›é€‰åŠŸèƒ½å¿…é¡»æµ‹è¯•

- [ ] è®¾ç½®ç­›é€‰ â†’ æŸ¥çœ‹ç»“æœæ•°é‡å˜åŒ–
- [ ] æ¸…é™¤ç­›é€‰ â†’ æ¢å¤å…¨éƒ¨æ•°æ®
- [ ] å¤šæ¡ä»¶ç»„åˆ â†’ ç»“æœæ­£ç¡®
- [ ] é‡ç½®æŒ‰é’® â†’ æ‰€æœ‰æ¡ä»¶æ¸…ç©º
- [ ] æ—¥æœŸå˜æ›´ â†’ è‡ªåŠ¨/æ‰‹åŠ¨è§¦å‘æœç´¢

### è¡¨å•æ“ä½œå¿…é¡»æµ‹è¯•

- [ ] æäº¤æˆåŠŸ â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
- [ ] æäº¤å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- [ ] å–æ¶ˆæ“ä½œ â†’ æ•°æ®ä¸å˜
- [ ] é‡å¤æäº¤ â†’ é˜²æ­¢é‡å¤è¯·æ±‚

---

## ğŸ¯ æµ‹è¯•æ€ç»´è½¬å˜

| æ­»æ¿æµ‹è¯•æ€ç»´ | ç”¨æˆ·è¡Œä¸ºæµ‹è¯•æ€ç»´ |
|-------------|-----------------|
| "è¿™ä¸ªè¾“å…¥æ¡†èƒ½å¡«å€¼å—ï¼Ÿ" | "ç”¨æˆ·å¡«å®Œåèƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœå—ï¼Ÿ" |
| "æŒ‰é’®èƒ½ç‚¹å‡»å—ï¼Ÿ" | "ç‚¹å‡»åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç”¨æˆ·æ»¡æ„å—ï¼Ÿ" |
| "API è¢«è°ƒç”¨äº†å—ï¼Ÿ" | "API è¿”å›å UI æ­£ç¡®æ›´æ–°äº†å—ï¼Ÿ" |
| "åŠŸèƒ½å­˜åœ¨å—ï¼Ÿ" | "åŠŸèƒ½ç¬¦åˆç”¨æˆ·é¢„æœŸå—ï¼Ÿ" |
| "æµ‹è¯•é€šè¿‡äº†" | "ç”¨æˆ·èƒ½å®Œæˆä»–çš„å·¥ä½œå—ï¼Ÿ" |

---

## ğŸ”´ è§„åˆ™ E2E-USER-006ï¼šåˆ†é¡µå’Œæ•°æ®å®Œæ•´æ€§éªŒè¯

### é—®é¢˜èƒŒæ™¯

**çœŸå®æ¡ˆä¾‹**ï¼šç”¨æˆ·é€‰æ‹©æ—¥æœŸèŒƒå›´ `2/01 ~ 2/02`ï¼Œä½†åªçœ‹åˆ°2æœˆ1æ—¥çš„æ•°æ®ã€‚
- åŸå› ï¼šAPIé»˜è®¤åªè¿”å›20æ¡ï¼Œ2æœˆ1æ—¥æœ‰å¾ˆå¤šè®°å½•ï¼Œ2æœˆ2æ—¥çš„æ•°æ®åœ¨ç¬¬2é¡µ
- æµ‹è¯•æ²¡å‘ç°ï¼šå› ä¸ºåªéªŒè¯äº†"æœ‰æ•°æ®è¿”å›"ï¼Œæ²¡æœ‰éªŒè¯"æ•°æ®æ˜¯å¦è¦†ç›–æ‰€é€‰èŒƒå›´"

### å¿…é¡»æµ‹è¯•çš„åˆ†é¡µåœºæ™¯

```javascript
// âœ… åˆ†é¡µåŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•
test('åˆ†é¡µåŠŸèƒ½å…è®¸ç”¨æˆ·æŸ¥çœ‹æ‰€æœ‰æ•°æ®', async ({ page }) => {
  // 1. éªŒè¯åˆ†é¡µç»„ä»¶å­˜åœ¨
  const pagination = page.locator('.pagination, [class*="page"]')
  await expect(pagination).toBeVisible()
  
  // 2. éªŒè¯æ˜¾ç¤ºæ€»æ•°å’Œå½“å‰èŒƒå›´
  const totalText = page.locator('text=/å…±.*æ¡/')
  await expect(totalText).toBeVisible()
  
  // 3. éªŒè¯å¯ä»¥åˆ‡æ¢æ¯é¡µæ•°é‡
  const pageSizeSelector = page.locator('select').filter({ hasText: /æ¡\/é¡µ/ })
  if (await pageSizeSelector.isVisible()) {
    await pageSizeSelector.selectOption('50')
    await page.waitForTimeout(1500)
    const rowCount = await page.locator('tbody tr').count()
    expect(rowCount).toBeLessThanOrEqual(50)
  }
  
  // 4. éªŒè¯å¯ä»¥ç¿»é¡µ
  const nextBtn = page.locator('button:has-text("ä¸‹ä¸€é¡µ")')
  if (await nextBtn.isEnabled()) {
    await nextBtn.click()
    await page.waitForTimeout(1500)
    // éªŒè¯æ•°æ®å˜åŒ–
  }
})
```

### æ—¥æœŸç­›é€‰ + åˆ†é¡µçš„å®Œæ•´éªŒè¯

```javascript
// âœ… éªŒè¯æ—¥æœŸç­›é€‰åæ•°æ®è¦†ç›–æ‰€é€‰èŒƒå›´
test('æ—¥æœŸèŒƒå›´ç­›é€‰æ˜¾ç¤ºèŒƒå›´å†…æ‰€æœ‰æ—¥æœŸçš„æ•°æ®', async ({ page }) => {
  // è®¾ç½®æ—¥æœŸèŒƒå›´
  await page.fill('input[type="date"]:first-of-type', '2026-02-01')
  await page.fill('input[type="date"]:last-of-type', '2026-02-02')
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(2000)
  
  // æ”¶é›†æ‰€æœ‰é¡µçš„æ—¥æœŸ
  const allDates = new Set()
  let hasNextPage = true
  
  while (hasNextPage) {
    // è·å–å½“å‰é¡µæ‰€æœ‰æ—¥æœŸ
    const dates = await page.locator('tbody tr td:nth-child(7)').allTextContents()
    dates.forEach(d => allDates.add(d.split(' ')[0]))  // åªä¿ç•™æ—¥æœŸéƒ¨åˆ†
    
    // å°è¯•ç¿»é¡µ
    const nextBtn = page.locator('button:has-text("ä¸‹ä¸€é¡µ")')
    if (await nextBtn.isEnabled()) {
      await nextBtn.click()
      await page.waitForTimeout(1000)
    } else {
      hasNextPage = false
    }
  }
  
  // âœ… ä¸šåŠ¡éªŒè¯ï¼šåº”è¯¥åŒ…å«èŒƒå›´å†…çš„å¤šä¸ªæ—¥æœŸ
  console.log('å‘ç°çš„æ—¥æœŸ:', [...allDates])
  // å¦‚æœèŒƒå›´æ˜¯2å¤©ä½†åªæœ‰1å¤©çš„æ—¥æœŸï¼Œå¯èƒ½éœ€è¦ç¿»é¡µæˆ–æ•°æ®ç¡®å®åªæœ‰1å¤©
})
```

### åˆ†é¡µæµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] åˆ†é¡µç»„ä»¶å¯è§ä¸”åŠŸèƒ½æ­£å¸¸ï¼Ÿ
- [ ] æ˜¾ç¤ºæ€»è®°å½•æ•°ï¼Ÿ
- [ ] æ˜¾ç¤ºå½“å‰é¡µ/æ€»é¡µæ•°ï¼Ÿ
- [ ] å¯ä»¥åˆ‡æ¢æ¯é¡µæ•°é‡ï¼ˆ20/50/100ï¼‰ï¼Ÿ
- [ ] ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®æ­£å¸¸å·¥ä½œï¼Ÿ
- [ ] é¦–é¡µ/æœ«é¡µæŒ‰é’®æ­£å¸¸å·¥ä½œï¼Ÿ
- [ ] ç­›é€‰ååˆ†é¡µé‡ç½®åˆ°ç¬¬1é¡µï¼Ÿ

---

## ğŸ”´ è§„åˆ™ E2E-USER-007ï¼šéªŒè¯ç”¨æˆ·èƒ½å®Œæˆå®Œæ•´å·¥ä½œæµ

### æ ¸å¿ƒé—®é¢˜

æµ‹è¯•ä¸åº”è¯¥åªéªŒè¯"åŠŸèƒ½å­˜åœ¨"ï¼Œè€Œè¦éªŒè¯"ç”¨æˆ·èƒ½ç”¨è¿™ä¸ªåŠŸèƒ½å®Œæˆä»–çš„å·¥ä½œ"ã€‚

| æ­»æ¿éªŒè¯ | ç”¨æˆ·å·¥ä½œæµéªŒè¯ |
|---------|---------------|
| æ—¥æœŸè¾“å…¥æ¡†èƒ½å¡«å€¼ | é€‰æ‹©æ—¥æœŸåèƒ½çœ‹åˆ°å¯¹åº”æ—¥æœŸçš„æ•°æ® |
| æœç´¢æŒ‰é’®èƒ½ç‚¹å‡» | æœç´¢åç»“æœç¬¦åˆæ¡ä»¶ |
| è¡¨æ ¼æœ‰æ•°æ® | æ•°æ®è¦†ç›–ç”¨æˆ·æœŸæœ›çš„èŒƒå›´ |
| åˆ†é¡µæŒ‰é’®å­˜åœ¨ | ç¿»é¡µåèƒ½çœ‹åˆ°æ›´å¤šæ•°æ® |

### å¿…é—®çš„æµ‹è¯•è®¾è®¡é—®é¢˜

ç¼–å†™æµ‹è¯•å‰ï¼Œé—®è‡ªå·±ï¼š

1. **ç”¨æˆ·æƒ³åšä»€ä¹ˆï¼Ÿ** â†’ æŸ¥çœ‹2æœˆ1æ—¥~2æœˆ2æ—¥çš„æ‰€æœ‰æ¶ˆè´¹è®°å½•
2. **ç”¨æˆ·æ€ä¹ˆæ“ä½œï¼Ÿ** â†’ é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼Œç‚¹å‡»æœç´¢
3. **ç”¨æˆ·æœŸæœ›ä»€ä¹ˆç»“æœï¼Ÿ** â†’ çœ‹åˆ°è¿™ä¸¤å¤©çš„æ‰€æœ‰è®°å½•
4. **å¦‚æœåªçœ‹åˆ°éƒ¨åˆ†æ•°æ®ï¼Œç”¨æˆ·æ€ä¹ˆçŸ¥é“ï¼Ÿ** â†’ åˆ†é¡µæ˜¾ç¤º"å…±Xæ¡"
5. **ç”¨æˆ·å¦‚ä½•æŸ¥çœ‹å…¨éƒ¨ï¼Ÿ** â†’ ç¿»é¡µæˆ–è°ƒæ•´æ¯é¡µæ•°é‡

### æ ‡å‡†æµ‹è¯•æ¨¡æ¿

```javascript
/**
 * ç”¨æˆ·å·¥ä½œæµæµ‹è¯•æ¨¡æ¿
 * 
 * ç›®æ ‡ï¼šéªŒè¯ç”¨æˆ·èƒ½å®Œæˆ[å…·ä½“å·¥ä½œä»»åŠ¡]
 * ç”¨æˆ·è§’è‰²ï¼š[è¿è¥äººå‘˜/ç®¡ç†å‘˜/æ™®é€šç”¨æˆ·]
 * å‰ç½®æ¡ä»¶ï¼š[å·²ç™»å½•/æœ‰æ•°æ®ç­‰]
 */
test('è¿è¥äººå‘˜èƒ½æŸ¥çœ‹æŒ‡å®šæ—¥æœŸèŒƒå›´çš„æ‰€æœ‰æ¶ˆè´¹è®°å½•', async ({ page }) => {
  // 1. ç”¨æˆ·æ„å›¾ï¼šæŸ¥çœ‹2æœˆ1æ—¥~2æ—¥çš„æ¶ˆè´¹è®°å½•
  const startDate = '2026-02-01'
  const endDate = '2026-02-02'
  
  // 2. ç”¨æˆ·æ“ä½œï¼šè®¾ç½®ç­›é€‰æ¡ä»¶
  await page.fill('input[type="date"]:first-of-type', startDate)
  await page.fill('input[type="date"]:last-of-type', endDate)
  await page.click('button:has-text("æœç´¢")')
  await page.waitForTimeout(2000)
  
  // 3. éªŒè¯ç»“æœï¼šç”¨æˆ·èƒ½çœ‹åˆ°æ•°æ®
  const totalText = await page.locator('text=/å…±.*æ¡/').textContent()
  console.log(`ğŸ“Š ç­›é€‰ç»“æœ: ${totalText}`)
  
  // 4. éªŒè¯åˆ†é¡µï¼šç”¨æˆ·çŸ¥é“æœ‰å¤šå°‘æ•°æ®
  const paginationInfo = page.locator('text=/ç¬¬.*é¡µ/')
  await expect(paginationInfo).toBeVisible()
  
  // 5. éªŒè¯å®Œæ•´æ€§ï¼šå¦‚æœæœ‰å¤šé¡µï¼Œç”¨æˆ·èƒ½ç¿»é¡µæŸ¥çœ‹
  const nextBtn = page.locator('button:has-text("ä¸‹ä¸€é¡µ")')
  if (await nextBtn.isEnabled()) {
    console.log('â„¹ï¸ æ•°æ®è¶…è¿‡1é¡µï¼Œç”¨æˆ·å¯ä»¥ç¿»é¡µæŸ¥çœ‹æ›´å¤š')
  }
  
  // 6. éªŒè¯é‡ç½®ï¼šç”¨æˆ·èƒ½æ¢å¤æŸ¥çœ‹å…¨éƒ¨
  await page.click('button:has-text("é‡ç½®")')
  await page.waitForTimeout(1500)
  const restoredTotal = await page.locator('text=/å…±.*æ¡/').textContent()
  console.log(`ğŸ“Š é‡ç½®å: ${restoredTotal}`)
})
```

---

---

