---
alwaysApply: true
lastUpdated: 2025å¹´10æœˆ13æ—¥ 20:19:57
---

# â° æ—¥æœŸæ—¶é—´å¤„ç†æ ‡å‡†ï¼ˆä¸­å›½åŒºåŸŸ - åŒ—äº¬æ—¶é—´ç»Ÿä¸€è§„èŒƒï¼‰

## ğŸ”´ **åŸºäºå®é™…æ—¶é—´å¤„ç†é—®é¢˜çš„æ ‡å‡†åŒ–ä½“ç³»**

### **å®é™…å‘ç°çš„æ—¶é—´å¤„ç†é—®é¢˜ç»Ÿè®¡**
ä»11ä¸ªcursoræ–‡æ¡£æ·±åº¦åˆ†æå‘ç°ï¼š
- **æ—¶åŒºä¸ä¸€è‡´é—®é¢˜**: æ··ç”¨UTCå’ŒGMT+8æ—¶é—´ï¼Œå‡ºç°15+æ¬¡
- **æ•°æ®åº“æ—¶é—´å­—æ®µæ··ç”¨**: `NOW()` vs `new Date()`æ··ç”¨ï¼Œå¯¼è‡´æ—¶åŒºä¸ä¸€è‡´8æ¬¡
- **æ—¥æœŸæ ¼å¼ä¸ç»Ÿä¸€**: ISOæ ¼å¼ã€æœ¬åœ°æ ¼å¼ã€UTCå­—ç¬¦ä¸²æ ¼å¼æ··ç”¨12+æ¬¡
- **ä¸´æ—¶IDæ—¶é—´æˆ³å†²çª**: `Date.now()`é«˜é¢‘ä½¿ç”¨å¯èƒ½å¯¼è‡´é‡å¤IDï¼Œå‘ç°20+å¤„
- **æ—¥æœŸèŒƒå›´æŸ¥è¯¢å¤æ‚**: å¤æ‚çš„æ—¶é—´è®¡ç®—ä»£ç ï¼Œå®¹æ˜“å‡ºé”™6æ¬¡

### **å®é™…å‘ç°çš„æ—¶åŒºæ··ä¹±æ¨¡å¼**
```markdown
# cursoræ–‡æ¡£ä¸­å‘ç°çš„å®é™…æ—¶åŒºä¸ä¸€è‡´é—®é¢˜ï¼š

## é—®é¢˜1ï¼šå¯¼å‡ºæ—¶é—´ vs åº”ç”¨æ—¶é—´ä¸ä¸€è‡´
å¯¼å‡ºæ—¶é—´ï¼š_Exported on 2025/8/13 at GMT+8 6:41:06_
åº”ç”¨æ—¶é—´ï¼š**æ›´æ–°æ—¶é—´**ï¼š2025å¹´08æœˆ05æ—¥ 23:03:15 UTC

## é—®é¢˜2ï¼šæ··åˆæ—¶é—´æ ¼å¼å’Œæ—¶åŒº
- `new Date().toLocaleString()` (æœ¬åœ°æ—¶é—´ï¼Œæ—¶åŒºä¸ç¡®å®š)
- `new Date().toISOString()` (UTCæ—¶é—´ï¼Œéœ€è¦è½¬æ¢)
- `NOW()` (æ•°æ®åº“æœåŠ¡å™¨æ—¶é—´)
- æ‰‹åŠ¨æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²
```

## ğŸ‡¨ğŸ‡³ **æ—¶åŒºä¸€è‡´æ€§å¼ºåˆ¶è§„èŒƒï¼ˆä¸­å›½åŒºåŸŸä¸“ç”¨ï¼‰**

### **å…¨ç³»ç»ŸåŒ—äº¬æ—¶é—´æ ‡å‡†åŒ–**
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šå…¨ç³»ç»Ÿç»Ÿä¸€ä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆGMT+8/Asia/Shanghaiï¼‰
const BEIJING_TIME_STANDARD_SYSTEM = {
  // ç³»ç»Ÿæ—¶é—´é…ç½®æ ‡å‡†
  timeConfig: {
    // å†…éƒ¨å­˜å‚¨ï¼šå§‹ç»ˆåŒ—äº¬æ—¶é—´ï¼ˆGMT+8ï¼‰
    storage: 'Asia/Shanghai',
    // æ•°æ®åº“ï¼šç»Ÿä¸€åŒ—äº¬æ—¶é—´è®¾ç½®
    database: { timezone: 'Asia/Shanghai', sessionTimeZone: '+08:00' },
    // å‰ç«¯æ˜¾ç¤ºï¼šåŒ—äº¬æ—¶é—´
    display: { userTimeZone: 'Asia/Shanghai', format: 'YYYY-MM-DD HH:mm:ss' },
    // APIä¼ è¾“ï¼šISO8601æ ¼å¼ï¼ˆåŒ…å«+08:00æ—¶åŒºä¿¡æ¯ï¼‰
    api: { format: 'ISO8601', timezone: 'Asia/Shanghai' }
  },

  // ç»Ÿä¸€æ—¶é—´åˆ›å»ºå‡½æ•°
  createTime: {
    // åŒ—äº¬æ—¶é—´åˆ›å»ºï¼ˆç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ï¼‰
    beijing: () => {
      return new Date().toLocaleString('zh-CN', { 
        timeZone: 'Asia/Shanghai',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });
    },
    
    // ISOæ ¼å¼åŒ—äº¬æ—¶é—´ï¼ˆAPIä¼ è¾“ï¼‰
    beijingISO: () => {
      const date = new Date();
      const beijingDate = new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
      return beijingDate.toISOString().replace('Z', '+08:00');
    },
    
    // æ•°æ®åº“æ—¶é—´ï¼ˆä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼‰
    database: () => {
      const date = new Date();
      return new Date(date.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
    },
    
    // æ˜¾ç¤ºæ—¶é—´ï¼ˆç”¨æˆ·ç•Œé¢ - åŒ—äº¬æ—¶é—´ï¼‰
    display: (dateTime) => {
      const date = typeof dateTime === 'string' ? new Date(dateTime) : dateTime;
      return date.toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });
    }
  },

  // ç¦ç”¨çš„æ—¶é—´å¤„ç†æ–¹å¼ï¼ˆåŸºäºå®é™…é—®é¢˜å‘ç°ï¼‰
  forbiddenPatterns: [
    'new Date().toLocaleString()',  // æœ¬åœ°æ—¶é—´ï¼Œæ—¶åŒºä¸ç¡®å®š
    'toUTCString()',                // UTCæ—¶é—´ï¼Œä¸é€‚ç”¨äºä¸­å›½åŒºåŸŸ
    'getTime()',                    // æ—¶é—´æˆ³ï¼Œä¸åŒ…å«æ—¶åŒºä¿¡æ¯
    'toString()'                    // åŒ…å«æ—¶åŒºä¿¡æ¯ï¼Œæ ¼å¼ä¸ç»Ÿä¸€
  ],

  // æ¨èçš„æ—¶é—´å¤„ç†æ–¹å¼
  recommendedPatterns: [
    'BEIJING_TIME_STANDARD_SYSTEM.createTime.beijing()',
    'BEIJING_TIME_STANDARD_SYSTEM.createTime.beijingISO()',
    'new Date().toLocaleString("zh-CN", { timeZone: "Asia/Shanghai" })',
    'Intl.DateTimeFormat("zh-CN", { timeZone: "Asia/Shanghai" }).format(date)'
  ],

  // éªŒè¯æ—¶é—´å¤„ç†ä»£ç è§„èŒƒæ€§
  validateTimeUsage: (codeContent) => {
    const violations = [];
    
    BEIJING_TIME_STANDARD_SYSTEM.forbiddenPatterns.forEach(pattern => {
      if (codeContent.includes(pattern)) {
        violations.push(`ç¦ç”¨æ¨¡å¼: ${pattern}`);
      }
    });

    if (violations.length > 0) {
      console.error('ğŸš« æ—¶é—´å¤„ç†ä»£ç è¿è§„:');
      violations.forEach(v => console.error(`   âŒ ${v}`));
      console.error('ğŸ’¡ æ¨èä½¿ç”¨:');
      BEIJING_TIME_STANDARD_SYSTEM.recommendedPatterns.forEach(p => 
        console.error(`   âœ… ${p}`)
      );
      return false;
    }

    console.log('âœ… æ—¶é—´å¤„ç†ä»£ç ç¬¦åˆåŒ—äº¬æ—¶é—´è§„èŒƒ');
    return true;
  }
};
```

## ğŸ“… **æ—¥æœŸæ ¼å¼ç»Ÿä¸€è§„èŒƒï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **æ ‡å‡†åŒ–æ—¥æœŸæ ¼å¼å®šä¹‰å’Œå¤„ç†**
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šç»Ÿä¸€æ—¥æœŸæ ¼å¼æ ‡å‡†ç³»ç»Ÿï¼ˆåŒ—äº¬æ—¶é—´GMT+8ï¼‰
const DATE_FORMAT_STANDARD_SYSTEM = {
  // æ ‡å‡†æ ¼å¼å®šä¹‰
  formats: {
    // ISOæ ¼å¼ï¼šç³»ç»Ÿå†…éƒ¨ä¼ è¾“ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    iso: {
      format: 'YYYY-MM-DDTHH:mm:ss.sss+08:00',
      example: '2025-10-13T20:19:57.000+08:00',
      usage: 'APIä¼ è¾“ã€æ•°æ®åº“å­˜å‚¨ã€æ—¥å¿—è®°å½•'
    },
    // æ˜¾ç¤ºæ ¼å¼ï¼šç”¨æˆ·ç•Œé¢ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    display: {
      format: 'YYYY-MM-DD HH:mm:ss',
      example: '2025-10-13 20:19:57', 
      usage: 'å‰ç«¯æ˜¾ç¤ºã€æŠ¥è¡¨ç”Ÿæˆã€ç”¨æˆ·é€šçŸ¥'
    },
    // ä¸­æ–‡æ˜¾ç¤ºæ ¼å¼ï¼šç”¨æˆ·å‹å¥½ç•Œé¢
    displayCN: {
      format: 'YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss',
      example: '2025å¹´10æœˆ13æ—¥ 20:19:57',
      usage: 'ç”¨æˆ·é€šçŸ¥ã€ç®¡ç†åå°ã€æŠ¥è¡¨æ ‡é¢˜'
    },
    // æ—¥æœŸæ ¼å¼ï¼šä»…æ—¥æœŸ
    date: {
      format: 'YYYY-MM-DD',
      example: '2025-10-13',
      usage: 'æ—¥æœŸé€‰æ‹©å™¨ã€æŠ¥è¡¨æ ‡é¢˜ã€ç»Ÿè®¡åˆ†ç»„'
    },
    // æ—¶é—´æ ¼å¼ï¼šä»…æ—¶é—´
    time: {
      format: 'HH:mm:ss',
      example: '20:19:57',
      usage: 'æ—¶é—´é€‰æ‹©å™¨ã€è¿è¡Œæ—¶é—´æ˜¾ç¤º'
    }
  },

  // ç»Ÿä¸€æ ¼å¼åŒ–å·¥å…·ç±»ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  formatter: {
    // è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ISOæ ¼å¼ï¼ˆç³»ç»Ÿå†…éƒ¨æ ‡å‡†ï¼‰
    toISO: (date) => {
      const d = typeof date === 'string' ? new Date(date) : date;
      const beijingDate = new Date(d.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
      return beijingDate.toISOString().replace('Z', '+08:00');
    },
    
    // è½¬æ¢ä¸ºæ˜¾ç¤ºæ ¼å¼ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    toDisplay: (date) => {
      const d = typeof date === 'string' ? new Date(date) : date;
      return new Intl.DateTimeFormat('zh-CN', {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        timeZone: 'Asia/Shanghai', hour12: false
      }).format(d).replace(/\//g, '-');
    },
    
    // è½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤ºæ ¼å¼ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    toDisplayCN: (date) => {
      const d = typeof date === 'string' ? new Date(date) : date;
      return d.toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });
    },
    
    // ä»…æ—¥æœŸæ ¼å¼ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    toDate: (date) => {
      const d = typeof date === 'string' ? new Date(date) : date;
      return d.toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        year: 'numeric', month: '2-digit', day: '2-digit'
      }).replace(/\//g, '-');
    },
    
    // ä»…æ—¶é—´æ ¼å¼ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    toTime: (date) => {
      const d = typeof date === 'string' ? new Date(date) : date;
      return d.toLocaleString('zh-CN', {
        timeZone: 'Asia/Shanghai',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });
    },
    
    // ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆå¦‚ï¼š1å°æ—¶å‰ï¼‰- åŸºäºåŒ—äº¬æ—¶é—´
    toRelative: (dateTime) => {
      const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
      const time = new Date(new Date(dateTime).toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
      const diffMs = now - time;
      const diffMinutes = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMinutes / 60);
      const diffDays = Math.floor(diffHours / 24);
      
      if (diffDays > 0) return `${diffDays}å¤©å‰`;
      if (diffHours > 0) return `${diffHours}å°æ—¶å‰`;  
      if (diffMinutes > 0) return `${diffMinutes}åˆ†é’Ÿå‰`;
      return 'åˆšåˆš';
    }
  }
};
```

## ğŸ†” **å®‰å…¨IDç”Ÿæˆè§„èŒƒ**

### **è§£å†³æ—¶é—´æˆ³å†²çªçš„IDç”Ÿæˆç³»ç»Ÿ**
```javascript
// ğŸ”´ è§£å†³cursoræ–‡æ¡£ä¸­å‘ç°çš„Date.now()å†²çªé£é™©
const SAFE_ID_GENERATION_SYSTEM = {
  // å†…éƒ¨è®¡æ•°å™¨ï¼ˆé¿å…é«˜å¹¶å‘å†²çªï¼‰
  _counter: 0,
  _sequence: 0,

  // IDç”Ÿæˆç­–ç•¥åº“
  strategies: {
    // é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼ˆåŒ…å«æ¯«ç§’+éšæœºæ•°+è®¡æ•°å™¨ï¼‰
    highPrecision: () => {
      const now = Date.now();
      const random = Math.random().toString(36).substr(2, 6);
      const counter = (SAFE_ID_GENERATION_SYSTEM._counter++ % 1000).toString().padStart(3, '0');
      return `${now}_${random}_${counter}`;
    },

    // UUID v4ï¼ˆå®Œå…¨éšæœºï¼Œæ— æ—¶é—´ä¾èµ–ï¼‰
    uuid: () => {
      return require('uuid').v4();
    },

    // é›ªèŠ±ç®—æ³•ï¼ˆåˆ†å¸ƒå¼å”¯ä¸€IDï¼‰
    snowflake: (workerId = 1, datacenterId = 1) => {
      const timestamp = Date.now() - 1640995200000; // 2022-01-01 epoch
      const sequence = (SAFE_ID_GENERATION_SYSTEM._sequence++ % 4096);
      
      return ((timestamp << 22) | (datacenterId << 17) | (workerId << 12) | sequence).toString();
    }
  },

  // ä¸šåŠ¡IDç”Ÿæˆå™¨
  generateBusinessId: {
    // æ¶ˆæ¯IDï¼šmsg_20251003170511_a1b2c3d4
    message: () => {
      const timestamp = DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(new Date());
      const uuid = require('uuid').v4().substr(0, 8);
      return `msg_${timestamp.replace(/[-:T.]/g, '')}_${uuid}`;
    },

    // ä¼šè¯IDï¼šsession_20251003_a1b2c3d4e5f6
    session: () => {
      const dateStr = DATE_FORMAT_STANDARD_SYSTEM.formatter.toDate(new Date()).replace(/-/g, '');
      const uuid = require('uuid').v4().substr(0, 12);
      return `session_${dateStr}_${uuid}`;
    },

    // ä¸´æ—¶IDï¼štemp_1728048311123_a1b2c3_001
    temporary: (prefix = 'temp') => {
      return `${prefix}_${SAFE_ID_GENERATION_SYSTEM.strategies.highPrecision()}`;
    },

    // äº‹åŠ¡IDï¼šç”¨äºæ•°æ®åº“äº‹åŠ¡è¿½è¸ª
    transaction: () => {
      return `tx_${SAFE_ID_GENERATION_SYSTEM.strategies.snowflake()}`;
    }
  }
};
```

## â±ï¸ **æ—¶é—´è®¡ç®—å·¥å…·ç±»æ ‡å‡†åŒ–ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **æ ‡å‡†æ—¶é—´è®¡ç®—å’ŒæŸ¥è¯¢å·¥å…·**
```javascript
// ğŸ”´ è§£å†³å¤æ‚æ—¶é—´è®¡ç®—çš„æ ‡å‡†åŒ–å·¥å…·ç±»ï¼ˆåŒ—äº¬æ—¶é—´GMT+8ï¼‰
class StandardTimeCalculator {
  // ä»Šæ—¥æ—¶é—´èŒƒå›´ï¼ˆåŒ—äº¬æ—¶é—´åŸºå‡†ï¼‰
  static getTodayRange() {
    const now = new Date();
    const beijingNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
    
    const start = new Date(beijingNow);
    start.setHours(0, 0, 0, 0);
    
    const end = new Date(beijingNow);
    end.setHours(23, 59, 59, 999);
    
    return {
      start: DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(start),
      end: DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(end),
      display: `${DATE_FORMAT_STANDARD_SYSTEM.formatter.toDate(start)} å…¨å¤©`
    };
  }

  // Nå¤©å‰çš„æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  static daysAgo(days) {
    const now = new Date();
    const beijingNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
    const past = new Date(beijingNow.getTime() - days * 24 * 60 * 60 * 1000);
    return DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(past);
  }

  // Nå°æ—¶å‰çš„æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  static hoursAgo(hours) {
    const now = new Date();
    const beijingNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
    const past = new Date(beijingNow.getTime() - hours * 60 * 60 * 1000);
    return DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(past);
  }

  // æ—¶é—´å·®è®¡ç®—ï¼ˆè¿”å›æ˜“è¯»æ ¼å¼ï¼‰
  static timeDifference(startTime, endTime) {
    const start = new Date(startTime);
    const end = new Date(endTime);
    const diffMs = end - start;
    
    if (diffMs < 0) return 'æ—¶é—´é¡ºåºé”™è¯¯';
    
    const seconds = Math.floor(diffMs / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    
    if (days > 0) return `${days}å¤©${hours % 24}å°æ—¶${minutes % 60}åˆ†é’Ÿ`;
    if (hours > 0) return `${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿ${seconds % 60}ç§’`;
    if (minutes > 0) return `${minutes}åˆ†é’Ÿ${seconds % 60}ç§’`;
    return `${seconds}ç§’`;
  }

  // æ•°æ®åº“æŸ¥è¯¢æ—¶é—´èŒƒå›´ç”Ÿæˆå™¨ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  static createQueryRange(period) {
    const now = new Date();
    const beijingNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Shanghai' }));
    
    const ranges = {
      today: StandardTimeCalculator.getTodayRange(),
      yesterday: {
        start: StandardTimeCalculator.daysAgo(1),
        end: StandardTimeCalculator.daysAgo(0)
      },
      lastWeek: {
        start: StandardTimeCalculator.daysAgo(7),
        end: DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(beijingNow)
      },
      lastMonth: {
        start: StandardTimeCalculator.daysAgo(30),
        end: DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(beijingNow)
      }
    };

    return ranges[period] || ranges.today;
  }
}

// æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹ï¼ˆæ›¿ä»£å¤æ‚çš„æ—¶é—´è®¡ç®—ï¼‰
const timeQueryExamples = {
  // ä»Šæ—¥æ•°æ®æŸ¥è¯¢
  todayData: () => ({
    created_at: {
      [Op.gte]: StandardTimeCalculator.getTodayRange().start,
      [Op.lte]: StandardTimeCalculator.getTodayRange().end
    }
  }),
  
  // æœ€è¿‘ä¸€å‘¨æ•°æ®
  recentData: (days = 7) => ({
    created_at: {
      [Op.gte]: StandardTimeCalculator.daysAgo(days)
    }
  })
};
```

## ğŸ“ **æ—¥å¿—æ—¶é—´æˆ³æ ‡å‡†åŒ–ç³»ç»Ÿï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **ç»Ÿä¸€æ—¥å¿—æ—¶é—´æ ¼å¼**
```javascript
// ğŸ”´ ç»Ÿä¸€æ—¥å¿—æ—¶é—´æˆ³æ ¼å¼ç³»ç»Ÿï¼ˆåŒ—äº¬æ—¶é—´GMT+8ï¼‰
class StandardLogger {
  // æ ¼å¼åŒ–åŒ—äº¬æ—¶é—´æ—¥å¿—æ—¶é—´æˆ³
  static formatLogTime() {
    const now = new Date();
    return now.toLocaleString('zh-CN', {
      timeZone: 'Asia/Shanghai',
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit', second: '2-digit',
      hour12: false
    });
  }

  static createLogEntry(level, message, data = {}) {
    const timestamp = StandardLogger.formatLogTime();
    const logEntry = {
      timestamp,
      level: level.toUpperCase(),
      message,
      ...data
    };

    // æ ‡å‡†åŒ–æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
    const formattedOutput = `[${timestamp}] ${logEntry.level}: ${message}`;
    
    if (Object.keys(data).length > 0) {
      console.log(formattedOutput, data);
    } else {
      console.log(formattedOutput);
    }

    return logEntry;
  }

  // æ ‡å‡†æ—¥å¿—çº§åˆ«æ–¹æ³•
  static info(message, data) { return StandardLogger.createLogEntry('info', message, data); }
  static warn(message, data) { return StandardLogger.createLogEntry('warn', message, data); }
  static error(message, data) { return StandardLogger.createLogEntry('error', message, data); }
  static debug(message, data) { return StandardLogger.createLogEntry('debug', message, data); }

  // æ“ä½œæ—¥å¿—ï¼ˆç”¨äºè®°å½•é‡è¦æ“ä½œï¼‰- åŒ—äº¬æ—¶é—´
  static operation(operationType, details) {
    return StandardLogger.createLogEntry('operation', `${operationType}æ“ä½œ`, {
      type: operationType,
      details: details,
      timestamp: StandardLogger.formatLogTime()
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹å’Œæ ‡å‡†ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
// âœ… æ­£ç¡®ä½¿ç”¨
StandardLogger.info('æœåŠ¡å¯åŠ¨', { port: 3000, env: 'development' });
// è¾“å‡º: [2025/10/13 20:19:57] INFO: æœåŠ¡å¯åŠ¨ { port: 3000, env: 'development' }

// âŒ ç¦æ­¢ä½¿ç”¨
// console.log('ğŸ“… æ—¶é—´:', new Date().toISOString()); // UTCæ—¶é—´ï¼Œä¸é€‚ç”¨äºä¸­å›½åŒºåŸŸ
// console.log('ğŸ“… æ—¶é—´:', new Date().toUTCString()); // UTCæ—¶é—´ï¼Œä¸é€‚ç”¨äºä¸­å›½åŒºåŸŸ
```

## â° **æ—¶é—´æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **å®‰å…¨æ—¶é—´æ•°æ®å¤„ç†ç³»ç»Ÿ**
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šæ—¶é—´æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†ç³»ç»Ÿï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
class TimeDataValidator {
  // æ—¶é—´æ ¼å¼éªŒè¯ï¼ˆæ”¯æŒåŒ—äº¬æ—¶é—´æ ¼å¼ï¼‰
  static isValidBeijingTime(timeString) {
    try {
      const date = new Date(timeString);
      if (isNaN(date.getTime())) return false;
      
      // éªŒè¯æ˜¯å¦åŒ…å«+08:00æ—¶åŒºä¿¡æ¯æˆ–ä¸ºæœ‰æ•ˆçš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²
      return timeString.includes('+08:00') || 
             timeString.match(/^\d{4}-\d{2}-\d{2}/) || 
             !isNaN(date.getTime());
    } catch {
      return false;
    }
  }

  // æ—¶é—´èŒƒå›´éªŒè¯
  static isValidRange(startTime, endTime) {
    try {
      const start = new Date(startTime);
      const end = new Date(endTime);
      return !isNaN(start.getTime()) && !isNaN(end.getTime()) && start <= end;
    } catch {
      return false;
    }
  }

  // å®‰å…¨æ—¶é—´è§£æï¼ˆè½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´ï¼‰
  static safeParse(timeString, defaultValue = null) {
    try {
      const date = new Date(timeString);
      if (isNaN(date.getTime())) {
        console.warn(`âš ï¸ æ— æ•ˆæ—¶é—´å­—ç¬¦ä¸²: ${timeString}`);
        return defaultValue;
      }
      // è¿”å›åŒ—äº¬æ—¶é—´ISOæ ¼å¼
      return DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(date);
    } catch (error) {
      console.error(`âŒ æ—¶é—´è§£æé”™è¯¯: ${error.message}`);
      return defaultValue;
    }
  }

  // æ—¶é—´èŒƒå›´å®‰å…¨è§£æï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
  static parseTimeRange(startTime, endTime) {
    const start = TimeDataValidator.safeParse(startTime);
    const end = TimeDataValidator.safeParse(endTime);
    
    if (!start || !end) {
      throw new Error('æ—¶é—´èŒƒå›´è§£æå¤±è´¥');
    }

    if (!TimeDataValidator.isValidRange(start, end)) {
      throw new Error('æ— æ•ˆçš„æ—¶é—´èŒƒå›´ï¼šå¼€å§‹æ—¶é—´å¿…é¡»æ—©äºç»“æŸæ—¶é—´');
    }

    return { start, end };
  }
}

// APIå‚æ•°æ—¶é—´éªŒè¯ä¸­é—´ä»¶ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
function validateTimeParamsMiddleware(req, res, next) {
  const { start_time, end_time } = req.query;
  
  try {
    if (start_time && !TimeDataValidator.isValidBeijingTime(start_time)) {
      return res.status(400).json({ 
        error: 'Invalid start_time format, use ISO 8601 with Beijing time (YYYY-MM-DDTHH:mm:ss.sss+08:00) or YYYY-MM-DD HH:mm:ss',
        example: '2025-10-13T20:19:57.000+08:00 or 2025-10-13 20:19:57'
      });
    }

    if (end_time && !TimeDataValidator.isValidBeijingTime(end_time)) {
      return res.status(400).json({ 
        error: 'Invalid end_time format, use ISO 8601 with Beijing time (YYYY-MM-DDTHH:mm:ss.sss+08:00) or YYYY-MM-DD HH:mm:ss',
        example: '2025-10-13T20:19:57.000+08:00 or 2025-10-13 20:19:57'
      });
    }

    if (start_time && end_time && !TimeDataValidator.isValidRange(start_time, end_time)) {
      return res.status(400).json({ 
        error: 'Invalid time range: start_time must be before end_time' 
      });
    }

    next();
  } catch (error) {
    return res.status(400).json({ error: error.message });
  }
}
```

## ğŸ’¾ **æ—¶é—´è®¡ç®—ç¼“å­˜ä¼˜åŒ–ç³»ç»Ÿ**

### **é¢‘ç¹æ—¶é—´è®¡ç®—ç»“æœç¼“å­˜**
```javascript
// ğŸ”´ æ—¶é—´è®¡ç®—ç¼“å­˜ç³»ç»Ÿï¼ˆæå‡æ€§èƒ½ï¼‰
class TimeCalculationCache {
  constructor() {
    this.cache = new Map();
    this.cacheTTL = 60000; // 1åˆ†é’Ÿç¼“å­˜
  }

  // ç¼“å­˜æ—¶é—´è®¡ç®—ç»“æœ
  getCachedCalculation(cacheKey, calculationFunction) {
    const cached = this.cache.get(cacheKey);
    const now = Date.now();
    
    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    if (cached && (now - cached.timestamp) < this.cacheTTL) {
      console.log(`ğŸ’¾ ä½¿ç”¨ç¼“å­˜: ${cacheKey} (${Math.round((now-cached.timestamp)/1000)}ç§’å‰)`);
      return cached.value;
    }
    
    // æ‰§è¡Œè®¡ç®—å¹¶ç¼“å­˜
    console.log(`â³ è®¡ç®—: ${cacheKey}`);
    const value = calculationFunction();
    
    this.cache.set(cacheKey, {
      value: value,
      timestamp: now
    });
    
    return value;
  }

  // å¸¸ç”¨æ—¶é—´è®¡ç®—çš„ç¼“å­˜æ–¹æ³•
  getTodayStart() {
    return this.getCachedCalculation('today_start', () => 
      StandardTimeCalculator.getTodayRange().start);
  }

  getTodayEnd() {
    return this.getCachedCalculation('today_end', () => 
      StandardTimeCalculator.getTodayRange().end);
  }

  getCurrentWeekStart() {
    return this.getCachedCalculation('week_start', () => {
      const now = new Date();
      const weekStart = new Date(now.getTime() - (now.getDay() * 24 * 60 * 60 * 1000));
      return DATE_FORMAT_STANDARD_SYSTEM.formatter.toISO(weekStart);
    });
  }

  // æ¸…ç†è¿‡æœŸç¼“å­˜
  cleanup() {
    const now = Date.now();
    for (const [key, item] of this.cache.entries()) {
      if (now - item.timestamp > this.cacheTTL) {
        this.cache.delete(key);
      }
    }
  }
}

// å…¨å±€æ—¶é—´ç¼“å­˜å®ä¾‹
const globalTimeCache = new TimeCalculationCache();
setInterval(() => globalTimeCache.cleanup(), 60000); // æ¯åˆ†é’Ÿæ¸…ç†è¿‡æœŸç¼“å­˜
```

## ğŸ§ª **æ—¶é—´å¤„ç†æµ‹è¯•éªŒè¯è§„èŒƒï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **æ—¶é—´å¤„ç†åŠŸèƒ½å•å…ƒæµ‹è¯•æ ‡å‡†**
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šæ—¶é—´å¤„ç†åŠŸèƒ½å¿…é¡»æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
describe('æ—¶é—´å¤„ç†æ ‡å‡†åŒ–æµ‹è¯•ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰', () => {
  describe('StandardTimeCalculator', () => {
    test('getTodayRangeè¿”å›ä»Šæ—¥åŒ—äº¬æ—¶é—´èŒƒå›´', () => {
      const range = StandardTimeCalculator.getTodayRange();
      // éªŒè¯åŒ…å«+08:00æ—¶åŒºä¿¡æ¯æˆ–ä¸ºåŒ—äº¬æ—¶é—´æ ¼å¼
      expect(range.start).toMatch(/\+08:00$|T00:00:00/);
      expect(range.end).toMatch(/\+08:00$|T23:59:59/);
      expect(range.display).toContain('å…¨å¤©');
    });

    test('daysAgoè®¡ç®—æ­£ç¡®çš„è¿‡å»æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰', () => {
      const threeDaysAgo = StandardTimeCalculator.daysAgo(3);
      const now = new Date();
      const past = new Date(threeDaysAgo);
      const diffDays = Math.floor((now - past) / (24 * 60 * 60 * 1000));
      expect(diffDays).toBeGreaterThanOrEqual(2);
      expect(diffDays).toBeLessThanOrEqual(4); // è€ƒè™‘æ—¶åŒºå·®å¼‚
    });

    test('timeDifferenceæ ¼å¼åŒ–æ—¶é—´å·®æ˜¾ç¤º', () => {
      const start = '2025-10-13T20:00:00.000+08:00';
      const end = '2025-10-13T20:05:11.000+08:00';
      const diff = StandardTimeCalculator.timeDifference(start, end);
      expect(diff).toBe('5åˆ†é’Ÿ11ç§’');
    });
  });

  describe('TimeDataValidator', () => {
    test('éªŒè¯åŒ—äº¬æ—¶é—´æ ¼å¼æ­£ç¡®æ€§', () => {
      expect(TimeDataValidator.isValidBeijingTime('2025-10-13T20:19:57.000+08:00')).toBe(true);
      expect(TimeDataValidator.isValidBeijingTime('2025-10-13 20:19:57')).toBe(true);
      expect(TimeDataValidator.isValidBeijingTime('2025-10-13')).toBe(true);
      expect(TimeDataValidator.isValidBeijingTime('invalid')).toBe(false);
    });

    test('éªŒè¯æ—¶é—´èŒƒå›´æ­£ç¡®æ€§', () => {
      const start = '2025-10-13T20:00:00.000+08:00';
      const end = '2025-10-13T20:05:11.000+08:00';
      expect(TimeDataValidator.isValidRange(start, end)).toBe(true);
      expect(TimeDataValidator.isValidRange(end, start)).toBe(false);
    });
  });

  describe('DATE_FORMAT_STANDARD_SYSTEM', () => {
    test('åŒ—äº¬æ—¶é—´æ ¼å¼åŒ–æ­£ç¡®', () => {
      const date = new Date('2025-10-13T20:19:57.000+08:00');
      const display = DATE_FORMAT_STANDARD_SYSTEM.formatter.toDisplay(date);
      expect(display).toMatch(/2025-10-13 \d{2}:\d{2}:\d{2}/);
    });

    test('ä¸­æ–‡æ˜¾ç¤ºæ ¼å¼æ­£ç¡®', () => {
      const date = new Date('2025-10-13T20:19:57.000+08:00');
      const displayCN = DATE_FORMAT_STANDARD_SYSTEM.formatter.toDisplayCN(date);
      expect(displayCN).toContain('2025');
      expect(displayCN).toContain('10');
      expect(displayCN).toContain('13');
    });
  });

  describe('SAFE_ID_GENERATION_SYSTEM', () => {
    test('ç”Ÿæˆçš„IDåº”è¯¥æ˜¯å”¯ä¸€çš„', () => {
      const ids = new Set();
      for (let i = 0; i < 1000; i++) {
        const id = SAFE_ID_GENERATION_SYSTEM.strategies.highPrecision();
        expect(ids.has(id)).toBe(false);
        ids.add(id);
      }
    });

    test('ä¸šåŠ¡IDæ ¼å¼åº”è¯¥æ­£ç¡®', () => {
      const messageId = SAFE_ID_GENERATION_SYSTEM.generateBusinessId.message();
      expect(messageId).toMatch(/^msg_\d{14}_[a-f0-9]{8}$/);
      
      const sessionId = SAFE_ID_GENERATION_SYSTEM.generateBusinessId.session();
      expect(sessionId).toMatch(/^session_\d{8}_[a-f0-9]{12}$/);
    });
  });
});
```

## ğŸ”„ **æ—¶é—´æ•°æ®è¿ç§»å·¥å…·ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **ç°æœ‰æ—¶é—´æ•°æ®è¿ç§»å’ŒéªŒè¯**
```sql
-- æ—¶åŒºæ•°æ®è¿ç§»å’ŒéªŒè¯è„šæœ¬
-- ğŸ”´ åŸºäºå®é™…æ—¶åŒºä¸ä¸€è‡´é—®é¢˜çš„è¿ç§»æ–¹æ¡ˆï¼ˆç»Ÿä¸€ä¸ºåŒ—äº¬æ—¶é—´ï¼‰

-- 1. è®¾ç½®æ•°æ®åº“æ—¶åŒºä¸ºåŒ—äº¬æ—¶é—´
SET time_zone = '+08:00';
SET SESSION time_zone = 'Asia/Shanghai';

-- 2. åˆ›å»ºè¿ç§»è„šæœ¬ï¼ˆç¡®ä¿æ‰€æœ‰æ—¶é—´æ•°æ®ä¸ºåŒ—äº¬æ—¶é—´ï¼‰
CREATE PROCEDURE MigrateTimeDataToBeijingTime()
BEGIN
  DECLARE done INT DEFAULT FALSE;
  DECLARE table_name VARCHAR(64);
  DECLARE time_column VARCHAR(64);
  
  -- å£°æ˜æ¸¸æ ‡éå†æ‰€æœ‰æ—¶é—´å­—æ®µ
  DECLARE time_cursor CURSOR FOR 
    SELECT TABLE_NAME, COLUMN_NAME 
    FROM INFORMATION_SCHEMA.COLUMNS 
    WHERE TABLE_SCHEMA = DATABASE() 
    AND DATA_TYPE IN ('datetime', 'timestamp');
  
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
  
  -- å¼€å¯äº‹åŠ¡
  START TRANSACTION;
  
  OPEN time_cursor;
  
  read_loop: LOOP
    FETCH time_cursor INTO table_name, time_column;
    IF done THEN
      LEAVE read_loop;
    END IF;
    
    -- ç¡®ä¿æ—¶é—´å­—æ®µå­˜å‚¨çš„æ˜¯åŒ—äº¬æ—¶é—´
    -- å¦‚æœæ•°æ®åŸæœ¬æ˜¯UTCï¼Œéœ€è¦åŠ 8å°æ—¶è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´
    SET @sql = CONCAT('UPDATE ', table_name, 
                     ' SET ', time_column, ' = DATE_ADD(', time_column, ', INTERVAL 8 HOUR)',
                     ' WHERE ', time_column, ' IS NOT NULL');
    PREPARE stmt FROM @sql;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
    
  END LOOP;
  
  CLOSE time_cursor;
  COMMIT;
  
  SELECT 'âœ… æ—¶åŒºæ•°æ®è¿ç§»å®Œæˆï¼ˆåŒ—äº¬æ—¶é—´ï¼‰' as result;
END;

-- 3. éªŒè¯è¿ç§»ç»“æœï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
SELECT 
  'users' as table_name,
  COUNT(*) as total_records,
  MIN(created_at) as earliest_time,
  MAX(created_at) as latest_time,
  DATE_FORMAT(created_at, '%Y-%m-%d %H:%i:%s') as sample_time
FROM users
LIMIT 1;

-- 4. éªŒè¯æ—¶åŒºè®¾ç½®
SELECT @@global.time_zone, @@session.time_zone;

-- 5. ç¡®ä¿æ‰€æœ‰æ–°è®°å½•ä½¿ç”¨åŒ—äº¬æ—¶é—´
-- åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œï¼š
-- SET time_zone = '+08:00';
```

## ğŸ“‹ **æ—¶é—´å¤„ç†å®æ–½æ£€æŸ¥æ¸…å•ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰**

### **æ¯æ¬¡æ—¶é—´ç›¸å…³å¼€å‘å‰**
- [ ] ç¡®è®¤ä½¿ç”¨**åŒ—äº¬æ—¶é—´ï¼ˆGMT+8/Asia/Shanghaiï¼‰**ä½œä¸ºå†…éƒ¨å­˜å‚¨æ ‡å‡†
- [ ] éªŒè¯æ—¶é—´æ ¼å¼ä½¿ç”¨ISO8601æ ‡å‡†ï¼ˆåŒ…å«+08:00æ—¶åŒºä¿¡æ¯ï¼‰
- [ ] æ£€æŸ¥æ—¶åŒºå¤„ç†çš„ä¸€è‡´æ€§ï¼ˆç»Ÿä¸€ä½¿ç”¨Asia/Shanghaiï¼‰
- [ ] å‡†å¤‡æ—¶é—´æ•°æ®éªŒè¯æœºåˆ¶ï¼ˆæ”¯æŒåŒ—äº¬æ—¶é—´æ ¼å¼ï¼‰

### **æ•°æ®åº“æ—¶é—´å­—æ®µè®¾è®¡æ—¶**
- [ ] ä½¿ç”¨Sequelizeçš„DataTypes.DATEç±»å‹
- [ ] æ•°æ®åº“è¿æ¥é…ç½®ä¸­è®¾ç½® `timezone: '+08:00'`
- [ ] å»ºç«‹ç»Ÿä¸€çš„æ—¶é—´æŸ¥è¯¢æ–¹æ³•ï¼ˆä½¿ç”¨StandardTimeCalculatorï¼‰
- [ ] ç¡®ä¿æ•°æ®åº“ä¼šè¯æ—¶åŒºä¸º `Asia/Shanghai`

### **å‰ç«¯æ—¶é—´æ˜¾ç¤ºæ—¶**
- [ ] ç»Ÿä¸€æ˜¾ç¤ºåŒ—äº¬æ—¶é—´ï¼ˆä¸éœ€è¦æ—¶åŒºè½¬æ¢ï¼‰
- [ ] ä½¿ç”¨DATE_FORMAT_STANDARD_SYSTEM.formatteræ ¼å¼åŒ–å‡½æ•°
- [ ] æä¾›ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºé€‰é¡¹ï¼ˆå¦‚ï¼š1å°æ—¶å‰ï¼‰
- [ ] ä¸­æ–‡ç•Œé¢ä½¿ç”¨ä¸­æ–‡æ—¥æœŸæ ¼å¼ï¼ˆ2025å¹´10æœˆ13æ—¥ 20:19:57ï¼‰

### **APIæ—¶é—´å‚æ•°å¤„ç†æ—¶**
- [ ] å¼ºåˆ¶ä½¿ç”¨ISO8601æ ¼å¼ï¼ˆåŒ…å«+08:00æ—¶åŒºï¼‰
- [ ] æ·»åŠ æ—¶é—´å‚æ•°éªŒè¯ä¸­é—´ä»¶ï¼ˆvalidateTimeParamsMiddlewareï¼‰
- [ ] æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…å«åŒ—äº¬æ—¶é—´ç¤ºä¾‹ï¼‰
- [ ] è®°å½•æ—¶é—´ç›¸å…³çš„æ“ä½œæ—¥å¿—ï¼ˆä½¿ç”¨StandardLoggerï¼‰

### **é…ç½®æ–‡ä»¶æ£€æŸ¥**
- [ ] config/database.js ä¸­è®¾ç½® `timezone: '+08:00'`
- [ ] Sequelizeåˆå§‹åŒ–æ—¶è®¾ç½® `dialectOptions: { timezone: '+08:00' }`
- [ ] ç¡®ä¿ç¯å¢ƒå˜é‡ TZ='Asia/Shanghai'ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

---

**æ ¸å¿ƒåŸåˆ™**: åŒ—äº¬æ—¶é—´æ ‡å‡†åŒ–ã€æ ¼å¼å¼ºåˆ¶ç»Ÿä¸€ï¼ˆ+08:00ï¼‰ã€æ—¶åŒºå¤„ç†ä¸€è‡´ï¼ˆAsia/Shanghaiï¼‰ã€IDç”Ÿæˆå®‰å…¨ã€éªŒè¯æœºåˆ¶å®Œæ•´