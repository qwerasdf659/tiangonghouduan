# ğŸ—ï¸ åç«¯æŠ€æœ¯è§„èŒƒæ–‡æ¡£æ ‡å‡† - é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿv2.0

> **å¤šä¸šåŠ¡çº¿åˆ†å±‚å­˜å‚¨æ¶æ„æŠ€æœ¯è§„èŒƒ** - åŸºäºSealosäº‘åŸç”Ÿå¹³å°çš„ä¼ä¸šçº§åç«¯è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£åŸºæœ¬ä¿¡æ¯

### æ–‡æ¡£å®šä½

- **é€‚ç”¨é¡¹ç›®**ï¼šé¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿv2.0
- **æ¶æ„ç‰ˆæœ¬**ï¼šå¤šä¸šåŠ¡çº¿åˆ†å±‚å­˜å‚¨æ¶æ„ v2.0
- **æŠ€æœ¯æ ˆ**ï¼šNode.js + Express + MySQL + Sequelize + Sealoså¯¹è±¡å­˜å‚¨
- **æ›´æ–°æ—¶é—´**ï¼š2025å¹´07æœˆ29æ—¥ 23:52:11 UTC
- **ä½¿ç”¨æ¨¡å‹**ï¼šClaude Sonnet 4
- **åŸºäºä»£ç **ï¼šå®é™…è¿è¡Œçš„v2.0å®Œæ•´ä¸šåŠ¡æ¶æ„ä»£ç å®ç°ï¼ˆ10ä¸ªæ¨¡å‹+9ä¸ªä¸šåŠ¡æœåŠ¡ï¼‰

### ğŸ”´ æ ¸å¿ƒæ¶æ„ç‰¹æ€§v2.0ï¼ˆ2025å¹´07æœˆ29æ—¥å®Œæ•´å®ç°ï¼‰

- **å®Œæ•´ä¸šåŠ¡æœåŠ¡å±‚**ï¼šLotteryServiceã€ExchangeServiceã€TradeServiceã€AdminReviewServiceã€PointsServiceã€WebSocketService
- **å¤šä¸šåŠ¡çº¿æ”¯æŒ**ï¼šlotteryï¼ˆæŠ½å¥–ï¼‰ã€exchangeï¼ˆå…‘æ¢ï¼‰ã€tradeï¼ˆäº¤æ˜“ï¼‰ã€uploadsï¼ˆç”¨æˆ·ä¸Šä¼ ï¼‰ã€adminï¼ˆç®¡ç†å‘˜ï¼‰
- **æ™ºèƒ½åˆ†å±‚å­˜å‚¨**ï¼šhotï¼ˆçƒ­å­˜å‚¨ï¼‰ã€standardï¼ˆæ ‡å‡†å­˜å‚¨ï¼‰ã€archiveï¼ˆå½’æ¡£å­˜å‚¨ï¼‰
- **ç»Ÿä¸€èµ„æºç®¡ç†**ï¼šåŸºäºImageResourcesç»Ÿä¸€æ¨¡å‹çš„å›¾ç‰‡èµ„æºç®¡ç†
- **å®æ—¶é€šä¿¡æ”¯æŒ**ï¼šWebSocketæœåŠ¡ï¼Œæ”¯æŒç§¯åˆ†å˜åŠ¨ã€å®¡æ ¸ç»“æœã€åº“å­˜æ›´æ–°ç­‰å®æ—¶æ¨é€
- **äº‘åŸç”Ÿæ¶æ„**ï¼šåŸç”Ÿæ”¯æŒSealosäº‘å¹³å°éƒ¨ç½²å’Œå¯¹è±¡å­˜å‚¨
- **è‡ªåŠ¨åŒ–ç¼“å­˜**ï¼šè·¯å¾„ç”Ÿæˆç¼“å­˜ã€ä¸šåŠ¡é…ç½®ç¼“å­˜ã€ç”¨æˆ·åˆ†ç‰‡ç¼“å­˜

## ğŸ›ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### æ¶æ„å±‚æ¬¡åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APIç½‘å…³å±‚ (Express)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   è®¤è¯ä¸­é—´ä»¶     â”‚   å­—æ®µè½¬æ¢ä¸­é—´ä»¶   â”‚   é”™è¯¯å¤„ç†ä¸­é—´ä»¶  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸šåŠ¡è·¯ç”±å±‚ (v2 API)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   lottery   â”‚  exchange   â”‚    trade    â”‚   uploads   â”‚   â”‚
â”‚  â”‚   æŠ½å¥–ä¸šåŠ¡   â”‚   å…‘æ¢ä¸šåŠ¡   â”‚   äº¤æ˜“ä¸šåŠ¡   â”‚  ç”¨æˆ·ä¸Šä¼     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              resources ç»Ÿä¸€èµ„æºç®¡ç†API                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ ¸å¿ƒä¸šåŠ¡æœåŠ¡å±‚ (Business Services)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚LotteryServ  â”‚ExchangeServ â”‚ TradeServ   â”‚AdminReview  â”‚   â”‚
â”‚  â”‚  æŠ½å¥–æœåŠ¡    â”‚  å…‘æ¢æœåŠ¡    â”‚  äº¤æ˜“æœåŠ¡    â”‚  å®¡æ ¸æœåŠ¡    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PointsServ  â”‚          WebSocketService              â”‚   â”‚
â”‚  â”‚  ç§¯åˆ†æœåŠ¡    â”‚           å®æ—¶é€šä¿¡æœåŠ¡                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å­˜å‚¨æœåŠ¡å±‚ (Storage Services)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ImageResourceServâ”‚MultiBusinessPhotâ”‚  SealosStorageServ â”‚ â”‚
â”‚  â”‚  å›¾ç‰‡èµ„æºæœåŠ¡    â”‚   å¤šä¸šåŠ¡å­˜å‚¨æœåŠ¡  â”‚    Sealoså­˜å‚¨æœåŠ¡   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (Models)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ImageResources  â”‚ BusinessConfigs â”‚      Future         â”‚ â”‚
â”‚  â”‚  ç»Ÿä¸€èµ„æºæ¨¡å‹    â”‚   ä¸šåŠ¡é…ç½®æ¨¡å‹   â”‚     æ‰©å±•æ¨¡å‹        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å­˜å‚¨å±‚ (Storage Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MySQLæ•°æ®åº“    â”‚  Sealoså¯¹è±¡å­˜å‚¨  â”‚    ç¼“å­˜ç³»ç»Ÿ         â”‚ â”‚
â”‚  â”‚   å…ƒæ•°æ®å­˜å‚¨     â”‚   æ–‡ä»¶å­˜å‚¨       â”‚   å†…å­˜ç¼“å­˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡ç†å¿µv2.0

#### 1. ä¸šåŠ¡é¢†åŸŸé©±åŠ¨æ¶æ„

- **ä¸šåŠ¡åˆ†ç¦»**ï¼šæ¯ä¸ªä¸šåŠ¡çº¿ç‹¬ç«‹APIå’Œå­˜å‚¨ç­–ç•¥
- **ä¸Šä¸‹æ–‡è¾¹ç•Œ**ï¼šæ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œå’Œæ•°æ®æ‰€æœ‰æƒ
- **ç»Ÿä¸€æœåŠ¡**ï¼šé€šè¿‡ç»Ÿä¸€çš„èµ„æºæœåŠ¡å±‚å®ç°å…±äº«é€»è¾‘

#### 2. æ™ºèƒ½åˆ†å±‚å­˜å‚¨ç­–ç•¥

- **çƒ­å­˜å‚¨(hot)**ï¼šæ–°ä¸Šä¼ å’Œæ´»è·ƒèµ„æºï¼Œå¿«é€Ÿè®¿é—®ï¼ŒSSDå­˜å‚¨
- **æ ‡å‡†å­˜å‚¨(standard)**ï¼šä¸­æœŸå­˜å‚¨ï¼Œå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
- **å½’æ¡£å­˜å‚¨(archive)**ï¼šé•¿æœŸå­˜å‚¨ï¼Œä½æˆæœ¬ï¼ŒæŒ‰å¹´æœˆåˆ†ç»„

#### 3. äº‘åŸç”Ÿè®¾è®¡åŸåˆ™

- **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²å’Œè´Ÿè½½å‡è¡¡
- **é…ç½®å¤–éƒ¨åŒ–**ï¼šæ‰€æœ‰é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- **å¥åº·æ£€æŸ¥**ï¼šå®Œæ•´çš„å¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹
- **ä¼˜é›…å…³é—­**ï¼šæ”¯æŒSIGTERM/SIGINTä¿¡å·çš„ä¼˜é›…å…³é—­

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦ç»†è§„èŒƒ

### æ ¸å¿ƒæŠ€æœ¯æ ˆv2.0

| æŠ€æœ¯ç»„ä»¶  | ç‰ˆæœ¬è¦æ±‚     | ç”¨é€”           | é…ç½®è¦ç‚¹         |
| --------- | ------------ | -------------- | ---------------- |
| Node.js   | >=16.0.0     | è¿è¡Œæ—¶ç¯å¢ƒ     | ES2021è¯­æ³•æ”¯æŒ   |
| Express   | ^4.18.2      | Webæ¡†æ¶        | æ”¯æŒä¸­é—´ä»¶å’Œè·¯ç”± |
| Sequelize | ^6.35.2      | ORMæ¡†æ¶        | MySQLè¿æ¥æ± é…ç½®  |
| MySQL     | 8.0+         | å…³ç³»æ•°æ®åº“     | æ”¯æŒJSONå­—æ®µç±»å‹ |
| AWS SDK   | ^2.1691.0    | å¯¹è±¡å­˜å‚¨å®¢æˆ·ç«¯ | S3å…¼å®¹API        |
| Sharp     | ^0.32.6      | å›¾ç‰‡å¤„ç†       | é«˜æ€§èƒ½å›¾ç‰‡å¤„ç†   |
| JWT       | ^9.0.2       | è®¤è¯ä»¤ç‰Œ       | HMAC SHA256ç­¾å  |
| Multer    | ^1.4.5-lts.1 | æ–‡ä»¶ä¸Šä¼        | å†…å­˜å­˜å‚¨æ¨¡å¼     |

### ä¾èµ–ç®¡ç†è§„èŒƒ

```json
{
  "engines": {
    "node": ">=16.0.0",
    "npm": ">=8.0.0"
  },
  "scripts": {
    "start": "node app.js",
    "dev": "NODE_ENV=development nodemon app.js",
    "health": "curl -f http://localhost:3000/health || exit 1"
  }
}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è§„èŒƒv2.0

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### ImageResourcesç»Ÿä¸€èµ„æºæ¨¡å‹

```sql
CREATE TABLE `image_resources` (
  `resource_id` VARCHAR(36) NOT NULL,           -- UUIDä¸»é”®
  `business_type` ENUM('lottery','exchange','trade','uploads') NOT NULL,
  `category` VARCHAR(50) NOT NULL,              -- ä¸šåŠ¡åˆ†ç±»
  `context_id` INT NOT NULL,                    -- ä¸Šä¸‹æ–‡IDï¼ˆç”¨æˆ·ID/å•†å“IDç­‰ï¼‰
  `user_id` INT NULL,                           -- ä¸Šä¼ ç”¨æˆ·ID
  `storage_layer` ENUM('hot','standard','archive') DEFAULT 'hot',
  `file_path` VARCHAR(500) NOT NULL,            -- å­˜å‚¨è·¯å¾„
  `cdn_url` VARCHAR(500) NOT NULL,              -- CDNè®¿é—®URL
  `thumbnail_paths` JSON NULL,                  -- ç¼©ç•¥å›¾è·¯å¾„é›†åˆ
  `original_filename` VARCHAR(255) NOT NULL,    -- åŸå§‹æ–‡ä»¶å
  `file_size` INT NOT NULL,                     -- æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  `mime_type` VARCHAR(100) NOT NULL,            -- MIMEç±»å‹
  `dimensions` JSON NULL,                       -- å›¾ç‰‡å°ºå¯¸
  `status` ENUM('active','archived','deleted') DEFAULT 'active',
  `access_count` INT DEFAULT 0,                 -- è®¿é—®ç»Ÿè®¡
  `last_accessed_at` DATETIME NULL,             -- æœ€åè®¿é—®æ—¶é—´
  `metadata` JSON NULL,                         -- æ‰©å±•å…ƒæ•°æ®
  `review_status` ENUM('pending','approved','rejected') NULL,
  `reviewer_id` INT NULL,                       -- å®¡æ ¸å‘˜ID
  `review_reason` TEXT NULL,                    -- å®¡æ ¸è¯´æ˜
  `reviewed_at` DATETIME NULL,                  -- å®¡æ ¸æ—¶é—´
  `consumption_amount` DECIMAL(10,2) NULL,      -- æ¶ˆè´¹é‡‘é¢
  `points_awarded` INT NULL,                    -- å¥–åŠ±ç§¯åˆ†
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` DATETIME NULL,                   -- è½¯åˆ é™¤
  PRIMARY KEY (`resource_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### å…³é”®ç´¢å¼•è®¾è®¡

```sql
-- ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼•
CREATE INDEX `idx_business_category` ON `image_resources` (`business_type`, `category`);

-- ç”¨æˆ·ä¸Šä¼ æŸ¥è¯¢ç´¢å¼•
CREATE INDEX `idx_user_business` ON `image_resources` (`user_id`, `business_type`, `status`);

-- å®¡æ ¸å·¥ä½œå°ç´¢å¼•
CREATE INDEX `idx_review_status` ON `image_resources` (`review_status`, `business_type`, `created_at`);

-- å­˜å‚¨å±‚çº§ç´¢å¼•
CREATE INDEX `idx_storage_layer` ON `image_resources` (`storage_layer`, `created_at`);

-- ä¸Šä¸‹æ–‡æŸ¥è¯¢ç´¢å¼•
CREATE INDEX `idx_context_category` ON `image_resources` (`context_id`, `category`, `status`);
```

#### BusinessConfigsä¸šåŠ¡é…ç½®æ¨¡å‹

```sql
CREATE TABLE `business_configs` (
  `config_id` VARCHAR(36) NOT NULL,
  `business_type` ENUM('lottery','exchange','trade','uploads') NOT NULL,
  `config_key` VARCHAR(100) NOT NULL,
  `config_value` JSON NOT NULL,
  `description` TEXT NULL,
  `is_active` BOOLEAN DEFAULT TRUE,
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`config_id`),
  UNIQUE KEY `uk_business_key` (`business_type`, `config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### æ•°æ®åº“è¿æ¥é…ç½®

```javascript
// config/database.js - åŸºäºå®é™…ä»£ç é…ç½®
const config = {
  development: {
    host: process.env.DB_HOST || 'test-db-mysql.ns-br0za7uc.svc',
    port: process.env.DB_PORT || 3306,
    username: process.env.DB_USER || 'root',
    password: process.env.DB_PASSWORD || 'mc6r9cgb',
    database: process.env.DB_NAME || 'restaurant_points_dev',
    dialect: 'mysql',
    timezone: '+08:00',
    logging: process.env.NODE_ENV === 'development' ? console.log : false,
    pool: {
      max: 20,
      min: 0,
      acquire: 30000,
      idle: 10000
    },
    define: {
      charset: 'utf8mb4',
      collate: 'utf8mb4_unicode_ci',
      timestamps: true,
      underscored: false,
      freezeTableName: true
    }
  },
  production: {
    host: process.env.DB_HOST || 'dbconn.sealosbja.site',
    port: process.env.DB_PORT || 42182,
    username: process.env.DB_USER || 'root',
    password: process.env.DB_PASSWORD || 'mc6r9cgb',
    database: process.env.DB_NAME || 'restaurant_points_prod',
    dialect: 'mysql',
    timezone: '+08:00',
    logging: false,
    pool: {
      max: 50,
      min: 5,
      acquire: 60000,
      idle: 10000
    }
  }
}
```

## ğŸ¯ ä¸šåŠ¡æœåŠ¡å±‚è§„èŒƒ

### ImageResourceServiceæ ¸å¿ƒæœåŠ¡

```javascript
class ImageResourceService {
  constructor() {
    this.storageService = new MultiBusinessPhotoStorage()
    this.cache = new Map()
  }

  /**
   * åˆ›å»ºå›¾ç‰‡èµ„æº
   * @param {Object} resourceData - èµ„æºæ•°æ®
   * @param {Buffer} fileBuffer - æ–‡ä»¶ç¼“å†²åŒº
   * @param {Object} options - é…ç½®é€‰é¡¹
   */
  async createResource(resourceData, fileBuffer, options = {}) {
    // 1. æ–‡ä»¶éªŒè¯
    await this.validateFile(fileBuffer, resourceData)

    // 2. ç”Ÿæˆå­˜å‚¨è·¯å¾„
    const storagePath = await this.storageService.generateStoragePath(
      resourceData.businessType,
      resourceData.category,
      resourceData.contextId,
      options
    )

    // 3. ä¸Šä¼ åˆ°Sealoså­˜å‚¨
    const cdnUrl = await this.storageService.uploadImage(
      fileBuffer,
      resourceData.originalFilename,
      path.dirname(storagePath)
    )

    // 4. åˆ›å»ºæ•°æ®åº“è®°å½•
    const resource = await ImageResources.create({
      ...resourceData,
      file_path: storagePath,
      cdn_url: cdnUrl,
      storage_layer: this.getStorageLayer(storagePath)
    })

    return resource
  }
}
```

### MultiBusinessPhotoStorageåˆ†å±‚å­˜å‚¨æœåŠ¡

```javascript
class MultiBusinessPhotoStorage extends SealosStorageService {
  /**
   * æ™ºèƒ½å­˜å‚¨å±‚é€‰æ‹©ç®—æ³•
   */
  async selectStorageLayer(businessType, category, options) {
    const { uploadTime, isActive, priority } = options
    const config = await this.getBusinessConfig(businessType)

    // é«˜ä¼˜å…ˆçº§æ•°æ®ç›´æ¥ä½¿ç”¨çƒ­å­˜å‚¨
    if (priority === 'high' || isActive === true) {
      return 'hot'
    }

    // åŸºäºæ—¶é—´çš„æ™ºèƒ½åˆ¤æ–­
    const fileAge = (Date.now() - uploadTime) / (1000 * 60 * 60 * 24)

    // ä¸šåŠ¡ç‰¹å®šé€»è¾‘
    if (businessType === 'uploads' && category === 'pending_review') {
      return 'hot' // å¾…å®¡æ ¸å›¾ç‰‡éœ€è¦å¿«é€Ÿè®¿é—®
    }

    // åŸºäºæ–‡ä»¶å¹´é¾„åˆ¤æ–­å­˜å‚¨å±‚çº§
    if (fileAge <= config.hotDays) return 'hot'
    if (fileAge <= config.standardDays) return 'standard'
    return 'archive'
  }

  /**
   * æ„å»ºå®Œæ•´æ–‡ä»¶è·¯å¾„
   */
  buildFilePath(storageLayer, businessType, category, contextId, options) {
    const { uploadTime, originalName } = options
    const fileName = this.generateFileName(businessType, contextId, uploadTime, originalName)

    switch (storageLayer) {
      case 'hot':
        return `hot/${businessType}/${category}/${fileName}`

      case 'standard':
        if (businessType === 'uploads') {
          // ç”¨æˆ·ä¸Šä¼ ä½¿ç”¨åˆ†ç‰‡å­˜å‚¨
          const userShard = this.getUserShard(contextId)
          const datePath = this.getDatePath(uploadTime)
          return `standard/users/${userShard}/u${contextId}/${datePath}/${fileName}`
        } else {
          // ä¸šåŠ¡å›¾ç‰‡ä½¿ç”¨ä¸šåŠ¡åˆ†ç±»å­˜å‚¨
          return `standard/${businessType}/${category}/${fileName}`
        }

      case 'archive':
        const year = new Date(uploadTime).getFullYear()
        const month = (new Date(uploadTime).getMonth() + 1).toString().padStart(2, '0')
        return `archive/${year}/${month}/${businessType}/${category}/${fileName}`

      default:
        throw new Error(`æœªçŸ¥å­˜å‚¨å±‚çº§: ${storageLayer}`)
    }
  }
}
```

## ğŸ” è®¤è¯æˆæƒè§„èŒƒv2.0

### JWTè®¤è¯ä¸­é—´ä»¶

```javascript
const authenticateToken = async (req, res, next) => {
  try {
    const authHeader = req.headers.authorization
    const token = authHeader && authHeader.split(' ')[1] // Bearer TOKEN

    if (!token) {
      return res.status(401).json({
        code: 4001,
        msg: 'ç¼ºå°‘è®¿é—®ä»¤ç‰Œ',
        data: null
      })
    }

    const decoded = verifyAccessToken(token)
    if (!decoded) {
      return res.status(401).json({
        code: 4002,
        msg: 'è®¿é—®ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ',
        data: null
      })
    }

    // ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯
    const users = await sequelize.query(
      'SELECT user_id, mobile, nickname, status, is_admin FROM users WHERE user_id = ?',
      { replacements: [decoded.user_id], type: sequelize.QueryTypes.SELECT }
    )

    const user = users[0]
    if (!user || user.status === 'banned') {
      return res.status(401).json({
        code: 4003,
        msg: 'ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«ç¦ç”¨',
        data: null
      })
    }

    req.user = user
    req.token = decoded
    next()
  } catch (error) {
    console.error('è®¤è¯ä¸­é—´ä»¶é”™è¯¯:', error)
    res.status(500).json({
      code: 5000,
      msg: 'è®¤è¯æœåŠ¡å¼‚å¸¸',
      data: null
    })
  }
}
```

### æƒé™çº§åˆ«å®šä¹‰

| æƒé™çº§åˆ« | æ ‡è¯†å­—æ®µ        | æƒé™èŒƒå›´                 | é€‚ç”¨åœºæ™¯   |
| -------- | --------------- | ------------------------ | ---------- |
| æ™®é€šç”¨æˆ· | is_admin: false | æŸ¥çœ‹ã€ä¸Šä¼ è‡ªå·±çš„å†…å®¹     | ç”¨æˆ·ç«¯æ“ä½œ |
| ç®¡ç†å‘˜   | is_admin: true  | å…¨éƒ¨æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€å®¡æ ¸ | ç®¡ç†åå°   |

## ğŸŒ APIæ¥å£è®¾è®¡è§„èŒƒ

### RESTful APIè®¾è®¡åŸåˆ™

- **èµ„æºå¯¼å‘**ï¼šä»¥èµ„æºä¸ºä¸­å¿ƒçš„URLè®¾è®¡
- **HTTPåŠ¨è¯**ï¼šæ­£ç¡®ä½¿ç”¨GETã€POSTã€PUTã€DELETE
- **çŠ¶æ€ç **ï¼šç»Ÿä¸€çš„HTTPçŠ¶æ€ç è§„èŒƒ
- **ç‰ˆæœ¬æ§åˆ¶**ï¼š/api/v2å‰ç¼€è¿›è¡Œç‰ˆæœ¬ç®¡ç†

### ç»Ÿä¸€å“åº”æ ¼å¼

```javascript
// æˆåŠŸå“åº”
{
  "code": 0,
  "msg": "success",
  "data": {...},
  "timestamp": "2025-07-28T20:15:37.000Z"
}

// é”™è¯¯å“åº”
{
  "code": 1001,
  "msg": "å‚æ•°éªŒè¯å¤±è´¥",
  "data": null,
  "timestamp": "2025-07-28T20:15:37.000Z"
}
```

### ä¸šåŠ¡APIè·¯ç”±ç»“æ„

```
/api/v2/
â”œâ”€â”€ resources/              # ç»Ÿä¸€èµ„æºç®¡ç†API
â”‚   â”œâ”€â”€ POST /             # åˆ›å»ºèµ„æº
â”‚   â”œâ”€â”€ GET /              # æŸ¥è¯¢èµ„æºåˆ—è¡¨
â”‚   â”œâ”€â”€ GET /:resourceId   # è·å–å•ä¸ªèµ„æº
â”‚   â”œâ”€â”€ PUT /:resourceId   # æ›´æ–°èµ„æº
â”‚   â””â”€â”€ DELETE /:resourceId # åˆ é™¤èµ„æº
â”œâ”€â”€ lottery/               # æŠ½å¥–ä¸šåŠ¡API
â”‚   â”œâ”€â”€ GET /prizes/:prizeId
â”‚   â”œâ”€â”€ POST /prizes/:prizeId/images
â”‚   â”œâ”€â”€ GET /wheels
â”‚   â””â”€â”€ GET /banners
â”œâ”€â”€ exchange/              # å…‘æ¢ä¸šåŠ¡API
â”‚   â”œâ”€â”€ GET /products/:productId
â”‚   â”œâ”€â”€ POST /products/:productId/images
â”‚   â””â”€â”€ GET /categories
â”œâ”€â”€ trade/                 # äº¤æ˜“ä¸šåŠ¡API
â”‚   â”œâ”€â”€ GET /items/:itemId
â”‚   â”œâ”€â”€ POST /items/:itemId/images
â”‚   â””â”€â”€ GET /banners
â””â”€â”€ uploads/               # ç”¨æˆ·ä¸Šä¼ API
    â”œâ”€â”€ POST /submit
    â”œâ”€â”€ GET /my-submissions
    â””â”€â”€ GET /pending-reviews
```

## ğŸ”§ ä¸­é—´ä»¶ç³»ç»Ÿè§„èŒƒ

### å­—æ®µè½¬æ¢ä¸­é—´ä»¶

```javascript
// è‡ªåŠ¨å¤„ç†å‰åç«¯å­—æ®µæ˜ å°„
const fieldTransformMiddleware = createResponseTransformMiddleware({
  logTransformations: process.env.NODE_ENV === 'development',
  strictMode: process.env.NODE_ENV === 'production'
})

// è½¬æ¢è§„åˆ™ç¤ºä¾‹
const transformRules = {
  user_id: 'userId',
  created_at: 'createdAt',
  updated_at: 'updatedAt',
  file_size: 'fileSize',
  mime_type: 'mimeType'
}
```

### é”™è¯¯å¤„ç†ä¸­é—´ä»¶

```javascript
app.use((error, req, res, next) => {
  console.error('APIé”™è¯¯:', {
    message: error.message,
    stack: error.stack,
    url: req.url,
    method: req.method,
    ip: req.ip
  })

  if (error.name === 'ValidationError') {
    return res.status(400).json(ApiResponse.error(error.message, 'VALIDATION_ERROR'))
  }

  if (error.name === 'UnauthorizedError') {
    return res.status(401).json(ApiResponse.unauthorized())
  }

  res.status(500).json(ApiResponse.error('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯', 'INTERNAL_ERROR'))
})
```

## â˜ï¸ Sealoså¯¹è±¡å­˜å‚¨é›†æˆ

### å­˜å‚¨æœåŠ¡é…ç½®

```javascript
class SealosStorageService {
  constructor() {
    this.config = {
      endpoint: process.env.SEALOS_ENDPOINT || 'https://objectstorageapi.bja.sealos.run',
      bucket: 'br0za7uc-tiangong',
      accessKeyId: process.env.SEALOS_ACCESS_KEY || 'br0za7uc',
      secretAccessKey: process.env.SEALOS_SECRET_KEY || 'skxg8mk5gqfhf9xz'
    }

    this.s3 = new AWS.S3({
      endpoint: this.config.endpoint,
      accessKeyId: this.config.accessKeyId,
      secretAccessKey: this.config.secretAccessKey,
      region: process.env.SEALOS_REGION || 'bja',
      s3ForcePathStyle: true,
      signatureVersion: 'v4'
    })
  }
}
```

### æ–‡ä»¶ä¸Šä¼ å¤„ç†

```javascript
async uploadImage(fileBuffer, originalName, folder = 'photos') {
  try {
    const timestamp = Date.now();
    const hash = crypto.randomBytes(8).toString('hex');
    const ext = path.extname(originalName) || '.jpg';
    const fileName = `${folder}/${timestamp}_${hash}${ext}`;

    const uploadParams = {
      Bucket: this.config.bucket,
      Key: fileName,
      Body: fileBuffer,
      ContentType: this.getContentType(ext),
      ACL: 'public-read',
      CacheControl: 'max-age=31536000'
    };

    const result = await this.s3.upload(uploadParams).promise();
    return result.Location;
  } catch (error) {
    throw new Error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`);
  }
}
```

## ğŸ“Š ç¼“å­˜ç­–ç•¥è§„èŒƒ

### å¤šçº§ç¼“å­˜è®¾è®¡

```javascript
class CacheManager {
  constructor() {
    // è·¯å¾„ç”Ÿæˆç¼“å­˜ - 5åˆ†é’Ÿ
    this.pathCache = new Map()
    this.pathCacheExpiry = 5 * 60 * 1000

    // ä¸šåŠ¡é…ç½®ç¼“å­˜ - 10åˆ†é’Ÿ
    this.businessConfigCache = new Map()
    this.configCacheExpiry = 10 * 60 * 1000

    // ç”¨æˆ·åˆ†ç‰‡ç¼“å­˜ - é•¿æœŸæœ‰æ•ˆ
    this.userShardCache = new Map()

    this.maxCacheSize = 1000
  }

  /**
   * æ™ºèƒ½ç¼“å­˜æ¸…ç†
   */
  cleanExpiredCache() {
    const now = Date.now()
    let cleanedCount = 0

    // æ¸…ç†è¿‡æœŸçš„è·¯å¾„ç¼“å­˜
    for (const [key, value] of this.pathCache.entries()) {
      if (now - value.timestamp > this.pathCacheExpiry) {
        this.pathCache.delete(key)
        cleanedCount++
      }
    }

    if (cleanedCount > 0) {
      console.log(`ğŸ§¹ æ¸…ç†è¿‡æœŸç¼“å­˜: ${cleanedCount}é¡¹`)
    }
  }
}
```

## ğŸš€ éƒ¨ç½²å’Œè¿ç»´è§„èŒƒ

### ç¯å¢ƒé…ç½®

```bash
# åŸºç¡€ç¯å¢ƒå˜é‡
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆåŸºäºå®é™…é…ç½®ï¼‰
DB_HOST=test-db-mysql.ns-br0za7uc.svc
DB_PORT=3306
DB_NAME=restaurant_points_dev
DB_USER=root
DB_PASSWORD=mc6r9cgb

# Sealoså­˜å‚¨é…ç½®ï¼ˆåŸºäºå®é™…é…ç½®ï¼‰
SEALOS_ENDPOINT=https://objectstorageapi.bja.sealos.run
SEALOS_ACCESS_KEY=br0za7uc
SEALOS_SECRET_KEY=skxg8mk5gqfhf9xz
SEALOS_REGION=bja
SEALOS_BUCKET=br0za7uc-tiangong

# JWTé…ç½®ï¼ˆåŸºäºå®é™…ä»£ç ï¼‰
JWT_SECRET=your_jwt_secret_key_change_in_production
JWT_EXPIRES_IN=24h

# åº”ç”¨é…ç½®ï¼ˆåŸºäºå®é™…ä»£ç ï¼‰
ALLOWED_ORIGINS=*
MAX_FILE_SIZE=20971520
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=300
```

### å¥åº·æ£€æŸ¥ç«¯ç‚¹

```javascript
app.get('/health', async (req, res) => {
  try {
    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
    await sequelize.authenticate()

    // æ£€æŸ¥å­˜å‚¨æœåŠ¡
    const storageHealth = await storageService.testConnection()

    res.json({
      status: 'healthy',
      version: '2.0.0',
      timestamp: new Date().toISOString(),
      checks: {
        database: 'connected',
        storage: storageHealth ? 'connected' : 'disconnected',
        uptime: process.uptime()
      }
    })
  } catch (error) {
    res.status(503).json({
      status: 'unhealthy',
      error: error.message,
      timestamp: new Date().toISOString()
    })
  }
})
```

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹       | ç›®æ ‡å€¼      | ç›‘æ§æ–¹æ³•       |
| -------------- | ----------- | -------------- |
| APIå“åº”æ—¶é—´    | <100ms      | å“åº”æ—¶é—´ä¸­é—´ä»¶ |
| æ–‡ä»¶ä¸Šä¼ æ—¶é—´   | <2s         | ä¸Šä¼ æ—¶é—´è®°å½•   |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | <50ms       | Sequelizeæ—¥å¿—  |
| ç³»ç»Ÿå¯ç”¨æ€§     | >99.95%     | å¥åº·æ£€æŸ¥ç«¯ç‚¹   |
| å¹¶å‘ç”¨æˆ·æ•°     | 1000+       | è´Ÿè½½æµ‹è¯•       |
| å­˜å‚¨å®¹é‡       | 20M+ images | å­˜å‚¨ç»Ÿè®¡API    |

## ğŸ”’ å®‰å…¨è§„èŒƒv2.0

### æ•°æ®ä¿æŠ¤

- **å¯†ç åŠ å¯†**ï¼šBCryptåŠ å¯†å­˜å‚¨
- **æ–‡ä»¶éªŒè¯**ï¼šä¸¥æ ¼çš„æ–‡ä»¶ç±»å‹å’Œå¤§å°é™åˆ¶
- **SQLæ³¨å…¥é˜²æŠ¤**ï¼šSequelize ORMå‚æ•°åŒ–æŸ¥è¯¢
- **XSSé˜²æŠ¤**ï¼šè¾“å…¥æ•°æ®æ¸…ç†å’Œè¾“å‡ºç¼–ç 
- **CORSé…ç½®**ï¼šé™åˆ¶è·¨åŸŸè®¿é—®æº

### è®¿é—®æ§åˆ¶

- **JWTè®¤è¯**ï¼šåŸºäºJSON Web Tokençš„æ— çŠ¶æ€è®¤è¯
- **æƒé™åˆ†çº§**ï¼šç”¨æˆ·ã€ç®¡ç†å‘˜ä¸¤çº§æƒé™æ§åˆ¶
- **APIé™æµ**ï¼šåŸºäºIPçš„è¯·æ±‚é¢‘ç‡é™åˆ¶
- **å®‰å…¨å¤´**ï¼šHelmetä¸­é—´ä»¶è®¾ç½®å®‰å…¨HTTPå¤´

### å®¡è®¡æ—¥å¿—

```javascript
const auditLogger = (req, res, next) => {
  const auditInfo = {
    timestamp: new Date().toISOString(),
    method: req.method,
    url: req.originalUrl,
    ip: req.ip,
    userAgent: req.get('User-Agent'),
    userId: req.user?.user_id,
    duration: null
  }

  const startTime = Date.now()

  res.on('finish', () => {
    auditInfo.duration = Date.now() - startTime
    auditInfo.statusCode = res.statusCode

    console.log('ğŸ“‹ å®¡è®¡æ—¥å¿—:', JSON.stringify(auditInfo))
  })

  next()
}
```

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•æ”¯æŒ

- **æ— çŠ¶æ€è®¾è®¡**ï¼šåº”ç”¨å®ä¾‹é—´æ— çŠ¶æ€å…±äº«
- **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒå¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- **æ•°æ®åº“è¿æ¥æ± **ï¼šä¼˜åŒ–æ•°æ®åº“è¿æ¥ç®¡ç†
- **åˆ†å¸ƒå¼ç¼“å­˜**ï¼šæ”¯æŒRedisç­‰å¤–éƒ¨ç¼“å­˜

### ä¸šåŠ¡æ‰©å±•èƒ½åŠ›

```javascript
// æ–°ä¸šåŠ¡ç±»å‹æ³¨å†Œ
const BusinessTypes = {
  LOTTERY: 'lottery',
  EXCHANGE: 'exchange',
  TRADE: 'trade',
  UPLOADS: 'uploads',
  // ğŸ”´ æœªæ¥å¯æ‰©å±•
  MARKETING: 'marketing', // è¥é”€æ´»åŠ¨
  ANALYTICS: 'analytics' // æ•°æ®åˆ†æ
}

// å­˜å‚¨ç­–ç•¥æ‰©å±•
const StorageStrategies = {
  HOT: 'hot',
  STANDARD: 'standard',
  ARCHIVE: 'archive',
  // ğŸ”´ æœªæ¥å¯æ‰©å±•
  COLD: 'cold', // å†·å­˜å‚¨
  BACKUP: 'backup' // å¤‡ä»½å­˜å‚¨
}
```

## ğŸ“š å¼€å‘è§„èŒƒæ€»ç»“

### ç¼–ç è§„èŒƒ

- **ES2021è¯­æ³•**ï¼šä½¿ç”¨ç°ä»£JavaScriptè¯­æ³•
- **å¼‚æ­¥å¤„ç†**ï¼šç»Ÿä¸€ä½¿ç”¨async/await
- **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„try-catché”™è¯¯å¤„ç†
- **æ—¥å¿—è®°å½•**ï¼šç»“æ„åŒ–æ—¥å¿—è®°å½•
- **ä»£ç æ³¨é‡Š**ï¼šå…³é”®é€»è¾‘å¿…é¡»æ³¨é‡Š

### æµ‹è¯•è§„èŒƒ

- **å•å…ƒæµ‹è¯•**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘100%è¦†ç›–
- **é›†æˆæµ‹è¯•**ï¼šAPIæ¥å£ç«¯åˆ°ç«¯æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**ï¼šå…³é”®æ¥å£æ€§èƒ½åŸºå‡†æµ‹è¯•
- **å®‰å…¨æµ‹è¯•**ï¼šæƒé™å’Œæ•°æ®å®‰å…¨æµ‹è¯•

### æ–‡æ¡£è§„èŒƒ

- **APIæ–‡æ¡£**ï¼šOpenAPI 3.0è§„èŒƒ
- **ä»£ç æ–‡æ¡£**ï¼šJSDocæ³¨é‡Šè§„èŒƒ
- **éƒ¨ç½²æ–‡æ¡£**ï¼šè¯¦ç»†çš„éƒ¨ç½²å’Œé…ç½®æŒ‡å—
- **è¿ç»´æ–‡æ¡£**ï¼šç›‘æ§å’Œæ•…éšœæ’æŸ¥æ‰‹å†Œ

---

**æ ¸å¿ƒè®¾è®¡ç†å¿µ**: ä¸šåŠ¡é©±åŠ¨ã€åˆ†å±‚å­˜å‚¨ã€äº‘åŸç”Ÿã€å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å®‰å…¨å¯é 

> æœ¬è§„èŒƒåŸºäºv2.0å¤šä¸šåŠ¡çº¿åˆ†å±‚å­˜å‚¨æ¶æ„çš„å®é™…ä»£ç å®ç°ï¼Œç¡®ä¿æ–‡æ¡£ä¸ä»£ç ä¿æŒä¸€è‡´æ€§ï¼Œä¸ºå‰åç«¯åä½œæä¾›å‡†ç¡®çš„æŠ€æœ¯å‚è€ƒã€‚
