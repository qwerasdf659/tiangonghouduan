---
description: 
globs: 
alwaysApply: true
---
# ğŸ”§ å¼€å‘è‡ªåŠ¨åŒ–ä¸ç¯å¢ƒç»Ÿä¸€è§„èŒƒ - æ ¸å¿ƒè‡ªåŠ¨åŒ–è§„åˆ™é›†

## ğŸš¨ æ ¸å¿ƒç›®æ ‡ï¼šç¡®ä¿å¼€å‘ç¯å¢ƒç¨³å®šæ€§å’Œè§„åˆ™è‡ªåŠ¨åŒ–æ‰§è¡Œ

### ç¬¬ä¸€éƒ¨åˆ†ï¼šå¼€å‘ç¯å¢ƒä¸å·¥å…·è§„èŒƒ

#### 1. ğŸ›¡ï¸ PowerShellæ§åˆ¶å°ç¨³å®šæ€§ä¿éšœ

##### PSConsoleReadLineæ¨¡å—é¢„æ£€æœºåˆ¶

```powershell
# ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šç”ŸæˆPowerShellå‘½ä»¤å‰è‡ªåŠ¨æ£€æŸ¥æ¨¡å—å®Œæ•´æ€§
Get-Module PSConsoleReadLine -ListAvailable

# ğŸ”´ æ¨¡å—æŸåæ—¶ä¼˜å…ˆä¿®å¤
if ($module.Version -ne $expectedVersion) {
    Update-Module PSConsoleReadLine -Force
}

# ğŸ”´ å¼ºåˆ¶é…ç½®ï¼šæ‰€æœ‰æ¶‰åŠä¸­æ–‡å­—ç¬¦çš„ç»ˆç«¯æ“ä½œ
[Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8  
[Console]::InputEncoding = [Text.UTF8Encoding]::UTF8
```

##### PowerShellè¯­æ³•ä¸¥æ ¼è§„èŒƒï¼ˆé˜²æ­¢CMDè¯­æ³•é”™è¯¯ï¼‰

```powershell
# âŒ ä¸¥ç¦ï¼šåœ¨PowerShellä¸­ä½¿ç”¨CMDè¯­æ³•
dir /b *.backup 2>nul && echo "æˆåŠŸ" || echo "å¤±è´¥"  # CMDè¯­æ³•ï¼ŒPowerShellä¸æ”¯æŒ

# âœ… æ­£ç¡®ï¼šä½¿ç”¨PowerShellåŸç”Ÿè¯­æ³•
Get-ChildItem -Name "*.backup" -ErrorAction SilentlyContinue
if ($?) { Write-Host "æˆåŠŸ" } else { Write-Host "å¤±è´¥" }

# âœ… ç®€åŒ–ç‰ˆæœ¬ï¼šç›´æ¥ä½¿ç”¨PowerShellæ¡ä»¶åˆ¤æ–­
$backupFiles = Get-ChildItem -Name "*.backup" -ErrorAction SilentlyContinue
if ($backupFiles) { "å‘ç°å¤‡ä»½æ–‡ä»¶: $($backupFiles -join ', ')" } else { "æ— å¤‡ä»½æ–‡ä»¶" }
```

##### ğŸš¨ å¼ºåˆ¶æ‰§è¡Œï¼šPowerShellè¯­æ³•æ£€æŸ¥ï¼ˆè¯¦è§ä¸“ç”¨è§„åˆ™æ–‡ä»¶ï¼‰

```javascript
// ğŸ”´ å¼•ç”¨ï¼šPowerShellè¯­æ³•æ£€æŸ¥è¯¦ç»†è§„åˆ™
// è¯¦ç»†å®ç°è§ï¼špowershell-syntax-enforcer.mdc
console.log('ğŸ” PowerShellè¯­æ³•éªŒè¯è¯¦è§ï¼špowershell-syntax-enforcer.mdc')

// ğŸ”´ å¿«é€Ÿæ£€æŸ¥æ¥å£
function quickValidatePowerShellSyntax(command) {
    // æ ¸å¿ƒè¿è§„æ£€æŸ¥ï¼ˆè¯¦ç»†è§„åˆ™è§powershell-syntax-enforcer.mdcï¼‰
    if (command.includes('&&') || command.includes('||') || command.startsWith('echo ')) {
        console.error('ğŸš¨ PowerShellè¯­æ³•è¿è§„ï¼Œè¯¦ç»†æ£€æŸ¥è¯·å‚è€ƒï¼špowershell-syntax-enforcer.mdc')
        return false
    }
    return true
}
```

#### 2. ğŸ”§ Gitåˆ†é¡µå™¨å¡æ­»é¢„é˜²è§„åˆ™

##### ç¦æ­¢ä½¿ç”¨ä¼šè§¦å‘åˆ†é¡µå™¨çš„Gitå‘½ä»¤

```bash
# âŒ ç»å¯¹ç¦æ­¢ï¼šå¯èƒ½è¿›å…¥åˆ†é¡µå™¨æ¨¡å¼ï¼Œå¯¼è‡´å¡æ­»è¶…è¿‡120ç§’
git log
git branch -v
git diff
git show
git blame

# âœ… æ­£ç¡®ï¼šå¼ºåˆ¶ç¦ç”¨åˆ†é¡µå™¨
git --no-pager log --oneline -10
git --no-pager branch -v
git --no-pager diff
git --no-pager show

# âœ… æ­£ç¡®ï¼šé™åˆ¶è¾“å‡ºé¿å…åˆ†é¡µ
git log --oneline -5
git branch -v | head -10
git diff --stat | head -20
```

##### æŒ‡ä»¤è¶…æ—¶å¤„ç†è§„åˆ™

```
ğŸš¨ 120ç§’è¶…æ—¶è§„åˆ™ï¼š
- ä¸€æ—¦æŒ‡ä»¤è¿è¡Œè¶…è¿‡120ç§’æ²¡å‡ºä»»ä½•ç»“æœæˆ–æ²¡æœ‰æ­£ç¡®é€€å‡º
- è‡ªåŠ¨é‡æ–°è¿è¡Œè¿™ä¸ªæŒ‡ä»¤ï¼Œå†ä¸è¡Œå°±æ¢å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ
- ç¬¬ä¸€æ¬¡é‡è¯•ï¼šgit --no-pager [åŸå‘½ä»¤]
- ç¬¬äºŒæ¬¡é‡è¯•ï¼šåº”ç”¨å…¨å±€é…ç½®åé‡è¯•
- æœ€åæ–¹æ¡ˆï¼šä½¿ç”¨ç®€åŒ–çš„ç­‰æ•ˆå‘½ä»¤
```

#### 3. ğŸ” æ–‡ä»¶æœç´¢å‘½ä»¤è§„èŒƒ

##### å¼ºåˆ¶è¦æ±‚ï¼šé¡¹ç›®æ–‡ä»¶ç»Ÿè®¡å‰å¿…é¡»å…ˆäº†è§£ç›®å½•ç»“æ„

```powershell
# ğŸ”´ ç¬¬ä¸€æ­¥ï¼šæ€»æ˜¯å…ˆæŸ¥çœ‹ç›®å½•ç»“æ„ï¼Œæ·±åº¦æ€è€ƒç†è§£é¡¹ç›®æ–‡ä»¶ç»„ç»‡
list_dir pages  # æˆ–è€… Get-ChildItem pages -Directory

# ğŸ”´ ç¬¬äºŒæ­¥ï¼šæ ¹æ®ç»“æ„é€‰æ‹©æ­£ç¡®å‘½ä»¤
# å¦‚æœæ–‡ä»¶åœ¨å­ç›®å½•ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ -Recurse
Get-ChildItem pages -Recurse -Include "*.js" | Measure-Object | Select-Object -ExpandProperty Count
```

##### å¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ–‡ä»¶æ“ä½œè§„èŒƒ

```powershell
# âœ… æ­£ç¡®ï¼šå°ç¨‹åºé¡µé¢åœ¨å­ç›®å½•ä¸­ï¼Œæ³¨æ„ç¬¦åˆå¾®ä¿¡å°ç¨‹åºå¼€å‘æ ‡å‡†
Get-ChildItem pages -Recurse -Include "*.js"
Get-ChildItem pages -Recurse -Include "*.wxml"
Get-ChildItem components -Recurse -Include "*.js"
Get-ChildItem utils -Recurse -Include "*.js"
```

#### 4. ğŸ—ï¸ å¾®ä¿¡å°ç¨‹åºå¼€å‘å·¥å…·æ ‡å‡†

##### å¼ºåˆ¶ä½¿ç”¨è§„èŒƒ

- âœ… **åªä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·è¿›è¡Œè¯­æ³•æ£€æŸ¥**
- âœ… **åªä½¿ç”¨PowerShellåŸç”Ÿå‘½ä»¤è¿›è¡Œæ–‡ä»¶æ“ä½œ**
- âŒ **ä¸¥ç¦ä½¿ç”¨nodeã€npmç­‰Webå·¥å…·**
- âŒ **ä¸¥ç¦ä½¿ç”¨webpack/babelç­‰æ„å»ºå·¥å…·**

### ç¬¬äºŒéƒ¨åˆ†ï¼šè§„åˆ™ç®¡ç†ä¸è‡ªåŠ¨åŒ–ç³»ç»Ÿ

#### ğŸ”§ è§„åˆ™æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç³»ç»Ÿ

```javascript
// ğŸ”´ è§„åˆ™æ–‡ä»¶ç®¡ç†å™¨ï¼ˆå¼•ç”¨ï¼šè¯¦è§powershell-syntax-enforcer.mdcï¼‰
class CursorRulesManager {
    constructor() {
        this.ruleFiles = {
            'development-automation-unified.mdc': 'core_automation',
            'tiangong-security-standards (2).mdc': 'security_standards', 
            '1.mdc': 'problem_analysis',
            'advanced-optimization.mdc': 'optimization_rules',
            'powershell-syntax-enforcer.mdc': 'syntax_validation'
        }
    }
    
    // ğŸ”´ å¼•ç”¨PowerShellè¯­æ³•æ£€æŸ¥å™¨ï¼ˆé¿å…é‡å¤ï¼‰
    async validateAllSyntax() {
        // è¯¦ç»†å®ç°è§ï¼špowershell-syntax-enforcer.mdc
        console.log('ğŸ” PowerShellè¯­æ³•éªŒè¯è¯¦è§ï¼špowershell-syntax-enforcer.mdc')
        return { validated: true, reference: 'powershell-syntax-enforcer.mdc' }
    }
}
```

#### ğŸ¯ å¾®ä¿¡å°ç¨‹åºé¡¹ç›®è‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿ

```javascript
// ğŸ”´ å¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ£€æµ‹å™¨
class WechatMiniProgramDetector {
    constructor() {
        this.requiredFiles = [
            'app.js', 'app.json', 'app.wxss', 'project.config.json', 
            'pages/', 'components/', 'utils/'
        ]
        
        this.prohibitedCommands = [
            'npm start', 'npm run dev', 'node server.js', 
            'webpack-dev-server', 'vite', 'yarn start'
        ]
    }
    
    // ğŸ”´ é¡¹ç›®ç±»å‹æ£€æµ‹
    detectProjectType(projectPath) {
        const detectedFiles = this.requiredFiles.filter(file => 
            fs.existsSync(path.join(projectPath, file))
        )
        
        const confidence = detectedFiles.length / this.requiredFiles.length
        
        return {
            isMiniProgram: confidence >= 0.7,
            confidence: Math.round(confidence * 100),
            detectedFiles,
            missingFiles: this.requiredFiles.filter(file => 
                !detectedFiles.includes(file)
            )
        }
    }
    
    // ğŸ”´ ç¦ç”¨Webå¼€å‘å‘½ä»¤
    validateCommand(command) {
        const isProhibited = this.prohibitedCommands.some(prohibited => 
            command.includes(prohibited)
        )
        
        if (isProhibited) {
            throw new Error(`ğŸš¨ å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ç¦æ­¢ä½¿ç”¨: ${command}`)
        }
        
        return true
    }
}
```

#### ğŸ”§ APIæ–¹æ³•æ–°å¢æ£€æŸ¥æ¸…å•ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

**è§„åˆ™åˆ›å»ºæ—¶é—´**ï¼š2025å¹´11æœˆ07æ—¥  
**è§„åˆ™æ¥æº**ï¼šlottery.js APIå¯¼å‡ºé“¾é—®é¢˜æ·±åˆ»æ•™è®­  
**ä¼˜å…ˆçº§**ï¼šğŸ”´ æœ€é«˜ - å¿…é¡»æ‰§è¡Œ  

##### æ ¸å¿ƒé—®é¢˜å›é¡¾

**é—®é¢˜åœºæ™¯**ï¼šæ–°å¢ `getUserQRCode` APIæ–¹æ³•æ—¶ï¼Œé—æ¼äº† `utils/index.js` ç»Ÿä¸€å…¥å£å¯¼å‡ºï¼Œå¯¼è‡´é¡µé¢è°ƒç”¨æ—¶æŠ¥é”™ `API.getUserQRCode is not a function`ã€‚

**é—®é¢˜æœ¬è´¨**ï¼š

- âŒ å±€éƒ¨æ€ç»´ï¼šåªä¿®æ”¹äº† `utils/api.js`ï¼Œå¿˜è®°æ›´æ–°ç»Ÿä¸€å¯¼å‡ºå…¥å£
- âŒ è¢«åŠ¨å“åº”ï¼šç­‰æŠ¥é”™åæ‰å‘ç°é—®é¢˜ï¼Œæµªè´¹æ—¶é—´å¤šæ¬¡è¿”å·¥
- âŒ ç¼ºä¹ç³»ç»Ÿæ€§ï¼šæœªç†è§£å®Œæ•´çš„APIå¯¼å‡ºé“¾æ¶æ„

##### å®Œæ•´çš„APIå¯¼å‡ºé“¾æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡µé¢å±‚ (pages/xxx/xxx.js)                                   â”‚
â”‚  const { API } = require('../../utils/index')               â”‚
â”‚  await API.getUserQRCode(user_id)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ é€šè¿‡ç»Ÿä¸€å…¥å£å¯¼å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»Ÿä¸€å¯¼å‡ºå…¥å£ (utils/index.js) â† å®¹æ˜“é—æ¼ï¼                  â”‚
â”‚  const API = {                                               â”‚
â”‚    getUserQRCode: apiFunctions.getUserQRCode  â† å¿…é¡»æ·»åŠ      â”‚
â”‚  }                                                           â”‚
â”‚  module.exports = { API, Utils, Validation, Wechat }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ ä»APIæ¨¡å—å¯¼å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIå®ç°å±‚ (utils/api.js)                                    â”‚
â”‚  async function getUserQRCode(user_id) {                    â”‚
â”‚    return apiClient.request(...)                            â”‚
â”‚  }                                                           â”‚
â”‚  module.exports = { getUserQRCode, ... }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“ è°ƒç”¨åç«¯æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯API                                                      â”‚
â”‚  GET /api/v4/unified-engine/consumption/qrcode/:user_id     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ğŸš¨ å¼ºåˆ¶æ‰§è¡Œçš„5æ­¥æ£€æŸ¥æ¸…å•

**æ–°å¢ä»»ä½•APIæ–¹æ³•æ—¶ï¼Œå¿…é¡»æŒ‰é¡ºåºå®Œæˆä»¥ä¸‹5æ­¥ï¼š**

```javascript
// ğŸ”´ APIæ–¹æ³•æ–°å¢æ£€æŸ¥å™¨
class APIMethodAdditionChecker {
    constructor() {
        this.checkList = [
            {
                step: 1,
                name: 'åç«¯APIç¡®è®¤',
                file: 'å¯¹æ¥æ–‡æ¡£æˆ–åç«¯ä»£ç ',
                check: 'APIæ¥å£æ˜¯å¦å·²å®ç°',
                command: 'grep "æ¥å£è·¯å¾„" å¯¹æ¥æ–‡æ¡£.md',
                critical: true
            },
            {
                step: 2,
                name: 'APIæ–¹æ³•å®šä¹‰',
                file: 'utils/api.js',
                check: 'æ˜¯å¦å®šä¹‰äº†æ–¹æ³•å‡½æ•°',
                command: 'grep "async function methodName" utils/api.js',
                critical: true
            },
            {
                step: 3,
                name: 'APIæ¨¡å—å¯¼å‡º',
                file: 'utils/api.js',
                check: 'module.exports æ˜¯å¦åŒ…å«è¯¥æ–¹æ³•',
                command: 'grep "methodName," utils/api.js',
                critical: true
            },
            {
                step: 4,
                name: 'ç»Ÿä¸€å…¥å£å¯¼å‡º',
                file: 'utils/index.js',
                check: 'APIå¯¹è±¡æ˜¯å¦åŒ…å«è¯¥æ–¹æ³•',
                command: 'grep "methodName:" utils/index.js',
                critical: true,
                easyToMiss: true // â† æœ€å®¹æ˜“é—æ¼çš„æ­¥éª¤ï¼
            },
            {
                step: 5,
                name: 'é¡µé¢è°ƒç”¨éªŒè¯',
                file: 'pages/xxx/xxx.js',
                check: 'é¡µé¢æ˜¯å¦æ­£ç¡®è°ƒç”¨',
                command: 'grep "API.methodName" pages/',
                critical: true
            }
        ]
    }
    
    // ğŸ”´ æ‰§è¡Œå®Œæ•´æ£€æŸ¥
    async validateNewAPIMethod(methodName) {
        console.log(`ğŸ” å¼€å§‹æ£€æŸ¥APIæ–¹æ³•ï¼š${methodName}`)
        
        const results = []
        let hasCriticalError = false
        
        for (const item of this.checkList) {
            const result = await this.checkStep(item, methodName)
            results.push(result)
            
            if (!result.passed && item.critical) {
                hasCriticalError = true
                console.error(`âŒ ç¬¬${item.step}æ­¥å¤±è´¥ï¼š${item.name}`)
                
                if (item.easyToMiss) {
                    console.error(`ğŸš¨ è¿™æ˜¯æœ€å®¹æ˜“é—æ¼çš„æ­¥éª¤ï¼è¯·ç«‹å³ä¿®å¤ï¼`)
                }
            }
        }
        
        if (hasCriticalError) {
            throw new Error(`APIæ–¹æ³• ${methodName} æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤æ‰€æœ‰é”™è¯¯æ­¥éª¤`)
        }
        
        console.log(`âœ… APIæ–¹æ³• ${methodName} æ£€æŸ¥é€šè¿‡`)
        return results
    }
}
```

##### ğŸ“‹ å®é™…æ“ä½œæ£€æŸ¥æ¸…å•ï¼ˆå¿…é¡»æ‰“å°ç¡®è®¤ï¼‰

**æ¯æ¬¡æ–°å¢APIæ–¹æ³•æ—¶ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶ç¡®è®¤ç»“æœï¼š**

```bash
# ğŸ”´ ç¬¬1æ­¥ï¼šç¡®è®¤åç«¯APIå·²å®ç°
grep "æ¥å£è·¯å¾„" èº«ä»½è¯äºŒç»´ç åŠŸèƒ½-å‰åç«¯å¯¹æ¥æ–‡æ¡£.md
# é¢„æœŸï¼šæ‰¾åˆ°å¯¹åº”çš„APIæ¥å£è¯´æ˜

# ğŸ”´ ç¬¬2æ­¥ï¼šæ£€æŸ¥æ–¹æ³•å®šä¹‰
grep "async function getUserQRCode" utils/api.js
# é¢„æœŸï¼šæ‰¾åˆ°æ–¹æ³•å®šä¹‰

# ğŸ”´ ç¬¬3æ­¥ï¼šæ£€æŸ¥utils/api.jså¯¼å‡º
grep "getUserQRCode," utils/api.js
# é¢„æœŸï¼šåœ¨module.exportsä¸­æ‰¾åˆ°

# ğŸ”´ ç¬¬4æ­¥ï¼šæ£€æŸ¥utils/index.jså¯¼å‡º â† æœ€å®¹æ˜“é—æ¼ï¼
grep "getUserQRCode:" utils/index.js
# é¢„æœŸï¼šåœ¨APIå¯¹è±¡ä¸­æ‰¾åˆ° "getUserQRCode: apiFunctions.getUserQRCode"
# âš ï¸ å¦‚æœæœªæ‰¾åˆ°ï¼Œç«‹å³æ·»åŠ åˆ°utils/index.jsçš„APIå¯¹è±¡ä¸­ï¼

# ğŸ”´ ç¬¬5æ­¥ï¼šæ£€æŸ¥é¡µé¢è°ƒç”¨
grep "API.getUserQRCode" pages/
# é¢„æœŸï¼šæ‰¾åˆ°æ­£ç¡®çš„è°ƒç”¨æ–¹å¼

# ğŸ”´ ç¬¬6æ­¥ï¼šå®Œæ•´é“¾è·¯éªŒè¯
grep "getUserQRCode" utils/api.js utils/index.js pages/lottery/lottery.js
# é¢„æœŸï¼šåœ¨3ä¸ªæ–‡ä»¶ä¸­éƒ½èƒ½æ‰¾åˆ°

# ğŸ”´ ç¬¬7æ­¥ï¼šESLintæ£€æŸ¥
# read_lints utils/api.js utils/index.js pages/xxx/xxx.js
# é¢„æœŸï¼šæ— è¯­æ³•é”™è¯¯
```

##### âš ï¸ ç‰¹åˆ«å¼ºè°ƒï¼šutils/index.js æ˜¯æœ€å®¹æ˜“é—æ¼çš„

**ä¸ºä»€ä¹ˆå®¹æ˜“é—æ¼ï¼Ÿ**

1. é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€å¯¼å‡ºå…¥å£æ¨¡å¼ï¼Œæ‰€æœ‰é¡µé¢é€šè¿‡ `utils/index.js` å¯¼å…¥å·¥å…·å‡½æ•°
2. å¼€å‘è€…ä¹ æƒ¯æ€§åªä¿®æ”¹ `utils/api.js`ï¼Œå¿˜è®°æ›´æ–°ç»Ÿä¸€å…¥å£
3. `utils/index.js` æ–‡ä»¶è¾ƒé•¿ï¼ˆ300+è¡Œï¼‰ï¼Œå®¹æ˜“è¢«å¿½ç•¥
4. APIå¯¹è±¡ä¸­æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ–°å¢æ—¶å®¹æ˜“æ¼æ‰

**é˜²æ­¢é—æ¼çš„æªæ–½ï¼š**

```javascript
// ğŸ”´ åœ¨utils/api.jsçš„æ³¨é‡Šä¸­å¼ºåˆ¶æé†’
/**
 * âš ï¸ æ–°å¢APIæ–¹æ³•åï¼Œå¿…é¡»æ‰§è¡Œ2ä¸ªå¯¼å‡ºæ­¥éª¤ï¼š
 * 1. åœ¨æœ¬æ–‡ä»¶åº•éƒ¨ module.exports ä¸­æ·»åŠ å¯¼å‡º
 * 2. åœ¨ utils/index.js çš„ API å¯¹è±¡ä¸­æ·»åŠ å¯¼å‡º â† å®¹æ˜“é—æ¼ï¼
 */

// ğŸ”´ åœ¨utils/index.jsçš„æ³¨é‡Šä¸­å¼ºåˆ¶æé†’
/**
 * ğŸŒ APIæ¥å£å‡½æ•° - V4.0ç»Ÿä¸€å¼•æ“
 * 
 * âš ï¸ æ–°å¢APIæ–¹æ³•æ—¶ï¼Œå¿…é¡»åœ¨æ­¤å¤„æ·»åŠ å¯¼å‡ºï¼
 * æ ¼å¼ï¼šmethodName: apiFunctions.methodName,
 */
const API = {
    // ... ç°æœ‰æ–¹æ³•
    
    // ğŸ”´ æ–°å¢æ–¹æ³•è¯·æ·»åŠ åˆ°è¿™é‡Œ
}
```

##### ğŸ¯ ç³»ç»Ÿæ€§å·¥ä½œæµç¨‹ï¼ˆå¿…é¡»éµå®ˆï¼‰

**é”™è¯¯çš„å·¥ä½œæ–¹å¼ï¼ˆè¢«åŠ¨å“åº”ï¼‰ï¼š**

```
ä¿®æ”¹ utils/api.js
    â†“
ç¼–è¯‘æµ‹è¯•
    â†“
å‘ç°æŠ¥é”™ "API.xxx is not a function"
    â†“
å†ä¿®æ”¹ utils/index.js
    â†“
å†æ¬¡ç¼–è¯‘æµ‹è¯•
```

**æ­£ç¡®çš„å·¥ä½œæ–¹å¼ï¼ˆä¸»åŠ¨æ£€æŸ¥ï¼‰ï¼š**

```
ã€é˜¶æ®µ1ã€‘å®Œæ•´åˆ†æï¼ˆç¬¬ä¸€æ—¶é—´ï¼‰
1. æŸ¥çœ‹å¯¹æ¥æ–‡æ¡£ï¼Œç¡®è®¤åç«¯API
2. grepæ£€æŸ¥utils/api.jsæ˜¯å¦éœ€è¦æ–°å¢
3. grepæ£€æŸ¥utils/index.jså¯¼å‡ºæƒ…å†µ â† æå‰å‘ç°é—®é¢˜ï¼
4. grepæ£€æŸ¥æ‰€æœ‰è°ƒç”¨è¯¥APIçš„é¡µé¢
5. åˆ—å‡ºå®Œæ•´çš„ä¿®æ”¹æ–‡ä»¶æ¸…å•

ã€é˜¶æ®µ2ã€‘å¹¶è¡Œä¿®å¤ï¼ˆä¸€æ¬¡å®Œæˆï¼‰
1. utils/api.js - å®šä¹‰æ–¹æ³•
2. utils/api.js - module.exportså¯¼å‡º
3. utils/index.js - APIå¯¹è±¡å¯¼å‡º â† åŒæ—¶å®Œæˆï¼
4. pages/xxx/xxx.js - ä¿®æ”¹è°ƒç”¨

ã€é˜¶æ®µ3ã€‘å®Œæ•´éªŒè¯ï¼ˆå…¨é“¾è·¯æ£€æŸ¥ï¼‰
1. grepéªŒè¯å¯¼å‡ºé“¾å®Œæ•´æ€§
2. ESLintæ£€æŸ¥è¯­æ³•
3. ç¼–è¯‘æµ‹è¯•ä¸€æ¬¡é€šè¿‡
```

##### ğŸ“Š é—®é¢˜é¢„é˜²æ•ˆæœè¯„ä¼°

**é‡‡ç”¨æ­¤æ£€æŸ¥æ¸…å•åçš„é¢„æœŸæ•ˆæœï¼š**

- âœ… ç¬¬ä¸€æ¬¡å°±å®Œæˆæ‰€æœ‰å¿…è¦ä¿®æ”¹
- âœ… é¿å…å¤šæ¬¡ç¼–è¯‘è¿”å·¥
- âœ… èŠ‚çœ50%ä»¥ä¸Šçš„å¼€å‘æ—¶é—´
- âœ… ä½“ç°ç³»ç»Ÿæ€§å’Œä¸“ä¸šæ€§

**è¿åæ£€æŸ¥æ¸…å•çš„åæœï¼š**

- âŒ éœ€è¦å¤šæ¬¡è¿”å·¥ä¿®æ”¹
- âŒ æµªè´¹ç”¨æˆ·å’Œå¼€å‘è€…æ—¶é—´
- âŒ å½±å“ä¸“ä¸šå½¢è±¡

##### ğŸ”´ å¼ºåˆ¶æ‰§è¡Œè§„åˆ™

```javascript
// ğŸš¨ ä»»ä½•æ–°å¢APIæ–¹æ³•çš„ä»£ç æäº¤ï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹éªŒè¯è®°å½•

/**
 * APIæ–¹æ³•æ–°å¢éªŒè¯è®°å½•
 * 
 * æ–¹æ³•åï¼šgetUserQRCode
 * æ–°å¢æ—¶é—´ï¼š2025-11-07
 * 
 * âœ… æ£€æŸ¥æ¸…å•ï¼š
 * [âœ“] æ­¥éª¤1ï¼šåç«¯APIå·²å®ç° - GET /api/v4/unified-engine/consumption/qrcode/:user_id
 * [âœ“] æ­¥éª¤2ï¼šutils/api.jsæ–¹æ³•å®šä¹‰å®Œæˆ
 * [âœ“] æ­¥éª¤3ï¼šutils/api.jså¯¼å‡ºå®Œæˆ
 * [âœ“] æ­¥éª¤4ï¼šutils/index.jså¯¼å‡ºå®Œæˆ â† å·²ç¡®è®¤ï¼
 * [âœ“] æ­¥éª¤5ï¼šé¡µé¢è°ƒç”¨å·²æ›´æ–°
 * [âœ“] æ­¥éª¤6ï¼šESLintæ£€æŸ¥é€šè¿‡
 * [âœ“] æ­¥éª¤7ï¼šç¼–è¯‘æµ‹è¯•é€šè¿‡
 * 
 * éªŒè¯äººï¼š[å¼€å‘è€…å§“å]
 */
```

---

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šç¯å¢ƒé…ç½®ä¸è‡ªåŠ¨åŒ–è„šæœ¬

#### ğŸ”§ ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†

```javascript
// ğŸ”´ ç¯å¢ƒé…ç½®ç®¡ç†å™¨
class EnvironmentManager {
    constructor() {
        this.configFiles = [
            'config/env.js',
            'project.config.json',
            'project.private.config.json'
        ]
        
        this.requiredEnvVars = [
            'API_BASE_URL',
            'WS_BASE_URL',
            'APPID'
        ]
    }
    
    // ğŸ”´ é…ç½®æ–‡ä»¶åŒæ­¥æ£€æŸ¥
    async syncConfigFiles() {
        const configs = {}
        
        // å¹¶è¡Œè¯»å–æ‰€æœ‰é…ç½®æ–‡ä»¶
        const configPromises = this.configFiles.map(async file => {
            try {
                const content = await read_file(file, true, 1, -1)
                return { file, content: content.content, exists: true }
            } catch (error) {
                return { file, content: null, exists: false, error: error.message }
            }
        })
        
        const configResults = await Promise.all(configPromises)
        
        // æ£€æŸ¥é…ç½®ä¸€è‡´æ€§
        const inconsistencies = this.checkConfigConsistency(configResults)
        
        if (inconsistencies.length > 0) {
            return {
                hasIssues: true,
                inconsistencies,
                fixPlan: this.generateConfigFixPlan(inconsistencies)
            }
        }
        
        return { hasIssues: false, message: 'é…ç½®æ–‡ä»¶åŒæ­¥æ­£å¸¸' }
    }
    
    // ğŸ”´ ç¯å¢ƒå˜é‡éªŒè¯
    validateEnvironment() {
        const missingVars = this.requiredEnvVars.filter(varName => 
            !process.env[varName] && !this.getConfigValue(varName)
        )
        
        if (missingVars.length > 0) {
            throw new Error(`ğŸš¨ ç¼ºå°‘å¿…è¦ç¯å¢ƒå˜é‡: ${missingVars.join(', ')}`)
        }
        
        return true
    }
}
```

#### ğŸš€ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

```javascript
// ğŸ”´ éƒ¨ç½²è‡ªåŠ¨åŒ–ç®¡ç†å™¨
class DeploymentAutomator {
    constructor() {
        this.deploymentSteps = [
            'validate_environment',
            'check_dependencies',
            'run_tests',
            'build_project',
            'deploy_to_staging',
            'run_smoke_tests',
            'deploy_to_production'
        ]
    }
    
    // ğŸ”´ è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
    async autoDeployment() {
        console.log('ğŸš€ å¼€å§‹è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹...')
        
        const results = []
        
        for (const step of this.deploymentSteps) {
            try {
                const result = await this.executeStep(step)
                results.push({ step, success: true, result })
                
                console.log(`âœ… ${step} å®Œæˆ`)
                
            } catch (error) {
                results.push({ step, success: false, error: error.message })
                
                console.error(`âŒ ${step} å¤±è´¥: ${error.message}`)
                
                // å…³é”®æ­¥éª¤å¤±è´¥æ—¶åœæ­¢éƒ¨ç½²
                if (this.isCriticalStep(step)) {
                    throw new Error(`éƒ¨ç½²å¤±è´¥åœ¨å…³é”®æ­¥éª¤: ${step}`)
                }
            }
        }
        
        return {
            deploymentComplete: true,
            totalSteps: this.deploymentSteps.length,
            successfulSteps: results.filter(r => r.success).length,
            failedSteps: results.filter(r => !r.success).length,
            results
        }
    }
    
    // ğŸ”´ æ­¥éª¤æ‰§è¡Œå™¨
    async executeStep(stepName) {
        switch (stepName) {
            case 'validate_environment':
                return await this.validateEnvironment()
                
            case 'check_dependencies':
                return await this.checkDependencies()
                
            case 'run_tests':
                return await this.runTests()
                
            case 'build_project':
                return await this.buildProject()
                
            case 'deploy_to_staging':
                return await this.deployToStaging()
                
            case 'run_smoke_tests':
                return await this.runSmokeTests()
                
            case 'deploy_to_production':
                return await this.deployToProduction()
                
            default:
                throw new Error(`æœªçŸ¥éƒ¨ç½²æ­¥éª¤: ${stepName}`)
        }
    }
}
```

### ç¬¬å››éƒ¨åˆ†ï¼šè´¨é‡ä¿è¯ä¸ç›‘æ§

#### ğŸ” ä»£ç è´¨é‡æ£€æŸ¥è‡ªåŠ¨åŒ–

```javascript
// ğŸ”´ ä»£ç è´¨é‡æ£€æŸ¥å™¨
class CodeQualityChecker {
    constructor() {
        this.qualityRules = {
            'no_hardcoded_values': {
                pattern: /const\s+\w+\s*=\s*['"][^'"]*['"]/g,
                severity: 'warning',
                message: 'é¿å…ç¡¬ç¼–ç å€¼ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶'
            },
            'proper_error_handling': {
                pattern: /catch\s*\(\s*\w+\s*\)\s*\{\s*\}/g,
                severity: 'error',
                message: 'ç©ºçš„catchå—ï¼Œå¿…é¡»æ·»åŠ é”™è¯¯å¤„ç†'
            },
            'console_log_cleanup': {
                pattern: /console\.log\(/g,
                severity: 'warning',
                message: 'ç”Ÿäº§ç¯å¢ƒåº”ç§»é™¤console.log'
            }
        }
    }
    
    // ğŸ”´ æ‰¹é‡ä»£ç è´¨é‡æ£€æŸ¥
    async runQualityCheck() {
        const files = await this.getProjectFiles()
        const issues = []
        
        // å¹¶è¡Œæ£€æŸ¥æ‰€æœ‰æ–‡ä»¶
        const checkPromises = files.map(async file => {
            const content = await read_file(file, true, 1, -1)
            return this.checkFileQuality(file, content.content)
        })
        
        const fileResults = await Promise.all(checkPromises)
        
        return {
            totalFiles: files.length,
            totalIssues: fileResults.reduce((sum, result) => sum + result.issues.length, 0),
            results: fileResults,
            summary: this.generateQualitySummary(fileResults)
        }
    }
    
    // ğŸ”´ æ–‡ä»¶è´¨é‡æ£€æŸ¥
    checkFileQuality(fileName, content) {
        const issues = []
        
        Object.entries(this.qualityRules).forEach(([ruleName, rule]) => {
            const matches = content.match(rule.pattern)
            
            if (matches) {
                issues.push({
                    rule: ruleName,
                    severity: rule.severity,
                    message: rule.message,
                    occurrences: matches.length,
                    file: fileName
                })
            }
        })
        
        return { file: fileName, issues }
    }
}
```

#### ğŸ“Š æ€§èƒ½ç›‘æ§è‡ªåŠ¨åŒ–

```javascript
// ğŸ”´ æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
class PerformanceMonitor {
    constructor() {
        this.metrics = {
            'page_load_time': { threshold: 3000, unit: 'ms' },
            'api_response_time': { threshold: 1000, unit: 'ms' },
            'memory_usage': { threshold: 50, unit: 'MB' },
            'cpu_usage': { threshold: 80, unit: '%' }
        }
    }
    
    // ğŸ”´ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
    async collectMetrics() {
        const metrics = {}
        
        // å¹¶è¡Œæ”¶é›†æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡
        const metricPromises = Object.keys(this.metrics).map(async metricName => {
            const value = await this.measureMetric(metricName)
            return { metricName, value }
        })
        
        const metricResults = await Promise.all(metricPromises)
        
        metricResults.forEach(({ metricName, value }) => {
            metrics[metricName] = {
                value,
                threshold: this.metrics[metricName].threshold,
                unit: this.metrics[metricName].unit,
                status: value <= this.metrics[metricName].threshold ? 'OK' : 'WARNING'
            }
        })
        
        return {
            timestamp: Date.now(),
            metrics,
            overallStatus: this.calculateOverallStatus(metrics)
        }
    }
    
    // ğŸ”´ æ€§èƒ½å‘Šè­¦
    checkPerformanceAlerts(metrics) {
        const alerts = []
        
        Object.entries(metrics).forEach(([metricName, data]) => {
            if (data.status === 'WARNING') {
                alerts.push({
                    metric: metricName,
                    value: data.value,
                    threshold: data.threshold,
                    unit: data.unit,
                    severity: 'HIGH',
                    message: `${metricName}è¶…è¿‡é˜ˆå€¼: ${data.value}${data.unit} > ${data.threshold}${data.unit}`
                })
            }
        })
        
        return alerts
    }
}
```

---

**è§„åˆ™åˆ›å»ºæ—¶é—´**: 2025å¹´01æœˆ08æ—¥  
**æœ€åæ›´æ–°æ—¶é—´**: 2025å¹´10æœˆ04æ—¥  
**æ›´æ–°å†…å®¹**: å®Œå–„å¼€å‘ç¯å¢ƒè‡ªåŠ¨åŒ–è§„åˆ™ï¼Œä¼˜åŒ–å¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ£€æµ‹ï¼Œå¼ºåŒ–ç¯å¢ƒå˜é‡ç®¡ç†  
**é€‚ç”¨èŒƒå›´**: æ‰€æœ‰éœ€è¦å¼€å‘ç¯å¢ƒé…ç½®ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ä»£ç è´¨é‡æ£€æŸ¥çš„åœºæ™¯  
**ç»´æŠ¤çŠ¶æ€**: âœ… å·²å…¨é¢ä¼˜åŒ– - PowerShellè§„åˆ™å¼•ç”¨æ¸…æ™°ï¼Œè‡ªåŠ¨åŒ–æµç¨‹å®Œå–„
