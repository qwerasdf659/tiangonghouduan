<!--pages/trade/market/market.wxml - ç€‘å¸ƒæµå¡ç‰‡å¸ƒå±€æ¨¡æ¿v1.0-->
<!--ğŸ“‹ åŸºäºäº¤æ˜“å¸‚åœºUIå¸ƒå±€ä¼˜åŒ–æ–¹æ¡ˆæŠ€æœ¯æ–‡æ¡£ - æ–¹æ¡ˆ1ï¼šç€‘å¸ƒæµå¡ç‰‡å¸ƒå±€-->

<view class="waterfall-market-container">

  <!-- ğŸŒŠ ç€‘å¸ƒæµä¸»å®¹å™¨ -->
  <view class="waterfall-container" style="height: {{containerHeight}}px;">

    <!-- ğŸ“¦ å•†å“å¡ç‰‡åˆ—è¡¨ - ç»å¯¹å®šä½ç€‘å¸ƒæµ -->
    <view class="product-card waterfall-card" wx:for="{{products}}" wx:key="productId"
      style="left: {{item.layoutInfo.left}}px; top: {{item.layoutInfo.top}}px; width: {{item.layoutInfo.width}}px; z-index: {{item.layoutInfo.zIndex}};"
      data-product="{{item}}" bindtap="onProductClick">

      <!-- ğŸ–¼ï¸ å•†å“å›¾ç‰‡åŒºåŸŸ - æ”¯æŒæ‡’åŠ è½½ -->
      <view class="card-image-container">
        <image class="product-image card-image" src="{{item.image}}" mode="aspectFill" lazy-load="{{true}}"
          data-product-id="{{item.productId}}" show-menu-by-longpress="{{false}}" />

        <!-- ğŸ·ï¸ å•†å“æ ‡ç­¾ -->
        <view class="product-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="product-tag {{item.isHot ? 'hot-tag' : ''}} {{item.isNew ? 'new-tag' : ''}}"
            wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>

        <!-- ğŸ“Š é”€é‡æ˜¾ç¤º -->
        <view class="sales-badge" wx:if="{{item.sales}}">
          <text class="sales-text">å·²å”®{{item.sales}}</text>
        </view>
      </view>

      <!-- ğŸ“ å•†å“ä¿¡æ¯åŒºåŸŸ -->
      <view class="card-content">

        <!-- ğŸ“Œ å•†å“æ ‡é¢˜ -->
        <view class="product-title-section">
          <text class="product-title">{{item.name}}</text>
        </view>

        <!-- ğŸ’° ä»·æ ¼ä¿¡æ¯ -->
        <view class="price-section">
          <view class="price-row">
            <text class="current-price">Â¥{{item.currentPrice}}</text>
            <text class="original-price"
              wx:if="{{item.originalPrice && item.originalPrice > item.currentPrice}}">Â¥{{item.originalPrice}}</text>
          </view>

          <!-- â­ è¯„åˆ†å’Œè¯„ä»· -->
          <view class="rating-section" wx:if="{{item.rating}}">
            <text class="rating-stars">â˜…â˜…â˜…â˜…â˜…</text>
            <text class="rating-score">{{item.rating}}</text>
          </view>
        </view>

        <!-- ğŸª å•†å®¶ä¿¡æ¯ -->
        <view class="seller-info" wx:if="{{item.seller}}">
          <text class="seller-name">{{item.seller.name}}</text>
          <text class="seller-rating" wx:if="{{item.seller.rating}}">{{item.seller.rating}}åˆ†</text>
        </view>

      </view>

      <!-- ğŸ­ å¡ç‰‡æ‚¬åœæ•ˆæœé®ç½© -->
      <view class="card-hover-mask"></view>

    </view>

  </view>

  <!-- â³ åŠ è½½çŠ¶æ€æ˜¾ç¤º -->
  <view class="loading-section" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner">
        <view class="spinner-dot dot1"></view>
        <view class="spinner-dot dot2"></view>
        <view class="spinner-dot dot3"></view>
      </view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- ğŸ“Š æ— æ›´å¤šæ•°æ®æç¤º -->
  <view class="no-more-data" wx:if="{{!hasMore && products.length > 0}}">
    <view class="no-more-content">
      <text class="no-more-icon">ğŸ‰</text>
      <text class="no-more-text">å·²åŠ è½½å…¨éƒ¨å•†å“</text>
      <text class="no-more-subtitle">å…±{{products.length}}ä»¶å¥½ç‰©ç­‰ä½ å‘ç°</text>
    </view>
  </view>

  <!-- ğŸš« ç©ºçŠ¶æ€æ˜¾ç¤º -->
  <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
    <view class="empty-content">
      <text class="empty-icon">ğŸ›’</text>
      <text class="empty-title">æš‚æ— å•†å“</text>
      <text class="empty-subtitle">å¿«å»ä¸Šæ¶ä¸€äº›å¥½ç‰©å§</text>
      <button class="empty-retry-btn" bindtap="onPullDownRefresh" size="mini">
        é‡æ–°åŠ è½½
      </button>
    </view>
  </view>

  <!-- ğŸ”„ ä¸‹æ‹‰åˆ·æ–°æç¤º -->
  <view class="refresh-hint" wx:if="{{!loading && products.length > 0}}">
    <text class="refresh-text">ä¸‹æ‹‰åˆ·æ–°è·å–æœ€æ–°å•†å“</text>
  </view>

  <!-- ğŸ“± æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">

    <!-- ğŸ” å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <view class="floating-btn back-to-top-btn" bindtap="scrollToTop" wx:if="{{products.length > 10}}">
      <text class="btn-icon">â†‘</text>
    </view>

    <!-- ğŸ“Š æ€§èƒ½ç»Ÿè®¡æŒ‰é’® (å¼€å‘ç¯å¢ƒ) -->
    <view class="floating-btn stats-btn" bindtap="showStats" wx:if="{{performanceStats.totalProducts > 0}}">
      <text class="btn-icon">ğŸ“Š</text>
    </view>

  </view>

</view>

<!-- ğŸ“Š æ€§èƒ½ç»Ÿè®¡å¼¹çª— -->
<view class="stats-modal" wx:if="{{showStatsModal}}">
  <view class="stats-mask" bindtap="hideStats"></view>
  <view class="stats-content">
    <view class="stats-header">
      <text class="stats-title">ğŸ“Š æ€§èƒ½ç»Ÿè®¡</text>
      <text class="stats-close" bindtap="hideStats">âœ•</text>
    </view>
    <view class="stats-body">
      <view class="stats-item">
        <text class="stats-label">å¸ƒå±€è®¡ç®—è€—æ—¶:</text>
        <text class="stats-value">{{performanceStats.layoutCalculationTime}}ms</text>
      </view>
      <view class="stats-item">
        <text class="stats-label">å•†å“æ€»æ•°:</text>
        <text class="stats-value">{{performanceStats.totalProducts}}ä¸ª</text>
      </view>
      <view class="stats-item">
        <text class="stats-label">å½“å‰é¡µç :</text>
        <text class="stats-value">ç¬¬{{currentPage}}é¡µ</text>
      </view>
      <view class="stats-item">
        <text class="stats-label">å®¹å™¨å°ºå¯¸:</text>
        <text class="stats-value">{{containerWidth}}Ã—{{containerHeight}}px</text>
      </view>
    </view>
  </view>
</view>