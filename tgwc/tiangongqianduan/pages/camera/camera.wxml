<!--pages/camera/camera.wxml - å‘ç°é¡µé¢ï¼ˆæ´»åŠ¨èšåˆå…¥å£ - æ–¹æ¡ˆCï¼šæ ‡ç­¾é¡µåˆ†ç±»ï¼‰-->

<view class="discover-container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" type="text" placeholder="æœç´¢æ´»åŠ¨" value="{{searchKeyword}}"
        bindinput="onSearchInput" />
      <text class="clear-icon" wx:if="{{searchKeyword}}" bindtap="onClearSearch">âœ•</text>
    </view>
  </view>

  <!-- Tab åˆ†ç±»å¯¼èˆª -->
  <view class="tab-bar">
    <scroll-view class="tab-scroll" scroll-x="true" scroll-with-animation="true">
      <view class="tab-list">
        <view class="tab-item {{currentTab === item.key ? 'active' : ''}}" wx:for="{{tabs}}" wx:key="key"
          data-tab="{{item.key}}" bindtap="onTabChange">
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="activity-list">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{loading && !refreshing}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€æç¤º -->
    <view class="empty-state" wx:if="{{!loading && isEmpty}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ´»åŠ¨' : 'æš‚æ—¶æ²¡æœ‰æ´»åŠ¨'}}</text>
      <text class="empty-hint">æ¢ä¸ªå…³é”®è¯è¯•è¯•ï¼Œæˆ–è€…æµè§ˆå…¶ä»–åˆ†ç±»</text>
    </view>

    <!-- é”™è¯¯æç¤º -->
    <view class="error-state" wx:if="{{!loading && errorMessage}}">
      <text class="error-icon">âŒ</text>
      <text class="error-text">{{errorMessage}}</text>
      <button class="retry-btn" bindtap="initializePage">é‡æ–°åŠ è½½</button>
    </view>

    <!-- æ´»åŠ¨å¡ç‰‡åˆ—è¡¨ -->
    <view class="activity-items" wx:if="{{!loading && !isEmpty && !errorMessage}}">
      <view class="activity-card" wx:for="{{filteredActivities}}" wx:key="id" data-activity="{{item}}"
        bindtap="onActivityTap">
        <!-- æ´»åŠ¨å°é¢ -->
        <view class="card-cover">
          <image class="cover-image" src="{{item.cover}}" mode="aspectFill"></image>
          <!-- çŠ¶æ€æ ‡ç­¾ -->
          <view class="status-badge status-{{item.status}}">
            <text>{{item.status === 'ongoing' ? 'è¿›è¡Œä¸­' : item.status === 'upcoming' ? 'å³å°†å¼€å§‹' : 'å·²ç»“æŸ'}}</text>
          </view>
          <!-- çƒ­é—¨æ ‡ç­¾ -->
          <view class="hot-badge" wx:if="{{item.hot_score >= 90}}">
            <text>ğŸ”¥ çƒ­é—¨</text>
          </view>
        </view>

        <!-- æ´»åŠ¨ä¿¡æ¯ -->
        <view class="card-content">
          <!-- æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ -->
          <view class="card-header">
            <text class="card-title">{{item.title}}</text>
            <text class="card-subtitle">{{item.subtitle}}</text>
          </view>

          <!-- æ´»åŠ¨æ•°æ® -->
          <view class="card-data">
            <!-- å‚ä¸äººæ•° -->
            <view class="data-item" wx:if="{{item.participants_count}}">
              <text class="data-icon">ğŸ‘¥</text>
              <text class="data-text">{{item.participants_count}}äººå‚ä¸</text>
            </view>

            <!-- åé¢ä¿¡æ¯ -->
            <view class="data-item" wx:if="{{item.quota_total}}">
              <text class="data-icon">ğŸ“Š</text>
              <text class="data-text">å‰©ä½™{{item.quota_left}}/{{item.quota_total}}</text>
            </view>

            <!-- å¥–åŠ±ä¿¡æ¯ -->
            <view class="data-item" wx:if="{{item.reward_type === 'points' && item.reward_value}}">
              <text class="data-icon">ğŸ</text>
              <text class="data-text">{{item.reward_value}}ç§¯åˆ†</text>
            </view>
          </view>

          <!-- æ ‡ç­¾ -->
          <view class="card-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
          </view>

          <!-- CTAæŒ‰é’® -->
          <view class="card-footer">
            <button class="cta-btn {{item.status === 'ongoing' ? 'primary' : 'secondary'}}">
              {{item.cta_text}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more-tip" wx:if="{{filteredActivities.length > 0 && !loading}}">
      <text class="tip-text">å·²æ˜¾ç¤ºå…¨éƒ¨æ´»åŠ¨</text>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tip" wx:if="{{!loading && filteredActivities.length > 0}}">
    <text class="tip-icon">ğŸ’¡</text>
    <text class="tip-text">ç‚¹å‡»æ´»åŠ¨å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…å¹¶å‚ä¸</text>
  </view>
</view>
