<!--pages/records/trade-upload-records/trade-upload-records.wxml - ç§¯åˆ†æ´»åŠ¨è®°å½•é¡µé¢ï¼ˆäº¤æ˜“+ä¸Šä¼ åˆå¹¶ï¼‰-->
<view class="trade-upload-records-container">

  <!-- ğŸ”´ Tabåˆ‡æ¢æ  -->
  <view class="tab-section">
    <view class="tab-list">
      <block wx:for="{{tabs}}" wx:key="id">
        <view class="tab-item {{activeTab === item.id ? 'active' : ''}}" bind:tap="onTabChange" data-id="{{item.id}}">
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-name">{{item.name}}</text>
          <view class="tab-indicator" wx:if="{{activeTab === item.id}}"></view>
        </view>
      </block>
    </view>
  </view>

  <!-- ğŸ”´ åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- ============================================================================ -->
  <!-- ğŸ’° äº¤æ˜“è®°å½•Tabå†…å®¹ -->
  <!-- ============================================================================ -->
  <view class="trade-tab-content" wx:if="{{activeTab === 0 && !loading}}">

    <!-- ç»Ÿè®¡é¢æ¿ -->
    <view class="statistics-section">
      <view class="main-stats-grid">
        <view class="main-stat-card income">
          <view class="stat-header">
            <text class="stat-icon">ğŸ“ˆ</text>
            <text class="stat-label">æ€»æ”¶å…¥</text>
          </view>
          <text class="stat-value">+{{monthlyStats.totalIncome}}</text>
        </view>

        <view class="main-stat-card expense">
          <view class="stat-header">
            <text class="stat-icon">ğŸ“‰</text>
            <text class="stat-label">æ€»æ”¯å‡º</text>
          </view>
          <text class="stat-value">{{monthlyStats.totalExpense}}</text>
        </view>

        <view class="main-stat-card net">
          <view class="stat-header">
            <text class="stat-icon">ğŸ’</text>
            <text class="stat-label">å‡€æ”¶ç›Š</text>
          </view>
          <text class="stat-value">{{monthlyStats.netIncome > 0 ? '+' : ''}}{{monthlyStats.netIncome}}</text>
        </view>
      </view>
    </view>

    <!-- ç­›é€‰å·¥å…·æ  -->
    <view class="filter-section">
      <view class="filter-content">
        <view class="time-filters">
          <view class="filter-chip {{currentTimeFilter === 'all' ? 'active' : ''}}" bind:tap="onTimeFilter"
            data-filter="all">
            <text class="chip-text">å…¨éƒ¨</text>
          </view>
          <view class="filter-chip {{currentTimeFilter === 'today' ? 'active' : ''}}" bind:tap="onTimeFilter"
            data-filter="today">
            <text class="chip-text">ä»Šå¤©</text>
          </view>
          <view class="filter-chip {{currentTimeFilter === 'week' ? 'active' : ''}}" bind:tap="onTimeFilter"
            data-filter="week">
            <text class="chip-text">æœ¬å‘¨</text>
          </view>
          <view class="filter-chip {{currentTimeFilter === 'month' ? 'active' : ''}}" bind:tap="onTimeFilter"
            data-filter="month">
            <text class="chip-text">æœ¬æœˆ</text>
          </view>
        </view>

        <view class="filter-actions">
          <button class="filter-btn" bind:tap="onToggleFilter">
            <text class="btn-icon">ğŸ”</text>
            <text class="btn-text">ç­›é€‰</text>
          </button>
          <button class="filter-btn secondary" bind:tap="onResetFilters">
            <text class="btn-icon">ğŸ”„</text>
            <text class="btn-text">é‡ç½®</text>
          </button>
        </view>
      </view>
    </view>

    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="search-container">
        <view class="search-box">
          <text class="search-icon">ğŸ”</text>
          <input class="search-input" placeholder="æœç´¢äº¤æ˜“IDã€æè¿°..." value="{{searchKeyword}}" bind:input="onSearchInput" />
        </view>
      </view>
    </view>

    <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
    <view class="records-section">
      <view class="transaction-list">
        <block wx:if="{{filteredRecords.length > 0}}" wx:for="{{filteredRecords}}" wx:key="id">
          <view class="transaction-card">
            <view class="transaction-header">
              <view class="transaction-left">
                <view class="transaction-icon-wrapper">
                  <text class="transaction-icon">{{getTypeIcon(item.type)}}</text>
                </view>
                <view class="transaction-info">
                  <text class="transaction-title">{{item.title}}</text>
                  <text class="transaction-desc">{{item.description}}</text>
                  <text class="transaction-time">{{formatTime(item.created_at)}}</text>
                </view>
              </view>
              <view class="transaction-right">
                <text class="amount-value {{item.category}}">{{formatAmount(item.amount)}}ç§¯åˆ†</text>
              </view>
            </view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="transaction-actions">
              <button class="action-btn primary" bind:tap="onViewDetail" data-record="{{item}}">
                <text class="btn-icon">ğŸ“‹</text>
                <text class="btn-text">è¯¦æƒ…</text>
              </button>
            </view>
          </view>
        </block>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{filteredRecords.length === 0}}">
          <view class="empty-content">
            <text class="empty-icon">ğŸ“Š</text>
            <text class="empty-title">æš‚æ— äº¤æ˜“è®°å½•</text>
            <text class="empty-subtitle">å¿«å»å‚ä¸æ´»åŠ¨èµšå–ç§¯åˆ†å§ï¼</text>
            <button class="activity-action-btn" bind:tap="goToActivity">
              <text class="btn-icon">ğŸ‰</text>
              <text class="btn-text">å¼€å§‹èµšå–ç§¯åˆ†</text>
            </button>
          </view>
        </view>
      </view>
    </view>

  </view>

  <!-- ============================================================================ -->
  <!-- ğŸ“· ä¸Šä¼ è®°å½•Tabå†…å®¹ -->
  <!-- ============================================================================ -->
  <view class="upload-tab-content" wx:if="{{activeTab === 1 && !loading}}">

    <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="statistics-section">
      <view class="stats-grid">
        <view class="stat-card total">
          <view class="stat-icon">ğŸ“‹</view>
          <view class="stat-content">
            <text class="stat-number">{{uploadStatistics.totalCount}}</text>
            <text class="stat-label">æ€»ä¸Šä¼ </text>
          </view>
        </view>
        <view class="stat-card approved">
          <view class="stat-icon">âœ…</view>
          <view class="stat-content">
            <text class="stat-number">{{uploadStatistics.approvedCount}}</text>
            <text class="stat-label">å·²é€šè¿‡</text>
          </view>
        </view>
        <view class="stat-card pending">
          <view class="stat-icon">â³</view>
          <view class="stat-content">
            <text class="stat-number">{{uploadStatistics.pendingCount}}</text>
            <text class="stat-label">å¾…å®¡æ ¸</text>
          </view>
        </view>
        <view class="stat-card points">
          <view class="stat-icon">ğŸ’</view>
          <view class="stat-content">
            <text class="stat-number">{{uploadStatistics.totalEarnedPoints}}</text>
            <text class="stat-label">è·å¾—ç§¯åˆ†</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç­›é€‰æ ‡ç­¾ -->
    <view class="filter-section">
      <view class="filter-tabs">
        <block wx:for="{{uploadFilterOptions}}" wx:key="key">
          <button class="filter-tab {{uploadFilter === item.key ? 'active' : ''}}" bind:tap="switchUploadFilter"
            data-filter="{{item.key}}">
            <text class="filter-icon">{{item.icon}}</text>
            <text class="filter-name">{{item.name}}</text>
          </button>
        </block>
      </view>
    </view>

    <!-- ä¸Šä¼ è®°å½•åˆ—è¡¨ -->
    <view class="records-section">
      <view class="records-list">
        <block wx:if="{{uploadRecords.length > 0}}" wx:for="{{uploadRecords}}" wx:key="id">
          <view class="record-card">
            <view class="record-header">
              <view class="record-meta">
                <text class="record-time">{{formatTime(item.created_at)}}</text>
              </view>
              <view class="record-status {{formatReviewStatus(item.review_status).color}}">
                <text class="status-icon">{{formatReviewStatus(item.review_status).icon}}</text>
                <text class="status-text">{{formatReviewStatus(item.review_status).text}}</text>
              </view>
            </view>

            <view class="record-content">
              <view class="image-section">
                <view class="image-preview" bind:tap="previewImage" data-url="{{item.image_url}}">
                  <image src="{{item.image_url}}" mode="aspectFill" class="preview-image" />
                  <view class="preview-overlay">
                    <text class="preview-icon">ğŸ”</text>
                    <text class="preview-text">ç‚¹å‡»é¢„è§ˆ</text>
                  </view>
                </view>
              </view>

              <view class="upload-info">
                <text class="upload-desc" wx:if="{{item.description}}">{{item.description}}</text>
                <view class="points-info" wx:if="{{item.earned_points && item.review_status === 'approved'}}">
                  <view class="points-badge">
                    <text class="points-icon">ğŸ’°</text>
                    <text class="points-earned">+{{item.earned_points}}ç§¯åˆ†</text>
                  </view>
                </view>
                <view class="reject-reason" wx:if="{{item.reject_reason && item.review_status === 'rejected'}}">
                  <view class="reason-header">
                    <text class="reason-icon">âš ï¸</text>
                    <text class="reason-label">æ‹’ç»åŸå› </text>
                  </view>
                  <text class="reason-text">{{item.reject_reason}}</text>
                </view>
              </view>
            </view>

            <view class="record-actions">
              <button class="action-btn primary" bind:tap="viewReviewDetail" data-record="{{item}}">
                <text class="btn-icon">ğŸ“</text>
                <text class="btn-text">æŸ¥çœ‹è¯¦æƒ…</text>
              </button>
              <button class="action-btn warning" bind:tap="reuploadImage" data-id="{{item.id}}"
                wx:if="{{item.review_status === 'rejected'}}">
                <text class="btn-icon">ğŸ”„</text>
                <text class="btn-text">é‡æ–°ä¸Šä¼ </text>
              </button>
              <button class="action-btn danger" bind:tap="deleteRecord" data-id="{{item.id}}"
                wx:if="{{item.review_status === 'rejected'}}">
                <text class="btn-icon">ğŸ—‘ï¸</text>
                <text class="btn-text">åˆ é™¤</text>
              </button>
            </view>
          </view>
        </block>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{uploadRecords.length === 0}}">
          <view class="empty-content">
            <text class="empty-icon">ğŸ“·</text>
            <text class="empty-title">è¿˜æ²¡æœ‰ä¸Šä¼ è®°å½•</text>
            <text class="empty-subtitle">æ‹æ‘„æ¶ˆè´¹ç…§ç‰‡ï¼Œè½»æ¾è·å¾—ç§¯åˆ†å¥–åŠ±</text>
            <button class="upload-action-btn" bind:tap="goToCamera">
              <text class="btn-icon">ğŸ“·</text>
              <text class="btn-text">ç«‹å³ä¸Šä¼ ç…§ç‰‡</text>
            </button>
          </view>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more-section" wx:if="{{uploadHasMore && uploadRecords.length > 0}}">
          <view class="load-more-content" wx:if="{{loadingMore}}">
            <view class="loading-spinner small"></view>
            <text class="loading-text">åŠ è½½æ›´å¤š...</text>
          </view>
          <view class="load-more-content" wx:else>
            <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
          </view>
        </view>

        <!-- æ²¡æœ‰æ›´å¤š -->
        <view class="no-more-section" wx:if="{{!uploadHasMore && uploadRecords.length > 0}}">
          <view class="no-more-line"></view>
          <text class="no-more-text">å·²æ˜¾ç¤ºå…¨éƒ¨è®°å½•</text>
          <view class="no-more-line"></view>
        </view>
      </view>
    </view>

  </view>

  <!-- ğŸ”´ åˆ·æ–°æç¤º -->
  <view class="refresh-hint" wx:if="{{refreshing}}">
    <view class="refresh-content">
      <view class="refresh-spinner"></view>
      <text class="refresh-text">åˆ·æ–°ä¸­...</text>
    </view>
  </view>

</view>