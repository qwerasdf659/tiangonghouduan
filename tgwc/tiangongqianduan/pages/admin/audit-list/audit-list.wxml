<!-- pages/admin/audit-list/audit-list.wxml -->
<view class="audit-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">å®¡æ ¸åˆ—è¡¨</text>
    <view class="page-subtitle">
      <text>å¾…å®¡æ ¸ï¼š{{total}}æ¡</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && records.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— å¾…å®¡æ ¸è®°å½•</text>
      <text class="empty-desc">æ‰€æœ‰æ¶ˆè´¹è®°å½•å·²å®¡æ ¸å®Œæˆ</text>
    </view>

    <!-- è®°å½•å¡ç‰‡ -->
    <view class="record-card" wx:for="{{records}}" wx:key="record_id">
      <!-- å¡ç‰‡å¤´éƒ¨ -->
      <view class="card-header">
        <view class="user-info">
          <text class="user-icon">ğŸ‘¤</text>
          <view class="user-details">
            <text class="user-name">{{item.user_nickname || item.user_mobile}}</text>
            <text class="user-mobile">{{item.user_mobile}}</text>
          </view>
        </view>
        <view class="status-badge pending">
          <text>å¾…å®¡æ ¸</text>
        </view>
      </view>

      <!-- å¡ç‰‡ä¸»ä½“ -->
      <view class="card-body">
        <!-- æ¶ˆè´¹é‡‘é¢ -->
        <view class="info-row highlight">
          <text class="info-label">æ¶ˆè´¹é‡‘é¢</text>
          <text class="info-value amount">Â¥{{item.consumption_amount}}</text>
        </view>

        <!-- é¢„è®¡ç§¯åˆ† -->
        <view class="info-row highlight">
          <text class="info-label">é¢„è®¡ç§¯åˆ†</text>
          <text class="info-value points">{{item.points_to_award}}åˆ†</text>
        </view>

        <!-- å•†å®¶å¤‡æ³¨ -->
        <view class="info-row" wx:if="{{item.merchant_notes}}">
          <text class="info-label">å•†å®¶å¤‡æ³¨</text>
          <text class="info-value notes">{{item.merchant_notes}}</text>
        </view>

        <!-- æäº¤æ—¶é—´ -->
        <view class="info-row">
          <text class="info-label">æäº¤æ—¶é—´</text>
          <text class="info-value time">{{item.created_at_formatted || item.created_at}}</text>
        </view>
        <!-- æ—¶åŒºæ ‡æ³¨ -->
        <view class="info-row">
          <text class="info-label timezone-note">ï¼ˆåŒ—äº¬æ—¶é—´ GMT+8ï¼‰</text>
        </view>
      </view>

      <!-- å¡ç‰‡åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <view class="card-footer">
        <button 
          class="action-btn reject-btn" 
          bindtap="onReject" 
          data-record="{{item}}"
          disabled="{{submitting}}"
        >
          <text class="btn-icon">âŒ</text>
          <text class="btn-text">æ‹’ç»</text>
        </button>
        <button 
          class="action-btn approve-btn" 
          bindtap="onApprove" 
          data-record="{{item}}"
          disabled="{{submitting}}"
        >
          <text class="btn-icon">âœ…</text>
          <text class="btn-text">é€šè¿‡</text>
        </button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <text class="load-more-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ®æç¤º -->
    <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
      <text class="no-more-text">å·²åŠ è½½å…¨éƒ¨è®°å½•</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading && !refreshing}}">
    <view class="loading-icon"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½...</text>
  </view>

  <!-- å®¡æ ¸æ‹’ç»å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showRejectModal}}" bindtap="cancelReject">
    <view class="modal-content" catchtap="{{''}}">
      <view class="modal-header">
        <text class="modal-title">å®¡æ ¸æ‹’ç»</text>
        <view class="modal-close" bindtap="cancelReject">
          <text>âœ•</text>
        </view>
      </view>

      <view class="modal-body">
        <!-- æ‹’ç»åŸå› è¾“å…¥ -->
        <view class="input-label">æ‹’ç»åŸå› ï¼ˆå¿…å¡«ï¼Œè‡³å°‘5ä¸ªå­—ç¬¦ï¼‰</view>
        <textarea
          class="reject-reason-input"
          placeholder="è¯·è¾“å…¥æ‹’ç»åŸå› ï¼Œå¦‚ï¼šæ¶ˆè´¹é‡‘é¢ä¸å®é™…ä¸ç¬¦"
          value="{{rejectReason}}"
          bindinput="onRejectReasonInput"
          maxlength="200"
          auto-height
        />
        <view class="input-tips">ï¼ˆæ‹’ç»åç”¨æˆ·å°†æ”¶åˆ°é€šçŸ¥ï¼Œè¯·è°¨æ…æ“ä½œï¼‰</view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="cancelReject">
          å–æ¶ˆ
        </button>
        <button 
          class="modal-btn confirm-btn" 
          bindtap="confirmReject"
          disabled="{{submitting}}"
        >
          {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤æ‹’ç»'}}
        </button>
      </view>
    </view>
  </view>
</view>
