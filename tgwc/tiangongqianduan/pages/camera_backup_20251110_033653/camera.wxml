<!--pages/camera/camera.wxml - å‘ç°é¡µé¢æ¨¡æ¿-->

<view class="discover-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="user-info">
      <text class="welcome">ğŸ” å‘ç°ç²¾å½©</text>
      <view class="points-info">
        <view class="points-item">
          <text class="points-label">å¯ç”¨ç§¯åˆ†ï¼š</text>
          <text class="points-value">{{pointsBalance}}</text>
        </view>
        <view class="points-item frozen">
          <text class="points-label">å†»ç»“ç§¯åˆ†ï¼š</text>
          <text class="points-value frozen">{{frozenPoints}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="statistics-card">
    <view class="stat-item">
      <text class="stat-value">{{statistics.totalCount}}</text>
      <text class="stat-label">æ€»è®°å½•</text>
    </view>
    <view class="stat-item">
      <text class="stat-value pending">{{statistics.pendingCount}}</text>
      <text class="stat-label">å®¡æ ¸ä¸­</text>
    </view>
    <view class="stat-item">
      <text class="stat-value approved">{{statistics.approvedCount}}</text>
      <text class="stat-label">å·²é€šè¿‡</text>
    </view>
    <view class="stat-item">
      <text class="stat-value rejected">{{statistics.rejectedCount}}</text>
      <text class="stat-label">å·²æ‹’ç»</text>
    </view>
  </view>

  <!-- ç­›é€‰æŒ‰é’® -->
  <view class="filter-bar">
    <view class="filter-item {{filterStatus === item.key ? 'active' : ''}}" wx:for="{{filterOptions}}" wx:key="key"
      data-status="{{item.key}}" bindtap="onFilterChange">
      <text class="filter-icon">{{item.icon}}</text>
      <text class="filter-name">{{item.name}}</text>
    </view>
  </view>

  <!-- æ¶ˆè´¹è®°å½•åˆ—è¡¨ -->
  <view class="records-list">
    <!-- ç©ºçŠ¶æ€æç¤º -->
    <view class="empty-state" wx:if="{{!loading && consumeRecords.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— æ¶ˆè´¹è®°å½•</text>
      <button class="qrcode-btn" bindtap="goToShowQRCode">å±•ç¤ºäºŒç»´ç ä¾›å•†å®¶æ‰«æ</button>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="record-item" wx:for="{{consumeRecords}}" wx:key="id" data-record="{{item}}" bindtap="onViewDetail">
      <!-- è®°å½•å¤´éƒ¨ -->
      <view class="record-header">
        <view class="merchant-info">
          <text class="merchant-icon">ğŸª</text>
          <text class="merchant-name">{{item.merchant_name || 'çº¿ä¸‹å•†å®¶'}}</text>
        </view>
        <view class="status-badge status-{{item.status}}">
          <text>{{item.status === 'pending' ? 'å®¡æ ¸ä¸­' : item.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'}}</text>
        </view>
      </view>

      <!-- è®°å½•å†…å®¹ -->
      <view class="record-content">
        <view class="content-row">
          <text class="label">æ¶ˆè´¹é‡‘é¢ï¼š</text>
          <text class="value amount">Â¥{{item.amount}}</text>
        </view>
        <view class="content-row">
          <text class="label">è·å¾—ç§¯åˆ†ï¼š</text>
          <text class="value points">{{item.points || 0}}åˆ†</text>
        </view>
        <view class="content-row">
          <text class="label">æ¶ˆè´¹æ—¶é—´ï¼š</text>
          <text class="value time">{{item.created_at}}</text>
        </view>
        <!-- å®¡æ ¸ä¿¡æ¯ -->
        <view class="content-row" wx:if="{{item.status === 'approved' && item.approved_at}}">
          <text class="label">å®¡æ ¸æ—¶é—´ï¼š</text>
          <text class="value time approved">{{item.approved_at}}</text>
        </view>
        <view class="content-row" wx:if="{{item.status === 'rejected' && item.reject_reason}}">
          <text class="label">æ‹’ç»åŸå› ï¼š</text>
          <text class="value reason rejected">{{item.reject_reason}}</text>
        </view>
      </view>

      <!-- æç¤ºä¿¡æ¯ -->
      <view class="record-tip" wx:if="{{item.status === 'pending'}}">
        <text class="tip-icon">â°</text>
        <text class="tip-text">å®¡æ ¸ä¸­ï¼Œé¢„è®¡24å°æ—¶å†…å®Œæˆ</text>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view class="load-more" wx:if="{{consumeRecords.length > 0}}">
      <text class="load-text" wx:if="{{loading}}">åŠ è½½ä¸­...</text>
      <text class="load-text" wx:elif="{{!hasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
      <text class="load-text" wx:else>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tip">
    <text class="tip-icon">ğŸ’¡</text>
    <text class="tip-text">æ¶ˆè´¹åè¯·å‘å•†å®¶å±•ç¤ºæ‚¨çš„èº«ä»½äºŒç»´ç </text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading && consumeRecords.length === 0}}">
    <text class="loading-text">æ­£åœ¨åŠ è½½ç²¾å½©å†…å®¹...</text>
  </view>
</view>