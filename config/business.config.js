/**
 * 餐厅积分抽奖系统 - 统一业务配置
 * 
 * @description 集中管理所有业务规则，配置即文档
 * @version 1.0.0
 * @created 2025-10-21
 * 
 * 核心原则：
 * 1. 配置即文档：配置文件就是业务规则说明书
 * 2. 单一数据源：所有业务规则都在这里定义
 * 3. 向后兼容：新增配置必须提供默认值
 * 4. 易于调整：修改业务规则只需改这个文件，重启服务即可生效
 */

module.exports = {
  // ====================================
  // 🎰 抽奖系统配置
  // ====================================
  lottery: {
    /**
     * 连抽定价配置
     * 
     * @description 定义不同抽奖类型的价格和折扣
     * @业务规则 
     * - 单抽/3连抽/5连抽：无折扣，按100积分/次计算
     * - 10连抽：九折优惠，900积分（节省100积分）
     */
    draw_pricing: {
      single: { 
        total_cost: 100,    // 总消耗积分
        count: 1,           // 抽奖次数
        discount: 1.0,      // 折扣率（1.0=无折扣）
        per_draw: 100,      // 单次价格
        label: '单抽'       // 前端显示名称
      },
      triple: { 
        total_cost: 300,    // 3次共300积分
        count: 3, 
        discount: 1.0,      // 无折扣
        per_draw: 100, 
        label: '3连抽' 
      },
      five: { 
        total_cost: 500,    // 5次共500积分
        count: 5, 
        discount: 1.0,      // 无折扣
        per_draw: 100, 
        label: '5连抽' 
      },
      ten: { 
        total_cost: 900,    // 🎁 10次仅需900积分（节省100积分）
        count: 10, 
        discount: 0.9,      // 九折优惠
        per_draw: 90,       // 折后单价
        label: '10连抽(九折)' 
      }
    },
    
    /**
     * 每日抽奖次数限制
     * 
     * @description 所有用户类型统一限制，防止刷奖
     * @业务规则 普通用户和管理员都是每日50次上限
     */
    daily_limit: {
      all: 50,  // 所有用户类型统一50次/日
      reset_time: '00:00:00'  // 每日0点重置（北京时间）
    },
    
    /**
     * 免费抽奖控制
     * 
     * @description 是否允许免费抽奖（cost_per_draw=0）
     * @业务规则 禁止免费抽奖，所有抽奖必须消耗积分
     */
    free_draw_allowed: false  // false=禁止免费抽奖
  },

  // ====================================
  // 💰 积分系统配置
  // ====================================
  points: {
    /**
     * 积分余额限制
     * 
     * @description 用户可持有的积分上下限
     * @数据库支持 DECIMAL(10,2) 最大值：99,999,999.99
     * @业务规则 
     * - 上限：99,999,999.99（数据库技术上限）
     * - 下限：0（不能为负数）
     */
    max_balance: 99999999.99,  // 积分上限（约1亿积分）
    min_balance: 0,            // 积分下限（不能为负）
    
    /**
     * 积分显示名称
     * 
     * @description 前端统一显示名称
     * @业务规则 统一显示为"积分"，不可调整
     */
    display_name: '积分',
    
    /**
     * 积分操作验证规则
     * 
     * @description 所有积分操作必须遵守的规则
     */
    validation: {
      allow_negative: false,        // 禁止负数积分
      allow_zero_balance: true,      // 允许余额为0
      enforce_transaction: true     // 强制事务保护
    }
  },

  // ====================================
  // 👤 用户系统配置
  // ====================================
  user: {
    /**
     * 昵称长度限制
     * 
     * @description 前后端统一验证规则
     * @业务规则 2-50个字符（中文、字母、数字、下划线）
     */
    nickname: { 
      min_length: 2,      // 最小2个字符
      max_length: 50,     // 最大50个字符
      pattern: /^[\u4e00-\u9fa5a-zA-Z0-9_]+$/  // 允许的字符
    },
    
    /**
     * 验证码有效期
     * 
     * @description 短信验证码/邮箱验证码有效期
     * @业务规则 前后端统一300秒（5分钟）
     */
    verification_code: { 
      expiry_seconds: 300,  // 300秒（5分钟）
      resend_interval: 60   // 60秒后才能重新发送
    }
  },

  // ====================================
  // 📤 文件上传配置
  // ====================================
  upload: {
    /**
     * 图片上传限制
     * 
     * @description 拍照功能的文件类型和大小限制
     * @业务规则 
     * - 普通用户和管理员权限相同
     * - 仅支持图片类型
     * - 单次上传1张
     */
    image: { 
      max_size_mb: 10,              // 最大10MB
      max_size_bytes: 10485760,     // 10MB = 10 * 1024 * 1024
      max_count: 1,                // 单次上传1张
      allowed_types: ['image/*'],  // 允许所有图片格式
      allowed_extensions: ['.jpg', '.jpeg', '.png', '.gif', '.webp']
    }
  },

  // ====================================
  // 📄 分页配置
  // ====================================
  pagination: {
    /**
     * 普通用户分页配置
     * 
     * @description 列表查询的默认和最大分页数
     * @业务规则 默认20条，最大50条
     */
    user: { 
      default: 20,  // 默认每页20条
      max: 50       // 最大每页50条
    },
    
    /**
     * 管理员分页配置
     * 
     * @description 管理员可查看更多数据
     * @业务规则 默认20-50条可配置，最大100-200条
     */
    admin: { 
      default: 50,   // 默认每页50条
      max: 200       // 最大每页200条
    }
  }
}

