# å¾®ä¿¡å°ç¨‹åºå‰ç«¯é€‚é…åç«¯ - å¯¹é½åˆ†ææ–¹æ¡ˆ

> ç”Ÿæˆæ—¶é—´ï¼š2026-02-06  
> æ•°æ®æ¥æºï¼šåç«¯çœŸå®ä»£ç  + çœŸå®æ•°æ®åº“è¿æ¥æŸ¥è¯¢  
> å‰ç«¯ç›®å½•ï¼š`tgwc/tiangongqianduan`  
> åç«¯ç›®å½•ï¼š`/home/devbox/project`  

---

## ä¸€ã€æ ¸å¿ƒåŸåˆ™

1. **åç«¯æ•°æ®åº“æ˜¯æƒå¨æº**ï¼šä¸€åˆ‡ä»¥åç«¯çœŸå®æ•°æ®åº“è¡¨ç»“æ„ã€çœŸå® API è·¯ç”±ä¸ºå‡†
2. **å‰ç«¯é€‚é…åç«¯**ï¼šä¸æ”¹é¡µé¢ç»“æ„/æ ·å¼/äº¤äº’ï¼Œåªæ”¹ API è°ƒç”¨è·¯å¾„ã€æ•°æ®æ ¼å¼è½¬æ¢ã€é”™è¯¯å¤„ç†
3. **ä¸å…¼å®¹æ—§é€»è¾‘**ï¼šå‰ç«¯ä»£ç ä¸­å·²æœ‰çš„æ—§æ¥å£è°ƒç”¨å¦‚æœè·Ÿåç«¯å¯¹ä¸ä¸Šï¼Œç›´æ¥æ”¹æ‰
4. **ä¸ç”¨æ¨¡æ‹Ÿæ•°æ®**ï¼šè°ƒä¸é€šå°±æ˜¾ç¤ºé”™è¯¯æç¤º
5. **å‰ç«¯ = æ•°æ®å±•ç¤ºå±‚ï¼Œåç«¯ = ä¸šåŠ¡é€»è¾‘ + æ•°æ®å¤„ç†**

---

## äºŒã€é¡¹ç›®å…¨è²Œï¼ˆåŸºäºçœŸå®ä»£ç å’Œæ•°æ®åº“ï¼‰

### ä¸šåŠ¡æ¨¡å¼

**é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ** â†’ ç”¨æˆ·åœ¨é¤å…æ¶ˆè´¹ â†’ è·å¾—ç§¯åˆ† â†’ ç§¯åˆ†å¯ä»¥ç”¨æ¥ï¼šæŠ½å¥–ã€å…‘æ¢å•†å“ã€åœ¨å¸‚åœºäº¤æ˜“

### æŠ€æœ¯æ¶æ„

| å±‚çº§ | æŠ€æœ¯ |
|---|---|
| åç«¯ | Node.js + Express + Sequelize + MySQL + Redis |
| å‰ç«¯ | å¾®ä¿¡å°ç¨‹åºï¼ˆåŸç”Ÿå¼€å‘ï¼‰ |
| APIç‰ˆæœ¬ | V4.0 ç»Ÿä¸€å¼•æ“æ¶æ„ |
| è®¤è¯ | JWTï¼ˆaccess_token + refresh_tokenï¼‰ |
| éƒ¨ç½² | Sealos DevBox |

### æ•°æ®åº“çœŸå®çŠ¶æ€ï¼ˆå…³é”®ä¸šåŠ¡è¡¨ï¼‰

| è¡¨å | è®°å½•æ•° | è¯´æ˜ |
|---|---|---|
| users | 59 | ç”¨æˆ· |
| lottery_campaigns | 4 | æŠ½å¥–æ´»åŠ¨ï¼ˆ1ä¸ªactiveï¼šBASIC_LOTTERYï¼‰ |
| lottery_prizes | 30 | å¥–å“ |
| lottery_draws | 1642 | æŠ½å¥–è®°å½• |
| products | 52 | å…‘æ¢å•†å“ |
| item_instances | 5913 | ç”¨æˆ·åº“å­˜ç‰©å“ |
| item_templates | 16 | ç‰©å“æ¨¡æ¿ |
| market_listings | 272 | äº¤æ˜“å¸‚åœºæŒ‚å• |
| consumption_records | 48 | æ¶ˆè´¹å½•å…¥è®°å½• |
| accounts | 55 | èµ„äº§è´¦æˆ· |
| account_asset_balances | 42 | èµ„äº§ä½™é¢ |
| material_asset_types | 4 | èµ„äº§ç±»å‹ï¼šPOINTSã€DIAMONDã€red_shardã€BUDGET_POINTS |
| stores | 5 | é¤å…é—¨åº— |
| store_staff | 3 | é—¨åº—å‘˜å·¥ |
| customer_service_sessions | 13 | å®¢æœä¼šè¯ |
| chat_messages | 432 | èŠå¤©æ¶ˆæ¯ |
| feedbacks | 147 | ç”¨æˆ·åé¦ˆ |
| system_announcements | 73 | ç³»ç»Ÿå…¬å‘Š |
| popup_banners | 4 | å¼¹çª—æ¨ªå¹… |
| image_resources | 0 | å›¾ç‰‡èµ„æºï¼ˆç©ºï¼‰ |
| exchange_records | 0 | å…‘æ¢è®°å½•ï¼ˆç©ºï¼‰ |

### èµ„äº§ç±»å‹ï¼ˆmaterial_asset_types çœŸå®æ•°æ®ï¼‰

| asset_code | display_name | group_code | form | tier |
|---|---|---|---|---|
| red_shard | çº¢è‰²ç¢ç‰‡ | red | shard | 1 |
| POINTS | æ™®é€šç§¯åˆ† | points | crystal | 0 |
| BUDGET_POINTS | é¢„ç®—ç§¯åˆ† | points | crystal | 0 |
| DIAMOND | é’»çŸ³ | currency | currency | 10 |

### è§’è‰²ä½“ç³»ï¼ˆroles çœŸå®æ•°æ®ï¼‰

| role_name | role_level | description |
|---|---|---|
| user | 0 | æ™®é€šç”¨æˆ· |
| merchant_staff | 20 | å•†å®¶å‘˜å·¥ï¼ˆå¯æ‰§è¡Œæ¶ˆè´¹å½•å…¥ï¼‰ |
| ops | 30 | è¿è¥åªè¯»è§’è‰² |
| sales_staff | 40 | ä¸šåŠ¡å‘˜ |
| merchant_manager | 40 | å•†å®¶åº—é•¿ |
| business_manager | 60 | ä¸šåŠ¡ç»ç† |
| regional_manager | 80 | åŒºåŸŸè´Ÿè´£äºº |
| admin | 100 | ç®¡ç†å‘˜ï¼ˆå…¨éƒ¨æƒé™ï¼‰ |

---

## ä¸‰ã€åç«¯çœŸå®è·¯ç”±æŒ‚è½½ï¼ˆä» app.js ç¡®è®¤ï¼‰

```
/api/v4/auth              â†’ è®¤è¯ï¼ˆlogin, verify, profile, refresh, quick-login, logoutï¼‰
/api/v4/permissions       â†’ æƒé™æ£€æŸ¥
/api/v4/lottery           â†’ æŠ½å¥–ï¼ˆdraw, campaigns, prizes, history, configï¼‰
/api/v4/market            â†’ äº¤æ˜“å¸‚åœºï¼ˆlistings, buy, sell, manageï¼‰
/api/v4/shop              â†’ å•†åŸï¼ˆexchange, consumption/qrcode, premium, staff, audit, redemption, assetsï¼‰
/api/v4/system            â†’ ç³»ç»Ÿï¼ˆannouncements, chat, feedback, status, popup-banners, notifications, dictionaries, statisticsï¼‰
/api/v4/user              â†’ ç”¨æˆ·ï¼ˆ/meï¼‰
/api/v4/assets            â†’ èµ„äº§ï¼ˆbalance, transactions, conversion-rulesï¼‰
/api/v4/backpack          â†’ èƒŒåŒ…/åº“å­˜
/api/v4/merchant-points   â†’ å•†æˆ·ç§¯åˆ†
/api/v4/activities        â†’ æ´»åŠ¨
/api/v4/console           â†’ ç®¡ç†åå°ï¼ˆéå°ç¨‹åºç”¨æˆ·ä½¿ç”¨ï¼‰
/api/v4/debug-control     â†’ è°ƒè¯•æ§åˆ¶
```

### åç«¯è·¯ç”±æ–‡ä»¶ç»“æ„

```
routes/v4/
â”œâ”€â”€ auth/           â†’ login.js, profile.js, token.js, permissions.js, index.js
â”œâ”€â”€ lottery/        â†’ draw.js, campaigns.js, history.js, user-points.js, middleware.js, lottery-preset.js, index.js
â”œâ”€â”€ market/         â†’ listings.js, buy.js, sell.js, manage.js, index.js
â”œâ”€â”€ shop/
â”‚   â”œâ”€â”€ exchange/   â†’ exchange.js, orders.js, items.js, statistics.js, index.js
â”‚   â”œâ”€â”€ consumption/â†’ qrcode.js
â”‚   â”œâ”€â”€ audit/      â†’ index.js
â”‚   â”œâ”€â”€ redemption/ â†’ orders.js, fulfill.js, query.js, index.js
â”‚   â”œâ”€â”€ assets/     â†’ rules.js, convert.js, index.js
â”‚   â”œâ”€â”€ risk/       â†’ index.js
â”‚   â”œâ”€â”€ staff/      â†’ index.js
â”‚   â””â”€â”€ premium.js
â”œâ”€â”€ system/         â†’ announcements.js, chat.js, feedback.js, status.js, popup-banners.js, notifications.js, dictionaries.js, statistics.js, user-stats.js, index.js
â”œâ”€â”€ user/           â†’ index.js
â”œâ”€â”€ assets/         â†’ balance.js, transactions.js, conversion-rules.js, index.js
â”œâ”€â”€ backpack/       â†’ index.js
â”œâ”€â”€ console/        â†’ (å¤§é‡ç®¡ç†åå°è·¯ç”±ï¼Œéå°ç¨‹åºå‰ç«¯ä½¿ç”¨)
â”œâ”€â”€ activities.js
â”œâ”€â”€ merchant-points.js
â””â”€â”€ debug-control.js
```

---

## å››ã€å‰ç«¯é¡µé¢ç»“æ„

### TabBar é¡µé¢ï¼ˆ4ä¸ªä¸»æ ‡ç­¾ï¼‰

| æ ‡ç­¾ | é¡µé¢è·¯å¾„ | åŠŸèƒ½ |
|---|---|---|
| ğŸ° æŠ½å¥– | pages/lottery/lottery | æŠ½å¥–è½¬ç›˜ |
| ğŸ” å‘ç° | pages/camera/camera | æ´»åŠ¨èšåˆå…¥å£ |
| ğŸ å…‘æ¢ | pages/exchange/exchange | ç§¯åˆ†å…‘æ¢å•†å“ |
| ğŸ‘¤ æˆ‘çš„ | pages/user/user | ç”¨æˆ·ä¸­å¿ƒ |

### å­é¡µé¢

| é¡µé¢è·¯å¾„ | åŠŸèƒ½ |
|---|---|
| pages/auth/auth | ç™»å½•/è®¤è¯ |
| pages/points-detail/points-detail | ç§¯åˆ†è¯¦æƒ…/å†å² |
| pages/trade/market/market | äº¤æ˜“å¸‚åœº |
| pages/trade/inventory/inventory | ç”¨æˆ·åº“å­˜ |
| pages/records/trade-upload-records/trade-upload-records | ç§¯åˆ†æ´»åŠ¨è®°å½• |
| pages/chat/chat | å®¢æœèŠå¤© |
| pages/feedback/feedback | åé¦ˆæäº¤ |
| pages/admin/admin-dashboard/admin-dashboard | ç®¡ç†å‘˜ä»ªè¡¨æ¿ |
| pages/admin/consume-submit/consume-submit | æ¶ˆè´¹å½•å…¥ï¼ˆå•†å®¶æ‰«ç ï¼‰ |
| pages/admin/audit-list/audit-list | å®¡æ ¸åˆ—è¡¨ |
| pages/admin/customer-service/customer-service | ç®¡ç†å‘˜å®¢æœ |
| pages/admin/chat-management/chat-management | èŠå¤©å·¥ä½œå° |

---

## äº”ã€ğŸ”´ æ ¸å¿ƒå‘ç°ï¼šå‰ç«¯ API è·¯å¾„ä¸åç«¯çœŸå®è·¯ç”±ä¸¥é‡ä¸åŒ¹é…

### å¯¹ç…§è¡¨

| åŠŸèƒ½æ¨¡å— | å‰ç«¯å½“å‰è·¯å¾„ï¼ˆapi.jsï¼‰ | åç«¯çœŸå®è·¯å¾„ | çŠ¶æ€ |
|---|---|---|---|
| **ç™»å½•** | `/auth/login` | `/api/v4/auth/login` | âœ… åŒ¹é… |
| **å¿«é€Ÿç™»å½•** | `/auth/quick-login` | `/api/v4/auth/quick-login` | âœ… åŒ¹é… |
| **ç”¨æˆ·ä¿¡æ¯** | `/auth/profile` | `/api/v4/auth/profile` | âœ… åŒ¹é… |
| **TokenéªŒè¯** | `/auth/verify` (POST) | `/api/v4/auth/verify` (GET) | âš ï¸ HTTPæ–¹æ³•å¯èƒ½ä¸åŒ¹é… |
| **Tokenåˆ·æ–°** | `/auth/refresh` | `/api/v4/auth/refresh` | âœ… åŒ¹é… |
| **ç§¯åˆ†ä½™é¢** | `/points/balance/:user_id` | `/api/v4/assets/balance/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **å½“å‰ç”¨æˆ·ä½™é¢** | `/points/balance` | `/api/v4/assets/balance/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç§¯åˆ†äº¤æ˜“å†å²** | `/points/transactions/:user_id` | `/api/v4/assets/transactions/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç”¨æˆ·ç»Ÿè®¡** | `/points/user/statistics/:user_id` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **ç®¡ç†å‘˜ç§¯åˆ†è°ƒæ•´** | `/points/admin/adjust` | å¯èƒ½åœ¨ `/api/v4/console/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç®¡ç†å‘˜ç§¯åˆ†ç»Ÿè®¡** | `/points/admin/statistics` | å¯èƒ½åœ¨ `/api/v4/console/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æŠ½å¥–-æ´»åŠ¨åˆ—è¡¨** | `/lottery/campaigns` | `/api/v4/lottery/campaigns` | âœ… åŒ¹é… |
| **æŠ½å¥–-å¥–å“åˆ—è¡¨** | `/lottery/prizes/:code` | `/api/v4/lottery/:code/prizes` | âš ï¸ è·¯å¾„å‚æ•°ä½ç½®ä¸åŒ |
| **æŠ½å¥–-é…ç½®** | `/lottery/config/:code` | `/api/v4/lottery/:code/config` | âš ï¸ è·¯å¾„å‚æ•°ä½ç½®ä¸åŒ |
| **æŠ½å¥–-æ‰§è¡Œ** | `/lottery/draw` | `/api/v4/lottery/draw` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤POST bodyï¼‰ |
| **æŠ½å¥–-å†å²** | `/lottery/history/:user_id` | `/api/v4/lottery/history/:user_id` | âœ… åŒ¹é… |
| **ç”¨æˆ·åº“å­˜** | `/inventory/user/:user_id` | `/api/v4/backpack/*` | âŒ æ¨¡å—å®Œå…¨ä¸åŒ |
| **ç‰©å“è¯¦æƒ…** | `/inventory/item/:item_id` | `/api/v4/backpack/*` | âŒ æ¨¡å—å®Œå…¨ä¸åŒ |
| **ä½¿ç”¨ç‰©å“** | `/inventory/use/:item_id` | `/api/v4/backpack/*` | âŒ æ¨¡å—å®Œå…¨ä¸åŒ |
| **å…‘æ¢å•†å“åˆ—è¡¨** | `/inventory/products` | `/api/v4/shop/exchange/items` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æ‰§è¡Œå…‘æ¢** | `/inventory/exchange` | `/api/v4/shop/exchange/` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **å…‘æ¢è®°å½•** | `/inventory/exchange-records` | `/api/v4/shop/exchange/orders` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **å–æ¶ˆå…‘æ¢** | `/inventory/exchange-records/:id/cancel` | `/api/v4/shop/exchange/orders/:id/cancel` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç”Ÿæˆæ ¸é”€ç ** | `/inventory/generate-code/:item_id` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **è½¬ç§»ç‰©å“** | `/inventory/transfer` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **è½¬ç§»å†å²** | `/inventory/transfer-history` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **ç®¡ç†å‘˜åº“å­˜ç»Ÿè®¡** | `/inventory/admin/statistics` | å¯èƒ½åœ¨ `/api/v4/console/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **å¸‚åœºå•†å“åˆ—è¡¨** | `/inventory/market/products` | `/api/v4/market/listings` | âŒ æ¨¡å—å®Œå…¨ä¸åŒ |
| **å¸‚åœºå•†å“è¯¦æƒ…** | `/inventory/market/products/:id` | `/api/v4/market/listings/:id` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **è´­ä¹°å¸‚åœºå•†å“** | `/inventory/market/products/:id/purchase` | `/api/v4/market/buy` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æ’¤å›å¸‚åœºå•†å“** | `/inventory/market/products/:id/withdraw` | `/api/v4/market/manage` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æ¶ˆè´¹äºŒç»´ç ** | `/consumption/qrcode/:user_id` | `/api/v4/shop/consumption/qrcode/:user_id` | âŒ ç¼ºå°‘ shop å‰ç¼€ |
| **æ¶ˆè´¹æäº¤** | `/consumption/submit` | `/api/v4/shop/consumption/*` | âŒ ç¼ºå°‘ shop å‰ç¼€ |
| **æ¶ˆè´¹å®¡æ ¸-å¾…å®¡åˆ—è¡¨** | `/consumption/pending` | `/api/v4/shop/audit/*` æˆ– `/api/v4/shop/consumption/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æ¶ˆè´¹å®¡æ ¸-é€šè¿‡** | `/consumption/approve/:record_id` | `/api/v4/shop/audit/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **æ¶ˆè´¹å®¡æ ¸-æ‹’ç»** | `/consumption/reject/:record_id` | `/api/v4/shop/audit/*` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **å®¡æ ¸è®°å½•æ•°é‡** | `/consumption/my-recent-audits/count` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **å®¡æ ¸è®°å½•åˆ—è¡¨** | `/consumption/my-recent-audits` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **æ ¹æ®äºŒç»´ç è·å–ç”¨æˆ·** | `/consumption/user-info` | å¾…ç¡®è®¤ | âŒ å¾…ç¡®è®¤ |
| **å›¾ç‰‡ä¸Šä¼ ** | `/photo/upload` | âŒ å·²åºŸå¼ƒï¼Œå‰ç«¯ç”¨æˆ·ç«¯æ— æ­¤è·¯ç”±ï¼›å›¾ç‰‡ä¸Šä¼ å·²æ•´åˆåˆ°ç®¡ç†åå° `/api/v4/console/images` | âŒ å·²åºŸå¼ƒ |
| **æˆ‘çš„ä¸Šä¼ ** | `/photo/my-uploads` | âŒ å·²åºŸå¼ƒï¼Œåç«¯æ— æ­¤è·¯ç”± | âŒ å·²åºŸå¼ƒ |
| **ä¸Šä¼ ç»Ÿè®¡** | `/photo/my-stats` | âŒ å·²åºŸå¼ƒï¼Œåç«¯æ— æ­¤è·¯ç”± | âŒ å·²åºŸå¼ƒ |
| **å¾…å®¡æ ¸å›¾ç‰‡** | `/photo/pending-reviews` | âŒ å·²åºŸå¼ƒï¼Œå®¡æ ¸åŠŸèƒ½ç»Ÿä¸€å¹¶å…¥ `content_review_records` è¡¨ï¼ˆä»…æœ‰ consumption/merchant_points ä¸¤ç§å®¡æ ¸ç±»å‹ï¼Œæ—  image ç±»å‹ï¼‰ | âŒ å·²åºŸå¼ƒ |
| **å®¡æ ¸å›¾ç‰‡** | `/photo/review/:resource_id` | âŒ å·²åºŸå¼ƒï¼Œ`image_resources` è¡¨ä¸ºç©ºï¼ˆ0æ¡è®°å½•ï¼‰ï¼Œå›¾ç‰‡ç‹¬ç«‹å®¡æ ¸åŠŸèƒ½å·²å–æ¶ˆ | âŒ å·²åºŸå¼ƒ |
| **ç³»ç»Ÿå…¬å‘Š** | `/system/announcements` | `/api/v4/system/announcements` | âœ… åŒ¹é… |
| **é¦–é¡µå…¬å‘Š** | `/system/announcements/home` | `/api/v4/system/announcements/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **æäº¤åé¦ˆ** | `/system/feedback` | `/api/v4/system/feedback` | âœ… åŒ¹é… |
| **æˆ‘çš„åé¦ˆ** | `/system/feedback/my` | `/api/v4/system/feedback/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **ç³»ç»ŸçŠ¶æ€** | `/system/status` | `/api/v4/system/status` | âœ… åŒ¹é… |
| **åˆ›å»ºå®¢æœä¼šè¯** | `/system/chat/create` | `/api/v4/system/chat/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **å®¢æœä¼šè¯åˆ—è¡¨** | `/system/chat/sessions` | `/api/v4/system/chat/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **èŠå¤©å†å²** | `/system/chat/history/:session_id` | `/api/v4/system/chat/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **å‘é€æ¶ˆæ¯** | `/system/chat/send` | `/api/v4/system/chat/*` | âœ… åŒ¹é…ï¼ˆéœ€ç¡®è®¤ï¼‰ |
| **å¼¹çª—æ¨ªå¹…** | å‰ç«¯æœªè°ƒç”¨ | `/api/v4/system/popup-banners` | âŒ å‰ç«¯æœªå¯¹æ¥ |
| **ç®¡ç†å‘˜ç»Ÿè®¡** | `/admin/statistics/today` | `/api/v4/console/dashboard` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨** | `/admin/users` | `/api/v4/console/user_management` | âŒ è·¯å¾„ä¸åŒ¹é… |
| **ç®¡ç†å‘˜èŠå¤©ä¼šè¯** | `/system/admin/chat/sessions` | `/api/v4/system/chat/*` æˆ– `/api/v4/console/customer-service/*` | âš ï¸ å¾…ç¡®è®¤ |

---

## å…­ã€æ–¹æ¡ˆï¼šæŒ‰é¡µé¢é€ä¸€é€‚é…

### ç¬¬1ç»„ï¼šâœ… åŸºæœ¬åŒ¹é…ï¼ˆå¾®è°ƒå³å¯ï¼‰

| é¡µé¢ | æ¶‰åŠAPI | æ”¹åŠ¨ |
|---|---|---|
| authï¼ˆç™»å½•ï¼‰ | login, quick-login, profile, verify, refresh | verify å¯èƒ½éœ€æ”¹ POSTâ†’GET |
| chatï¼ˆå®¢æœèŠå¤©ï¼‰ | system/chat/* | åŸºæœ¬åŒ¹é…ï¼Œéœ€ç¡®è®¤ç²¾ç¡®è·¯å¾„ |
| feedbackï¼ˆåé¦ˆï¼‰ | system/feedback | åŸºæœ¬åŒ¹é… |
| lotteryï¼ˆæŠ½å¥–ï¼‰ | campaigns, draw, history | åŸºæœ¬åŒ¹é…ï¼Œprizeså’Œconfigè·¯å¾„å‚æ•°ä½ç½®éœ€è°ƒæ•´ |

### ç¬¬2ç»„ï¼šâŒ è·¯å¾„ä¸åŒ¹é…ï¼ˆéœ€æ”¹ api.js ä¸­çš„è·¯å¾„ï¼‰

| é¡µé¢ | å½“å‰é”™è¯¯è·¯å¾„ | åº”æ”¹ä¸º | è¯´æ˜ |
|---|---|---|---|
| lotteryï¼ˆå¥–å“ï¼‰ | `/lottery/prizes/CODE` | `/lottery/CODE/prizes` | è·¯å¾„å‚æ•°ä½ç½®ä¸åŒ |
| lotteryï¼ˆé…ç½®ï¼‰ | `/lottery/config/CODE` | `/lottery/CODE/config` | åŒä¸Š |
| userï¼ˆç§¯åˆ†ä½™é¢ï¼‰ | `/points/balance/:user_id` | `/assets/balance/*` | éœ€è¯»backendè·¯ç”±ç¡®è®¤ç²¾ç¡®è·¯å¾„ |
| points-detailï¼ˆç§¯åˆ†å†å²ï¼‰ | `/points/transactions/:user_id` | `/assets/transactions/*` | éœ€è¯»backendè·¯ç”±ç¡®è®¤ |
| exchangeï¼ˆå•†å“åˆ—è¡¨ï¼‰ | `/inventory/products` | `/shop/exchange/items` | æ¨¡å—è·¯å¾„å˜äº† |
| exchangeï¼ˆæ‰§è¡Œå…‘æ¢ï¼‰ | `/inventory/exchange` | `/shop/exchange/` | åŒä¸Š |
| exchangeï¼ˆå…‘æ¢è®°å½•ï¼‰ | `/inventory/exchange-records` | `/shop/exchange/orders` | åŒä¸Š |
| trade/inventoryï¼ˆåº“å­˜ï¼‰ | `/inventory/user/:user_id` | `/backpack/*` | æ¨¡å—å®Œå…¨å˜äº† |
| trade/marketï¼ˆå¸‚åœºåˆ—è¡¨ï¼‰ | `/inventory/market/products` | `/market/listings` | æ¨¡å—å®Œå…¨å˜äº† |
| trade/marketï¼ˆè´­ä¹°ï¼‰ | `/inventory/market/products/:id/purchase` | `/market/buy` | åŒä¸Š |
| admin/consume-submit | `/consumption/submit` | `/shop/consumption/*` | éœ€åŠ shopå‰ç¼€ |
| admin/consume-submit | `/consumption/qrcode/:user_id` | `/shop/consumption/qrcode/:user_id` | åŒä¸Š |
| admin/audit-list | `/consumption/pending` | `/shop/audit/*` æˆ–ç±»ä¼¼ | éœ€ç¡®è®¤ |
| admin/audit-list | `/consumption/approve/:id` | `/shop/audit/*` | éœ€ç¡®è®¤ |
| admin/audit-list | `/consumption/reject/:id` | `/shop/audit/*` | éœ€ç¡®è®¤ |
| admin/admin-dashboard | `/admin/statistics/today` | `/console/dashboard` | éœ€ç¡®è®¤ |

### ç¬¬3ç»„ï¼šå‰ç«¯ç¼ºå¤±çš„åç«¯èƒ½åŠ›ï¼ˆéœ€æ–°å¢APIè°ƒç”¨ï¼‰

| åç«¯èƒ½åŠ› | è·¯ç”± | æ•°æ®åº“è®°å½• | å¯å¯¹æ¥çš„å‰ç«¯é¡µé¢ |
|---|---|---|---|
| å¼¹çª—æ¨ªå¹… | `/api/v4/system/popup-banners` | 4æ¡è®°å½• | é¦–é¡µ/å¼¹çª—å±•ç¤º |
| èµ„äº§è½¬æ¢è§„åˆ™ | `/api/v4/assets/conversion-rules` | - | ç”¨æˆ·ä¸­å¿ƒ/ç§¯åˆ†è½¬æ¢ |
| æ´»åŠ¨é¡µ | `/api/v4/activities` | - | camera/å‘ç°é¡µ |
| ä¸Šæ¶åˆ°å¸‚åœº | `/api/v4/market/sell` | - | inventoryé¡µå¢åŠ ä¸Šæ¶æ“ä½œ |
| èƒŒåŒ…ç³»ç»Ÿ | `/api/v4/backpack` | 5913æ¡item_instances | inventoryé¡µæ›¿æ¢ç°æœ‰API |
| ç”¨æˆ·è¯¦æƒ… | `/api/v4/user/me` | - | ç”¨æˆ·ä¸­å¿ƒ |
| å•†æˆ·ç§¯åˆ† | `/api/v4/merchant-points` | - | å•†æˆ·ç›¸å…³é¡µé¢ |
| å…‘æ¢è®¢å•æµç¨‹ | `/api/v4/shop/redemption/orders` | - | å…‘æ¢å®Œæ•´æµç¨‹ |

### ç¬¬4ç»„ï¼šå‰ç«¯æœ‰ä½†åç«¯æ— ï¼ˆéœ€åˆ é™¤æˆ–æ ‡è®°ä¸å¯ç”¨ï¼‰

| å‰ç«¯API | è¯´æ˜ |
|---|---|
| `getUserIdentity()` | ä»£ç ä¸­å·²æ ‡æ³¨ "API_NOT_IMPLEMENTED"ï¼Œéœ€åˆ é™¤æˆ–èµ° `/auth/profile` æ›¿ä»£ |
| `uploadImage()` | âŒ `/photo/upload` è·¯ç”±å·²åºŸå¼ƒï¼Œå›¾ç‰‡ä¸Šä¼ æ•´åˆåˆ°ç®¡ç†åå° `/api/v4/console/images`ï¼Œç”¨æˆ·ç«¯ä¸å†æœ‰ç‹¬ç«‹ä¸Šä¼ åŠŸèƒ½ |
| `getMyUploads()` | âŒ `/photo/my-uploads` è·¯ç”±å·²åºŸå¼ƒ |
| `getMyUploadStats()` | âŒ `/photo/my-stats` è·¯ç”±å·²åºŸå¼ƒ |
| `getPendingReviews()` | âŒ `/photo/pending-reviews` è·¯ç”±å·²åºŸå¼ƒï¼Œå®¡æ ¸ç»Ÿä¸€å¹¶å…¥ `content_review_records`ï¼ˆä»… consumption/merchant_points ç±»å‹ï¼‰ |
| `reviewImage()` | âŒ `/photo/review/:id` è·¯ç”±å·²åºŸå¼ƒï¼Œ`image_resources` è¡¨ä¸ºç©º |
| `getCurrentUserBalance()` | `/points/balance` è·¯å¾„ä¸å­˜åœ¨ï¼Œéœ€æ”¹ä¸º assets æ¨¡å—è·¯å¾„ |

---

## ä¸ƒã€å…·ä½“å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šç¡®è®¤åç«¯æ¯ä¸ªè·¯ç”±çš„ç²¾ç¡®è·¯å¾„å’Œå‚æ•°

é€ä¸ªè¯»å–åç«¯è·¯ç”±æ–‡ä»¶ï¼ˆç‰¹åˆ«æ˜¯ä»¥ä¸‹å…³é”®æ–‡ä»¶ï¼‰ï¼Œç¡®è®¤æ¯ä¸ªAPIçš„ç²¾ç¡®URLã€HTTPæ–¹æ³•ã€è¯·æ±‚å‚æ•°ã€å“åº”æ ¼å¼ï¼š

- `routes/v4/assets/balance.js` â†’ ç§¯åˆ†ä½™é¢ç²¾ç¡®è·¯å¾„
- `routes/v4/assets/transactions.js` â†’ ç§¯åˆ†äº¤æ˜“å†å²ç²¾ç¡®è·¯å¾„
- `routes/v4/backpack/index.js` â†’ èƒŒåŒ…/åº“å­˜ç²¾ç¡®è·¯å¾„
- `routes/v4/shop/exchange/items.js` â†’ å…‘æ¢å•†å“åˆ—è¡¨
- `routes/v4/shop/exchange/exchange.js` â†’ æ‰§è¡Œå…‘æ¢
- `routes/v4/shop/exchange/orders.js` â†’ å…‘æ¢è®¢å•
- `routes/v4/shop/consumption/qrcode.js` â†’ æ¶ˆè´¹äºŒç»´ç 
- `routes/v4/shop/audit/index.js` â†’ æ¶ˆè´¹å®¡æ ¸
- `routes/v4/market/listings.js` â†’ å¸‚åœºåˆ—è¡¨
- `routes/v4/market/buy.js` â†’ å¸‚åœºè´­ä¹°
- `routes/v4/market/sell.js` â†’ å¸‚åœºä¸Šæ¶
- `routes/v4/system/chat.js` â†’ å®¢æœèŠå¤©ç²¾ç¡®è·¯å¾„
- `routes/v4/system/popup-banners.js` â†’ å¼¹çª—æ¨ªå¹…

### æ­¥éª¤2ï¼šä¿®æ”¹ `utils/api.js` ä¸­çš„è·¯å¾„

åªæ”¹è·¯å¾„å­—ç¬¦ä¸²ï¼Œä¸æ”¹å‡½æ•°ç­¾åå’Œé¡µé¢è°ƒç”¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼š

```javascript
// æ”¹å‰
'/lottery/prizes/' + campaign_code
// æ”¹å
'/lottery/' + campaign_code + '/prizes'

// æ”¹å‰
'/inventory/user/' + user_id
// æ”¹å
'/backpack/...'  // ç²¾ç¡®è·¯å¾„å¾…æ­¥éª¤1ç¡®è®¤

// æ”¹å‰
'/points/balance/' + user_id
// æ”¹å
'/assets/...'  // ç²¾ç¡®è·¯å¾„å¾…æ­¥éª¤1ç¡®è®¤
```

### æ­¥éª¤3ï¼šè°ƒæ•´æ•°æ®æ ¼å¼è½¬æ¢

åç«¯è¿”å›çš„å­—æ®µåå¯èƒ½ä¸å‰ç«¯é¡µé¢æœŸæœ›çš„ä¸åŒï¼Œéœ€è¦åœ¨APIå±‚åšæ•°æ®è½¬æ¢ï¼ˆä¸æ”¹é¡µé¢WXML/WXSS/äº¤äº’é€»è¾‘ï¼‰

### æ­¥éª¤4ï¼šè¡¥é½ç¼ºå¤±çš„APIè°ƒç”¨

å¦‚ popup-bannersã€backpack ç­‰åç«¯å·²æœ‰ä½†å‰ç«¯æœªå¯¹æ¥çš„èƒ½åŠ›

### æ­¥éª¤5ï¼šåˆ é™¤/æ¸…ç†ä¸å­˜åœ¨çš„APIè°ƒç”¨

å¦‚ `getUserIdentity` ç­‰æ ‡è®°ä¸ºæœªå®ç°çš„API

---

## å…«ã€å‰ç«¯ç¯å¢ƒé…ç½®ç¡®è®¤

å½“å‰å‰ç«¯ç¯å¢ƒé…ç½®ï¼ˆ`config/env.js`ï¼‰ï¼š

| é…ç½®é¡¹ | å½“å‰å€¼ | è¯´æ˜ |
|---|---|---|
| CURRENT_ENV | `testing` | æµ‹è¯•ç¯å¢ƒ |
| API baseUrl | `https://omqktqrtntnn.sealosbja.site` | SealosåŸŸå |
| API prefix | `/api/v4` | V4ç»Ÿä¸€å¼•æ“ |
| WebSocket | `wss://omqktqrtntnn.sealosbja.site/ws` | WSSåè®® |
| ä¸‡èƒ½éªŒè¯ç  | `123456` | æµ‹è¯•é˜¶æ®µå¯ç”¨ |

---

## ä¹ã€æ•°æ®åº“è¿æ¥ä¿¡æ¯

| é…ç½®é¡¹ | å€¼ |
|---|---|
| DB_HOST | dbconn.sealosbja.site |
| DB_PORT | 42569 |
| DB_NAME | restaurant_points_dev |
| DB_USER | root |

---

## åã€ç»Ÿè®¡æ±‡æ€»

| æŒ‡æ ‡ | æ•°å€¼ |
|---|---|
| å‰ç«¯APIæ–¹æ³•æ€»æ•° | çº¦50ä¸ª |
| âœ… è·¯å¾„åŒ¹é… | çº¦12ä¸ªï¼ˆ24%ï¼‰ |
| âš ï¸ éœ€å¾®è°ƒ | çº¦5ä¸ªï¼ˆ10%ï¼‰ |
| âŒ è·¯å¾„ä¸åŒ¹é… | çº¦25ä¸ªï¼ˆ50%ï¼‰ |
| âŒ å¾…ç¡®è®¤ | çº¦8ä¸ªï¼ˆ16%ï¼‰ |
| åç«¯æœ‰ä½†å‰ç«¯ç¼ºå¤± | çº¦8ä¸ªèƒ½åŠ›æ¨¡å— |
| å‰ç«¯æœ‰ä½†åç«¯æ—  | çº¦3ä¸ªAPI |

**ç»“è®º**ï¼šå‰ç«¯çº¦ 50% çš„APIè·¯å¾„ä¸åç«¯ä¸åŒ¹é…ï¼Œéœ€è¦ç³»ç»Ÿæ€§åœ°ä¿®æ­£ `utils/api.js` ä¸­çš„è·¯å¾„æ˜ å°„ã€‚ä¿®æ”¹èŒƒå›´ä»…é™äºAPIè°ƒç”¨å±‚ï¼Œä¸æ¶‰åŠé¡µé¢ç»“æ„ã€æ ·å¼å’Œäº¤äº’é€»è¾‘ã€‚

