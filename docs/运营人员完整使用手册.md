# 餐厅积分抽奖系统 - 运营人员完整使用手册

> **文档版本**: v2.0  
> **创建时间**: 2025年12月17日  
> **适用对象**: 运营人员、客服人员、业务管理人员  
> **系统版本**: V4.5 统一引擎架构

---

## 📌 第一部分：3分钟快速了解系统

### 系统是做什么的？

**餐厅积分抽奖系统**是一个面向餐饮行业的用户激励平台，通过"消费积分→抽奖游戏→兑换奖品→核销使用"的完整流程，提升用户粘性和复购率。

### 核心业务流程

```
顾客到店消费
    ↓
商家录入消费记录（扫码/手工录入）
    ↓
平台审核通过，发放积分
    ↓
用户使用积分参与抽奖
    ↓
中奖后获得奖品（实物/优惠券/虚拟物品）
    ↓
用户生成核销码到门店兑换
    ↓
门店扫码核销，完成兑换
```

### 系统能做什么？

- 📱 **用户管理**：管理所有用户信息、权限和状态
- 🎰 **抽奖活动**：创建抽奖活动，配置奖品和概率
- 💎 **积分系统**：管理用户积分获得、消耗和流水
- 🎒 **背包物品**：管理用户获得的奖品和材料
- 🔖 **核销兑换**：生成核销码，门店扫码核销
- 🛒 **交易市场**：用户间物品交易和兑换商品
- 💬 **客服系统**：在线实时客服和问题处理
- 📊 **数据报表**：查看各类业务数据和统计

---

## 📚 第二部分：系统功能详解（运营视角）

### 1. 用户管理系统（6个子模块）

#### 1.1 用户基础信息管理

**功能概述**：管理平台所有用户的基本信息、权限和状态

**运营场景**：

- 查看用户基本资料（手机号、昵称、注册时间）
- 查询用户积分余额和历史积分记录
- 管理用户角色权限（普通用户、商家、管理员）
- 封禁/解封异常用户账号

**关键数据**：

- 用户总数
- 活跃用户数（最近登录）
- 新增用户趋势

**数据模型**：

- `User` - 用户基本信息
- `AuthenticationSession` - 登录会话管理

---

#### 1.2 角色权限系统

**功能概述**：基于角色的权限管理

**权限分类**：

- 普通用户：参与抽奖、查看背包
- 商家用户：录入消费记录、查看审核状态
- 管理员：全部管理权限

**运营操作**：

- 分配用户角色
- 查看角色变更历史
- 权限审计和追溯

**数据模型**：

- `Role` - 角色定义
- `UserRole` - 用户角色关联
- `RoleChangeLog` - 角色变更日志

---

#### 1.3 层级权限管理

**功能概述**：三级权限体系管理

**层级结构**：

```
区域负责人（最高级）
    ↓
业务经理（中级）
    ↓
业务员（基层）
```

**运营场景**：

- 设置上下级关系
- 层级化数据权限
- 跨区域数据隔离

**数据模型**：`UserHierarchy`

---

#### 1.4 高级空间系统

**功能概述**：用户支付100积分解锁高级功能区域

**解锁条件**：

- 历史总积分 ≥ 10万
- 当前可用积分 ≥ 100

**有效期**：24小时（过期需重新手动解锁）

**运营监控**：

- 查看高级空间用户数
- 查看即将过期用户
- 统计高级空间使用情况

**数据模型**：`UserPremiumStatus`

---

### 2. 积分系统（核心资产）

**功能概述**：管理用户积分的获得、消耗和流水记录

#### 积分来源

| 来源类型    | 说明                                           | 举例               |
| ----------- | ---------------------------------------------- | ------------------ |
| ✅ 消费获得 | 商家录入消费记录 → 平台审核通过 → 自动发放积分 | 消费168元=168积分  |
| ✅ 活动奖励 | 抽奖中奖获得积分奖品                           | 中奖获得500积分    |
| ✅ 系统发放 | 管理员手动补发                                 | 活动补偿、补发积分 |

#### 积分用途

| 用途类型    | 消耗说明                | 举例              |
| ----------- | ----------------------- | ----------------- |
| 🎰 参与抽奖 | 每次抽奖消耗一定积分    | 单次抽奖10积分    |
| 🛍️ 兑换商品 | 使用积分直接兑换        | 100积分兑换优惠券 |
| 💎 解锁空间 | 支付100积分解锁高级空间 | 100积分/24小时    |

#### 运营操作

**1. 查询用户积分**

- 路径：管理后台 → 用户管理 → 积分查询
- 可查看：积分余额、历史收支、流水明细

**2. 手动发放积分**

- 路径：管理后台 → 用户管理 → 积分操作
- 步骤：
  1. 输入发放数量（如100）
  2. 选择原因（活动奖励/系统补偿/其他）
  3. 填写备注说明（如"双十一活动奖励"）
  4. 提交 → 系统自动发放

**3. 查看积分统计**

- 总发放量：平台累计发放的积分总数
- 总消耗量：用户累计使用的积分总数
- 余额分布：当前所有用户的积分余额总和

#### 重要规则

- ⚠️ 积分不会过期（永久有效）
- ⚠️ 积分不能提现或转让给其他用户
- ⚠️ 所有积分变动都有完整的审计记录
- ⚠️ 手动发放积分要填写原因，便于后续追溯

**数据模型**：

- `UserPointsAccount` - 积分账户
- `PointsTransaction` - 积分交易记录

---

### 3. 抽奖系统（5个子模块）

#### 3.1 抽奖活动管理

**功能概述**：用户使用积分参与抽奖，有机会获得各种奖品

**抽奖模式**：

- **基础模式**：公平随机抽奖，所有用户概率相同
- **保底机制**：连续多次未中奖后，提升中奖概率（避免用户流失）
- **管理干预**：运营人员可以设置特定用户的中奖规则（用于活动补偿、VIP特权等）

**奖品类型**：

| 类型     | 说明                     | 核销方式            |
| -------- | ------------------------ | ------------------- |
| 实物奖品 | 需要核销码到门店领取     | 生成核销码→门店扫码 |
| 虚拟奖品 | 直接发放到背包           | 无需核销，直接使用  |
| 谢谢参与 | 未中奖，消耗积分但无奖品 | -                   |

#### 3.2 创建抽奖活动

**路径**：管理后台 → 抽奖管理 → 创建活动

**步骤**：

1. 填写活动基本信息
   - 活动名称（如"双十一大抽奖"）
   - 活动时间（开始时间、结束时间）
   - 参与条件（如积分≥10）

2. 配置奖品池
   - 添加奖品（名称、图片、库存）
   - 设置中奖概率（如一等奖1%、二等奖5%）
   - 设置中奖限制（每人每天最多中1次）

3. 预览和测试
   - 预览抽奖界面
   - 测试抽奖流程

4. 发布活动
   - 确认无误后发布

#### 3.3 运营常见场景

**场景1：新用户注册活动**

```
需求：新用户前3次抽奖必中"奶茶券"
操作：
1. 在管理后台创建管理干预规则
2. 设置用户标签"新用户"
3. 配置前3次必中"奶茶券"
```

**场景2：VIP用户福利**

```
需求：历史消费超10000元的用户，中奖概率提升20%
操作：
1. 设置VIP用户分组
2. 调整概率权重（+20%）
3. 应用到抽奖活动
```

**场景3：活动补偿**

```
需求：用户投诉某次应该中奖但未中，人工补发
操作：
1. 查询抽奖记录确认情况
2. 直接在用户背包中发放对应奖品
3. 记录补偿原因
```

#### 3.4 抽奖数据监控

**关键指标**：

- **总抽奖次数**：用户累计抽奖次数
- **中奖率**：实际中奖次数 / 总抽奖次数
- **热门奖品TOP10**：中奖次数最多的奖品排行

**运营操作**：

- 查看抽奖数据报表
- 分析中奖率趋势
- 调整奖品配置

#### 3.5 奖品池管理

**功能**：

- 奖品库存管理
- 中奖次数限制（每日/总量）
- 奖品状态同步

**定时任务**：每天凌晨0点重置每日中奖次数

**数据模型**：

- `LotteryCampaign` - 抽奖活动
- `LotteryPrize` - 奖品配置
- `LotteryDraw` - 抽奖记录
- `LotteryManagementSetting` - 管理干预设置
- `LotteryPreset` - 抽奖预设模板

---

### 4. 背包与库存系统（双轨架构）

**功能概述**：用户中奖后，奖品会进入用户的"背包"，用户可以查看和使用这些奖品

#### 4.1 背包内容分类

**双轨架构说明**：

```
背包
├── 可叠加资产（assets[]）
│   └── 材料碎片类，可以累加数量
│       示例：红色碎片×100、蓝色水晶×50
│
└── 不可叠加物品（items[]）
    └── 每个都是独立的物品实例
        示例：奶茶券#12345、代金券#67890
```

#### 4.2 物品状态

| 状态      | 说明                   | 可执行操作             |
| --------- | ---------------------- | ---------------------- |
| ✅ 可用   | 正常状态               | 生成核销码、交易、使用 |
| 🔒 锁定中 | 正在交易或已生成核销码 | 无法操作，等待解锁     |
| ✔️ 已使用 | 已经核销或消耗         | 流程结束，无法操作     |
| 📦 已转让 | 已转让给其他用户       | 流程结束，无法操作     |

#### 4.3 运营操作

**1. 查看用户背包**

- 路径：管理后台 → 用户管理 → 选择用户 → 背包查询
- 可查看：
  - 可叠加资产清单（材料名称、数量）
  - 不可叠加物品清单（物品名称、状态、获得时间）

**2. 手动发放奖品**

- 路径：管理后台 → 用户管理 → 选择用户 → 发放奖品
- 步骤：
  1. 选择奖品类型（可叠加/不可叠加）
  2. 输入奖品信息和数量
  3. 填写发放原因
  4. 提交 → 自动发放到用户背包

**3. 查询物品流转记录**

- 路径：管理后台 → 物品追踪 → 输入物品ID
- 可追踪：某个物品从中奖→核销的全过程

**数据模型**：

- `AccountAssetBalance` - 可叠加资产
- `ItemInstance` - 不可叠加物品实例
- `UserInventory` - 旧库存系统（⚠️ 正在迁移，待废弃）

---

### 5. 核销系统 ⭐（重点核心）

**功能概述**：用户需要核销码才能到门店领取实物奖品

#### 5.1 核销码格式

- **格式**：12位字符，分3组：**XXXX-YYYY-ZZZZ**
- **示例**：`AB3D-5F7H-KL9M`
- **字符集**：Base32字符（去除易混淆字符I/O/0/1）
- **有效期**：30天（从生成时刻开始计算）
- **存储方式**：SHA-256哈希（不存明文，安全保护）

#### 5.2 核销流程

```
第1步：用户生成核销码
   用户在背包里点击"生成核销码"
   → 系统生成12位核销码（仅显示一次）
   → 用户需要截图保存

第2步：用户到门店出示核销码
   用户到门店出示核销码截图
   → 门店店员在系统中输入核销码验证

第3步：系统验证成功
   系统验证成功
   → 订单状态变为"已核销"
   → 物品状态变为"已使用"
   → 门店发放实物给用户
```

#### 5.3 核销码状态

| 状态   | 说明                   | 用户操作         | 运营操作 |
| ------ | ---------------------- | ---------------- | -------- |
| 待核销 | 刚生成，等待门店扫码   | 到门店出示核销码 | 可取消   |
| 已核销 | 门店已核销成功         | 流程结束         | 无法取消 |
| 已取消 | 用户或客服取消了核销码 | 可重新生成       | -        |
| 已过期 | 30天内未核销，自动过期 | 可重新生成       | -        |

#### 5.4 运营常见操作

**场景A：用户说核销码丢了/截图模糊**

**处理步骤**：

1. 路径：管理后台 → 核销管理 → 查询订单
2. 输入用户手机号查询核销订单
3. 找到"待核销"状态的订单
4. 点击"取消订单"
5. 告知用户"已取消，请重新生成"

---

**场景B：核销码过期，用户要求使用**

**处理步骤**：

1. 查询订单状态（确认是"已过期"）
2. 检查券本身是否还有效（看物品状态）
3. 判断：
   - 如果券有效：告知用户重新生成新核销码
   - 如果券已过期：告知用户券已失效，无法使用

---

**场景C：查询核销码状态**

**处理步骤**：

1. 路径：管理后台 → 核销管理 → 查询订单
2. 输入核销码或用户手机号
3. 查看订单详情和状态
4. 根据状态给出处理建议

#### 5.5 核销数据监控

**关键指标**：

- **核销率**：已核销订单数 / 总生成订单数（健康值≥60%）
- **过期率**：已过期订单数 / 总生成订单数（健康值≤20%）
- **平均核销时长**：从生成核销码到核销成功的平均时间

#### 5.6 重要提醒

- ⚠️ **核销码只显示一次**，务必提醒用户立即截图保存
- ⚠️ **核销成功后不能取消**，核销前务必确认
- ⚠️ **过期不影响券**，券还在背包里，只是核销码过期
- ⚠️ **系统不存明文**，核销码丢失无法查看，只能重新生成

**数据模型**：`RedemptionOrder`

**定时任务**：每天凌晨2点自动清理过期核销码

---

### 6. 兑换市场系统

#### 6.1 功能概述

**兑换市场**：用户可以使用材料资产（如红色碎片、蓝色水晶）兑换商品

**与核销系统的区别**：

- 兑换市场：使用**材料资产**支付，不是积分
- 积分兑换：直接用积分购买商品

#### 6.2 材料资产来源

- 抽奖中奖获得碎片类奖品
- 完成任务活动奖励
- 参与特殊活动获得

#### 6.3 兑换流程

```
第1步：用户选择商品
   选择商品（如"高级礼盒"，需要红色碎片×50）
   ↓
第2步：检查资产余额
   系统检查用户资产余额是否足够
   ↓
第3步：扣减资产，生成订单
   扣减材料资产，生成兑换订单
   ↓
第4步：发放商品
   商品发放到用户背包
   ↓
第5步：核销使用（如果是实物）
   用户生成核销码到门店领取
```

#### 6.4 运营操作

**1. 上架兑换商品**

- 路径：管理后台 → 兑换市场 → 商品管理 → 新增商品
- 配置：商品名称、图片、所需材料类型和数量

**2. 设置兑换价格**

- 配置需要多少材料（如红色碎片×50）
- 设置库存数量

**3. 查看兑换数据**

- 兑换订单记录
- 热门商品排行
- 材料消耗统计

**数据模型**：

- `ExchangeItem` - 兑换商品
- `ExchangeMarketRecord` - 兑换记录
- `MaterialAssetType` - 材料类型

---

### 7. 交易市场系统（P2P交易）

#### 7.1 功能概述

**交易市场**：用户之间可以相互交易背包里的物品

#### 7.2 交易模式

```
用户A把物品挂单到市场
    ↓
设置价格（使用积分）
    ↓
用户B看到后支付积分购买
    ↓
系统自动完成物品转移
    ↓
交易完成
```

#### 7.3 运营操作

**1. 审核挂单**

- 路径：管理后台 → 交易市场 → 挂单审核
- 检查：是否有违规内容、价格是否合理

**2. 处理交易纠纷**

- 查看交易记录
- 了解买家/卖家投诉
- 给出处理方案（退款、补偿等）

**3. 查看交易数据**

- 交易总量和成交额
- 热门商品排行
- 用户交易行为分析

#### 7.4 安全机制

- 挂单后物品锁定，卖家不能取消或使用
- 交易成功后自动转移所有权
- 超过72小时无人购买，自动下架
- 防止刷单和作弊

**数据模型**：

- `MarketListing` - 市场挂单
- `TradeOrder` - 交易订单
- `TradeRecord` - 交易记录

**定时任务**：每5分钟检查交易锁超时并解锁

---

### 8. 消费记录管理系统

#### 8.1 功能概述

**消费记录管理**：商家录入顾客消费记录，平台审核后发放积分

#### 8.2 消费录入流程

```
第1步：顾客到店消费
   顾客在门店消费（如消费168元）
   ↓
第2步：商家录入消费
   商家扫码或手动录入消费金额
   ↓
第3步：上传消费凭证
   上传消费小票照片
   ↓
第4步：提交到平台审核
   提交到平台等待审核
   ↓
第5步：平台审核通过
   平台审核通过 → 自动给用户发放积分
   （如168元=168积分）
```

#### 8.3 审核规则

**审核要求**：

- 需要上传清晰的消费凭证
- 审核时间：24小时内
- 拒绝理由：凭证模糊、金额不符、重复提交等

#### 8.4 运营操作

**审核消费记录**

**路径**：管理后台 → 消费管理 → 待审核列表

**步骤**：

1. 查看消费凭证（小票照片）
2. 核对消费金额和时间
3. 选择审核结果：
   - ✅ **通过**：自动发放积分给用户
   - ❌ **拒绝**：填写拒绝原因（如"小票模糊不清"）
   - ⚠️ **要求补充**：商家需要重新上传凭证

**常见审核场景**：

| 审核结果        | 判断依据                     |
| --------------- | ---------------------------- |
| ✅ 通过         | 小票清晰、金额一致、时间合理 |
| ❌ 拒绝         | 小票模糊不清、金额与录入不符 |
| ⚠️ 需要商家补充 | 小票看不清日期，要求重新上传 |

#### 8.5 消费数据监控

**关键指标**：

- **待审核数量**：当前待审核的消费记录数
- **审核通过率**：通过数 / 总审核数
- **平均审核时长**：从提交到审核完成的平均时间

**超时告警**：

- 24小时未审核：黄色告警
- 72小时未审核：红色告警

**数据模型**：

- `ConsumptionRecord` - 消费记录
- `ContentReviewRecord` - 内容审核记录

---

### 9. 客服系统（WebSocket实时通信）

#### 9.1 功能概述

**客服系统**：用户可以通过在线客服咨询问题，客服实时回复

#### 9.2 客服功能

- **实时聊天**：基于WebSocket技术的实时通信
- **查看用户资料**：查看用户消费记录和积分情况
- **快捷回复**：常见问题快捷回复模板
- **会话记录**：历史聊天记录查询

#### 9.3 客服常见问题处理

| 问题类型     | 处理方式                     |
| ------------ | ---------------------------- |
| 核销码丢了   | 取消旧核销码，让用户重新生成 |
| 积分未到账   | 查询消费记录审核状态         |
| 抽奖显示异常 | 查询抽奖记录，确认是否成功   |
| 物品不见了   | 查询背包和交易记录           |
| 核销码过期   | 检查券是否有效，引导重新生成 |

#### 9.4 运营监控

**关键指标**：

- 在线客服人数和响应时间
- 用户问题分类统计
- 满意度评分

**数据模型**：

- `CustomerServiceSession` - 客服会话
- `ChatMessage` - 聊天消息
- `WebSocketStartupLog` - WebSocket启停日志

---

### 10. 系统公告与通知

#### 10.1 系统公告管理

**功能概述**：运营人员发布系统公告、活动通知

**公告类型**：

- 📢 **系统公告**：全平台用户可见（如系统维护通知）
- 🎉 **活动通知**：特定活动宣传（如双倍积分活动）
- ⚠️ **重要提醒**：紧急公告（如规则变更）

**运营操作**：

- 创建和发布公告
- 设置公告生效时间和失效时间
- 设置公告展示位置（首页轮播、弹窗）
- 查看公告阅读数据

#### 10.2 用户通知推送

**功能**：

- 用户通知推送
- 通知已读管理
- 通知历史查询

**数据模型**：`SystemAnnouncement`

---

## 📊 第三部分：运营数据看板

### 1. 用户数据

| 指标名称   | 说明                 | 健康标准       |
| ---------- | -------------------- | -------------- |
| 总用户数   | 平台累计注册用户     | 持续增长       |
| 活跃用户数 | 最近7天/30天登录用户 | ≥总用户数的30% |
| 新增用户数 | 今日/本周/本月新增   | 持续增长       |

### 2. 积分数据

| 指标名称     | 说明                       | 健康标准        |
| ------------ | -------------------------- | --------------- |
| 积分总发放量 | 平台累计发放的积分总数     | -               |
| 积分总消耗量 | 用户累计使用的积分总数     | -               |
| 积分余额     | 当前所有用户的积分余额总和 | 发放量 - 消耗量 |

### 3. 抽奖数据

| 指标名称      | 说明                      | 健康标准 |
| ------------- | ------------------------- | -------- |
| 总抽奖次数    | 用户累计抽奖次数          | 持续增长 |
| 中奖率        | 实际中奖次数 / 总抽奖次数 | 20%-40%  |
| 热门奖品TOP10 | 中奖次数最多的奖品排行    | -        |

### 4. 核销数据（重点监控）

| 指标名称     | 说明                             | 健康标准 |
| ------------ | -------------------------------- | -------- |
| 核销率       | 已核销订单数 / 总生成订单数      | ≥60%     |
| 过期率       | 已过期订单数 / 总生成订单数      | ≤20%     |
| 平均核销时长 | 从生成核销码到核销成功的平均时间 | ≤7天     |

### 5. 消费审核数据

| 指标名称     | 说明                       | 健康标准 |
| ------------ | -------------------------- | -------- |
| 待审核数量   | 当前待审核的消费记录数     | <100条   |
| 审核通过率   | 通过数 / 总审核数          | 70%-90%  |
| 平均审核时长 | 从提交到审核完成的平均时间 | ≤12小时  |

---

## 🛠️ 第四部分：运营操作实战指南

### 操作1：查看用户详情

**路径**：管理后台 → 用户管理 → 搜索用户手机号

**可以看到**：

- 用户基本信息（昵称、注册时间、最后登录）
- 积分余额和历史记录
- 背包物品清单
- 抽奖记录
- 消费记录
- 交易记录

---

### 操作2：给用户发放积分（补偿）

**路径**：管理后台 → 用户管理 → 选择用户 → 积分操作

**步骤**：

1. 输入发放积分数量（如100）
2. 选择原因（活动奖励/系统补偿/其他）
3. 填写备注说明（如"双十一活动奖励"）
4. 提交 → 系统自动发放

---

### 操作3：创建抽奖活动

**路径**：管理后台 → 抽奖管理 → 创建活动

**步骤**：

1. 填写活动基本信息（名称、时间、参与条件）
2. 配置奖品池
   - 添加奖品（名称、图片、库存）
   - 设置中奖概率（如一等奖1%、二等奖5%）
   - 设置中奖限制（每人每天最多中1次）
3. 预览和测试
4. 发布活动

---

### 操作4：审核消费记录

**路径**：管理后台 → 消费管理 → 待审核列表

**步骤**：

1. 查看消费凭证（小票照片）
2. 核对消费金额和时间
3. 选择审核结果：
   - ✅ 通过 → 自动发放积分给用户
   - ❌ 拒绝 → 填写拒绝原因
   - ⚠️ 要求补充 → 商家需要重新上传凭证

---

### 操作5：处理核销码问题

**路径**：管理后台 → 核销管理 → 查询订单

**场景A：用户核销码丢了**

```
1. 输入用户手机号查询核销订单
2. 找到"待核销"状态的订单
3. 点击"取消订单"
4. 告知用户"已取消，请重新生成"
```

**场景B：核销码过期，用户要求使用**

```
1. 查询订单状态（确认是"已过期"）
2. 检查券本身是否还有效（看物品状态）
3. 如果券有效：告知用户重新生成新核销码
4. 如果券已过期：告知用户券已失效，无法使用
```

---

## 🆘 第五部分：运营问题快速解决

### 问题1：用户反馈"积分没到账"

**排查步骤**：

1. 查询用户消费记录 → 确认是否已提交
2. 查看审核状态 → 如果待审核，告知等待审核
3. 查看审核结果 → 如果已拒绝，告知拒绝原因
4. 查询积分流水 → 确认是否已发放

---

### 问题2：用户反馈"抽奖后奖品不见了"

**排查步骤**：

1. 查询抽奖记录 → 确认是否中奖
2. 查看背包物品 → 确认奖品是否在背包
3. 查询物品流转记录 → 确认是否被交易/核销
4. 如果确实丢失 → 补发奖品并记录问题

---

### 问题3：用户反馈"核销码用不了"

**排查步骤**：

**第一步：查询核销码状态**

- 待核销 → 检查是否过期
- 已核销 → 告知"此码已使用，不能重复核销"
- 已取消 → 告知"此码已作废，请重新生成"
- 已过期 → 告知"此码已过期，请重新生成"

**第二步：查询物品状态**

- 可用 → 正常，引导重新生成
- 已使用 → 告知"该券已使用，不能再生成"
- 锁定中 → 检查是否有其他待核销订单

---

### 问题4：门店反馈"核销码验证失败"

**可能原因**：

1. 核销码输入错误（易混淆字符）
2. 核销码已过期（30天有效期）
3. 核销码已被使用
4. 核销码已被取消

**处理方式**：

1. 确认核销码是否输入正确（注意大小写）
2. 查询核销码状态
3. 根据状态给出解决方案

---

### 问题5：用户反馈"兑换商品失败"

**排查步骤**：

1. 检查用户材料资产余额是否足够
2. 检查商品是否还有库存
3. 检查是否有重复提交（幂等性）
4. 查看系统错误日志

---

## ⚠️ 第六部分：运营注意事项

### 关于核销码（重要）

1. ⚠️ **核销码只显示一次**
   - 务必提醒用户立即截图保存
   - 系统不存明文，丢失无法查看

2. ⚠️ **核销成功后不能取消**
   - 核销前务必确认
   - 门店已发货，无法撤回

3. ⚠️ **过期不影响券**
   - 券还在背包里
   - 只是核销码过期
   - 可以重新生成新核销码

4. ⚠️ **同一物品同一时间只能有1个待核销的核销码**
   - 如需重新生成，先取消旧的

---

### 关于积分（重要）

1. ⚠️ **积分不能提现**
   - 只能用于平台内消费

2. ⚠️ **积分发放需谨慎**
   - 所有操作都有审计记录
   - 异常发放会被追溯

3. ⚠️ **手动发放积分要填写原因**
   - 便于后续追溯
   - 方便审计检查

---

### 关于抽奖（重要）

1. ⚠️ **概率设置要合理**
   - 避免中奖率过高（运营成本）
   - 避免中奖率过低（用户体验）
   - 建议中奖率：20%-40%

2. ⚠️ **库存要充足**
   - 避免奖品库存不足影响用户体验
   - 提前预警库存不足

3. ⚠️ **管理干预慎用**
   - 仅用于特殊活动和补偿
   - 记录干预原因

---

### 关于审核（重要）

1. ⚠️ **24小时内完成审核**
   - 超时会收到系统告警
   - 影响用户体验

2. ⚠️ **拒绝要说明原因**
   - 便于商家改进
   - 减少重复提交

3. ⚠️ **凭证要仔细核对**
   - 防止刷单和作弊
   - 保护平台利益

---

## 📋 第七部分：系统模块完整清单

### 业务模块总览

| 分类           | 模块数 | 核心特征                   |
| -------------- | ------ | -------------------------- |
| 用户与权限管理 | 6个    | 认证、角色、层级权限       |
| 抽奖与游戏系统 | 5个    | 统一引擎、管理策略、预设   |
| 资产与积分系统 | 5个    | 双账户、材料资产、积分     |
| 背包与库存系统 | 4个    | 双轨架构、物品实例         |
| 交易与市场系统 | 3个    | P2P交易、兑换市场          |
| 核销与兑换业务 | 1个    | 12位Base32核销码           |
| 消费与审核系统 | 2个    | 消费录入、内容审核         |
| 客服与通知系统 | 3个    | WebSocket客服、公告、通知  |
| 系统与运维功能 | 4个    | 反馈、统计、调试、定时任务 |

**总计**：33个独立业务模块

---

### 定时任务清单（12个任务）

| 任务名称             | 执行频率    | 功能说明           |
| -------------------- | ----------- | ------------------ |
| 检查超时订单         | 每小时      | 检查24小时超时订单 |
| 紧急超时告警         | 每天        | 检查72小时告警     |
| 数据一致性检查       | 每天凌晨3点 | 数据完整性验证     |
| 清理过期抽奖设置     | 每小时      | 清理过期管理干预   |
| 检查即将过期高级空间 | 每小时      | 高级空间到期提醒   |
| 清理过期高级空间     | 每天凌晨    | 清理过期状态       |
| 数据库性能监控       | 每5分钟     | 性能指标采集       |
| 重置每日中奖次数     | 每天凌晨0点 | 重置奖品每日限制   |
| 同步抽奖活动状态     | 每小时      | 活动状态同步       |
| 检查交易锁超时       | 每5分钟     | 解锁超时交易       |
| 清理过期核销码       | 每天凌晨2点 | 30天过期清理 ⭐    |
| 资产对账             | 每天凌晨2点 | 资产余额对账       |

---

## 📞 第八部分：技术支持与联系方式

### 系统问题报告

- 技术支持邮箱：tech-support@example.com
- 紧急联系电话：400-XXX-XXXX

### 运营培训

- 新员工培训：每周三下午2点
- 系统更新培训：提前3天邮件通知

### 文档更新记录

- 本文档会随系统更新同步修改
- 最新版本查看：管理后台 → 帮助中心

---

## 📈 第九部分：系统更新日志

### V4.5（2025年12月）

- ✅ 新增：核销码系统（12位Base32，30天有效期）
- ✅ 优化：背包双轨架构（可叠加资产+不可叠加物品）
- ✅ 新增：兑换市场材料资产支付功能
- ✅ 优化：定时任务系统（新增核销码过期清理）

### V4.0（2025年11月）

- ✅ 重构：统一抽奖引擎架构
- ✅ 新增：层级权限管理系统
- ✅ 新增：WebSocket客服系统
- ✅ 优化：积分系统性能提升

---

## 🎯 第十部分：核心业务流程图

### 完整业务闭环

```
用户注册登录
    ↓
商家录入消费记录 → 平台审核 → 发放积分
    ↓
用户使用积分参与抽奖
    ↓
中奖获得奖品（实物/虚拟）
    ↓
奖品进入背包
    ↓
├─→ 虚拟奖品：直接使用
├─→ 实物奖品：生成核销码 → 门店核销 → 完成兑换
└─→ 材料资产：兑换市场兑换商品 或 P2P交易
```

---

## 📌 运营核心提示

**系统围绕"消费→积分→抽奖→奖品→核销"的完整闭环设计**

**运营人员的核心工作**：

1. 审核消费记录（24小时内完成）
2. 管理抽奖活动（配置奖品、调整概率）
3. 处理核销问题（取消、重新生成）
4. 解决客诉（积分、奖品、核销）

**运营原则**：

- 公平：所有用户享受公平的抽奖机会
- 透明：所有规则明确告知用户
- 及时：快速响应用户问题
- 用户体验优先：始终从用户角度考虑问题

---

**核心理念**：通过游戏化的积分抽奖机制，提升用户粘性和复购率，为餐饮商家创造更大价值。所有操作都有完整的审计记录，确保业务可追溯、可监控、可优化。

---

**文档结束**
