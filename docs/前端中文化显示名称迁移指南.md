# 前端中文化显示名称迁移指南

> 版本：V4.7.0  
> 创建时间：2026-01-22  
> 适用范围：所有前端开发（小程序、管理后台）

## 一、背景

后端已完成中文显示名称机制的数据库化迁移，原有的硬编码常量文件 `constants/DisplayNames.js` 已删除。

**核心变更**：
- 所有枚举值的中文名称和颜色现在由**数据库字典表**管理
- 后端 API 响应将自动附加 `*_display` 和 `*_color` 字段
- 前端**不再需要**维护任何状态映射表

## 二、后端提供的字段格式

### 2.1 自动附加的字段

后端会为以下字段自动附加显示信息：

| 原始字段 | 显示名称字段 | 颜色字段 |
|---------|------------|---------|
| `status` | `status_display` | `status_color` |
| `operation_type` | `operation_type_display` | `operation_type_color` |
| `target_type` | `target_type_display` | `target_type_color` |
| 其他枚举字段 | `{field}_display` | `{field}_color` |

### 2.2 响应示例

**用户列表 API 响应**：
```json
{
  "success": true,
  "code": "SUCCESS",
  "data": {
    "users": [
      {
        "user_id": 1,
        "nickname": "张三",
        "status": "active",
        "status_display": "正常",
        "status_color": "bg-success"
      },
      {
        "user_id": 2,
        "nickname": "李四",
        "status": "banned",
        "status_display": "已封禁",
        "status_color": "bg-danger"
      }
    ]
  }
}
```

**交易订单 API 响应**：
```json
{
  "success": true,
  "code": "SUCCESS",
  "data": {
    "order": {
      "trade_id": 1001,
      "status": "completed",
      "status_display": "已完成",
      "status_color": "bg-success",
      "listing": {
        "listing_id": 500,
        "status": "sold",
        "status_display": "已售出",
        "status_color": "bg-info"
      }
    }
  }
}
```

## 三、前端需要做的改动

### 3.1 删除本地状态映射

**删除类似以下的代码**：

```javascript
// ❌ 删除这类映射表
const STATUS_MAP = {
  active: '正常',
  inactive: '未激活',
  banned: '已封禁'
}

const COLOR_MAP = {
  active: 'success',
  inactive: 'warning',
  banned: 'danger'
}

// ❌ 删除获取映射的函数
function getStatusText(status) {
  return STATUS_MAP[status] || status
}
```

### 3.2 直接使用后端返回的字段

**修改前**：
```javascript
// ❌ 旧写法：前端自己映射
<text class="status-{{ getColorClass(user.status) }}">
  {{ getStatusText(user.status) }}
</text>
```

**修改后**：
```javascript
// ✅ 新写法：直接使用后端返回的字段
<text class="status-{{ user.status_color }}">
  {{ user.status_display }}
</text>
```

### 3.3 处理颜色类名

后端返回的 `*_color` 字段格式为 Bootstrap 类名，如：
- `bg-success` (绿色/成功)
- `bg-warning` (黄色/警告)
- `bg-danger` (红色/危险)
- `bg-info` (蓝色/信息)
- `bg-secondary` (灰色/次要)
- `bg-primary` (主色)

**小程序适配示例**：

```javascript
// 小程序可能需要转换 Bootstrap 类名到 WXML 样式
function convertColorClass(bootstrapColor) {
  const colorMap = {
    'bg-success': 'status-success',
    'bg-warning': 'status-warning',
    'bg-danger': 'status-danger',
    'bg-info': 'status-info',
    'bg-secondary': 'status-secondary',
    'bg-primary': 'status-primary'
  }
  return colorMap[bootstrapColor] || 'status-default'
}
```

```css
/* 小程序样式 */
.status-success { background-color: #28a745; color: #fff; }
.status-warning { background-color: #ffc107; color: #212529; }
.status-danger { background-color: #dc3545; color: #fff; }
.status-info { background-color: #17a2b8; color: #fff; }
.status-secondary { background-color: #6c757d; color: #fff; }
.status-primary { background-color: #007bff; color: #fff; }
```

## 四、字典查询 API（可选）

如果前端需要**预先获取所有枚举选项**（如用于下拉选择器），可以调用字典 API：

### 4.1 获取所有字典类型

```http
GET /api/v4/system/dictionaries/types
```

**响应**：
```json
{
  "success": true,
  "code": "DICT_TYPES_SUCCESS",
  "data": {
    "types": ["user_status", "trade_order_status", "listing_status", ...],
    "count": 56
  }
}
```

### 4.2 获取指定类型的字典项

```http
GET /api/v4/system/dictionaries/type/user_status
```

**响应**：
```json
{
  "success": true,
  "code": "DICT_ITEMS_SUCCESS",
  "data": {
    "dict_type": "user_status",
    "items": [
      { "code": "active", "name": "正常", "color": "bg-success" },
      { "code": "inactive", "name": "未激活", "color": "bg-warning" },
      { "code": "banned", "name": "已封禁", "color": "bg-danger" }
    ],
    "count": 3
  }
}
```

### 4.3 查询单个字典项

```http
GET /api/v4/system/dictionaries/lookup?dict_type=user_status&dict_code=active
```

**响应**：
```json
{
  "success": true,
  "code": "DICT_LOOKUP_SUCCESS",
  "data": {
    "dict_type": "user_status",
    "dict_code": "active",
    "name": "正常",
    "color": "bg-success"
  }
}
```

## 五、常见字典类型清单

以下是系统中常用的字典类型，供前端参考：

### 5.1 用户相关
| dict_type | 说明 |
|-----------|------|
| `user_status` | 用户状态（active/inactive/banned） |
| `user_level` | 用户等级（normal/vip/merchant） |
| `account_status` | 账户状态（active/disabled） |

### 5.2 订单/交易相关
| dict_type | 说明 |
|-----------|------|
| `trade_order_status` | 交易订单状态（created/frozen/completed/cancelled/failed） |
| `exchange_status` | 兑换状态（pending/completed/shipped/cancelled） |
| `redemption_status` | 核销状态（pending/fulfilled/cancelled/expired） |

### 5.3 市场/挂牌相关
| dict_type | 说明 |
|-----------|------|
| `listing_status` | 挂牌状态（on_sale/locked/sold/withdrawn/admin_withdrawn） |
| `listing_kind` | 挂牌类型（item_instance/fungible_asset） |

### 5.4 物品相关
| dict_type | 说明 |
|-----------|------|
| `item_status` | 物品状态（available/locked/transferred/used/expired） |

### 5.5 审计日志相关
| dict_type | 说明 |
|-----------|------|
| `operation_type` | 操作类型（30+种） |
| `target_type` | 目标类型（user/admin/product/order等） |
| `operation_result` | 操作结果（success/failed/blocked） |

### 5.6 抽奖相关
| dict_type | 说明 |
|-----------|------|
| `campaign_status` | 活动状态（draft/active/paused/ended/cancelled） |
| `campaign_type` | 活动类型（daily/weekly/event/permanent等） |
| `prize_type` | 奖品类型（points/coupon/physical/virtual等） |
| `reward_tier` | 奖励档位（high/mid/low/fallback） |

### 5.7 反馈/客服相关
| dict_type | 说明 |
|-----------|------|
| `feedback_status` | 反馈状态（pending/processing/replied/closed） |
| `feedback_category` | 反馈类目（technical/feature/bug/complaint等） |
| `cs_session_status` | 客服会话状态（waiting/assigned/active/closed） |

### 5.8 优先级
| dict_type | 说明 |
|-----------|------|
| `priority` | 优先级（high/medium/low） |

## 六、迁移检查清单

前端开发在完成迁移后，请检查以下事项：

- [ ] 删除所有本地状态/颜色映射表
- [ ] 删除所有 `getStatusText()` / `getColorClass()` 类似函数
- [ ] 修改模板/视图使用 `*_display` 和 `*_color` 字段
- [ ] 如需下拉选项，调用 `/api/v4/system/dictionaries/type/:dictType` 获取
- [ ] 测试所有涉及状态展示的页面

## 七、注意事项

1. **空值处理**：如果后端返回的 `*_display` 为 `null`，表示该枚举值未配置，可显示原始值或占位符
2. **缓存策略**：字典数据变化不频繁，前端可缓存字典列表（建议 5-10 分钟）
3. **颜色兼容**：管理后台可直接使用 Bootstrap 类名，小程序需自行转换
4. **扩展性**：运营可通过管理后台动态修改中文名称，无需前端发版

## 八、联系方式

如有疑问，请联系后端开发团队。

