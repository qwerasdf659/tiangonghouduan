# 抽奖业务语义与口径统一规范

**文档版本**: v1.0.0  
**创建时间**: 2025年12月30日  
**适用范围**: 餐厅积分抽奖系统 V4.0  
**文档性质**: 业务规则定义 + 技术实现标准

---

## 📋 核心问题：谢谢惠顾算不算"中奖"？

### 问题来源

当前系统存在**口径不一致**的问题：

- **代码注释**：部分地方写"100%中奖"
- **真实数据**：`lottery_draws` 表中 `is_winner=0` 有 87 条（2.5%）
- **接口返回**：存在 `is_winner: false` 的分支，显示"未中奖"
- **奖品类型**：`prize_type` 枚举包含 `empty`（空奖）

这导致**业务语义混乱**：

- 运营说"100%中奖"，但用户抽到"谢谢惠顾"会觉得被骗
- 技术把"谢谢惠顾"记为 `is_winner=false`，但运营又说"这也算奖品"
- 客服不知道该怎么解释"到底中没中"

---

## 🎯 业务语义统一方案（参考大厂标准）

### 方案核心：双口径模型（技术口径 + 运营口径分离）

#### 1️⃣ 技术口径（给开发/数据/风控/审计）

**核心定义**：

- **抽奖结果（draw result）**：每次抽奖必定产生一个结果，对应 `lottery_draws` 表的一条记录
- **奖品类型（prize_type）**：`points`（积分）、`coupon`（券）、`physical`（实物）、`empty`（空奖/谢谢惠顾）
- **中奖（win）**：`is_winner=true`，仅当 `prize_type in ('points','coupon','physical')` 时成立
- **未中奖（no win）**：`is_winner=false`，对应 `prize_type='empty'`（谢谢惠顾）

**数据库字段语义**：

```sql
-- lottery_draws 表字段语义定义
is_winner TINYINT(1)  -- 是否中奖（获得有价值奖励）
  -- 1 = 中奖（prize_type in ('points','coupon','physical')）
  -- 0 = 未中奖（prize_type='empty'，谢谢惠顾）

prize_type ENUM('points','coupon','physical','empty')  -- 奖品类型
  -- 'points'   = 积分奖励（有价值）
  -- 'coupon'   = 优惠券（有价值）
  -- 'physical' = 实物奖品（有价值）
  -- 'empty'    = 谢谢惠顾（无价值，空奖）

prize_value INT  -- 奖品价值
  -- prize_type='empty' 时，prize_value=0 或 NULL
  -- 其他类型时，prize_value > 0
```

**业务规则**：

- ✅ **100%有抽奖结果**（每次都会产生一条 `lottery_draws` 记录）
- ✅ **不是100%中奖**（`is_winner` 可能为 0）
- ✅ **谢谢惠顾是"空奖/未中奖"**（`prize_type='empty'`, `is_winner=0`）

#### 2️⃣ 运营口径（给用户/客服/活动页面）

**推荐统一话术**：

| 场景     | 推荐表述                                     | ❌ 禁止表述              |
| -------- | -------------------------------------------- | ------------------------ |
| 活动规则 | "每次抽奖必定开奖，结果可能是奖品或谢谢惠顾" | "100%中奖"               |
| 前端文案 | "100%开奖（含空奖）"                         | "必中奖品"               |
| 客服话术 | "您本次抽奖结果是谢谢惠顾，未获得奖品"       | "您中了谢谢惠顾这个奖品" |
| 活动海报 | "必出结果，惊喜等你来"                       | "100%中奖率"             |

**客服应答标准**：

**用户问："我抽到谢谢惠顾，算不算中奖？"**

✅ **标准回答**：

> "您本次抽奖已成功开奖，结果是'谢谢惠顾'。这是抽奖的一种正常结果，但不属于中奖奖品（没有发放积分、券或实物）。我们的抽奖规则是：每次都会开奖出结果，结果可能是奖品，也可能是谢谢惠顾。感谢您的参与，欢迎继续尝试！"

❌ **错误回答**：

- "谢谢惠顾也是奖品，所以您中奖了"（会让用户觉得被骗）
- "您没中奖"（会让用户觉得抽奖失败/系统出错）

---

## 🔧 技术实现标准

### 1. 数据库层面

#### 必需的数据完整性约束

```sql
-- ✅ 强制约束：prize_type 与 is_winner 的一致性
-- 建议创建触发器或在应用层强制校验

-- 规则1：prize_type='empty' 时，is_winner 必须为 0
-- 规则2：prize_type in ('points','coupon','physical') 时，is_winner 必须为 1
-- 规则3：prize_type='empty' 时，prize_value 必须为 0 或 NULL

-- 检查当前数据是否符合规则
SELECT
  prize_type,
  is_winner,
  COUNT(*) as count,
  CASE
    WHEN prize_type='empty' AND is_winner=1 THEN '❌ 冲突：空奖标记为中奖'
    WHEN prize_type IN ('points','coupon','physical') AND is_winner=0 THEN '❌ 冲突：有价值奖品标记为未中奖'
    WHEN prize_type IS NULL OR prize_type='' THEN '❌ 脏数据：prize_type 为空'
    ELSE '✅ 正常'
  END as status
FROM lottery_draws
GROUP BY prize_type, is_winner
ORDER BY prize_type, is_winner;
```

#### 历史数据修复脚本

```sql
-- 修复脏数据：prize_type 为 NULL 或空字符串的记录
-- 根据 is_winner 和 prize_value 推断正确的 prize_type

START TRANSACTION;

-- 1. 修复 prize_type=NULL 且 is_winner=0 的记录 → empty
UPDATE lottery_draws
SET prize_type = 'empty',
    prize_value = 0
WHERE (prize_type IS NULL OR prize_type = '')
  AND is_winner = 0;

-- 2. 修复 prize_type=NULL 且 is_winner=1 的记录 → 根据 prize_value 推断
UPDATE lottery_draws
SET prize_type = CASE
  WHEN prize_value > 0 AND prize_value <= 1000 THEN 'points'  -- 假设积分奖励
  WHEN prize_value > 1000 THEN 'physical'  -- 假设实物奖品
  ELSE 'points'  -- 默认积分
END
WHERE (prize_type IS NULL OR prize_type = '')
  AND is_winner = 1;

-- 3. 验证修复结果
SELECT
  '修复后数据分布' as info,
  prize_type,
  is_winner,
  COUNT(*) as count
FROM lottery_draws
GROUP BY prize_type, is_winner
ORDER BY prize_type, is_winner;

-- 如果验证通过，提交事务；否则回滚
COMMIT;
-- ROLLBACK;  -- 如果发现问题，取消注释此行并注释上面的 COMMIT
```

### 2. 代码层面

#### 抽奖引擎返回格式标准

```javascript
// ✅ 标准返回格式（routes/v4/lottery/draw.js）
{
  prizes: [
    // 中奖情况（is_winner=true）
    {
      is_winner: true,
      id: 123,
      name: '50积分',
      type: 'points',
      sort_order: 3,
      icon: '💰',
      rarity: 'common',
      display_points: 50,
      display_value: '50积分'
    },

    // 未中奖情况（is_winner=false，谢谢惠顾）
    {
      is_winner: false,
      name: '未中奖', // ✅ 明确语义：未中奖
      type: 'empty', // ✅ 空奖类型
      sort_order: null,
      icon: '💨',
      rarity: 'common',
      display_points: 0
    }
  ]
}
```

#### 代码注释/文档统一标准

**✅ 推荐表述**：

```javascript
/**
 * 抽奖业务规则：
 * - 100%开奖：每次抽奖必定产生一个结果
 * - 结果类型：积分/券/实物/谢谢惠顾（空奖）
 * - 中奖定义：获得有价值奖励（积分/券/实物）
 * - 未中奖：抽到谢谢惠顾（prize_type='empty', is_winner=false）
 */
```

**❌ 禁止表述**：

```javascript
// ❌ 错误：会让用户误解
/**
 * 抽奖业务规则：
 * - 100%中奖：每次抽奖必定中奖
 * - 谢谢惠顾也是一种奖品
 */
```

### 3. 前端展示层面

#### 结果展示文案标准

```javascript
// ✅ 前端展示逻辑
function displayLotteryResult(prize) {
  if (prize.is_winner) {
    return {
      title: '🎉 恭喜中奖！',
      message: `您获得了 ${prize.name}`,
      type: 'success'
    }
  } else {
    return {
      title: '💨 未中奖',
      message: '谢谢惠顾，再接再厉！',
      type: 'info' // 不是 error，避免负面情绪
    }
  }
}
```

#### 活动规则页面标准文案

```markdown
### 抽奖规则

1. **开奖机制**：每次抽奖100%开奖，必定产生一个结果
2. **奖品类型**：
   - 积分奖励（10-1000积分）
   - 优惠券（满减券、折扣券等）
   - 实物奖品（商品兑换券等）
   - 谢谢惠顾（未中奖）
3. **中奖说明**：获得积分、券或实物即为中奖；抽到"谢谢惠顾"为未中奖
4. **抽奖成本**：每次抽奖消耗100积分
```

---

## 📊 大厂/游戏公司参考案例

### 案例1：美团/饿了么（外卖平台）

**对外话术**：

- "必出结果"、"100%开奖"
- 明确说明"可能获得红包或谢谢惠顾"

**技术实现**：

- 空奖记为 `prize_type='empty'`，`is_winner=0`
- 概率公示里会写"谢谢惠顾概率 XX%"

### 案例2：腾讯游戏（王者荣耀/和平精英）

**对外话术**：

- "必得道具"、"保底机制"
- 很少出现"谢谢惠顾"，通常最低奖励是少量金币/经验

**技术实现**：

- 如果有空奖，会叫"空气/空抽"
- 严格区分"中奖"和"开奖"

### 案例3：阿里（淘宝/支付宝）

**对外话术**：

- "100%有奖"（但会在规则里说明"奖品包括谢谢惠顾"）
- 或者直接改成"最低1积分"，避免空奖

**技术实现**：

- 空奖记为 `reward_type='none'`
- 数据统计时明确区分"中奖率"和"开奖率"

### 案例4：小众二手平台/虚拟物品交易

**核心原则**：

- 只有"可交易的资产化实体"才算奖品
- 空结果只是行为记录，不进入交易市场

**技术实现**：

- 中奖才会生成 `item_instance`（可交易实体）
- 未中奖只记录 `lottery_draws`（行为日志）

---

## ✅ 本项目统一标准（拍板决策）

### 业务语义定义（技术层面）

| 概念         | 定义                   | 数据库体现                   | 业务含义                       |
| ------------ | ---------------------- | ---------------------------- | ------------------------------ |
| **抽奖结果** | 每次抽奖必定产生的结果 | `lottery_draws` 表的一条记录 | 100%有结果                     |
| **奖品类型** | 结果的分类             | `prize_type` 字段            | `points/coupon/physical/empty` |
| **中奖**     | 获得有价值的奖励       | `is_winner=1`                | 仅 `prize_type != 'empty'`     |
| **未中奖**   | 抽到空奖/谢谢惠顾      | `is_winner=0`                | `prize_type='empty'`           |
| **谢谢惠顾** | 空奖的显示名称         | `prize_type='empty'`         | 未中奖的一种友好表述           |

### 统一口径标准

#### 对外表述（用户/活动/客服）

**✅ 推荐表述**：

- "每次抽奖100%开奖（必出结果）"
- "结果可能是奖品，也可能是谢谢惠顾"
- "中奖即可获得积分、券或实物奖励"

**❌ 禁止表述**：

- "100%中奖"（会让用户误解为必得奖品）
- "谢谢惠顾也是奖品"（语义混乱）
- "必中奖品"（与实际不符）

#### 对内表述（代码/文档/日志）

**✅ 标准术语**：

- `is_winner=true` → "中奖"
- `is_winner=false` → "未中奖"
- `prize_type='empty'` → "空奖/谢谢惠顾"
- 统计指标：**中奖率 = is_winner=1 的记录数 / 总抽奖次数**

**❌ 禁止混用**：

- 不要把"开奖率"和"中奖率"混为一谈
- 不要在技术文档里说"谢谢惠顾算中奖"

---

## 🔧 技术实现规范

### 1. 抽奖引擎返回格式（强制标准）

```javascript
// routes/v4/lottery/draw.js

// ✅ 中奖情况
{
  is_winner: true,           // ✅ 明确标识：中奖
  id: 123,
  name: "50积分",
  type: "points",            // ✅ 有价值类型
  sort_order: 3,
  icon: "💰",
  rarity: "common",
  display_points: 50,
  display_value: "50积分"
}

// ✅ 未中奖情况（谢谢惠顾）
{
  is_winner: false,          // ✅ 明确标识：未中奖
  name: "未中奖",            // ✅ 技术语义清晰
  type: "empty",             // ✅ 空奖类型
  sort_order: null,
  icon: "💨",
  rarity: "common",
  display_points: 0
}
```

### 2. 前端展示逻辑（强制标准）

```javascript
// 前端展示逻辑
function renderLotteryResult(prize) {
  if (prize.is_winner) {
    // 中奖：显示奖品信息
    return {
      title: '🎉 恭喜中奖！',
      subtitle: `您获得了 ${prize.name}`,
      animation: 'celebration',
      buttonText: '查看奖品'
    }
  } else {
    // 未中奖：显示谢谢惠顾
    return {
      title: '💨 谢谢惠顾',
      subtitle: '未中奖，再接再厉！',
      animation: 'fade',
      buttonText: '再抽一次'
    }
  }
}
```

### 3. 数据统计口径（强制标准）

```javascript
// 统计指标定义
const lotteryMetrics = {
  // ✅ 开奖率（必定100%）
  draw_completion_rate: (total_draws / total_attempts) * 100, // 应该恒为 100%

  // ✅ 中奖率（is_winner=1 的比例）
  win_rate: (draws_with_winner / total_draws) * 100,

  // ✅ 各奖品类型分布
  prize_distribution: {
    points: (count_of_points / total_draws) * 100,
    coupon: (count_of_coupon / total_draws) * 100,
    physical: (count_of_physical / total_draws) * 100,
    empty: (count_of_empty / total_draws) * 100 // 谢谢惠顾占比
  }
}
```

**SQL 查询示例**：

```sql
-- 计算中奖率（基于 is_winner）
SELECT
  COUNT(*) as total_draws,
  SUM(CASE WHEN is_winner=1 THEN 1 ELSE 0 END) as win_count,
  ROUND(SUM(CASE WHEN is_winner=1 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2) as win_rate_percent,
  ROUND(SUM(CASE WHEN prize_type='empty' THEN 1 ELSE 0 END) / COUNT(*) * 100, 2) as empty_rate_percent
FROM lottery_draws
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY);

-- 奖品类型分布
SELECT
  prize_type,
  COUNT(*) as count,
  ROUND(COUNT(*) / (SELECT COUNT(*) FROM lottery_draws) * 100, 2) as percentage
FROM lottery_draws
GROUP BY prize_type
ORDER BY count DESC;
```

---

## 🚨 当前系统需要修复的问题

### 问题1：历史数据存在脏数据

**发现**：数据库中存在 `prize_type` 为 `NULL` 或空字符串的记录（742 + 8 条）

**影响**：

- 统计中奖率时会出错
- 前端展示可能异常
- 业务语义不清晰

**修复方案**：

1. 执行上述"历史数据修复脚本"
2. 在应用层添加强制校验（创建抽奖记录时必须指定有效的 `prize_type`）

### 问题2：代码注释/文档口径不一致

**发现**：部分代码注释写"100%中奖"，与实际业务逻辑冲突

**影响**：

- 新开发者理解错误
- 前端可能按错误理解实现UI
- 客服话术不统一

**修复方案**：

1. 全局搜索并替换所有"100%中奖"表述
2. 统一改为"100%开奖（必出结果，含空奖）"

### 问题3：前端可能存在错误的文案

**需要检查的地方**：

- 活动规则页面
- 抽奖结果弹窗
- 客服FAQ
- 活动海报/宣传文案

**统一标准**：

- 使用"100%开奖"而非"100%中奖"
- 明确说明"结果可能是奖品或谢谢惠顾"

---

## 📋 客服应答标准话术库

### 场景1：用户问"是不是100%中奖？"

**标准回答**：

> "我们的抽奖是100%开奖，每次都会出结果。结果可能是积分、券、实物奖品，也可能是谢谢惠顾。获得积分、券或实物才算中奖，谢谢惠顾是未中奖的一种结果。"

### 场景2：用户问"我抽到谢谢惠顾，为什么说100%中奖？"

**标准回答**：

> "非常抱歉造成误解。我们的活动规则是'100%开奖（必出结果）'，而不是'100%中奖'。谢谢惠顾是抽奖的一种正常结果，但不属于中奖。中奖是指获得积分、券或实物奖品。感谢您的参与！"

### 场景3：用户投诉"说好100%中奖，结果是谢谢惠顾"

**标准回答**：

> "非常抱歉给您带来困扰。我们已经核实，活动规则是'每次抽奖必定开奖'，结果可能是奖品或谢谢惠顾。如果我们的宣传文案有'100%中奖'的表述，这是我们的失误，我们会立即更正。作为补偿，我们为您赠送XX积分，感谢您的理解和支持！"

### 场景4：用户问"谢谢惠顾的概率是多少？"

**标准回答**：

> "根据活动规则，各类奖品和谢谢惠顾的概率会根据奖池情况动态调整。您可以在活动规则页面查看当前的奖品类型和大致概率范围。感谢您的关注！"

---

## 🎯 实施检查清单

### 数据库层面

- [ ] 执行历史数据修复脚本，清理 `prize_type` 为 `NULL/''` 的记录
- [ ] 验证修复后所有记录的 `is_winner` 与 `prize_type` 一致性
- [ ] 添加数据完整性约束或触发器（可选）

### 代码层面

- [ ] 全局搜索"100%中奖"，替换为"100%开奖"
- [ ] 检查所有抽奖相关代码注释，统一业务语义
- [ ] 确保抽奖引擎返回格式符合标准
- [ ] 添加单元测试验证 `is_winner` 与 `prize_type` 的一致性

### 前端层面

- [ ] 检查活动规则页面文案
- [ ] 检查抽奖结果弹窗文案
- [ ] 检查宣传海报/banner文案
- [ ] 统一"未中奖"的展示逻辑和文案

### 客服层面

- [ ] 培训客服使用标准话术
- [ ] 更新FAQ文档
- [ ] 准备应对"100%中奖"投诉的标准流程
- [ ] 如有必要，准备补偿方案

---

## 🔍 技术债务修复脚本

### 一键检查脚本

```bash
#!/bin/bash
# 检查抽奖业务语义一致性

echo "🔍 检查抽奖业务语义一致性..."

# 1. 检查代码中的"100%中奖"表述
echo "📝 检查代码注释/文档..."
grep -r "100%中奖" --include="*.js" --include="*.md" . | grep -v node_modules | grep -v "禁止表述"

# 2. 检查数据库脏数据
echo "🗄️ 检查数据库脏数据..."
node - <<'NODE'
const mysql = require('mysql2/promise');

(async () => {
  const conn = await mysql.createConnection({
    host: 'dbconn.sealosbja.site',
    port: 42569,
    user: 'root',
    password: 'mc6r9cgb',
    database: 'restaurant_points_dev'
  });

  // 检查 prize_type 为 NULL 或空的记录
  const [dirty] = await conn.query(`
    SELECT
      COUNT(*) as count,
      is_winner,
      prize_type
    FROM lottery_draws
    WHERE prize_type IS NULL OR prize_type = ''
    GROUP BY is_winner, prize_type
  `);

  if (dirty.length > 0) {
    console.log('❌ 发现脏数据:', dirty);
  } else {
    console.log('✅ 无脏数据');
  }

  // 检查 is_winner 与 prize_type 的一致性
  const [inconsistent] = await conn.query(`
    SELECT
      COUNT(*) as count,
      prize_type,
      is_winner
    FROM lottery_draws
    WHERE
      (prize_type='empty' AND is_winner=1)
      OR (prize_type IN ('points','coupon','physical') AND is_winner=0)
    GROUP BY prize_type, is_winner
  `);

  if (inconsistent.length > 0) {
    console.log('❌ 发现不一致数据:', inconsistent);
  } else {
    console.log('✅ is_winner 与 prize_type 一致');
  }

  await conn.end();
})();
NODE

echo "✅ 检查完成"
```

### 数据修复脚本（需要拍板后执行）

```bash
#!/bin/bash
# 修复抽奖数据脏数据

echo "🔧 开始修复抽奖数据..."

node - <<'NODE'
const mysql = require('mysql2/promise');

(async () => {
  const conn = await mysql.createConnection({
    host: 'dbconn.sealosbja.site',
    port: 42569,
    user: 'root',
    password: 'mc6r9cgb',
    database: 'restaurant_points_dev'
  });

  await conn.beginTransaction();

  try {
    // 1. 修复 prize_type=NULL 且 is_winner=0 → empty
    const [result1] = await conn.query(`
      UPDATE lottery_draws
      SET prize_type = 'empty',
          prize_value = 0
      WHERE (prize_type IS NULL OR prize_type = '')
        AND is_winner = 0
    `);
    console.log(`✅ 修复未中奖空数据: ${result1.affectedRows} 条`);

    // 2. 修复 prize_type=NULL 且 is_winner=1 → 根据 prize_value 推断
    const [result2] = await conn.query(`
      UPDATE lottery_draws
      SET prize_type = CASE
        WHEN prize_value > 0 AND prize_value <= 1000 THEN 'points'
        WHEN prize_value > 1000 THEN 'physical'
        ELSE 'points'
      END
      WHERE (prize_type IS NULL OR prize_type = '')
        AND is_winner = 1
    `);
    console.log(`✅ 修复中奖空数据: ${result2.affectedRows} 条`);

    // 3. 验证修复结果
    const [verify] = await conn.query(`
      SELECT
        prize_type,
        is_winner,
        COUNT(*) as count
      FROM lottery_draws
      WHERE prize_type IS NULL OR prize_type = ''
      GROUP BY prize_type, is_winner
    `);

    if (verify.length > 0) {
      console.log('⚠️ 仍有未修复数据:', verify);
      throw new Error('数据修复不完整');
    }

    await conn.commit();
    console.log('✅ 数据修复完成并已提交');

  } catch (error) {
    await conn.rollback();
    console.error('❌ 数据修复失败，已回滚:', error.message);
    process.exit(1);
  } finally {
    await conn.end();
  }
})();
NODE

echo "✅ 修复完成"
```

---

## 📊 统计分析标准

### 中奖率统计（管理后台/运营分析）

```javascript
// services/AnalyticsService.js

/**
 * 计算抽奖中奖率
 *
 * @param {Object} options - 查询条件
 * @param {Date} options.start_date - 开始日期
 * @param {Date} options.end_date - 结束日期
 * @param {number} options.campaign_id - 活动ID（可选）
 * @returns {Object} 中奖率统计
 */
async function calculateWinRate(options = {}) {
  const { start_date, end_date, campaign_id } = options

  const whereClause = {}
  if (start_date) whereClause.created_at = { [Op.gte]: start_date }
  if (end_date) whereClause.created_at = { ...whereClause.created_at, [Op.lte]: end_date }
  if (campaign_id) whereClause.campaign_id = campaign_id

  const stats = await LotteryDraw.findAll({
    where: whereClause,
    attributes: [
      [sequelize.fn('COUNT', sequelize.col('draw_id')), 'total_draws'],
      [
        sequelize.fn('SUM', sequelize.literal('CASE WHEN is_winner=1 THEN 1 ELSE 0 END')),
        'win_count'
      ],
      [
        sequelize.fn('SUM', sequelize.literal('CASE WHEN prize_type="empty" THEN 1 ELSE 0 END')),
        'empty_count'
      ]
    ],
    raw: true
  })

  const total = parseInt(stats[0].total_draws)
  const wins = parseInt(stats[0].win_count)
  const empties = parseInt(stats[0].empty_count)

  return {
    total_draws: total,
    win_count: wins,
    empty_count: empties,
    win_rate: ((wins / total) * 100).toFixed(2) + '%', // 中奖率
    empty_rate: ((empties / total) * 100).toFixed(2) + '%', // 谢谢惠顾率
    draw_completion_rate: '100.00%' // 开奖率（恒为100%）
  }
}
```

---

## 🎓 最佳实践建议

### 1. 概率公示（透明化）

如果你的抽奖涉及概率调整，建议在活动规则页面公示：

```markdown
### 奖品概率说明

- 积分奖励：约 40-60%
- 优惠券：约 20-30%
- 实物奖品：约 5-10%
- 谢谢惠顾：约 10-30%

\*注：实际概率会根据奖池情况动态调整，以实际抽奖结果为准。
```

### 2. 保底机制（提升体验）

参考游戏公司做法，可以考虑：

- **连续N次未中奖后，下次必中**（保底机制）
- 或者**取消"谢谢惠顾"，改为最低1积分**（避免空奖负反馈）

### 3. 数据监控告警

建议添加监控：

- 如果某个时段"谢谢惠顾率"异常高（如 >50%），触发告警
- 如果出现 `prize_type=NULL` 的新记录，立即告警（数据质量问题）

---

## 🔗 相关文档

- **技术债务全面分析报告**：`docs/技术债务全面分析报告.md`
- **API响应格式规范**：`docs/生产质量保证标准.md`（规范体系中的 08 号文档）
- **数据库迁移规范**：`docs/资产域标准架构-破坏性重构方案.md`

---

## 📝 变更记录

| 版本   | 日期       | 变更内容                           | 变更人 |
| ------ | ---------- | ---------------------------------- | ------ |
| v1.0.0 | 2025-12-30 | 初始版本，定义抽奖业务语义统一标准 | 项目组 |

---

**核心原则**：技术语义清晰、运营口径统一、用户体验友好、数据可审计

**下一步行动**：

1. 拍板确认本规范
2. 执行数据修复脚本
3. 更新代码注释和文档
4. 培训客服使用标准话术
5. 检查并更新前端文案
