# ä¸­æ–‡åŒ–æ˜¾ç¤ºåç§°å®æ–½æ–‡æ¡£

> **åˆ›å»ºæ—¶é—´**: 2026-01-21  
> **æ›´æ–°æ—¶é—´**: 2026-01-22  
> **ç‰ˆæœ¬**: V4.7.0  
> **çŠ¶æ€**: ğŸ”„ æ–¹æ¡ˆå‡çº§ä¸­ï¼ˆä»£ç å¸¸é‡ â†’ æ•°æ®åº“å­—å…¸è¡¨ï¼‰

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰å‰åç«¯ç»Ÿä¸€çš„ä¸­æ–‡æ˜¾ç¤ºåç§°æœºåˆ¶ï¼Œè§£å†³ç®¡ç†åå°è‹±æ–‡çŠ¶æ€æ ‡è¯†éš¾ä»¥ç†è§£çš„é—®é¢˜ã€‚

### âš ï¸ æ–¹æ¡ˆå‡çº§è¯´æ˜ï¼ˆ2026-01-22ï¼‰

| ç‰ˆæœ¬ | æ–¹æ¡ˆ | é—®é¢˜ |
|------|------|------|
| V4.6.0 | ä»£ç å¸¸é‡ `DisplayNames.js` | ä¿®æ”¹éœ€å‘ç‰ˆï¼Œè¿è¥æ— æ³•è‡ªä¸»è°ƒæ•´ |
| **V4.7.0** | **æ•°æ®åº“å­—å…¸è¡¨ + Redisç¼“å­˜ + ç‰ˆæœ¬ç®¡ç†** | âœ… è¿è¥åå°å¯åŠ¨æ€ä¿®æ”¹ï¼Œæ”¯æŒå›æ»š |

---

## ğŸ¯ å·²æ‹æ¿çš„æ ¸å¿ƒå†³ç­–

| # | å†³ç­–é¡¹ | å†³å®š | è¯´æ˜ |
|---|--------|------|------|
| 1 | **æ•°æ®æºæ–¹æ¡ˆ** | æ•°æ®åº“å­—å…¸è¡¨ | è¿è¥å¯åŠ¨æ€è°ƒæ•´ï¼Œä¸å…è®¸ç¡¬ç¼–ç  |
| 2 | **æ ¡éªŒä¸¥æ ¼ç¨‹åº¦** | å›ºå®šä¸¥æ ¼æ¨¡å¼ | æ— è®ºä»€ä¹ˆç¯å¢ƒï¼Œå‘ç°æœªæ˜ å°„æšä¸¾ â†’ å¯åŠ¨å¤±è´¥ |
| 3 | **å‰ç«¯ fallback** | åˆ é™¤ | å‰ç«¯åˆ é™¤æ‰€æœ‰æ˜ å°„é€»è¾‘ï¼Œå¼ºåˆ¶ä¾èµ–åç«¯è¿”å› |
| 4 | **ç»Ÿä¸€è¾…åŠ©å‡½æ•°** | åˆ›å»º | `utils/displayNameHelper.js` ç»Ÿä¸€å®ç° |
| 5 | **åˆå§‹æ•°æ®è¦†ç›–** | å…¨é‡è¦†ç›– | 106 ä¸ª ENUM å­—æ®µå…¨éƒ¨é…ç½®ä¸­æ–‡æ˜ å°„ |
| 6 | **ç¼“å­˜ç­–ç•¥** | Redis ç¼“å­˜ | æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²ï¼Œè¿è¥ä¿®æ”¹åè‡ªåŠ¨åŒæ­¥ |
| 7 | **ç‰ˆæœ¬ç®¡ç†** | éœ€è¦ | å¢åŠ  version å­—æ®µï¼Œæ”¯æŒå†å²ç‰ˆæœ¬æŸ¥çœ‹å’Œå›æ»š |
| 8 | **æœåŠ¡å‘½å** | `DisplayNameService` | èšç„¦æ˜¾ç¤ºåç§°åŠŸèƒ½ï¼Œé¿å…ä¸ç°æœ‰ `DictionaryService` å†²çª |
| 9 | **Redis å®¢æˆ·ç«¯** | `UnifiedRedisClient` | ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ Redis å•ä¾‹ï¼ˆ`getRedisClient()`ï¼‰ |
| 10 | **æ—¥å¿—æ–¹å¼** | `utils/logger` | ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ç»“æ„åŒ–æ—¥å¿— |
| 11 | **æœåŠ¡ç±»é£æ ¼** | é™æ€æ–¹æ³• | ä¸ `AuditLogService`ã€`FeatureFlagService` ä¸€è‡´ |

---

## ğŸ—‚ï¸ æ•°æ®åº“è®¾è®¡

### 1. å­—å…¸è¡¨ç»“æ„ `system_dictionaries`

```sql
CREATE TABLE system_dictionaries (
  dict_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT 'å­—å…¸ID',
  dict_type VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç±»å‹ï¼ˆå¦‚ï¼šorder_status, user_statusï¼‰',
  dict_code VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç¼–ç ï¼ˆè‹±æ–‡å€¼ï¼Œå¦‚ï¼špending, completedï¼‰',
  dict_name VARCHAR(100) NOT NULL COMMENT 'å­—å…¸åç§°ï¼ˆä¸­æ–‡æ˜¾ç¤ºå€¼ï¼‰',
  dict_color VARCHAR(20) DEFAULT NULL COMMENT 'å‰ç«¯æ˜¾ç¤ºé¢œè‰²ï¼ˆå¦‚ï¼šbg-success, bg-warningï¼‰',
  sort_order INT DEFAULT 0 COMMENT 'æ’åºï¼ˆåŒç±»å‹å†…æ’åºï¼‰',
  is_enabled TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨ï¼ˆ0ç¦ç”¨ 1å¯ç”¨ï¼‰',
  remark VARCHAR(200) DEFAULT NULL COMMENT 'å¤‡æ³¨è¯´æ˜',
  
  -- ç‰ˆæœ¬ç®¡ç†å­—æ®µ
  version INT UNSIGNED DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·ï¼ˆæ¯æ¬¡ä¿®æ”¹+1ï¼‰',
  updated_by INT UNSIGNED DEFAULT NULL COMMENT 'æœ€åä¿®æ”¹äººID',
  
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  
  UNIQUE KEY uk_type_code (dict_type, dict_code),
  KEY idx_type (dict_type),
  KEY idx_enabled (is_enabled),
  KEY idx_version (version)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿå­—å…¸è¡¨';
```

### 2. å­—å…¸å†å²è¡¨ `system_dictionary_history`ï¼ˆç‰ˆæœ¬å›æ»šæ”¯æŒï¼‰

```sql
CREATE TABLE system_dictionary_history (
  history_id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT 'å†å²è®°å½•ID',
  dict_id INT UNSIGNED NOT NULL COMMENT 'å­—å…¸ID',
  dict_type VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç±»å‹',
  dict_code VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç¼–ç ',
  dict_name VARCHAR(100) NOT NULL COMMENT 'ä¿®æ”¹å‰çš„ä¸­æ–‡åç§°',
  dict_color VARCHAR(20) DEFAULT NULL COMMENT 'ä¿®æ”¹å‰çš„é¢œè‰²',
  version INT UNSIGNED NOT NULL COMMENT 'ç‰ˆæœ¬å·',
  changed_by INT UNSIGNED NOT NULL COMMENT 'ä¿®æ”¹äººID',
  changed_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¿®æ”¹æ—¶é—´',
  change_reason VARCHAR(200) DEFAULT NULL COMMENT 'ä¿®æ”¹åŸå› ',
  
  KEY idx_dict_id (dict_id),
  KEY idx_version (dict_id, version),
  KEY idx_changed_at (changed_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿå­—å…¸å†å²è¡¨ï¼ˆç‰ˆæœ¬å›æ»šï¼‰';
```

### 3. åˆå§‹æ•°æ®ï¼ˆå…¨é‡è¦†ç›– 106 ä¸ª ENUMï¼‰

åˆå§‹æ•°æ®æŒ‰ä¸šåŠ¡æ¨¡å—åˆ†ç±»ï¼Œå®Œæ•´ SQL è§ `migrations/xxx-init-system-dictionaries.js`

#### 3.1 ç”¨æˆ·ç›¸å…³

```sql
-- ç”¨æˆ·çŠ¶æ€ (users.status)
INSERT INTO system_dictionaries (dict_type, dict_code, dict_name, dict_color, sort_order) VALUES
('user_status', 'active', 'æ­£å¸¸', 'bg-success', 1),
('user_status', 'inactive', 'æœªæ¿€æ´»', 'bg-warning', 2),
('user_status', 'banned', 'å·²å°ç¦', 'bg-danger', 3);

-- ç”¨æˆ·ç­‰çº§ (users.user_level)
('user_level', 'normal', 'æ™®é€šç”¨æˆ·', 'bg-secondary', 1),
('user_level', 'vip', 'VIPç”¨æˆ·', 'bg-warning', 2),
('user_level', 'merchant', 'å•†æˆ·', 'bg-primary', 3);

-- è´¦æˆ·ç±»å‹ (accounts.account_type)
('account_type', 'user', 'ç”¨æˆ·è´¦æˆ·', NULL, 1),
('account_type', 'system', 'ç³»ç»Ÿè´¦æˆ·', NULL, 2);

-- è´¦æˆ·çŠ¶æ€ (accounts.status)
('account_status', 'active', 'æ­£å¸¸', 'bg-success', 1),
('account_status', 'disabled', 'å·²ç¦ç”¨', 'bg-danger', 2);
```

#### 3.2 è®¢å•/äº¤æ˜“ç›¸å…³

```sql
-- äº¤æ˜“è®¢å•çŠ¶æ€ (trade_orders.status)
('trade_order_status', 'created', 'å·²åˆ›å»º', 'bg-info', 1),
('trade_order_status', 'frozen', 'å·²å†»ç»“', 'bg-warning', 2),
('trade_order_status', 'completed', 'å·²å®Œæˆ', 'bg-success', 3),
('trade_order_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-secondary', 4),
('trade_order_status', 'failed', 'å¤±è´¥', 'bg-danger', 5);

-- å…‘æ¢è®¢å•çŠ¶æ€ (exchange_records.status)
('exchange_status', 'pending', 'å¾…å¤„ç†', 'bg-warning', 1),
('exchange_status', 'completed', 'å·²å®Œæˆ', 'bg-success', 2),
('exchange_status', 'shipped', 'å·²å‘è´§', 'bg-info', 3),
('exchange_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-secondary', 4);

-- æ ¸é”€è®¢å•çŠ¶æ€ (redemption_orders.status)
('redemption_status', 'pending', 'å¾…æ ¸é”€', 'bg-warning', 1),
('redemption_status', 'fulfilled', 'å·²æ ¸é”€', 'bg-success', 2),
('redemption_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-secondary', 3),
('redemption_status', 'expired', 'å·²è¿‡æœŸ', 'bg-danger', 4);
```

#### 3.3 å¸‚åœºæŒ‚ç‰Œç›¸å…³

```sql
-- æŒ‚ç‰ŒçŠ¶æ€ (market_listings.status)
('listing_status', 'on_sale', 'æŒ‚ç‰Œä¸­', 'bg-success', 1),
('listing_status', 'locked', 'å·²é”å®š', 'bg-warning', 2),
('listing_status', 'sold', 'å·²å”®å‡º', 'bg-info', 3),
('listing_status', 'withdrawn', 'å·²æ’¤å›', 'bg-secondary', 4),
('listing_status', 'admin_withdrawn', 'ç®¡ç†å‘˜æ’¤å›', 'bg-danger', 5);

-- æŒ‚ç‰Œç±»å‹ (market_listings.listing_kind)
('listing_kind', 'item_instance', 'ç‰©å“', NULL, 1),
('listing_kind', 'fungible_asset', 'èµ„äº§', NULL, 2);
```

#### 3.4 ç‰©å“ç›¸å…³

```sql
-- ç‰©å“çŠ¶æ€ (item_instances.status)
('item_status', 'available', 'å¯ç”¨', 'bg-success', 1),
('item_status', 'locked', 'å·²é”å®š', 'bg-warning', 2),
('item_status', 'transferred', 'å·²è½¬ç§»', 'bg-info', 3),
('item_status', 'used', 'å·²ä½¿ç”¨', 'bg-secondary', 4),
('item_status', 'expired', 'å·²è¿‡æœŸ', 'bg-danger', 5);
```

#### 3.5 åé¦ˆç›¸å…³

```sql
-- åé¦ˆçŠ¶æ€ (feedbacks.status)
('feedback_status', 'pending', 'å¾…å¤„ç†', 'bg-warning', 1),
('feedback_status', 'processing', 'å¤„ç†ä¸­', 'bg-primary', 2),
('feedback_status', 'replied', 'å·²å›å¤', 'bg-success', 3),
('feedback_status', 'closed', 'å·²å…³é—­', 'bg-secondary', 4);

-- åé¦ˆç±»ç›® (feedbacks.category)
('feedback_category', 'technical', 'æŠ€æœ¯é—®é¢˜', NULL, 1),
('feedback_category', 'feature', 'åŠŸèƒ½å»ºè®®', NULL, 2),
('feedback_category', 'bug', 'Bugåé¦ˆ', NULL, 3),
('feedback_category', 'complaint', 'æŠ•è¯‰', NULL, 4),
('feedback_category', 'suggestion', 'å»ºè®®', NULL, 5),
('feedback_category', 'other', 'å…¶ä»–', NULL, 6);

-- ä¼˜å…ˆçº§ (feedbacks.priority, content_review_records.priority, system_announcements.priority)
('priority', 'high', 'é«˜', 'bg-danger', 1),
('priority', 'medium', 'ä¸­', 'bg-warning', 2),
('priority', 'low', 'ä½', 'bg-info', 3);
```

#### 3.6 æ¶ˆè´¹è®°å½•ç›¸å…³

```sql
-- æ¶ˆè´¹è®°å½•çŠ¶æ€ (consumption_records.status)
('consumption_status', 'pending', 'å¾…å®¡æ ¸', 'bg-warning', 1),
('consumption_status', 'approved', 'å·²é€šè¿‡', 'bg-success', 2),
('consumption_status', 'rejected', 'å·²æ‹’ç»', 'bg-danger', 3),
('consumption_status', 'expired', 'å·²è¿‡æœŸ', 'bg-secondary', 4);

-- æ¶ˆè´¹è®°å½•æœ€ç»ˆçŠ¶æ€ (consumption_records.final_status)
('consumption_final_status', 'pending_review', 'å¾…å¤æ ¸', 'bg-warning', 1),
('consumption_final_status', 'approved', 'å·²é€šè¿‡', 'bg-success', 2),
('consumption_final_status', 'rejected', 'å·²æ‹’ç»', 'bg-danger', 3);
```

#### 3.7 å®¡è®¡æ—¥å¿—ç›¸å…³

```sql
-- æ“ä½œç±»å‹ (admin_operation_logs.operation_type) - 30ä¸ªæšä¸¾å€¼
('operation_type', 'points_adjust', 'ç§¯åˆ†è°ƒæ•´', NULL, 1),
('operation_type', 'asset_adjustment', 'èµ„äº§è°ƒæ•´', NULL, 2),
('operation_type', 'asset_orphan_cleanup', 'å­¤å„¿å†»ç»“æ¸…ç†', NULL, 3),
('operation_type', 'exchange_audit', 'å…‘æ¢å®¡æ ¸', NULL, 4),
('operation_type', 'product_update', 'å•†å“ä¿®æ”¹', NULL, 5),
('operation_type', 'product_create', 'å•†å“åˆ›å»º', NULL, 6),
('operation_type', 'product_delete', 'å•†å“åˆ é™¤', NULL, 7),
('operation_type', 'user_status_change', 'ç”¨æˆ·çŠ¶æ€å˜æ›´', NULL, 8),
('operation_type', 'role_assign', 'è§’è‰²åˆ†é…', NULL, 9),
('operation_type', 'role_change', 'è§’è‰²å˜æ›´', NULL, 10),
('operation_type', 'prize_config', 'å¥–å“é…ç½®', NULL, 11),
('operation_type', 'prize_create', 'å¥–å“åˆ›å»º', NULL, 12),
('operation_type', 'prize_delete', 'å¥–å“åˆ é™¤', NULL, 13),
('operation_type', 'prize_stock_adjust', 'å¥–å“åº“å­˜è°ƒæ•´', NULL, 14),
('operation_type', 'campaign_config', 'æ´»åŠ¨é…ç½®', NULL, 15),
('operation_type', 'lottery_force_win', 'å¼ºåˆ¶ä¸­å¥–', NULL, 16),
('operation_type', 'lottery_force_lose', 'å¼ºåˆ¶ä¸ä¸­å¥–', NULL, 17),
('operation_type', 'lottery_probability_adjust', 'æ¦‚ç‡è°ƒæ•´', NULL, 18),
('operation_type', 'lottery_user_queue', 'ç”¨æˆ·é˜Ÿåˆ—', NULL, 19),
('operation_type', 'lottery_clear_settings', 'æ¸…é™¤æŠ½å¥–è®¾ç½®', NULL, 20),
('operation_type', 'inventory_operation', 'åº“å­˜æ“ä½œ', NULL, 21),
('operation_type', 'inventory_transfer', 'åº“å­˜è½¬è®©', NULL, 22),
('operation_type', 'market_listing_admin_withdraw', 'ç®¡ç†å‘˜æ’¤å›æŒ‚ç‰Œ', NULL, 23),
('operation_type', 'system_config', 'ç³»ç»Ÿé…ç½®', NULL, 24),
('operation_type', 'session_assign', 'ä¼šè¯åˆ†é…', NULL, 25),
('operation_type', 'consumption_audit', 'æ¶ˆè´¹å®¡æ ¸', NULL, 26),
('operation_type', 'feature_flag_create', 'åŠŸèƒ½å¼€å…³åˆ›å»º', NULL, 27),
('operation_type', 'feature_flag_update', 'åŠŸèƒ½å¼€å…³æ›´æ–°', NULL, 28),
('operation_type', 'feature_flag_delete', 'åŠŸèƒ½å¼€å…³åˆ é™¤', NULL, 29),
('operation_type', 'feature_flag_toggle', 'åŠŸèƒ½å¼€å…³åˆ‡æ¢', NULL, 30);

-- ç›®æ ‡ç±»å‹ (admin_operation_logs.target_type æ˜¯ VARCHARï¼Œéœ€è¦†ç›–å¸¸è§å€¼)
('target_type', 'user', 'ç”¨æˆ·', NULL, 1),
('target_type', 'admin', 'ç®¡ç†å‘˜', NULL, 2),
('target_type', 'product', 'å•†å“', NULL, 3),
('target_type', 'order', 'è®¢å•', NULL, 4),
('target_type', 'trade_order', 'äº¤æ˜“è®¢å•', NULL, 5),
('target_type', 'market_listing', 'å¸‚åœºæŒ‚ç‰Œ', NULL, 6),
('target_type', 'system', 'ç³»ç»Ÿ', NULL, 7),
('target_type', 'config', 'é…ç½®', NULL, 8),
('target_type', 'lottery', 'æŠ½å¥–', NULL, 9),
('target_type', 'prize', 'å¥–å“', NULL, 10),
('target_type', 'campaign', 'æ´»åŠ¨', NULL, 11),
('target_type', 'feature_flag', 'åŠŸèƒ½å¼€å…³', NULL, 12);
```

#### 3.8 æŠ½å¥–ç³»ç»Ÿç›¸å…³

```sql
-- æ´»åŠ¨çŠ¶æ€ (lottery_campaigns.status)
('campaign_status', 'draft', 'è‰ç¨¿', 'bg-secondary', 1),
('campaign_status', 'active', 'è¿›è¡Œä¸­', 'bg-success', 2),
('campaign_status', 'paused', 'å·²æš‚åœ', 'bg-warning', 3),
('campaign_status', 'ended', 'å·²ç»“æŸ', 'bg-info', 4),
('campaign_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-danger', 5);

-- æ´»åŠ¨ç±»å‹ (lottery_campaigns.campaign_type)
('campaign_type', 'daily', 'æ¯æ—¥æ´»åŠ¨', NULL, 1),
('campaign_type', 'weekly', 'æ¯å‘¨æ´»åŠ¨', NULL, 2),
('campaign_type', 'event', 'ç‰¹æ®Šæ´»åŠ¨', NULL, 3),
('campaign_type', 'permanent', 'å¸¸é©»æ´»åŠ¨', NULL, 4),
('campaign_type', 'pool_basic', 'åŸºç¡€æ± ', NULL, 5),
('campaign_type', 'pool_advanced', 'è¿›é˜¶æ± ', NULL, 6),
('campaign_type', 'pool_vip', 'VIPæ± ', NULL, 7),
('campaign_type', 'pool_newbie', 'æ–°æ‰‹æ± ', NULL, 8);

-- é¢„ç®—æ¨¡å¼ (lottery_campaigns.budget_mode)
('budget_mode', 'user', 'ç”¨æˆ·é¢„ç®—', NULL, 1),
('budget_mode', 'pool', 'å¥–æ± é¢„ç®—', NULL, 2),
('budget_mode', 'none', 'æ— é¢„ç®—', NULL, 3);

-- å¥–å“ç±»å‹ (lottery_prizes.prize_type, lottery_draws.prize_type)
('prize_type', 'points', 'ç§¯åˆ†', NULL, 1),
('prize_type', 'coupon', 'ä¼˜æƒ åˆ¸', NULL, 2),
('prize_type', 'physical', 'å®ç‰©', NULL, 3),
('prize_type', 'virtual', 'è™šæ‹Ÿç‰©å“', NULL, 4),
('prize_type', 'service', 'æœåŠ¡', NULL, 5),
('prize_type', 'product', 'å•†å“', NULL, 6),
('prize_type', 'special', 'ç‰¹æ®Šå¥–å“', NULL, 7);

-- å¥–åŠ±æ¡£ä½ (lottery_prizes.reward_tier, lottery_draws.reward_tier)
('reward_tier', 'high', 'é«˜æ¡£', 'bg-danger', 1),
('reward_tier', 'mid', 'ä¸­æ¡£', 'bg-warning', 2),
('reward_tier', 'low', 'ä½æ¡£', 'bg-info', 3),
('reward_tier', 'fallback', 'ä¿åº•', 'bg-secondary', 4),
('reward_tier', 'unknown', 'æœªçŸ¥', 'bg-dark', 5);

-- æŠ½å¥–ç±»å‹ (lottery_draws.draw_type)
('draw_type', 'single', 'å•æŠ½', NULL, 1),
('draw_type', 'triple', 'ä¸‰è¿æŠ½', NULL, 2),
('draw_type', 'five', 'äº”è¿æŠ½', NULL, 3),
('draw_type', 'ten', 'åè¿æŠ½', NULL, 4),
('draw_type', 'multi', 'å¤šè¿æŠ½', NULL, 5);

-- Pipelineç±»å‹ (lottery_draws.pipeline_type)
('pipeline_type', 'normal', 'æ­£å¸¸æµç¨‹', NULL, 1),
('pipeline_type', 'preset', 'é¢„è®¾æµç¨‹', NULL, 2),
('pipeline_type', 'override', 'è¦†ç›–æµç¨‹', NULL, 3);

-- é¢„è®¾çŠ¶æ€ (lottery_presets.status)
('preset_status', 'pending', 'å¾…ä½¿ç”¨', 'bg-warning', 1),
('preset_status', 'used', 'å·²ä½¿ç”¨', 'bg-success', 2);

-- é¢„è®¾å®¡æ‰¹çŠ¶æ€ (lottery_presets.approval_status)
('preset_approval_status', 'pending', 'å¾…å®¡æ‰¹', 'bg-warning', 1),
('preset_approval_status', 'approved', 'å·²é€šè¿‡', 'bg-success', 2),
('preset_approval_status', 'rejected', 'å·²æ‹’ç»', 'bg-danger', 3);

-- ç®¡ç†è®¾ç½®çŠ¶æ€ (lottery_management_settings.status)
('management_setting_status', 'active', 'ç”Ÿæ•ˆä¸­', 'bg-success', 1),
('management_setting_status', 'expired', 'å·²è¿‡æœŸ', 'bg-secondary', 2),
('management_setting_status', 'used', 'å·²ä½¿ç”¨', 'bg-info', 3),
('management_setting_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-warning', 4);

-- ç®¡ç†è®¾ç½®ç±»å‹ (lottery_management_settings.setting_type)
('management_setting_type', 'force_win', 'å¼ºåˆ¶ä¸­å¥–', NULL, 1),
('management_setting_type', 'force_lose', 'å¼ºåˆ¶ä¸ä¸­å¥–', NULL, 2),
('management_setting_type', 'probability_adjust', 'æ¦‚ç‡è°ƒæ•´', NULL, 3),
('management_setting_type', 'user_queue', 'ç”¨æˆ·é˜Ÿåˆ—', NULL, 4);
```

#### 3.9 å®¢æœ/èŠå¤©ç›¸å…³

```sql
-- å®¢æœä¼šè¯çŠ¶æ€ (customer_service_sessions.status)
('cs_session_status', 'waiting', 'ç­‰å¾…ä¸­', 'bg-warning', 1),
('cs_session_status', 'assigned', 'å·²åˆ†é…', 'bg-info', 2),
('cs_session_status', 'active', 'è¿›è¡Œä¸­', 'bg-success', 3),
('cs_session_status', 'closed', 'å·²å…³é—­', 'bg-secondary', 4);

-- æ¶ˆæ¯ç±»å‹ (chat_messages.message_type)
('message_type', 'text', 'æ–‡æœ¬', NULL, 1),
('message_type', 'image', 'å›¾ç‰‡', NULL, 2),
('message_type', 'system', 'ç³»ç»Ÿæ¶ˆæ¯', NULL, 3);

-- æ¶ˆæ¯çŠ¶æ€ (chat_messages.status)
('message_status', 'sending', 'å‘é€ä¸­', 'bg-warning', 1),
('message_status', 'sent', 'å·²å‘é€', 'bg-info', 2),
('message_status', 'delivered', 'å·²é€è¾¾', 'bg-primary', 3),
('message_status', 'read', 'å·²è¯»', 'bg-success', 4);

-- å‘é€è€…ç±»å‹ (chat_messages.sender_type)
('sender_type', 'user', 'ç”¨æˆ·', NULL, 1),
('sender_type', 'admin', 'å®¢æœ', NULL, 2);

-- æ¶ˆæ¯æ¥æº (chat_messages.message_source)
('message_source', 'user_client', 'ç”¨æˆ·ç«¯', NULL, 1),
('message_source', 'admin_client', 'ç®¡ç†ç«¯', NULL, 2),
('message_source', 'system', 'ç³»ç»Ÿ', NULL, 3);
```

#### 3.10 å®¡æ ¸/å†…å®¹ç›¸å…³

```sql
-- å®¡æ ¸çŠ¶æ€ (content_review_records.audit_status)
('audit_status', 'pending', 'å¾…å®¡æ ¸', 'bg-warning', 1),
('audit_status', 'approved', 'å·²é€šè¿‡', 'bg-success', 2),
('audit_status', 'rejected', 'å·²æ‹’ç»', 'bg-danger', 3),
('audit_status', 'cancelled', 'å·²å–æ¶ˆ', 'bg-secondary', 4);

-- å›¾ç‰‡çŠ¶æ€ (image_resources.status)
('image_status', 'active', 'æ­£å¸¸', 'bg-success', 1),
('image_status', 'archived', 'å·²å½’æ¡£', 'bg-info', 2),
('image_status', 'deleted', 'å·²åˆ é™¤', 'bg-danger', 3);

-- å›¾ç‰‡ä¸šåŠ¡ç±»å‹ (image_resources.business_type)
('image_business_type', 'lottery', 'æŠ½å¥–', NULL, 1),
('image_business_type', 'exchange', 'å…‘æ¢', NULL, 2),
('image_business_type', 'trade', 'äº¤æ˜“', NULL, 3),
('image_business_type', 'uploads', 'ä¸Šä¼ ', NULL, 4);
```

#### 3.11 å•†æˆ·/é—¨åº—ç›¸å…³

```sql
-- é—¨åº—çŠ¶æ€ (stores.status)
('store_status', 'active', 'æ­£å¸¸', 'bg-success', 1),
('store_status', 'inactive', 'åœç”¨', 'bg-warning', 2),
('store_status', 'pending', 'å¾…å®¡æ ¸', 'bg-info', 3);

-- é—¨åº—å‘˜å·¥çŠ¶æ€ (store_staff.status)
('store_staff_status', 'active', 'åœ¨èŒ', 'bg-success', 1),
('store_staff_status', 'inactive', 'ç¦»èŒ', 'bg-secondary', 2),
('store_staff_status', 'pending', 'å¾…å…¥èŒ', 'bg-warning', 3);

-- å‘˜å·¥è§’è‰² (store_staff.role_in_store)
('store_staff_role', 'staff', 'åº—å‘˜', NULL, 1),
('store_staff_role', 'manager', 'åº—é•¿', NULL, 2);

-- å•†æˆ·æ“ä½œç±»å‹ (merchant_operation_logs.operation_type)
('merchant_operation_type', 'scan_user', 'æ‰«ç ç”¨æˆ·', NULL, 1),
('merchant_operation_type', 'submit_consumption', 'æäº¤æ¶ˆè´¹', NULL, 2),
('merchant_operation_type', 'view_consumption_list', 'æŸ¥çœ‹æ¶ˆè´¹åˆ—è¡¨', NULL, 3),
('merchant_operation_type', 'view_consumption_detail', 'æŸ¥çœ‹æ¶ˆè´¹è¯¦æƒ…', NULL, 4),
('merchant_operation_type', 'staff_login', 'å‘˜å·¥ç™»å½•', NULL, 5),
('merchant_operation_type', 'staff_logout', 'å‘˜å·¥ç™»å‡º', NULL, 6),
('merchant_operation_type', 'staff_add', 'æ·»åŠ å‘˜å·¥', NULL, 7),
('merchant_operation_type', 'staff_transfer', 'å‘˜å·¥è°ƒåŠ¨', NULL, 8),
('merchant_operation_type', 'staff_disable', 'ç¦ç”¨å‘˜å·¥', NULL, 9),
('merchant_operation_type', 'staff_enable', 'å¯ç”¨å‘˜å·¥', NULL, 10);

-- æ“ä½œç»“æœ (merchant_operation_logs.result)
('operation_result', 'success', 'æˆåŠŸ', 'bg-success', 1),
('operation_result', 'failed', 'å¤±è´¥', 'bg-danger', 2),
('operation_result', 'blocked', 'å·²é˜»æ–­', 'bg-warning', 3);
```

#### 3.12 é£æ§ç›¸å…³

```sql
-- é£æ§å‘Šè­¦ç±»å‹ (risk_alerts.alert_type)
('risk_alert_type', 'frequency_limit', 'é¢‘æ¬¡è¶…é™', NULL, 1),
('risk_alert_type', 'amount_limit', 'é‡‘é¢è¶…é™', NULL, 2),
('risk_alert_type', 'duplicate_user', 'é‡å¤ç”¨æˆ·', NULL, 3),
('risk_alert_type', 'suspicious_pattern', 'å¯ç–‘æ¨¡å¼', NULL, 4);

-- é£æ§å‘Šè­¦ä¸¥é‡ç¨‹åº¦ (risk_alerts.severity)
('risk_severity', 'low', 'ä½', 'bg-info', 1),
('risk_severity', 'medium', 'ä¸­', 'bg-warning', 2),
('risk_severity', 'high', 'é«˜', 'bg-danger', 3),
('risk_severity', 'critical', 'ä¸¥é‡', 'bg-dark', 4);

-- é£æ§å‘Šè­¦çŠ¶æ€ (risk_alerts.status)
('risk_alert_status', 'pending', 'å¾…å¤„ç†', 'bg-warning', 1),
('risk_alert_status', 'reviewed', 'å·²å®¡æ ¸', 'bg-success', 2),
('risk_alert_status', 'ignored', 'å·²å¿½ç•¥', 'bg-secondary', 3);
```

#### 3.13 åŠŸèƒ½å¼€å…³ç›¸å…³

```sql
-- å‘å¸ƒç­–ç•¥ (feature_flags.rollout_strategy)
('rollout_strategy', 'all', 'å…¨é‡', NULL, 1),
('rollout_strategy', 'percentage', 'ç™¾åˆ†æ¯”', NULL, 2),
('rollout_strategy', 'user_list', 'ç”¨æˆ·ç™½åå•', NULL, 3),
('rollout_strategy', 'user_segment', 'ç”¨æˆ·åˆ†ç¾¤', NULL, 4),
('rollout_strategy', 'schedule', 'å®šæ—¶', NULL, 5);

-- é™çº§è¡Œä¸º (feature_flags.fallback_behavior)
('fallback_behavior', 'disabled', 'ç¦ç”¨', NULL, 1),
('fallback_behavior', 'default_value', 'é»˜è®¤å€¼', NULL, 2),
('fallback_behavior', 'old_logic', 'æ—§é€»è¾‘', NULL, 3);
```

#### 3.14 å…¶ä»–ç³»ç»Ÿå­—æ®µ

```sql
-- é€šç”¨å¯ç”¨çŠ¶æ€ï¼ˆå¤šå¤„å¤ç”¨ï¼‰
('enabled_status', 'active', 'å¯ç”¨', 'bg-success', 1),
('enabled_status', 'inactive', 'ç¦ç”¨', 'bg-secondary', 2);

-- é€šç”¨æ˜¯/å¦
('yes_no', 'yes', 'æ˜¯', 'bg-success', 1),
('yes_no', 'no', 'å¦', 'bg-secondary', 2);

-- å…¬å‘Šç±»å‹ (system_announcements.type)
('announcement_type', 'system', 'ç³»ç»Ÿå…¬å‘Š', NULL, 1),
('announcement_type', 'activity', 'æ´»åŠ¨å…¬å‘Š', NULL, 2),
('announcement_type', 'maintenance', 'ç»´æŠ¤å…¬å‘Š', NULL, 3),
('announcement_type', 'notice', 'é€šçŸ¥', NULL, 4);

-- å•†å“ç©ºé—´ (products.space)
('product_space', 'lucky', 'å¹¸è¿ç©ºé—´', NULL, 1),
('product_space', 'premium', 'é«˜çº§ç©ºé—´', NULL, 2),
('product_space', 'both', 'åŒç©ºé—´', NULL, 3);

-- å•†å“çŠ¶æ€ (products.status)
('product_status', 'active', 'ä¸Šæ¶', 'bg-success', 1),
('product_status', 'offline', 'ä¸‹æ¶', 'bg-warning', 2),
('product_status', 'deleted', 'å·²åˆ é™¤', 'bg-danger', 3);

-- è¡Œæ”¿åŒºåˆ’çŠ¶æ€ (administrative_regions.status)
('region_status', 'active', 'æ­£å¸¸', 'bg-success', 1),
('region_status', 'merged', 'å·²åˆå¹¶', 'bg-info', 2),
('region_status', 'abolished', 'å·²æ’¤é”€', 'bg-secondary', 3);

-- å¹‚ç­‰è¯·æ±‚çŠ¶æ€ (api_idempotency_requests.status)
('idempotency_status', 'processing', 'å¤„ç†ä¸­', 'bg-warning', 1),
('idempotency_status', 'completed', 'å·²å®Œæˆ', 'bg-success', 2),
('idempotency_status', 'failed', 'å¤±è´¥', 'bg-danger', 3);

-- WebSocketçŠ¶æ€ (websocket_startup_logs.status)
('websocket_status', 'running', 'è¿è¡Œä¸­', 'bg-success', 1),
('websocket_status', 'stopped', 'å·²åœæ­¢', 'bg-secondary', 2),
('websocket_status', 'crashed', 'å·²å´©æºƒ', 'bg-danger', 3);

-- é«˜çº§ç©ºé—´è§£é”æ–¹å¼ (user_premium_status.unlock_method)
('unlock_method', 'points', 'ç§¯åˆ†è§£é”', NULL, 1),
('unlock_method', 'exchange', 'å…‘æ¢è§£é”', NULL, 2),
('unlock_method', 'vip', 'VIPè§£é”', NULL, 3),
('unlock_method', 'manual', 'æ‰‹åŠ¨è§£é”', NULL, 4);

-- æ¬ è´¦çŠ¶æ€ (preset_inventory_debt.status, preset_budget_debt.status)
('debt_status', 'pending', 'å¾…æ¸…å¿', 'bg-warning', 1),
('debt_status', 'cleared', 'å·²æ¸…å¿', 'bg-success', 2),
('debt_status', 'written_off', 'å·²æ ¸é”€', 'bg-secondary', 3);
```

---

## ğŸ”§ åç«¯å®ç°æ–¹æ¡ˆ

### 1. æ˜¾ç¤ºåç§°æœåŠ¡ `services/DisplayNameService.js`

> **å‘½åè¯´æ˜**ï¼šä½¿ç”¨ `DisplayNameService` è€Œé `DictionaryService`ï¼Œå› ä¸ºç°æœ‰ `DictionaryService` å·²ç”¨äºç®¡ç† `category_defs`ã€`rarity_defs` ç­‰å­—å…¸è¡¨ã€‚

```javascript
/**
 * æ˜¾ç¤ºåç§°æœåŠ¡ï¼ˆæ•°æ®åº“ + Redis ç¼“å­˜ï¼‰
 * 
 * æŠ€æœ¯è§„èŒƒï¼š
 * - Redis å®¢æˆ·ç«¯ï¼šä½¿ç”¨ UnifiedRedisClient å•ä¾‹ï¼ˆgetRedisClient()ï¼‰
 * - æ—¥å¿—ï¼šä½¿ç”¨ utils/loggerï¼ˆç»“æ„åŒ–æ—¥å¿—ï¼‰
 * - ç±»é£æ ¼ï¼šé™æ€æ–¹æ³•ï¼ˆä¸ AuditLogServiceã€FeatureFlagService ä¸€è‡´ï¼‰
 * 
 * èŒè´£ï¼š
 * - å¯åŠ¨æ—¶åŠ è½½å­—å…¸åˆ° Redis
 * - æä¾›å­—å…¸æŸ¥è¯¢æ¥å£ï¼ˆä¼˜å…ˆ Redisï¼Œfallback æ•°æ®åº“ï¼‰
 * - æä¾›åˆ·æ–°ç¼“å­˜æ¥å£ï¼ˆè¿è¥åå°è°ƒç”¨ï¼‰
 * - å¯åŠ¨æ—¶ä¸¥æ ¼æ ¡éªŒï¼šæœªæ˜ å°„æšä¸¾ â†’ å¯åŠ¨å¤±è´¥ï¼ˆå›ºå®šä¸¥æ ¼æ¨¡å¼ï¼‰
 * - æ”¯æŒç‰ˆæœ¬ç®¡ç†å’Œå›æ»š
 */

const { getRedisClient } = require('../utils/UnifiedRedisClient')
const logger = require('../utils/logger').logger
const { SystemDictionary, SystemDictionaryHistory } = require('../models')

class DisplayNameService {
  // Redis Key å‰ç¼€
  static REDIS_PREFIX = 'display_name:'
  static REDIS_VERSION_KEY = 'display_name:version'
  
  /**
   * å¯åŠ¨æ—¶åˆå§‹åŒ– + ä¸¥æ ¼æ ¡éªŒ
   */
  static async initialize() {
    logger.info('[DisplayNameService] å¼€å§‹åˆå§‹åŒ–æ˜¾ç¤ºåç§°æœåŠ¡')
    await DisplayNameService.loadToRedis()
    logger.info('[DisplayNameService] æ˜¾ç¤ºåç§°æœåŠ¡åˆå§‹åŒ–å®Œæˆ')
  }
  
  /**
   * åŠ è½½æ‰€æœ‰å­—å…¸åˆ° Redis
   */
  static async loadToRedis() {
    const redisClient = getRedisClient()
    const dictionaries = await SystemDictionary.findAll({
      where: { is_enabled: true }
    })
    
    const pipeline = await redisClient.pipeline()
    
    for (const dict of dictionaries) {
      const key = `${DisplayNameService.REDIS_PREFIX}${dict.dict_type}:${dict.dict_code}`
      const value = JSON.stringify({
        name: dict.dict_name,
        color: dict.dict_color
      })
      pipeline.set(key, value)
    }
    
    // æ›´æ–°ç‰ˆæœ¬æˆ³
    pipeline.set(DisplayNameService.REDIS_VERSION_KEY, Date.now().toString())
    
    await pipeline.exec()
    logger.info('[DisplayNameService] å·²åŠ è½½å­—å…¸åˆ° Redis', { count: dictionaries.length })
  }
  
  /**
   * è·å–ä¸­æ–‡åç§°ï¼ˆä¼˜å…ˆ Redisï¼‰
   * @param {string} dictType - å­—å…¸ç±»å‹
   * @param {string} dictCode - å­—å…¸ç¼–ç 
   * @returns {Promise<string|null>} ä¸­æ–‡åç§°
   */
  static async getDisplayName(dictType, dictCode) {
    if (!dictType || !dictCode) return null
    
    const redisClient = getRedisClient()
    const key = `${DisplayNameService.REDIS_PREFIX}${dictType}:${dictCode}`
    
    try {
      const cached = await redisClient.get(key)
      if (cached) {
        const data = JSON.parse(cached)
        return data.name
      }
    } catch (error) {
      logger.warn('[DisplayNameService] Redis è¯»å–å¤±è´¥ï¼Œé™çº§åˆ°æ•°æ®åº“', { error: error.message })
    }
    
    // Fallback åˆ°æ•°æ®åº“
    const dict = await SystemDictionary.findOne({
      where: { dict_type: dictType, dict_code: dictCode, is_enabled: true }
    })
    
    return dict?.dict_name || null
  }
  
  /**
   * è·å–é¢œè‰²
   * @param {string} dictType - å­—å…¸ç±»å‹
   * @param {string} dictCode - å­—å…¸ç¼–ç 
   * @returns {Promise<string|null>} é¢œè‰²ç±»å
   */
  static async getDisplayColor(dictType, dictCode) {
    if (!dictType || !dictCode) return null
    
    const redisClient = getRedisClient()
    const key = `${DisplayNameService.REDIS_PREFIX}${dictType}:${dictCode}`
    
    try {
      const cached = await redisClient.get(key)
      if (cached) {
        const data = JSON.parse(cached)
        return data.color
      }
    } catch (error) {
      logger.warn('[DisplayNameService] Redis è¯»å–å¤±è´¥ï¼Œé™çº§åˆ°æ•°æ®åº“', { error: error.message })
    }
    
    // Fallback åˆ°æ•°æ®åº“
    const dict = await SystemDictionary.findOne({
      where: { dict_type: dictType, dict_code: dictCode, is_enabled: true }
    })
    
    return dict?.dict_color || null
  }
  
  /**
   * åˆ·æ–°ç¼“å­˜åˆ° Redisï¼ˆè¿è¥åå°è°ƒç”¨ï¼‰
   */
  static async refreshCache() {
    logger.info('[DisplayNameService] æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜')
    await DisplayNameService.loadToRedis()
  }
  
  /**
   * ä¸¥æ ¼æ ¡éªŒï¼šæ£€æŸ¥æ•°æ®åº“æšä¸¾æ˜¯å¦éƒ½æœ‰æ˜ å°„
   * @returns {Promise<{success: boolean, missing: Array, totalMappings: number}>}
   */
  static async validateEnumMappings() {
    // å®ç°é€»è¾‘ï¼šæŸ¥è¯¢æ•°æ®åº“æ‰€æœ‰ ENUM å­—æ®µï¼Œå¯¹æ¯” system_dictionaries è¡¨
    // è¿”å›ç¼ºå¤±çš„æ˜ å°„åˆ—è¡¨
  }
  
  /**
   * æ›´æ–°å­—å…¸é¡¹ï¼ˆå¸¦ç‰ˆæœ¬ç®¡ç†ï¼‰
   */
  static async updateDictionary(dictId, newName, newColor, operatorId, reason) {
    // 1. è®°å½•å†å²ç‰ˆæœ¬åˆ° system_dictionary_history
    // 2. æ›´æ–° system_dictionaries
    // 3. åˆ·æ–° Redis ç¼“å­˜
  }
  
  /**
   * å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
   */
  static async rollbackToVersion(dictId, targetVersion, operatorId) {
    // 1. ä» history è¡¨è¯»å–ç›®æ ‡ç‰ˆæœ¬æ•°æ®
    // 2. æ›´æ–° system_dictionaries
    // 3. åˆ·æ–° Redis ç¼“å­˜
  }
  
  /**
   * è·å–å†å²ç‰ˆæœ¬åˆ—è¡¨
   */
  static async getVersionHistory(dictId) {
    return SystemDictionaryHistory.findAll({
      where: { dict_id: dictId },
      order: [['version', 'DESC']]
    })
  }
}

module.exports = DisplayNameService
```

### 2. Redis ç¼“å­˜ç»“æ„

```
display_name:user_status:active      â†’ {"name":"æ­£å¸¸","color":"bg-success"}
display_name:user_status:banned      â†’ {"name":"å·²å°ç¦","color":"bg-danger"}
display_name:order_status:completed  â†’ {"name":"å·²å®Œæˆ","color":"bg-success"}
display_name:version                 â†’ "1642857600000"  // æœ€åæ›´æ–°æ—¶é—´æˆ³
```

### 3. ç»Ÿä¸€è¾…åŠ©å‡½æ•° `utils/displayNameHelper.js`

```javascript
/**
 * æ˜¾ç¤ºåç§°è¾…åŠ©å‡½æ•°
 * 
 * æŠ€æœ¯è§„èŒƒï¼š
 * - ä½¿ç”¨ DisplayNameServiceï¼ˆé DictionaryServiceï¼‰
 * - å¼‚æ­¥å‡½æ•°ï¼Œè¯»å– Redis ç¼“å­˜
 */

const DisplayNameService = require('../services/DisplayNameService')

/**
 * ç»Ÿä¸€çš„æ˜¾ç¤ºåç§°é™„åŠ å‡½æ•°ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼Œè¯»å– Redisï¼‰
 * 
 * @param {Object|Array} data - å•å¯¹è±¡æˆ–æ•°ç»„
 * @param {Object} mappings - å­—æ®µæ˜ å°„ { å­—æ®µå: å­—å…¸ç±»å‹ }
 * @returns {Promise<Object|Array>} æ·»åŠ äº† *_display å’Œ *_color å­—æ®µçš„æ•°æ®
 * 
 * @example
 * const orders = await attachDisplayNames(orderList, {
 *   status: 'trade_order_status'
 * })
 * // è¿”å›: [{ status: 'completed', status_display: 'å·²å®Œæˆ', status_color: 'bg-success' }, ...]
 */
async function attachDisplayNames(data, mappings) {
  if (!data) return data
  
  const isArray = Array.isArray(data)
  const items = isArray ? data : [data]
  
  const results = await Promise.all(items.map(async (item) => {
    const newItem = { ...item }
    
    for (const [field, dictType] of Object.entries(mappings)) {
      const value = item[field]
      if (value !== undefined && value !== null) {
        const [name, color] = await Promise.all([
          DisplayNameService.getDisplayName(dictType, value),
          DisplayNameService.getDisplayColor(dictType, value)
        ])
        newItem[`${field}_display`] = name
        newItem[`${field}_color`] = color
      }
    }
    
    return newItem
  }))
  
  return isArray ? results : results[0]
}

module.exports = { attachDisplayNames }
```

### 4. éœ€è¦ä¿®æ”¹çš„æœåŠ¡æ¸…å•

| æœåŠ¡æ–‡ä»¶ | éœ€é™„åŠ çš„å­—æ®µ | å­—å…¸ç±»å‹ |
|----------|-------------|----------|
| `AuditLogService.js` | `operation_type`, `target_type` | `operation_type`, `target_type` |
| `TradeOrderService.js` | `status` | `trade_order_status` |
| `MarketListingService.js` | `status`, `listing_kind` | `listing_status`, `listing_kind` |
| `BackpackService.js` | `status` | `item_status` |
| `ConsumptionService.js` | `status`, `final_status` | `consumption_status`, `consumption_final_status` |
| `ExchangeService.js` | `status` | `exchange_status` |
| `FeedbackService.js` | `status`, `category`, `priority` | `feedback_status`, `feedback_category`, `priority` |
| `UserService.js` | `status`, `user_level` | `user_status`, `user_level` |
| `LotteryService.js` | `status`, `campaign_type`, `prize_type` ç­‰ | å¤šä¸ªå­—å…¸ç±»å‹ |

### 5. å¯åŠ¨æ ¡éªŒï¼ˆå›ºå®šä¸¥æ ¼æ¨¡å¼ï¼‰

```javascript
// app.js å¯åŠ¨æµç¨‹
const logger = require('./utils/logger').logger
const { getRedisClient } = require('./utils/UnifiedRedisClient')
const DisplayNameService = require('./services/DisplayNameService')

async function startServer() {
  // 1. æ•°æ®åº“è¿æ¥
  await testConnection()
  
  // 2. Redis è¿æ¥ï¼ˆä½¿ç”¨ UnifiedRedisClientï¼‰
  const redisClient = getRedisClient()
  await redisClient.ensureConnection()
  
  // 3. æ˜¾ç¤ºåç§°æœåŠ¡åˆå§‹åŒ– + ä¸¥æ ¼æ ¡éªŒï¼ˆå›ºå®šä¸¥æ ¼ï¼Œæ— ç¯å¢ƒåˆ¤æ–­ï¼‰
  await DisplayNameService.initialize()
  const validation = await DisplayNameService.validateEnumMappings()
  
  if (!validation.success) {
    logger.error('[å¯åŠ¨] å­—å…¸æ˜ å°„æ ¡éªŒå¤±è´¥ï¼Œå¯åŠ¨ç»ˆæ­¢', {
      missing_count: validation.missing.length
    })
    validation.missing.forEach(item => {
      logger.error(`[å¯åŠ¨] ç¼ºå¤±æ˜ å°„: ${item.table}.${item.column}`, {
        values: item.values
      })
    })
    logger.error('[å¯åŠ¨] è§£å†³æ–¹æ¡ˆ: åœ¨ system_dictionaries è¡¨ä¸­æ·»åŠ ç¼ºå¤±çš„æ˜ å°„')
    process.exit(1) // å›ºå®šä¸¥æ ¼ï¼šä»»ä½•ç¯å¢ƒéƒ½å¯åŠ¨å¤±è´¥
  }
  
  logger.info('[å¯åŠ¨] å­—å…¸æ˜ å°„æ ¡éªŒé€šè¿‡', { total_mappings: validation.totalMappings })
  
  // 4. å¯åŠ¨æœåŠ¡å™¨
  app.listen(PORT)
}
```

---

## ğŸ–¥ï¸ å‰ç«¯å®ç°æ–¹æ¡ˆ

### 1. åˆ é™¤æ‰€æœ‰ fallback æ˜ å°„

**ä¿®æ”¹å**ï¼ˆå¼ºåˆ¶ä¾èµ–åç«¯ï¼Œæ—  fallbackï¼‰ï¼š

```javascript
/**
 * è·å–çŠ¶æ€å¾½ç« ï¼ˆå¼ºåˆ¶ä¾èµ–åç«¯è¿”å›ï¼‰
 * 
 * @param {string} displayName - åç«¯è¿”å›çš„ä¸­æ–‡åç§°ï¼ˆå¿…éœ€ï¼‰
 * @param {string} displayColor - åç«¯è¿”å›çš„é¢œè‰²ç±»åï¼ˆå¿…éœ€ï¼‰
 */
function getStatusBadge(displayName, displayColor) {
  if (!displayName) {
    console.error('âŒ åç«¯æœªè¿”å› displayNameï¼Œè¯·æ£€æŸ¥æ¥å£')
    return `<span class="badge bg-danger">æ•°æ®å¼‚å¸¸</span>`
  }
  return `<span class="badge ${displayColor || 'bg-secondary'}">${displayName}</span>`
}

// è°ƒç”¨æ–¹å¼ï¼ˆåªä¼ åç«¯è¿”å›çš„å­—æ®µï¼‰
const badge = getStatusBadge(order.status_display, order.status_color)
```

### 2. éœ€è¦ä¿®æ”¹çš„å‰ç«¯é¡µé¢

| é¡µé¢æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|----------|----------|
| `audit-logs.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `operation_type_display`, `target_type_display` |
| `trade-orders.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `status_color` |
| `market-management.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `status_color` |
| `feedbacks.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `category_display`, `priority_display` |
| `exchange-market-orders.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `status_color` |
| `presets.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `status_color` |
| `user-management.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `status_color` |
| `consumption-records.js` | åˆ é™¤æ˜ å°„ï¼Œä½¿ç”¨ `status_display`, `final_status_display` |

---

## ğŸ› ï¸ è¿è¥åå°åŠŸèƒ½

### å­—å…¸ç®¡ç†é¡µé¢ `/admin/dictionaries`

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| æŸ¥çœ‹å­—å…¸åˆ—è¡¨ | æŒ‰ç±»å‹åˆ†ç»„å±•ç¤ºæ‰€æœ‰å­—å…¸é¡¹ |
| ç¼–è¾‘ä¸­æ–‡åç§° | ä¿®æ”¹ `dict_name` å­—æ®µï¼Œè‡ªåŠ¨è®°å½•å†å²ç‰ˆæœ¬ |
| ç¼–è¾‘æ˜¾ç¤ºé¢œè‰² | ä¿®æ”¹ `dict_color` å­—æ®µ |
| å¯ç”¨/ç¦ç”¨ | ä¿®æ”¹ `is_enabled` å­—æ®µ |
| åˆ·æ–°ç¼“å­˜ | è°ƒç”¨ `DisplayNameService.refreshCache()`ï¼ŒåŒæ­¥åˆ° Redis |
| æ–°å¢å­—å…¸é¡¹ | æ–°å¢æšä¸¾å€¼çš„ä¸­æ–‡æ˜ å°„ |
| **æŸ¥çœ‹å†å²ç‰ˆæœ¬** | æŸ¥çœ‹æŸä¸ªå­—å…¸é¡¹çš„æ‰€æœ‰å†å²ç‰ˆæœ¬ |
| **å›æ»šç‰ˆæœ¬** | å°†æŸä¸ªå­—å…¸é¡¹å›æ»šåˆ°æŒ‡å®šå†å²ç‰ˆæœ¬ |

---

## ğŸ“¦ åºŸå¼ƒæ¸…å•

ä»¥ä¸‹æ–‡ä»¶/ä»£ç å°†åœ¨è¿ç§»å®Œæˆååˆ é™¤ï¼š

| æ–‡ä»¶/ä»£ç  | è¯´æ˜ |
|-----------|------|
| `constants/DisplayNames.js` | åŸä»£ç å¸¸é‡æ–‡ä»¶ï¼Œè¿ç§»åˆ°æ•°æ®åº“ååˆ é™¤ |
| å„æœåŠ¡ä¸­çš„ `require('../constants/DisplayNames')` | åˆ é™¤å¼•ç”¨ |
| å„æœåŠ¡ä¸­çš„åŒæ­¥ `getDisplayName()` è°ƒç”¨ | æ›¿æ¢ä¸ºå¼‚æ­¥ `attachDisplayNames()` |
| å‰ç«¯çš„ `colorMap` / `statusMap` ç­‰æ˜ å°„ | å…¨éƒ¨åˆ é™¤ |
| `AuditLogService.js` ä¸­çš„ `result_display` | åˆ é™¤ï¼ˆæ•°æ®åº“æ— æ­¤å­—æ®µï¼‰ |

---

## ğŸ“ˆ å®æ–½è®¡åˆ’

| é˜¶æ®µ | ä»»åŠ¡ | é¢„ä¼°æ—¶é—´ |
|------|------|----------|
| 1 | åˆ›å»º `system_dictionaries` è¡¨ + `system_dictionary_history` è¡¨ | 30åˆ†é’Ÿ |
| 2 | ç¼–å†™å…¨é‡åˆå§‹æ•°æ®è¿ç§»è„šæœ¬ï¼ˆ106ä¸ªENUMï¼‰ | 3å°æ—¶ |
| 3 | å®ç° `DisplayNameService.js`ï¼ˆå« Redis ç¼“å­˜ + ç‰ˆæœ¬ç®¡ç†ï¼‰ | 4å°æ—¶ |
| 4 | å®ç° `displayNameHelper.js` | 1å°æ—¶ |
| 5 | å¯åŠ¨æ ¡éªŒé€»è¾‘ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ | 1å°æ—¶ |
| 6 | ä¿®æ”¹ 9 ä¸ªåç«¯æœåŠ¡ | 4å°æ—¶ |
| 7 | ä¿®æ”¹ 8+ ä¸ªå‰ç«¯é¡µé¢ | 4å°æ—¶ |
| 8 | è¿è¥åå°ã€Œå­—å…¸ç®¡ç†ã€é¡µé¢ï¼ˆå«ç‰ˆæœ¬å›æ»šï¼‰ | 6å°æ—¶ |
| 9 | åˆ é™¤åºŸå¼ƒä»£ç  | 1å°æ—¶ |
| 10 | æµ‹è¯•éªŒè¯ | 3å°æ—¶ |
| **æ€»è®¡** | | **çº¦ 27.5 å°æ—¶ï¼ˆ3-4å¤©ï¼‰** |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–°å¢æšä¸¾å€¼æ—¶**ï¼šå¿…é¡»åŒæ—¶åœ¨ `system_dictionaries` è¡¨æ’å…¥æ˜ å°„ï¼Œå¦åˆ™**ä»»ä½•ç¯å¢ƒéƒ½å¯åŠ¨å¤±è´¥**
2. **å‰ç«¯å¼ºçº¦æŸ**ï¼šå‰ç«¯ä¸å†æœ‰ fallbackï¼Œåç«¯å¿…é¡»è¿”å› `*_display` å’Œ `*_color`
3. **ç¼“å­˜åŒæ­¥**ï¼šè¿è¥ä¿®æ”¹å­—å…¸åéœ€ç‚¹å‡»ã€Œåˆ·æ–°ç¼“å­˜ã€æŒ‰é’®ï¼ŒåŒæ­¥åˆ° Redis
4. **ç‰ˆæœ¬å›æ»š**ï¼šå›æ»šæ“ä½œä¼šè‡ªåŠ¨åˆ·æ–° Redis ç¼“å­˜
5. **è¿ç§»é¡ºåº**ï¼šå…ˆå®Œæˆåç«¯ï¼Œå†ä¿®æ”¹å‰ç«¯ï¼Œæœ€ååˆ é™¤åºŸå¼ƒä»£ç 
6. **Redis ä¾èµ–**ï¼šç¡®ä¿ Redis æœåŠ¡å¯ç”¨ï¼Œå¦åˆ™å­—å…¸åŠŸèƒ½ä¸å¯ç”¨

---

## ğŸ“ å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 2026-01-21 | V4.6.0 | åˆå§‹å®ç°ï¼šä»£ç å¸¸é‡ `DisplayNames.js` æ–¹æ¡ˆ |
| 2026-01-22 | V4.7.0 | **æ–¹æ¡ˆå‡çº§**ï¼šæ”¹ç”¨æ•°æ®åº“å­—å…¸è¡¨ï¼›å…¨é‡è¦†ç›– 106 ä¸ª ENUMï¼›Redis ç¼“å­˜ï¼›ç‰ˆæœ¬ç®¡ç†/å›æ»šï¼›å›ºå®šä¸¥æ ¼æ¨¡å¼ |
| 2026-01-22 | V4.7.1 | **æŠ€æœ¯è§„èŒƒå¯¹é½**ï¼šæœåŠ¡å‘½å `DisplayNameService`ï¼›ä½¿ç”¨ `UnifiedRedisClient` å•ä¾‹ï¼›ä½¿ç”¨ `utils/logger`ï¼›é™æ€æ–¹æ³•é£æ ¼ |
