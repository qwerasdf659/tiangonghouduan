# 核销码业务规则说明（运营手册）

> **文档版本**: v1.0  
> **创建时间**: 2025-12-17  
> **适用对象**: 运营人员、客服人员、门店管理员  
> **系统版本**: V4.2 新核销系统（12位Base32核销码）

---

## 📌 核心概念（3分钟快速了解）

### 什么是核销码？

核销码是用户在兑换商品后，系统自动生成的一串验证码（格式：**XXXX-YYYY-ZZZZ**，共12位字符）。用户拿着这个码到门店，门店扫码或输入验证后，用户就可以领取实物商品或享受服务。

### 为什么要有核销码？

防止用户重复领取商品、验证用户确实有兑换权益、追踪商品的发放记录。

---

## 🔄 核销码的完整生命周期

```
用户兑换商品
    ↓
生成核销码（12位，30天有效期）
    ↓
三种结局：
├── 已核销（门店扫码成功） → 物品已使用，流程结束
├── 已取消（用户/管理员取消） → 物品恢复可用，可重新生成码
└── 已过期（30天未核销） → 物品恢复可用，可重新生成码
```

---

## 📋 详细业务规则

### 规则1：生成核销码的前提条件

**什么时候可以生成核销码？**

- 物品在用户背包里，且状态为"**可用**"（available）
- 物品没有被其他订单锁定
- 操作人是物品所有者本人，或者是管理员

**什么时候不能生成核销码？**

- 物品已经被使用（used）
- 物品已经过期（expired）
- 物品正在被其他订单锁定（locked）
- 物品已经转让给其他人（transferred）

**实际例子**

```
✅ 可以生成：
用户小明背包里有一张"免费奶茶券"，状态是可用
→ 小明可以点击"生成核销码"按钮

❌ 不能生成：
小明的奶茶券已经被核销使用了
→ 系统提示"该物品已使用，不能再生成核销码"
```

---

### 规则2：核销码的有效期

**有效期多长？**

- 核销码生成后，**有效期为30天**（从生成时刻开始算）

**过期后会怎么样？**

- 核销订单自动标记为"已过期"
- 物品恢复为"可用"状态
- 用户可以重新生成新的核销码

**实际例子**

```
2025年1月1日：用户生成核销码 ABCD-1234-EFGH
2025年1月31日：核销码到期自动过期
结果：这个核销码作废，但奶茶券还在背包里
      用户可以在2月1日重新生成新的核销码
```

---

### 规则3：核销成功（已核销）

**什么是核销成功？**

- 门店/管理员输入核销码 → 系统验证通过 → 标记为"已核销"

**核销成功后会发生什么？**

- 核销订单变为"**已核销**"状态
- 物品变为"**已使用**"状态
- **用户不能再次生成核销码**（因为券已经用掉了）

**实际例子**

```
场景：用户小红带着核销码去门店
1. 小红出示核销码：ABCD-1234-EFGH
2. 门店店员扫码验证 → 系统提示"核销成功"
3. 门店给小红一杯奶茶
4. 结果：
   - 核销订单状态：已核销 ✅
   - 奶茶券状态：已使用 ✅
   - 小红不能再用这张券生成新的核销码
```

---

### 规则4：取消核销码（已取消）

**什么情况下会取消核销码？**

- 用户自己点击"取消核销码"按钮
- 管理员/客服手动取消（例如用户要求重发）

**取消后会发生什么？**

- 核销订单变为"**已取消**"状态
- 物品恢复为"**可用**"状态
- **用户可以重新生成新的核销码**

**实际例子**

```
场景1：用户误操作
- 小王本来想周末去门店，不小心点了"生成核销码"
- 小王发现今天不去，点击"取消核销码"
- 结果：券还在背包里，下周末可以重新生成新的核销码

场景2：门店要求重发
- 用户小李的核销码截图模糊，门店扫不出来
- 小李联系客服 → 客服取消旧核销码
- 小李重新生成新核销码 → 门店扫码成功
```

---

### 规则5：核销码过期（已过期）

**什么情况下核销码会过期？**

- 核销码生成后30天内，没有被核销

**过期后会发生什么？（采用策略A - 用户体验优先）**

- 核销订单变为"**已过期**"状态
- 物品恢复为"**可用**"状态
- **用户可以重新生成新的核销码**

**为什么这样设计？**

- 核销码只是"临时通行证"，过期了不代表券本身失效
- 给用户第二次机会，提升用户体验

**实际例子**

```
场景：用户忘记使用
- 2025年1月1日：用户小赵生成核销码，但一直没去门店
- 2025年1月31日：核销码自动过期
- 2025年2月5日：小赵想起来还有券 → 重新生成新核销码 → 去门店核销成功

注意：如果这张券本身也有截止日期（例如"春节活动券，2月1日过期"），
     那么到2月5日时，券本身已经失效，无法生成核销码
```

---

## 🎯 特殊场景说明

### 场景1：一个物品可以同时有多个核销码吗？

**答案：不可以**

- 同一个物品，同一时间只允许有 **1个"待核销"的核销码**
- 如果要生成新码，必须先取消旧的待核销码

**例子**

```
用户小周已经生成了核销码 AAAA-BBBB-CCCC（待核销）
此时用户再次点击"生成核销码"
→ 系统提示"该物品已有待核销的订单，请先取消或使用旧核销码"
```

---

### 场景2：生成核销码后，还能转让给朋友吗？

**答案：推荐不允许（系统会锁定物品）**

- 生成核销码后，物品进入"**锁定**"状态
- 在核销完成/取消/过期之前，不能转让、不能上架交易
- 避免"核销码在你手里，券却被卖给别人"的纠纷

**例子**

```
用户小陈生成核销码后，想把券转让给朋友
→ 系统提示"该物品有待核销订单，无法转让"
→ 小陈需要先取消核销码，才能转让
```

---

### 场景3：核销码被核销后，能取消吗？

**答案：不能**

- 一旦核销成功，订单状态变为"已核销"，不能再取消
- 物品已经标记为"已使用"，流程完全结束

**例子**

```
门店已经给用户发货了，用户说"我点错了想取消"
→ 系统不支持取消已核销的订单（需要线下协商退货流程）
```

---

## 📊 核销码状态转换图（给运营的可视化说明）

```
          用户生成核销码
                ↓
         [待核销 pending]（30天有效期）
                ↓
    ┌───────────┼───────────┐
    ↓           ↓           ↓
[已核销]    [已取消]    [已过期]
fulfilled   cancelled   expired
    ↓           ↓           ↓
物品已使用   物品可用     物品可用
（流程结束） （可重新生成码）（可重新生成码）
```

---

## 🛠️ 运营操作指南

### 操作1：帮用户取消核销码

**使用场景**：用户说"核销码截图丢了/模糊/发错人了"

**操作步骤**

1. 登录管理后台
2. 找到用户的核销订单（通过物品ID或订单ID）
3. 点击"取消订单"按钮
4. 告诉用户"已取消，您可以重新生成新的核销码"

**系统变化**

- 核销订单：pending → cancelled
- 物品状态：可用（用户可重新生成）

---

### 操作2：查询核销码状态

**使用场景**：用户说"我的核销码怎么用不了？"

**排查步骤**

1. 查询核销订单状态：
   - **待核销** → 检查是否过期（看过期时间）
   - **已核销** → 告知"此码已使用过，不能重复核销"
   - **已取消** → 告知"此码已作废，请重新生成"
   - **已过期** → 告知"此码已过期，请重新生成新码"

2. 查询物品状态：
   - **可用** → 正常，可以生成核销码
   - **已使用** → 告知"该券已使用，不能再生成核销码"
   - **锁定中** → 说明有其他待核销订单，需要先处理

---

### 操作3：处理"券过期但用户要求核销"

**使用场景**：核销码过期了，用户说"我现在来门店了，能不能用？"

**策略A（推荐）：允许重新生成**

1. 核销码虽然过期，但券本身还有效
2. 引导用户重新生成新的核销码
3. 用新码核销

**策略B（严格）：拒绝核销**

1. 如果券本身有活动截止日期且已过期 → 无法核销
2. 告知用户"该券已过活动有效期，无法使用"

---

## ⚠️ 常见问题与注意事项

### 注意1：核销码只显示一次

- 用户生成核销码后，系统会显示明文码（XXXX-YYYY-ZZZZ）
- **用户必须立即截图保存**
- 系统不存储明文码（只存哈希），无法再次查看

**客服话术**：
"请您务必截图保存核销码，系统只显示一次，后续无法再次查看。"

---

### 注意2：核销码区分大小写吗？

- **不区分**（系统会自动转大写处理）
- 用户输入 `abcd-1234-efgh` 和 `ABCD-1234-EFGH` 效果一样

---

### 注意3：核销码可以转发给别人吗？

- **技术上可以**（系统只验证核销码，不验证核销人身份）
- **运营建议**：在用户协议中说明"核销码请勿转让，仅限本人使用"
- 如果需要严格控制，可以要求核销时验证用户手机号

---

## 📊 核销码数据统计（给运营的参考指标）

### 健康指标

- **核销率** = 已核销订单数 / 总生成订单数
  - 健康值：≥ 60%
  - 如果低于40%，说明用户生成后不去核销，需要优化活动设计

- **过期率** = 已过期订单数 / 总生成订单数
  - 健康值：≤ 20%
  - 如果高于30%，说明有效期太短或用户忘记使用

- **取消率** = 已取消订单数 / 总生成订单数
  - 健康值：≤ 10%
  - 如果高于15%，可能是用户操作流程不清晰

---

## 🔧 系统技术规则（给技术对接人员）

### 核销码格式

- **长度**：12位字符（分3组，每组4位）
- **字符集**：Base32编码（ABCDEFGHJKLMNPQRSTUVWXYZ23456789，去除易混淆字符I/O/0/1）
- **分隔符**：使用"-"分隔，格式 XXXX-YYYY-ZZZZ
- **存储**：系统不存明文，只存SHA-256哈希值

### 订单状态定义

| 状态   | 英文标识  | 说明                 | 后续操作         |
| ------ | --------- | -------------------- | ---------------- |
| 待核销 | pending   | 刚生成，等待门店扫码 | 可以核销/取消    |
| 已核销 | fulfilled | 门店已核销成功       | 流程结束         |
| 已取消 | cancelled | 用户/管理员取消      | 物品可重新生成码 |
| 已过期 | expired   | 超过30天未核销       | 物品可重新生成码 |

### 物品状态定义

| 状态   | 英文标识    | 说明                | 能否生成核销码 |
| ------ | ----------- | ------------------- | -------------- |
| 可用   | available   | 在背包里可正常使用  | ✅ 可以        |
| 锁定中 | locked      | 有待核销订单/交易中 | ❌ 不可以      |
| 已使用 | used        | 已核销完成          | ❌ 不可以      |
| 已转移 | transferred | 已转让给其他人      | ❌ 不可以      |
| 已过期 | expired     | 物品本身过期        | ❌ 不可以      |

---

## 💡 运营实战案例

### 案例1：用户说"我的核销码找不到了"

**问题诊断**

1. 先确认：用户是否已经生成过核销码？
   - 查询该物品的核销订单记录
2. 如果有待核销订单：
   - 告知用户"系统不存储明文核销码，无法再次查看"
   - 解决方案：取消旧核销码 → 用户重新生成新的核销码

3. 如果订单已过期：
   - 告知用户"核销码已过期，请重新生成"

**客服话术**
"您好，核销码只在生成时显示一次，系统无法再次查看（安全保护）。我帮您取消旧的核销码，请您重新生成新的核销码并立即截图保存。"

---

### 案例2：用户说"我生成了核销码，但现在不想用了"

**问题诊断**

- 用户想取消核销码，让券回到可用状态

**解决方案**

1. 帮用户取消核销订单
2. 物品自动恢复为"可用"状态
3. 告知用户"券还在背包里，随时可以重新生成核销码"

**客服话术**
"好的，我已帮您取消核销码。您的券还在背包里，等您想用时可以重新生成新的核销码。"

---

### 案例3：核销码过期了，用户现在来门店

**场景A：券本身没有截止日期（通用券）**

- 核销码过期不影响券的有效性
- 引导用户当场重新生成新核销码
- 用新码核销

**场景B：券有活动截止日期（限时券）**

- 先检查券的活动时间
- 如果活动已结束 → 券失效，无法核销
- 如果活动仍在进行 → 可以重新生成核销码

**客服话术**

```
场景A：
"您好，虽然核销码过期了，但您的券还有效。
请您现在重新生成新的核销码，就可以正常核销。"

场景B（券已过期）：
"抱歉，该券参加的活动已于X月X日结束，券已失效，无法核销。"
```

---

### 案例4：用户重复核销同一个码

**问题诊断**

- 用户或门店多次扫描同一个核销码

**系统行为**

- 第1次核销：成功 → 订单变为"已核销"，物品变为"已使用"
- 第2次核销：系统提示"核销码已被使用"

**客服话术**
"该核销码已经核销过了，不能重复使用。如果您有其他券，请生成新的核销码。"

---

## 🚨 异常处理指南

### 异常1：核销码格式错误

**用户反馈**："系统提示核销码格式错误"

**原因**

- 用户输入错误（少输/多输字符）
- 复制时带了空格或其他字符

**解决方案**

1. 引导用户检查核销码格式：XXXX-YYYY-ZZZZ（共12位+2个短横线）
2. 建议用户重新截图核销码，避免手动输入错误

---

### 异常2：核销码不存在

**用户反馈**："系统提示核销码不存在"

**可能原因**

- 用户输入错误的核销码
- 核销码被取消/删除

**解决方案**

1. 让用户确认核销码是否输入正确
2. 查询系统：该用户是否有其他待核销订单
3. 如果确实找不到，引导用户重新生成

---

### 异常3：物品已被其他订单锁定

**用户反馈**："无法生成核销码，提示物品被锁定"

**可能原因**

- 物品正在交易市场挂单中
- 有其他待核销订单

**解决方案**

1. 检查是否有其他待核销订单 → 取消旧订单
2. 检查是否在交易市场挂单 → 下架后再生成核销码

---

## 📞 客服常用话术模板

### 生成核销码成功

"您的核销码已生成成功：XXXX-YYYY-ZZZZ（请截图保存）。核销码有效期30天，请在门店出示此码即可核销。注意：核销码只显示一次，请务必截图保存。"

### 核销成功

"恭喜您核销成功！您的【商品名称】已成功核销，请在门店领取。"

### 核销码过期

"该核销码已过期，但您的券还有效。请重新生成新的核销码，即可继续使用。"

### 取消核销码

"您的核销码已取消。券还在您的背包里，您可以随时重新生成新的核销码。"

### 核销码已使用

"该核销码已经核销过了，不能重复使用。如果您有其他券，请在背包中生成新的核销码。"

---

## 📈 运营建议

### 提升核销率的建议

1. **缩短有效期**：如果核销率低，可考虑缩短有效期（例如改为7天），增加紧迫感
2. **提醒通知**：在核销码即将过期前3天，发送提醒通知
3. **门店培训**：培训门店熟悉核销流程，提升核销效率
4. **优化流程**：让用户在生成核销码时，可以预约核销时间（减少过期）

### 监控关键指标

1. 每日核销码生成数量
2. 核销成功率（已核销/总生成）
3. 过期率（已过期/总生成）
4. 平均核销时长（生成到核销的时间差）

---

## 🔄 业务规则总结（一句话记住）

| 状态   | 物品是否可用 | 能否再生成核销码 | 一句话说明                 |
| ------ | ------------ | ---------------- | -------------------------- |
| 已核销 | ❌ 已使用    | ❌ 不可以        | 券用掉了，流程结束         |
| 已取消 | ✅ 可用      | ✅ 可以          | 只是作废码，券还在         |
| 已过期 | ✅ 可用      | ✅ 可以          | 码过期不影响券（默认规则） |

---

**核心原则**：核销码是"临时通行证"，作废/过期不代表券失效。只有"核销成功"才真正消耗券。

**运营口径**：我们优先保障用户体验，给用户第二次机会（取消/过期后可重新生成），避免因误操作/忘记使用导致券浪费。

**技术保障**：系统会自动清理过期核销码、恢复物品状态，无需人工干预。
