# ç®¡ç†å‘˜å‘Šè­¦æŒä¹…åŒ– â€” å®æ–½æ–¹æ¡ˆ

> åˆ›å»ºæ—¶é—´ï¼š2026-02-24
> **æ•°æ®æ¥æºï¼šNode.js (mysql2) è¿æ¥ Sealos çœŸå®æ•°æ®åº“å®æ—¶éªŒè¯ï¼ˆdbconn.sealosbja.site:42569ï¼‰**
> **ä»£ç æ¥æºï¼š`/home/devbox/project` åç«¯æºç å®é™…å®¡è®¡**
> **å®¡è®¡æ›´æ–°ï¼š2026-03-01 â€” ä¸‰ç«¯ï¼ˆåç«¯+Webç®¡ç†åå°+å¾®ä¿¡å°ç¨‹åºï¼‰å®é™…ä»£ç ä¸æ•°æ®åº“å¯¹é½å®¡è®¡**
> ä¼˜å…ˆçº§ï¼šä½ï¼ˆé¡¹ç›®æœªä¸Šçº¿ï¼Œæ–¹æ¡ˆ B ç”¨æˆ·é€šçŸ¥ç‹¬ç«‹åŒ–ä¼˜å…ˆï¼‰
> çŠ¶æ€ï¼šæ–¹æ¡ˆå·²å‡ºï¼Œç­‰å¾…æ’æœŸ

---

## ä¸€ã€é—®é¢˜æè¿°

`NotificationService.sendToAdmins()` æ˜¯ç®¡ç†å‘˜å‘Šè­¦çš„ç»Ÿä¸€å…¥å£ï¼Œå½“å‰å®ç°**åªåš WebSocket å¹¿æ’­ï¼Œä¸å†™æ•°æ®åº“**ã€‚ç®¡ç†å‘˜ä¸åœ¨çº¿æ—¶å‘Šè­¦ç›´æ¥ä¸¢å¤±ã€‚

### 1.1 å½“å‰ä»£ç æµç¨‹

```
sendToAdmins(options)
  â””â”€ ChatWebSocketService.broadcastNotificationToAllAdmins(notification)
       â””â”€ éå† connectedAdmins Map
            â””â”€ io.to(socketId).emit('notification', notification)
                 â”œâ”€ ç®¡ç†å‘˜åœ¨çº¿ â†’ æ”¶åˆ°
                 â””â”€ ç®¡ç†å‘˜ä¸åœ¨çº¿ â†’ ä¸¢å¤±
```

å…³é”®ä»£ç ä½ç½®ï¼š

- `services/NotificationService.js` ç¬¬ 279-341 è¡Œï¼š`sendToAdmins()` æ–¹æ³•
- `services/ChatWebSocketService.js` ç¬¬ 466-484 è¡Œï¼š`broadcastNotificationToAllAdmins()` æ–¹æ³•

### 1.2 å—å½±å“çš„å‘Šè­¦åœºæ™¯ï¼ˆ10 ä¸ªç”Ÿäº§ä»£ç è§¦å‘ç‚¹ï¼Œå·²åœ¨ä»£ç ä¸­é€ä¸€ç¡®è®¤ï¼‰

| è§¦å‘ä½ç½® | å‘Šè­¦ç±»å‹ | è§¦å‘æ¡ä»¶ |
|---|---|---|
| `NotificationService.notifyNewExchangeAudit` | æ–°å…‘æ¢è®¢å•å¾…å®¡æ ¸ | ç”¨æˆ·æäº¤å…‘æ¢ç”³è¯· |
| `NotificationService.notifyTimeoutAlert` | å¾…å®¡æ ¸è®¢å•è¶…æ—¶ | å®šæ—¶ä»»åŠ¡æ£€æµ‹åˆ°è¶…æ—¶ |
| `NotificationService.notifyAnnouncement` | ç³»ç»Ÿå…¬å‘Šå¹¿æ’­ | ç®¡ç†å‘˜å‘å¸ƒå…¬å‘Šï¼ˆæ— æŒ‡å®šç”¨æˆ·æ—¶ï¼‰ |
| `NotificationService.notifyActivityStatusChange` | æ´»åŠ¨çŠ¶æ€å˜æ›´ | æŠ½å¥–æ´»åŠ¨å¯åŠ¨/æš‚åœ/ç»“æŸ |
| `jobs/daily-asset-reconciliation.js` | èµ„äº§å¯¹è´¦å‘Šè­¦ | æ¯æ—¥å¯¹è´¦å‘ç°å·®å¼‚ |
| `jobs/daily-asset-reconciliation.js` | ä¸šåŠ¡è®°å½•å…³è”å¯¹è´¦å‘Šè­¦ | ä¸šåŠ¡è®°å½•å¯¹è´¦å¼‚å¸¸ |
| `jobs/hourly-market-listing-monitor.js` | å¸‚åœºæŒ‚ç‰Œå¼‚å¸¸ | æŒ‚ç‰Œç›‘æ§æ£€æµ‹åˆ°å¼‚å¸¸ |
| `jobs/daily-orphan-frozen-check.js` | å­¤å„¿å†»ç»“æ£€æµ‹å‘Šè­¦ | æ£€æµ‹åˆ°å­¤å„¿å†»ç»“èµ„äº§ |
| `jobs/daily-orphan-frozen-check.js` | æ£€æµ‹ä»»åŠ¡å¤±è´¥ | æ£€æµ‹ job æœ¬èº«æ‰§è¡Œå‡ºé”™ |
| `services/ReminderEngineService.js` | æé†’è§„åˆ™è§¦å‘ | é…ç½®çš„æé†’è§„åˆ™æ¡ä»¶æ»¡è¶³ |

### 1.3 å·²æœ‰ä½†æœªä½¿ç”¨çš„åŸºç¡€è®¾æ–½

`admin_notifications` è¡¨å’Œ `AdminNotification` æ¨¡å‹å·²ç»å­˜åœ¨ï¼Œä½†**ä»æœªè¢«ä»»ä½•è·¯ç”±æˆ–æœåŠ¡è°ƒç”¨**ï¼Œè¡¨å†… 0 è¡Œæ•°æ®ã€‚

**è¡¨ç»“æ„ï¼ˆå·²å»ºå¥½ï¼Œæ— éœ€ DDL å˜æ›´ï¼Œæ•°æ®åº“å®æ—¶éªŒè¯ 2026-03-01ï¼‰ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|---|---|---|
| admin_notification_id | INT ä¸»é”® è‡ªå¢ | â€” |
| admin_id | INT NOT NULL | æ¥æ”¶ç®¡ç†å‘˜ IDï¼ˆå¤–é”® â†’ users.user_idï¼‰ |
| title | VARCHAR(200) NOT NULL | é€šçŸ¥æ ‡é¢˜ |
| content | TEXT | é€šçŸ¥å†…å®¹ |
| notification_type | ENUM(system/alert/reminder/task) | ç±»å‹ï¼Œé»˜è®¤ system |
| priority | ENUM(low/normal/high/urgent) | ä¼˜å…ˆçº§ï¼Œé»˜è®¤ normal |
| is_read | TINYINT(1) NOT NULL | å·²è¯»æ ‡è®°ï¼Œé»˜è®¤ 0 |
| read_at | DATETIME | å·²è¯»æ—¶é—´ |
| source_type | VARCHAR(50) | æ¥æºç±»å‹ï¼ˆå¦‚ lottery_alert, reconciliationï¼‰ |
| source_id | INT | æ¥æºå®ä½“ ID |
| extra_data | JSON | é™„åŠ ä¸šåŠ¡æ•°æ® |
| expires_at | DATETIME | è¿‡æœŸæ—¶é—´ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•ï¼ˆå·²å»ºå¥½ï¼Œæ•°æ®åº“å®æ—¶éªŒè¯ï¼‰ï¼š**

- `idx_admin_notifications_admin_read` (admin_id, is_read)
- `idx_admin_notifications_type_created` (notification_type, created_at)
- `idx_admin_notifications_priority_read` (priority, is_read)
- `idx_admin_notifications_source` (source_type, source_id)

**æ¨¡å‹å·²æœ‰çš„æ–¹æ³•ï¼ˆ`models/AdminNotification.js`ï¼Œä»£ç å®¡è®¡ç¡®è®¤ï¼‰ï¼š**

- `markAsRead()` â€” æ ‡è®°å•æ¡å·²è¯»
- `isExpired()` â€” æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
- `getUnreadCount(adminId)` â€” è·å–æŸç®¡ç†å‘˜æœªè¯»æ•°é‡
- `getUrgentUnreadCount(adminId)` â€” è·å–é«˜ä¼˜å…ˆçº§æœªè¯»æ•°é‡
- `markAllAsRead(adminId, notificationIds?)` â€” æ‰¹é‡/å…¨éƒ¨æ ‡è®°å·²è¯»
- `createSystemNotification(adminId, title, content, options)` â€” åˆ›å»ºç³»ç»Ÿé€šçŸ¥
- `createAlertNotification(adminId, title, content, options)` â€” åˆ›å»ºå‘Šè­¦é€šçŸ¥
- `cleanupExpired(daysToKeep)` â€” æ¸…ç†è¿‡æœŸé€šçŸ¥

### 1.4 å½“å‰ç®¡ç†å‘˜æ•°æ®ï¼ˆæ•°æ®åº“å®æ—¶æŸ¥è¯¢ 2026-03-01ï¼‰

> **æ³¨æ„**ï¼š`users` è¡¨è‡ªèº«**æ²¡æœ‰** `role_level` å­—æ®µã€‚ç®¡ç†å‘˜èº«ä»½é€šè¿‡ `users` â†’ `user_roles` â†’ `roles` ä¸‰è¡¨ JOIN åˆ¤å®šï¼Œ`roles.role_level >= 100` ä¸ºç®¡ç†å‘˜ã€‚ä¸­é—´ä»¶ `requireRoleLevel(100)` å’Œ WebSocket çš„ `socket.user.role_level >= 100` éƒ½ä¾èµ– JWT ä¸­æºå¸¦çš„ role_levelã€‚

| user_id | nickname | role_name | role_level |
|---|---|---|---|
| 31 | ç®¡ç†å‘˜ç”¨æˆ· | admin | 100 |
| 135 | æµ‹è¯•ç”¨æˆ·2 | admin | 100 |
| 11114 | ç”¨æˆ·8002 | admin | 100 |
| 11132 | ç”¨æˆ·0001 | admin | 100 |

å…± 4 ä¸ª role_level >= 100 çš„ç®¡ç†å‘˜è´¦å·ã€‚

---

## äºŒã€ä¸‰ç«¯å®é™…ä»£ç å®¡è®¡ç»“æœï¼ˆ2026-03-01ï¼‰

### 2.1 åç«¯æ•°æ®åº“é¡¹ç›®å®¡è®¡

| å®¡è®¡é¡¹ | çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|---|---|---|
| `admin_notifications` è¡¨ | âœ… å·²å°±ç»ª | 14 å­—æ®µ + 4 ç´¢å¼•ï¼Œ0 è¡Œæ•°æ® |
| `AdminNotification` æ¨¡å‹ | âœ… å·²å°±ç»ª | 7 ä¸ªç±»æ–¹æ³• + 2 ä¸ªå®ä¾‹æ–¹æ³•å…¨éƒ¨å®ç° |
| `sendToAdmins()` | âš ï¸ éœ€æ”¹é€  | å½“å‰åªæœ‰ WebSocket å¹¿æ’­ï¼Œæ— æŒä¹…åŒ– |
| `routes/v4/system/notifications.js` | âš ï¸ éœ€æ”¹é€  | 6 ä¸ªç«¯ç‚¹ï¼Œæ•°æ®æºæ˜¯ `AdCampaignService`ï¼ˆ`ad_campaigns` è¡¨ï¼‰ï¼Œä¸æ˜¯ `AdminNotification` |
| `POST /:id/read` ç«¯ç‚¹ | ğŸ”´ å ä½å®ç° | ç›´æ¥è¿”å› `{ notification_id, is_read: true }`ï¼Œä¸å†™æ•°æ®åº“ |
| `POST /read-all` ç«¯ç‚¹ | ğŸ”´ å ä½å®ç° | ç›´æ¥è¿”å› `{ updated_count: 0 }`ï¼Œä¸å†™æ•°æ®åº“ |
| `POST /clear` ç«¯ç‚¹ | ğŸ”´ å ä½å®ç° | ç›´æ¥è¿”å› `{ cleared_count: 0 }`ï¼Œä¸å†™æ•°æ®åº“ |
| `GET /` ç«¯ç‚¹ | âš ï¸ æ•°æ®æºé”™è¯¯ | è°ƒ `AdCampaignService.getSystemNotifications()`ï¼ŒæŸ¥çš„æ˜¯ `ad_campaigns WHERE campaign_category='system'`ï¼ˆå½“å‰ä»… 1 æ¡è®°å½•ï¼‰ |
| `GET /:notification_id` ç«¯ç‚¹ | âš ï¸ æ•°æ®æºé”™è¯¯ | è°ƒ `AdCampaignService.getSystemNotificationById()` |
| `POST /send` ç«¯ç‚¹ | âš ï¸ æ•°æ®æºé”™è¯¯ | è°ƒ `AdCampaignService.sendSystemNotification()`ï¼Œåˆ›å»º campaign + creative |
| `DELETE /:id` ç«¯ç‚¹ | ğŸ”´ åç«¯ç¼ºå¤± | åç«¯æ— æ­¤è·¯ç”±ï¼Œä½† Web å‰ç«¯å·²åœ¨è°ƒç”¨ |
| `GET /unread-count` ç«¯ç‚¹ | ğŸ”´ åç«¯ç¼ºå¤± | æ¨¡å‹æœ‰ `getUnreadCount()` æ–¹æ³•ä½†æ— è·¯ç”±æš´éœ² |
| ç®¡ç†å‘˜æŸ¥è¯¢æ–¹å¼ | âš ï¸ æ–‡æ¡£å‹˜è¯¯ | é `users.role_level`ï¼Œè€Œæ˜¯ `users JOIN user_roles JOIN roles WHERE roles.role_level >= 100` |
| 10 ä¸ªå‘Šè­¦è§¦å‘ç‚¹ | âœ… ä»£ç ç¡®è®¤ | å…¨éƒ¨é€šè¿‡ `sendToAdmins()` å…¥å£ï¼Œæ”¹ä¸€å¤„å³å…¨éƒ¨ç”Ÿæ•ˆ |
| `AdCampaignService` ç³»ç»Ÿé€šçŸ¥ | ç¡®è®¤ç°çŠ¶ | `ad_campaigns WHERE campaign_category='system'` å½“å‰ä»… 1 æ¡è®°å½• |
| `user_notifications` è¡¨ | âœ… ç‹¬ç«‹å­˜åœ¨ | 11 è¡Œæ•°æ®ï¼Œç”¨äºç”¨æˆ·é€šçŸ¥ï¼ˆæ–¹æ¡ˆ Bï¼‰ï¼Œä¸æœ¬æ–¹æ¡ˆäº’ä¸å½±å“ |
| è§’è‰²ç³»ç»Ÿ | âœ… ä¸‰è¡¨æ¶æ„ | `users` + `user_roles` + `roles`ï¼Œ11 ä¸ªè§’è‰²å®šä¹‰ï¼Œ`admin` role_level=100 |

**åç«¯éœ€æ–°å¢/æ”¹é€ æ¸…å•ï¼ˆ3 ä¸ªæ–‡ä»¶ï¼‰ï¼š**

| åºå· | æ–‡ä»¶ | æ”¹åŠ¨ç±»å‹ | å…·ä½“å†…å®¹ |
|---|---|---|---|
| B1 | `services/NotificationService.js` | ä¿®æ”¹ | `sendToAdmins()` ä¸­ WebSocket å¹¿æ’­å‰å¢åŠ  `AdminNotification` æ‰¹é‡å†™å…¥ |
| B2 | `routes/v4/system/notifications.js` | é‡å†™ | å…¨éƒ¨ 6 ä¸ªç«¯ç‚¹ä» `AdCampaignService` åˆ‡æ¢åˆ° `AdminNotification` æ¨¡å‹ï¼Œè¡¥å® 3 ä¸ªå ä½ç«¯ç‚¹ |
| B3 | `routes/v4/system/notifications.js` | æ–°å¢ | æ–°å¢ `DELETE /:id` ç«¯ç‚¹ + `GET /unread-count` ç«¯ç‚¹ |

### 2.2 Web ç®¡ç†åå°å‰ç«¯å®¡è®¡

**æŠ€æœ¯æ ˆï¼š** Vite 6 + Alpine.js 3 + Tailwind CSS + Socket.IO Client + EJS æ¨¡æ¿ï¼Œå¤šé¡µåº”ç”¨ï¼ˆworkspace.html ä¸ºä¸»æ¡†æ¶ï¼Œå…¶ä»–é¡µé¢é€šè¿‡ iframe åŠ è½½ï¼‰

| å®¡è®¡é¡¹ | çŠ¶æ€ | è¯¦ç»†è¯´æ˜ |
|---|---|---|
| notification-center.jsï¼ˆå³ä¸Šè§’é“ƒé“›ï¼‰ | âš ï¸ éœ€é€‚é… | å­—æ®µåã€ç±»å‹æ˜ å°„ã€å“åº”æ ¼å¼éƒ½éœ€è¦æ”¹ |
| message-center.html + message-center.js | âš ï¸ éœ€é€‚é… | å­—æ®µåã€ç±»å‹æ˜ å°„ã€å“åº”æ ¼å¼éƒ½éœ€è¦æ”¹ |
| api/system/admin.js API å®šä¹‰ | âš ï¸ éœ€è¡¥å…… | ç¼ºå°‘ `unread-count` å’Œ `DELETE` ç«¯ç‚¹å®šä¹‰ |
| WebSocket é›†æˆ | âœ… å·²å°±ç»ª | Socket.IO è¿æ¥ã€`notification` äº‹ä»¶ç›‘å¬ã€é™çº§è½®è¯¢ â€” æ— éœ€æ”¹åŠ¨ |
| éŸ³é¢‘æç¤º + æµè§ˆå™¨é€šçŸ¥ | âœ… å·²å°±ç»ª | Web Audio API æç¤ºéŸ³ + Notification API â€” æ— éœ€æ”¹åŠ¨ |

**Web å‰ç«¯å…·ä½“å·®å¼‚åˆ†æï¼š**

#### å·®å¼‚ 1ï¼šID å­—æ®µå

| ç»„ä»¶ | å½“å‰ä½¿ç”¨ | åç«¯ AdminNotification å®é™…å­—æ®µ |
|---|---|---|
| notification-center.js | `notification.id` | `admin_notification_id` |
| message-center.js | `message.id` | `admin_notification_id` |

**å†³ç­–ï¼šå‰ç«¯ç›´æ¥æ”¹ç”¨ `admin_notification_id`ï¼Œä¸åšæ˜ å°„ã€‚**

#### å·®å¼‚ 2ï¼šnotification_type æšä¸¾å€¼

| ç«¯ | ç±»å‹æšä¸¾ | ç”¨é€” |
|---|---|---|
| åç«¯ AdminNotification | `system` / `alert` / `reminder` / `task` | æ•°æ®åº“ ENUM |
| Web notification-center.js | `consumption` / `customer_service` / `lottery_alert` / `risk_alert` / `alert` / `warning` / `info` | å›¾æ ‡+é¢œè‰²+è·³è½¬ |
| Web message-center.js | `system` / `maintenance` / `notice` / `activity` | ç­›é€‰+å›¾æ ‡+æ ‡ç­¾ |

**åˆ†æï¼šå‰ç«¯çš„ type å€¼ç”¨äº UI æ¸²æŸ“ï¼ˆå›¾æ ‡ã€é¢œè‰²ã€è·³è½¬ï¼‰ï¼Œå’Œåç«¯çš„ `notification_type` æ˜¯ä¸¤ä¸ªç»´åº¦ã€‚** åç«¯çš„ `notification_type` æ˜¯å¤§åˆ†ç±»ï¼ˆç³»ç»Ÿ/å‘Šè­¦/æé†’/ä»»åŠ¡ï¼‰ï¼Œå‰ç«¯çš„ type å¯¹åº”çš„æ˜¯ä¸šåŠ¡åœºæ™¯ã€‚å»ºè®®ï¼š

- å‰ç«¯æ”¹ä¸ºä½¿ç”¨åç«¯çš„ `notification_type` åš UI å¤§åˆ†ç±»ï¼ˆå¯¹åº”ç­›é€‰æ ï¼‰
- æ›´ç»†ç²’åº¦çš„ä¸šåŠ¡åœºæ™¯ç±»å‹ä» `source_type` å­—æ®µè¯»å–ï¼ˆå¯¹åº”å›¾æ ‡ã€è·³è½¬ï¼‰
- `source_type` å·²åœ¨åç«¯è¡¨ä¸­ï¼Œç”± `sendToAdmins()` çš„ `type` å‚æ•°å†™å…¥

#### å·®å¼‚ 3ï¼špriority æšä¸¾å€¼

| ç«¯ | ä¼˜å…ˆçº§æšä¸¾ |
|---|---|
| åç«¯ AdminNotification | `low` / `normal` / `high` / `urgent` |
| Web message-center.js | `high` / `medium` / `low` |

**å†³ç­–ï¼šå‰ç«¯ç›´æ¥æ”¹ç”¨åç«¯çš„ `low` / `normal` / `high` / `urgent` å››çº§ã€‚**

#### å·®å¼‚ 4ï¼šåˆ—è¡¨ API å“åº”æ ¼å¼

| ç«¯ | å½“å‰æ ¼å¼ |
|---|---|
| notification-center.js | æœŸæœ› `result.data.items \|\| result.data`ï¼Œ`result.data.unread_count` |
| message-center.js | æœŸæœ› `result.data.notifications`ï¼Œ`result.data.statistics.total`ï¼Œ`result.data.statistics.unread` |
| åç«¯å½“å‰ï¼ˆAdCampaignServiceï¼‰ | è¿”å› `{ notifications: [...], statistics: { total, unread, ... } }` |

**å†³ç­–ï¼šåç«¯æ–°çš„ `GET /` æ¥å£ç»Ÿä¸€è¿”å› `{ items: [...], total, unread_count }`ï¼Œå‰ç«¯ä¸¤å¤„éƒ½æ”¹ç”¨è¿™ä¸ªæ ¼å¼ã€‚**

**Web å‰ç«¯æ”¹åŠ¨æ¸…å•ï¼ˆ4 ä¸ªæ–‡ä»¶ï¼‰ï¼š**

| åºå· | æ–‡ä»¶ | æ”¹åŠ¨ç±»å‹ | å…·ä½“å†…å®¹ |
|---|---|---|---|
| W1 | `admin/src/alpine/components/notification-center.js` | ä¿®æ”¹ | ID å­—æ®µ `id` â†’ `admin_notification_id`ï¼›å“åº”è§£æé€‚é…ï¼›type è¯» `source_type`ï¼›priority æšä¸¾é€‚é… |
| W2 | `admin/src/pages/message-center.js` | ä¿®æ”¹ | ID å­—æ®µ `id` â†’ `admin_notification_id`ï¼›å“åº”è§£æ `items`/`total`/`unread_count`ï¼›type ç­›é€‰æ”¹ä¸º `notification_type`ï¼›priority æšä¸¾é€‚é… |
| W3 | `admin/src/api/system/admin.js` | ä¿®æ”¹ | æ–°å¢ `NOTIFICATION_UNREAD_COUNT` å’Œ `NOTIFICATION_DELETE` ç«¯ç‚¹å®šä¹‰ |
| W4 | `admin/message-center.html` | ä¿®æ”¹ | ç­›é€‰é¢æ¿çš„ type é€‰é¡¹ä» `system/maintenance/notice/activity` æ”¹ä¸º `system/alert/reminder/task`ï¼›priority é€‰é¡¹æ”¹ä¸º `low/normal/high/urgent` |

### 2.3 å¾®ä¿¡å°ç¨‹åºå‰ç«¯å½±å“

æœ¬æ–¹æ¡ˆï¼ˆç®¡ç†å‘˜å‘Šè­¦æŒä¹…åŒ–ï¼‰**ä¸æ¶‰åŠå¾®ä¿¡å°ç¨‹åº**ã€‚

- æœ¬æ–¹æ¡ˆå—ä¼—ï¼šç®¡ç†åå°ç®¡ç†å‘˜ï¼ˆWeb ç«¯ï¼‰
- å¾®ä¿¡å°ç¨‹åºç”¨æˆ·é€šçŸ¥èµ° `user_notifications` è¡¨ + `NotificationService.send()`ï¼ˆæ–¹æ¡ˆ Bï¼‰ï¼Œä¸æœ¬æ–¹æ¡ˆå®Œå…¨ç‹¬ç«‹
- `sendToAdmins()` çš„ 10 ä¸ªè§¦å‘ç‚¹å…¨éƒ¨é¢å‘ç®¡ç†å‘˜ï¼Œä¸äº§ç”Ÿå¾®ä¿¡å°ç¨‹åºç«¯çš„é€šçŸ¥

---

## ä¸‰ã€æ”¹é€ æ–¹æ¡ˆ

### 3.1 æ ¸å¿ƒæ€è·¯

åœ¨ `sendToAdmins()` ç°æœ‰ WebSocket å¹¿æ’­é€»è¾‘**ä¹‹å‰**ï¼Œç»™æ¯ä¸ªç®¡ç†å‘˜å†™ä¸€æ¡ `AdminNotification` è®°å½•ã€‚è¡¨å’Œæ¨¡å‹å·²ç»å»ºå¥½ï¼Œåªéœ€è¦æ¥ä¸Šã€‚

### 3.2 åç«¯æ”¹åŠ¨èŒƒå›´

| æ”¹åŠ¨é¡¹ | ç±»å‹ | æ–‡ä»¶ | è¯´æ˜ |
|---|---|---|---|
| `sendToAdmins()` å¢åŠ æŒä¹…åŒ–é€»è¾‘ | ä¿®æ”¹ | `services/NotificationService.js` | å†™å…¥ `AdminNotification` è¡¨åå† WebSocket å¹¿æ’­ |
| é€šçŸ¥è·¯ç”±å…¨éƒ¨ç«¯ç‚¹åˆ‡æ¢æ•°æ®æº | é‡å†™ | `routes/v4/system/notifications.js` | ä» `AdCampaignService` åˆ‡æ¢ä¸º `AdminNotification` æ¨¡å‹ |
| æ–°å¢åˆ é™¤ã€æœªè¯»è®¡æ•°ç«¯ç‚¹ | æ–°å¢ | `routes/v4/system/notifications.js` | `DELETE /:id` + `GET /unread-count` |

### 3.3 `sendToAdmins()` æ”¹é€ åæµç¨‹

```
sendToAdmins(options)
  â”œâ”€ 1. æŸ¥è¯¢æ‰€æœ‰ç®¡ç†å‘˜ï¼ˆusers JOIN user_roles JOIN roles WHERE role_level >= 100ï¼‰
  â”œâ”€ 2. æ‰¹é‡å†™å…¥ AdminNotificationï¼ˆæ¯ä¸ªç®¡ç†å‘˜ä¸€æ¡ï¼‰
  â”‚     ä½¿ç”¨ AdminNotification.createAlertNotification() æˆ– bulkCreate
  â”‚     notification_type æ˜ å°„ï¼šæ ¹æ® options.type å†³å®š
  â”‚     source_type = options.typeï¼ˆå¦‚ exchange_audit, timeout_alert, reconciliation ç­‰ï¼‰
  â”‚     priority æ˜ å°„ï¼šé»˜è®¤ normalï¼Œç‰¹å®šç±»å‹æå‡
  â”‚     extra_data = options.dataï¼ˆJSON å­—æ®µå­˜ä¸šåŠ¡æ•°æ®ï¼‰
  â”œâ”€ 3. ChatWebSocketService.broadcastNotificationToAllAdmins()ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
  â””â”€ 4. è¿”å›ç»“æœï¼ˆå« persisted_count + broadcasted_countï¼‰
```

**ç®¡ç†å‘˜æŸ¥è¯¢æ–¹å¼ï¼ˆåŸºäºå®é™…è§’è‰²ç³»ç»Ÿï¼‰ï¼š**

```javascript
const { User, UserRole, Role } = require('../models')
const admins = await User.findAll({
  include: [{
    model: UserRole,
    as: 'userRoles',
    required: true,
    where: { is_active: true },
    include: [{
      model: Role,
      as: 'role',
      required: true,
      where: { role_level: { [Op.gte]: 100 } }
    }]
  }],
  attributes: ['user_id']
})
```

**priority è‡ªåŠ¨æ˜ å°„å»ºè®®ï¼š**

| source_type | priority |
|---|---|
| `orphan_frozen_alert`ï¼ˆP0 çº§ï¼‰ | `urgent` |
| `asset_reconciliation_alert` | `high` |
| `timeout_alert` | `high` |
| `exchange_audit` | `normal` |
| `activity_status_change` | `normal` |
| `market_monitor_alert` | `normal` |
| `reminder_alert` | `normal` |
| `orphan_frozen_error` | `high` |
| å…¶ä»– | `normal` |

### 3.4 è·¯ç”±ç«¯ç‚¹æ”¹é€ è¯¦ç»†è®¾è®¡

åŸºäºåç«¯ `AdminNotification` æ¨¡å‹å’Œç»Ÿä¸€ `apiSuccess/apiError` å“åº”æ ¼å¼ï¼š

**`GET /api/v4/system/notifications`** â€” è·å–é€šçŸ¥åˆ—è¡¨

```javascript
// è¯·æ±‚å‚æ•°
{ notification_type, priority, is_read, limit, offset }

// å“åº”ï¼ˆapiSuccess åŒ…è£…ï¼‰
{
  success: true,
  data: {
    items: [
      {
        admin_notification_id: 1,
        title: "æ–°å…‘æ¢è®¢å•å¾…å®¡æ ¸",
        content: "ç”¨æˆ·XXXæäº¤äº†å…‘æ¢ç”³è¯·...",
        notification_type: "alert",
        priority: "normal",
        is_read: 0,
        read_at: null,
        source_type: "exchange_audit",
        source_id: 123,
        extra_data: { exchange_id: 456, product_name: "..." },
        expires_at: null,
        created_at: "2026-03-01T12:00:00+08:00"
      }
    ],
    total: 25,
    unread_count: 8
  }
}
```

**`GET /api/v4/system/notifications/unread-count`** â€” è·å–æœªè¯»æ•°é‡

```javascript
// å“åº”
{
  success: true,
  data: {
    unread_count: 8,
    urgent_unread_count: 2
  }
}
```

**`GET /api/v4/system/notifications/:admin_notification_id`** â€” è·å–è¯¦æƒ…

```javascript
// å“åº”
{
  success: true,
  data: { /* å®Œæ•´ AdminNotification è®°å½• */ }
}
```

**`POST /api/v4/system/notifications/:admin_notification_id/read`** â€” æ ‡è®°å·²è¯»

```javascript
// è°ƒç”¨ AdminNotification.findByPk(id) â†’ instance.markAsRead()
// å“åº”
{
  success: true,
  data: { admin_notification_id: 1, is_read: 1, read_at: "..." }
}
```

**`POST /api/v4/system/notifications/read-all`** â€” å…¨éƒ¨æ ‡è®°å·²è¯»

```javascript
// è°ƒç”¨ AdminNotification.markAllAsRead(req.user.user_id)
// å“åº”
{
  success: true,
  data: { updated_count: 5 }
}
```

**`DELETE /api/v4/system/notifications/:admin_notification_id`** â€” åˆ é™¤é€šçŸ¥

```javascript
// ç‰©ç†åˆ é™¤å•æ¡é€šçŸ¥ï¼ˆä»…é™è‡ªå·±çš„ï¼‰
// å“åº”
{
  success: true,
  data: { deleted: true }
}
```

**`POST /api/v4/system/notifications/send`** â€” ç®¡ç†å‘˜æ‰‹åŠ¨å…¬å‘Š

```javascript
// è¯·æ±‚ä½“
{ title, content, target, priority }

// æ”¹é€ ï¼šå†™å…¥ AdminNotificationï¼ˆæ¯ä¸ªç®¡ç†å‘˜ä¸€æ¡ï¼‰+ WebSocket å¹¿æ’­
// ä¸å†è°ƒç”¨ AdCampaignService.sendSystemNotification()
// å“åº”
{
  success: true,
  data: { notification_count: 4, broadcasted_count: 2 }
}
```

### 3.5 ç®¡ç†å‘˜æ‰‹åŠ¨å…¬å‘Šçš„å¤„ç†

**å†³ç­–ï¼šé€‰ A â€” ç»Ÿä¸€åˆ° `admin_notifications` è¡¨ã€‚**

ç†ç”±ï¼š
- å½“å‰ `ad_campaigns WHERE campaign_category='system'` ä»… 1 æ¡è®°å½•ï¼Œå†å²æ•°æ®é‡å¯å¿½ç•¥
- é¡¹ç›®æœªä¸Šçº¿ï¼Œæ— éœ€å…¼å®¹æ—§æ•°æ®
- ç»Ÿä¸€æ•°æ®æº = æ¶ˆæ¯ä¸­å¿ƒåªæŸ¥ä¸€å¼ è¡¨ï¼Œé•¿æœŸç»´æŠ¤æˆæœ¬æœ€ä½
- `AdCampaignService` çš„å¹¿å‘Šç³»ç»Ÿå¤æ‚åº¦è¿œé«˜äºé€šçŸ¥éœ€æ±‚ï¼Œè§£è€¦åæ›´æ¸…æ™°

---

## å››ã€ä¸å˜çš„éƒ¨åˆ†

| æ¨¡å— | è¯´æ˜ |
|---|---|
| `admin_notifications` è¡¨ç»“æ„ | å·²å»ºå¥½ï¼Œæ— éœ€ DDL å˜æ›´ |
| `AdminNotification` æ¨¡å‹æ–¹æ³• | å·²å®ç° markAsRead / getUnreadCount / markAllAsRead ç­‰ |
| `ChatWebSocketService.broadcastNotificationToAllAdmins()` | ä¿æŒä¸å˜ï¼ŒæŒä¹…åŒ–æ˜¯æ–°å¢é€»è¾‘ |
| æ‰€æœ‰ 10 ä¸ªå‘Šè­¦è§¦å‘ç‚¹çš„ä¸šåŠ¡ä»£ç  | ä¸éœ€è¦æ”¹åŠ¨ï¼Œå®ƒä»¬éƒ½è°ƒ `sendToAdmins()`ï¼Œå†…éƒ¨å¢åŠ æŒä¹…åŒ–åè‡ªåŠ¨ç”Ÿæ•ˆ |
| `user_notifications` è¡¨å’Œç”¨æˆ·é€šçŸ¥ç³»ç»Ÿ | å®Œå…¨ç‹¬ç«‹ï¼Œæ–¹æ¡ˆ B ä¸å—å½±å“ |
| WebSocket è¿æ¥ã€Socket.IO äº‹ä»¶ä½“ç³» | `notification` äº‹ä»¶ä¸å˜ï¼Œå‰ç«¯ç›‘å¬ä»£ç æ— éœ€æ”¹ |
| Web å‰ç«¯éŸ³é¢‘æç¤ºã€æµè§ˆå™¨é€šçŸ¥ | æ— éœ€æ”¹åŠ¨ |
| å¾®ä¿¡å°ç¨‹åº | å®Œå…¨ä¸æ¶‰åŠ |

---

## äº”ã€å®æ–½æ­¥éª¤

### Step 1ï¼šåç«¯ â€” æ”¹é€  `sendToAdmins()`ï¼ˆæ–‡ä»¶ B1ï¼‰

åœ¨ `services/NotificationService.js` çš„ `sendToAdmins()` æ–¹æ³•ä¸­ï¼š

1. å¼•å…¥ `AdminNotification`ã€`User`ã€`UserRole`ã€`Role` æ¨¡å‹
2. æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒç®¡ç†å‘˜ï¼ˆä¸‰è¡¨ JOINï¼Œ`role_level >= 100`ï¼Œ`is_active = true`ï¼‰
3. æ ¹æ® `options.type` ç¡®å®š `notification_type`ï¼ˆalert/system/reminder/taskï¼‰å’Œ `priority`
4. ä½¿ç”¨ `AdminNotification.bulkCreate()` æ‰¹é‡å†™å…¥ï¼ˆæ¯ä¸ªç®¡ç†å‘˜ä¸€æ¡ï¼‰
5. åŸæœ‰ WebSocket å¹¿æ’­é€»è¾‘ä¸å˜
6. è¿”å›å€¼å¢åŠ  `persisted_count` å­—æ®µ

**å¯å¤ç”¨çš„ç°æœ‰åŸºç¡€è®¾æ–½ï¼š**
- `AdminNotification.createAlertNotification()` â€” å¯ç›´æ¥ç”¨äºå•æ¡åˆ›å»º
- `AdminNotification.createSystemNotification()` â€” å¯ç”¨äºæ‰‹åŠ¨å…¬å‘Šåœºæ™¯
- `BeijingTimeHelper` â€” æ—¶é—´å¤„ç†å·²æ ‡å‡†åŒ–

**éœ€è¦æ‰©å±•çš„éƒ¨åˆ†ï¼š**
- ç®¡ç†å‘˜æŸ¥è¯¢é€»è¾‘ï¼ˆä¸‰è¡¨ JOINï¼‰â€” å½“å‰ `sendToAdmins()` ä¸­æ²¡æœ‰æŸ¥è¯¢ç®¡ç†å‘˜åˆ—è¡¨çš„ä»£ç ï¼ŒWebSocket çš„ `broadcastNotificationToAllAdmins()` éå†çš„æ˜¯ `connectedAdmins` Mapï¼ˆä»…åœ¨çº¿ç®¡ç†å‘˜ï¼‰
- `bulkCreate` æ‰¹é‡å†™å…¥ â€” `AdminNotification` æ¨¡å‹å½“å‰åªæœ‰ `createSystemNotification()` å’Œ `createAlertNotification()` ä¸¤ä¸ªå•æ¡åˆ›å»ºæ–¹æ³•

### Step 2ï¼šåç«¯ â€” é‡å†™é€šçŸ¥è·¯ç”±ï¼ˆæ–‡ä»¶ B2 + B3ï¼‰

`routes/v4/system/notifications.js` å…¨éƒ¨ç«¯ç‚¹ä» `AdCampaignService` åˆ‡æ¢åˆ° `AdminNotification` æ¨¡å‹ï¼š

1. `GET /` â†’ `AdminNotification.findAll({ where: { admin_id: req.user.user_id }, ... })`
2. `GET /unread-count` â†’ `AdminNotification.getUnreadCount(req.user.user_id)` + `AdminNotification.getUrgentUnreadCount(req.user.user_id)`
3. `GET /:id` â†’ `AdminNotification.findByPk(id)`
4. `POST /:id/read` â†’ `instance.markAsRead()`
5. `POST /read-all` â†’ `AdminNotification.markAllAsRead(req.user.user_id)`
6. `POST /clear` â†’ ç‰©ç†åˆ é™¤æ‰€æœ‰å·²è¯»é€šçŸ¥ï¼ˆ`WHERE admin_id AND is_read = 1`ï¼‰
7. `DELETE /:id` â†’ ç‰©ç†åˆ é™¤å•æ¡é€šçŸ¥
8. `POST /send` â†’ æ‰‹åŠ¨å…¬å‘Šå†™å…¥ `AdminNotification`ï¼ˆä¸å†èµ° `AdCampaignService`ï¼‰

**å¯å¤ç”¨ï¼š**
- `authenticateToken` + `requireRoleLevel(100)` ä¸­é—´ä»¶ â€” ç°æœ‰çš„é‰´æƒé“¾ç›´æ¥å¤ç”¨
- `res.apiSuccess()` / `res.apiError()` â€” ç»Ÿä¸€å“åº”æ ¼å¼ä¸­é—´ä»¶
- æ‰€æœ‰æ¨¡å‹æ–¹æ³•ï¼ˆmarkAsReadã€getUnreadCountã€markAllAsRead ç­‰ï¼‰å‡å·²å®ç°

**æ³¨æ„è·¯ç”±é¡ºåºï¼š** `/unread-count` å’Œ `/read-all` æ˜¯å›ºå®šè·¯å¾„ï¼Œå¿…é¡»åœ¨ `/:id` ä¹‹å‰æ³¨å†Œï¼Œé¿å…è¢« Express å‚æ•°è·¯ç”±åƒæ‰ã€‚

### Step 3ï¼šWeb å‰ç«¯ â€” é€‚é…é€šçŸ¥ä¸­å¿ƒç»„ä»¶ï¼ˆæ–‡ä»¶ W1ï¼‰

`admin/src/alpine/components/notification-center.js`ï¼š

1. `loadNotifications()` å“åº”è§£æï¼š`result.data.items`ï¼ˆæ›¿ä»£ `result.data.items || result.data`ï¼‰ï¼Œ`result.data.unread_count`
2. `markAsRead(notification)` ä¸­çš„ URLï¼š`notification.admin_notification_id`ï¼ˆæ›¿ä»£ `notification.id`ï¼‰
3. `handleWebSocketMessage()` ä¸­å»é‡æ£€æŸ¥ï¼š`payload.admin_notification_id`ï¼ˆæ›¿ä»£ `payload.id`ï¼‰
4. `handleNotificationClick()` è·³è½¬æ˜ å°„ï¼šæ”¹ä¸ºåŸºäº `source_type` å­—æ®µ
5. `getNotificationIcon()` / `getNotificationColorClass()`ï¼šæ”¹ä¸ºåŸºäº `source_type` å­—æ®µ

### Step 4ï¼šWeb å‰ç«¯ â€” é€‚é…æ¶ˆæ¯ä¸­å¿ƒé¡µé¢ï¼ˆæ–‡ä»¶ W2 + W4ï¼‰

`admin/src/pages/message-center.js`ï¼š

1. `loadMessages()` å“åº”è§£æï¼š`result.data.items`ã€`result.data.total`ã€`result.data.unread_count`
2. æ‰€æœ‰ `message.id` â†’ `message.admin_notification_id`
3. ç­›é€‰æ  type é€‰é¡¹ï¼š`system/alert/reminder/task`
4. priority é€‰é¡¹ï¼š`low/normal/high/urgent`
5. `getTypeIcon()` / `getTypeLabel()` / `getTypeColorClass()`ï¼šé€‚é…åç«¯æšä¸¾å€¼
6. `handleMessageAction()` è·³è½¬æ˜ å°„ï¼šåŸºäº `source_type`

`admin/message-center.html`ï¼š

1. ç­›é€‰é¢æ¿çš„ `<option>` å€¼æ›´æ–°
2. priority æ˜¾ç¤ºæ ‡ç­¾é€‚é…

### Step 5ï¼šWeb å‰ç«¯ â€” è¡¥å…… API å®šä¹‰ï¼ˆæ–‡ä»¶ W3ï¼‰

`admin/src/api/system/admin.js`ï¼š

1. æ–°å¢ `NOTIFICATION_UNREAD_COUNT: '${API_PREFIX}/system/notifications/unread-count'`
2. æ–°å¢ `NOTIFICATION_DELETE: '${API_PREFIX}/system/notifications/:id'`
3. æ–°å¢ `getNotificationUnreadCount()` æ–¹æ³•
4. æ–°å¢ `deleteNotification(id)` æ–¹æ³•

### Step 6ï¼šéªŒè¯

- è§¦å‘ä¸€æ¬¡å‘Šè­¦æ“ä½œï¼ˆå¦‚å…‘æ¢ç”³è¯·ï¼‰ï¼Œç¡®è®¤ `admin_notifications` è¡¨æœ‰æ–°è®°å½•
- ç®¡ç†åå°æ¶ˆæ¯ä¸­å¿ƒåˆ·æ–°ï¼Œç¡®è®¤èƒ½æ˜¾ç¤ºå‘Šè­¦åˆ—è¡¨ï¼ˆå­—æ®µåæ­£ç¡®ï¼‰
- æ ‡è®°å·²è¯»ï¼Œç¡®è®¤ `is_read` çŠ¶æ€å’Œ `read_at` æ—¶é—´å˜æ›´
- å…¨éƒ¨æ ‡è®°å·²è¯»ï¼Œç¡®è®¤æ‰¹é‡æ›´æ–°
- åˆ é™¤é€šçŸ¥ï¼Œç¡®è®¤ç‰©ç†åˆ é™¤
- å…³é—­ç®¡ç†åå°ï¼Œå†è§¦å‘å‘Šè­¦ï¼Œé‡æ–°æ‰“å¼€ç¡®è®¤å†å²å‘Šè­¦å¯è§
- å³ä¸Šè§’é“ƒé“›æœªè¯»è§’æ ‡æ•°å­—æ­£ç¡®

---

## å…­ã€å›æ»šæ–¹æ¡ˆ

å›æ»šåªéœ€åœ¨ `sendToAdmins()` ä¸­ç§»é™¤æŒä¹…åŒ–é€»è¾‘ï¼Œæ¢å¤ä¸ºçº¯ WebSocket å¹¿æ’­ã€‚`admin_notifications` è¡¨æ•°æ®å¯ä¿ç•™ä¸å½±å“å…¶ä»–åŠŸèƒ½ã€‚è·¯ç”±å›æ»šåˆ™æ¢å¤ `AdCampaignService` è°ƒç”¨ã€‚

---

## ä¸ƒã€éœ€è¦æ‹æ¿çš„å†³ç­–ç‚¹

| # | å†³ç­–é¡¹ | å»ºè®® | å½±å“ |
|---|---|---|---|
| D1 | æ‰‹åŠ¨å…¬å‘Šç»Ÿä¸€åˆ° `admin_notifications` è¿˜æ˜¯ç»§ç»­èµ° `AdCampaignService` | **å»ºè®®é€‰ Aï¼šç»Ÿä¸€**ã€‚ad_campaigns è¡¨ system ç±»å‹ä»… 1 æ¡è®°å½•ï¼Œé¡¹ç›®æœªä¸Šçº¿æ— è¿ç§»è´Ÿæ‹… | åç«¯ `POST /send` ç«¯ç‚¹æ”¹åŠ¨æ–¹å¼ |
| D2 | é€šçŸ¥æ˜¯å¦æ”¯æŒç‰©ç†åˆ é™¤ | **å»ºè®®æ”¯æŒ**ã€‚Web å‰ç«¯å·²æœ‰åˆ é™¤ UI å’Œè°ƒç”¨é€»è¾‘ | åç«¯éœ€æ–°å¢ `DELETE` ç«¯ç‚¹ |
| D3 | `sendToAdmins()` å†™å…¥å¤±è´¥æ˜¯å¦é˜»æ–­ WebSocket å¹¿æ’­ | **å»ºè®®ä¸é˜»æ–­**ï¼ˆtry-catch åŒ…è£¹å†™å…¥é€»è¾‘ï¼Œå¤±è´¥ä»…è®°æ—¥å¿—ï¼Œå¹¿æ’­ç…§å¸¸æ‰§è¡Œï¼‰ | æ•…éšœé™çº§ç­–ç•¥ |

ä»¥ä¸Šä¸‰é¡¹å»ºè®®æ–¹å‘å·²åœ¨æ–¹æ¡ˆä¸­é‡‡ç”¨ï¼Œå¦‚æœ‰ä¸åŒæ„è§å¯è°ƒæ•´ã€‚

---

## é™„å½• Aï¼šæŠ€æœ¯æ ˆç¡®è®¤

### åç«¯æ•°æ®åº“é¡¹ç›®

| å±‚ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|---|---|---|
| è¿è¡Œæ—¶ | Node.js | â€” |
| Web æ¡†æ¶ | Express | v4.x |
| ORM | Sequelize | v6.x |
| æ•°æ®åº“ | MySQL (mysql2) | Sealos æ‰˜ç®¡ |
| å®æ—¶é€šä¿¡ | Socket.IO (Server) | v4.x |
| å®šæ—¶ä»»åŠ¡ | node-cron | â€” |
| æ—¥å¿— | è‡ªå®šä¹‰ logger (winston) | â€” |
| å“åº”æ ¼å¼ | `res.apiSuccess()` / `res.apiError()` ä¸­é—´ä»¶ | â€” |
| é‰´æƒ | JWT + `authenticateToken` + `requireRoleLevel` | â€” |
| æœåŠ¡ç®¡ç† | `app.locals.services.getService()` ServiceManager æ¨¡å¼ | â€” |

### Web ç®¡ç†åå°å‰ç«¯

| å±‚ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|---|---|---|
| æ„å»ºå·¥å…· | Vite | v6.x |
| UI æ¡†æ¶ | Alpine.js | v3.x |
| æ ·å¼ | Tailwind CSS | â€” |
| æ¨¡æ¿ | EJS (vite-plugin-ejs) | â€” |
| å®æ—¶é€šä¿¡ | Socket.IO (Client) | v4.x |
| å›¾è¡¨ | ECharts | â€” |
| æ¶æ„æ¨¡å¼ | å¤šé¡µåº”ç”¨ï¼ˆworkspace.html ä¸»æ¡†æ¶ + iframe å­é¡µé¢ï¼‰ | â€” |
| API è°ƒç”¨ | ç»Ÿä¸€ `request()` å‡½æ•° + `API_PREFIX` | â€” |

### å¾®ä¿¡å°ç¨‹åº

ä¸æ¶‰åŠï¼Œæœ¬æ–¹æ¡ˆå®Œå…¨é¢å‘ç®¡ç†åå°ã€‚

---

## é™„å½• Bï¼šä¸æ–¹æ¡ˆ Bï¼ˆç”¨æˆ·é€šçŸ¥ç‹¬ç«‹åŒ–ï¼‰çš„å…³ç³»

| ç»´åº¦ | æ–¹æ¡ˆ Bï¼ˆç”¨æˆ·é€šçŸ¥ï¼‰ | æœ¬æ–¹æ¡ˆï¼ˆç®¡ç†å‘˜å‘Šè­¦æŒä¹…åŒ–ï¼‰ |
|---|---|---|
| è§£å†³çš„é—®é¢˜ | ç”¨æˆ·é€šçŸ¥æ·¹æ²¡å®¢æœèŠå¤© | ç®¡ç†å‘˜ä¸åœ¨çº¿å‘Šè­¦ä¸¢å¤± |
| å—ä¼— | å¾®ä¿¡å°ç¨‹åºæ™®é€šç”¨æˆ· | ç®¡ç†åå°ç®¡ç†å‘˜ |
| æ•°æ®è¡¨ | `user_notifications`ï¼ˆå·²å­˜åœ¨ï¼Œ11 è¡Œæ•°æ®ï¼‰ | `admin_notifications`ï¼ˆå·²å­˜åœ¨ï¼Œ0 è¡Œæ•°æ®ï¼‰ |
| æ¨¡å‹ | `UserNotification`ï¼ˆå·²å­˜åœ¨ï¼‰ | `AdminNotification`ï¼ˆå·²å­˜åœ¨ï¼‰ |
| æ ¸å¿ƒæ”¹åŠ¨ | `send()` å·²åˆ‡åˆ° `user_notifications` | `sendToAdmins()` å¢åŠ å†™å…¥é€»è¾‘ |
| ä¼˜å…ˆçº§ | é«˜ï¼ˆç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒï¼‰ | ä½ï¼ˆç®¡ç†å‘˜å¯çœ‹æ—¥å¿—è¡¥æ•‘ï¼‰ |
| ä¾èµ–å…³ç³» | æ— ä¾èµ–ï¼Œç‹¬ç«‹å®æ–½ | æ— ä¾èµ–ï¼Œç‹¬ç«‹å®æ–½ |
| å»ºè®®å®æ–½é¡ºåº | å…ˆåš | ååš |
