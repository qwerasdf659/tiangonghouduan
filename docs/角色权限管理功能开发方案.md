# è§’è‰²æƒé™ç®¡ç†åŠŸèƒ½å¼€å‘æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬**: V3.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-26  
> **çŠ¶æ€**: âœ… æ–¹æ¡ˆå·²ç¡®è®¤ï¼Œå¾…å¼€å‘  
> **ä¼˜å…ˆçº§**: P2ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰

---

## ğŸ“‹ ä¸€ã€æ•°æ®åº“ç°çŠ¶åˆ†æï¼ˆçœŸå®æ•°æ®ï¼‰

### 1.1 roles è¡¨ç°æœ‰æ•°æ®ï¼ˆ10 ä¸ªè§’è‰²ï¼‰

| role_id | role_name | role_level | description | ç”¨æˆ·æ•° |
|---------|-----------|------------|-------------|--------|
| 2 | admin | 100 | ç®¡ç†å‘˜ | 4 |
| 6 | regional_manager | 80 | åŒºåŸŸè´Ÿè´£äºº | 0 |
| 7 | business_manager | 60 | ä¸šåŠ¡ç»ç† | 0 |
| 8 | sales_staff | 40 | ä¸šåŠ¡å‘˜ | 0 |
| 11 | merchant_manager | 40 | å•†å®¶åº—é•¿è§’è‰² | 1 |
| 9 | ops | 30 | è¿è¥åªè¯»è§’è‰² | 1 |
| 10 | merchant_staff | 20 | å•†å®¶å‘˜å·¥è§’è‰² | 0 |
| 5 | campaign_2 | 10 | é¤å…ç§¯åˆ†æŠ½å¥–æƒé™ | 1 |
| 1 | user | 0 | æ™®é€šç”¨æˆ· | 13 |
| 100 | system_job | -1 | ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ä¸“ç”¨è§’è‰² | 1 |

### 1.2 æƒé™å­˜å‚¨æ–¹å¼

- **æ— ç‹¬ç«‹ permission è¡¨**
- æƒé™å­˜å‚¨åœ¨ `roles.permissions` JSON å­—æ®µä¸­
- æ ¼å¼ï¼š`{"resource": ["action1", "action2"]}`

**ç¤ºä¾‹ï¼ˆops è§’è‰²æƒé™ï¼‰**ï¼š
```json
{
  "auth": ["read"],
  "assets": ["read"],
  "config": ["read"],
  "system": ["read"],
  "material": ["read"],
  "settings": ["read"],
  "analytics": ["read"],
  "prize-pool": ["read"],
  "marketplace": ["read"],
  "lottery-quota": ["read"],
  "popup-banners": ["read"],
  "campaign-budget": ["read"],
  "user-management": ["read"],
  "asset-adjustment": ["read"],
  "customer-service": ["read"],
  "lottery-management": ["read"]
}
```

---

## ğŸ”§ äºŒã€åç«¯ç°çŠ¶åˆ†æ

### 2.1 å·²å®ç°çš„ API

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| GET | `/api/v4/console/user-management/users` | è·å–ç”¨æˆ·åˆ—è¡¨ | âœ… |
| GET | `/api/v4/console/user-management/users/:user_id` | è·å–ç”¨æˆ·è¯¦æƒ… | âœ… |
| PUT | `/api/v4/console/user-management/users/:user_id/role` | æ›´æ–°ç”¨æˆ·è§’è‰² | âœ… |
| PUT | `/api/v4/console/user-management/users/:user_id/status` | æ›´æ–°ç”¨æˆ·çŠ¶æ€ | âœ… |
| GET | `/api/v4/console/user-management/roles` | è·å–è§’è‰²åˆ—è¡¨ï¼ˆåªè¯»ï¼‰| âœ… |

### 2.2 UserRoleService å·²æœ‰æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `getUserWithRoles(user_id)` | è·å–ç”¨æˆ·åŠå…¶è§’è‰² | âœ… |
| `checkUserPermission(user_id, resource, action)` | æ£€æŸ¥ç”¨æˆ·æƒé™ | âœ… |
| `updateUserRole(user_id, role_name, operator_id, options)` | æ›´æ–°ç”¨æˆ·è§’è‰²ï¼ˆå«äº‹åŠ¡+å®¡è®¡+ç¼“å­˜å¤±æ•ˆï¼‰| âœ… |
| `updateUserStatus(user_id, status, operator_id, options)` | æ›´æ–°ç”¨æˆ·çŠ¶æ€ | âœ… |
| `getUserList(filters)` | è·å–ç”¨æˆ·åˆ—è¡¨ | âœ… |
| `getUserDetail(user_id)` | è·å–ç”¨æˆ·è¯¦æƒ… | âœ… |
| `getRoleList()` | è·å–è§’è‰²åˆ—è¡¨ | âœ… |
| `getUserPermissions(user_id)` | è·å–ç”¨æˆ·æƒé™ | âœ… |
| `getAllAdmins()` | è·å–æ‰€æœ‰ç®¡ç†å‘˜ | âœ… |
| **`createRole()`** | **åˆ›å»ºè§’è‰²** | âŒ æœªå®ç° |
| **`updateRole()`** | **ç¼–è¾‘è§’è‰²** | âŒ æœªå®ç° |
| **`deleteRole()`** | **åˆ é™¤è§’è‰²** | âŒ æœªå®ç° |

### 2.3 æŠ€æœ¯æ¶æ„ç‰¹ç‚¹

1. **æœåŠ¡å±‚æ¶æ„**ï¼šè·¯ç”±å±‚ä¸ç›´è¿ modelsï¼Œæ‰€æœ‰æ•°æ®åº“æ“ä½œé€šè¿‡ Service å±‚
2. **äº‹åŠ¡ç®¡ç†**ï¼šä½¿ç”¨ `TransactionManager.execute()` ç»Ÿä¸€ç®¡ç†äº‹åŠ¡
3. **æœåŠ¡è·å–**ï¼šé€šè¿‡ `req.app.locals.services.getService('user_role')` è·å–æœåŠ¡
4. **å®¡è®¡æ—¥å¿—**ï¼šé€šè¿‡ `AuditLogService` è®°å½•æ“ä½œæ—¥å¿—
5. **æƒé™ç¼“å­˜**ï¼šæœ‰ `invalidateUserPermissions()` ç¼“å­˜å¤±æ•ˆæœºåˆ¶
6. **äº‹åŠ¡è¾¹ç•Œæ²»ç†**ï¼šæœåŠ¡å±‚æ–¹æ³•å¿…é¡»æ¥æ”¶å¤–éƒ¨äº‹åŠ¡ï¼ˆ`options.transaction`ï¼‰

---

## ğŸ¯ ä¸‰ã€å‰ç«¯ç°çŠ¶åˆ†æ

### 3.1 æŠ€æœ¯æ ˆ

- **æ„å»ºå·¥å…·**: Vite 6.x
- **UI æ¡†æ¶**: Alpine.js 3.x
- **æ ·å¼**: Tailwind CSS 3.x
- **WebSocket**: socket.io-client 4.x
- **å›¾è¡¨**: ECharts 6.x

### 3.2 å‰ç«¯æ¶æ„ç‰¹ç‚¹

1. **Composables æ¨¡å¼**ï¼šä½¿ç”¨ `useRolesPermissionsState()` å’Œ `useRolesPermissionsMethods()` åˆ†ç¦»çŠ¶æ€å’Œæ–¹æ³•
2. **API ç«¯ç‚¹é…ç½®**ï¼šåœ¨ `admin/src/api/user.js` çš„ `USER_ENDPOINTS` å¯¹è±¡ä¸­å®šä¹‰
3. **URL æ„å»º**ï¼šä½¿ç”¨ `buildURL()` å‡½æ•°å¤„ç†è·¯å¾„å‚æ•°
4. **æ¨¡æ€æ¡†ç®¡ç†**ï¼šä½¿ç”¨ `showModal()` / `hideModal()` æ–¹æ³•

### 3.3 å½“å‰å‰ç«¯å®ç°çŠ¶æ€

| åŠŸèƒ½ | å‰ç«¯ UI | å‰ç«¯ JS æ–¹æ³• | çŠ¶æ€ |
|------|---------|--------------|------|
| è§’è‰²åˆ—è¡¨å±•ç¤º | âœ… å·²æœ‰ | `loadRoles()` | æ­£å¸¸å·¥ä½œ |
| åˆ›å»ºè§’è‰² | âœ… æœ‰æŒ‰é’® | `openCreateRoleModal()` | æ˜¾ç¤º"åç«¯æš‚æœªå¼€æ”¾" |
| ç¼–è¾‘è§’è‰² | âœ… æœ‰æŒ‰é’® | `editRole()` | æ˜¾ç¤º"åç«¯æš‚æœªå¼€æ”¾" |
| åˆ é™¤è§’è‰² | âš ï¸ æ— æŒ‰é’® | - | æœªå®ç° |
| æƒé™é…ç½® | âœ… æœ‰æŒ‰é’® | `manageRolePermissions()` | æ˜¾ç¤º"åç«¯æš‚æœªå¼€æ”¾" |

---

## âš ï¸ å››ã€éœ€è¦ç”¨æˆ·å†³å®šçš„é—®é¢˜

### ã€å†³ç­–ç‚¹ 1ã€‘æƒé™èµ„æºçš„ç®¡ç†æ–¹å¼ âœ… å·²ç¡®è®¤

**é—®é¢˜**ï¼šç³»ç»Ÿä¸­æœ‰å¤šå°‘ç§æƒé™èµ„æºï¼ˆresourceï¼‰å’Œæ“ä½œï¼ˆactionï¼‰ï¼Ÿå¦‚ä½•ç®¡ç†ï¼Ÿ

**æœ€ç»ˆå†³ç­–**ï¼šé‡‡ç”¨ **æ–¹æ¡ˆ Aï¼ˆç¡¬ç¼–ç ï¼‰**

| æ–¹æ¡ˆ | è¯´æ˜ | æœ¬é¡¹ç›®é€‰æ‹© |
|------|------|------------|
| **æ–¹æ¡ˆ Aï¼šç¡¬ç¼–ç ** | æƒé™å®šä¹‰åœ¨ä»£ç æ–‡ä»¶ä¸­ | âœ… **é‡‡ç”¨** |
| **æ–¹æ¡ˆ Bï¼šæ•°æ®åº“é…ç½®è¡¨** | æƒé™å®šä¹‰åœ¨æ•°æ®åº“è¡¨ä¸­ | âŒ ä¸é‡‡ç”¨ |

**å†³ç­–ä¾æ®**ï¼š
- æœ¬é¡¹ç›®çš„æƒé™èµ„æº = ç³»ç»ŸåŠŸèƒ½æ¨¡å—ï¼ˆæŠ½å¥–ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€é—¨åº—ç®¡ç†ç­‰ï¼‰
- æ–°å¢åŠŸèƒ½æ¨¡å— = å¿…é¡»å†™ä»£ç å‘ç‰ˆ
- æƒé™å®šä¹‰è·Ÿç€ä»£ç èµ°ï¼Œå¤©ç„¶ä¸€è‡´ï¼Œä¸æ˜“å‡ºé”™
- æ–¹æ¡ˆ B é€‚åˆ SaaS å¤šç§Ÿæˆ·åœºæ™¯ï¼Œæœ¬é¡¹ç›®ä¸éœ€è¦

---

### ã€å†³ç­–ç‚¹ 2ã€‘ç³»ç»Ÿå†…ç½®è§’è‰²ä¿æŠ¤ âœ… å·²ç¡®è®¤

**é—®é¢˜**ï¼šå“ªäº›è§’è‰²åº”è®¾ä¸º"ç³»ç»Ÿå†…ç½®"ã€ç¦æ­¢åˆ é™¤/é‡å‘½åï¼Ÿ

**æœ€ç»ˆå†³ç­–**ï¼šåªä¿æŠ¤ **3 ä¸ªæŠ€æœ¯å¿…éœ€è§’è‰²**

| è§’è‰² | ä¿æŠ¤çº§åˆ« | æ€§è´¨ | ç†ç”± |
|------|----------|------|------|
| `admin` | ğŸ”’ å®Œå…¨ä¿æŠ¤ | æŠ€æœ¯å¿…éœ€ | ä»£ç ç¡¬ç¼–ç æ£€æŸ¥ `role_level >= 100`ï¼Œç®¡ç†åå°å…¥å£åŸºå‡† |
| `user` | ğŸ”’ å®Œå…¨ä¿æŠ¤ | æŠ€æœ¯å¿…éœ€ | æ–°ç”¨æˆ·æ³¨å†Œè‡ªåŠ¨åˆ†é…æ­¤è§’è‰²ï¼Œä»£ç ç¡¬ç¼–ç å¼•ç”¨ |
| `system_job` | ğŸ”’ å®Œå…¨ä¿æŠ¤ | æŠ€æœ¯å¿…éœ€ | å®šæ—¶ä»»åŠ¡/åå°Jobä½¿ç”¨æ­¤è§’è‰²ï¼Œä»£ç ç¡¬ç¼–ç å¼•ç”¨ |
| `ops` | âœï¸ å¯ç¼–è¾‘å¯åˆ é™¤ | ä¸šåŠ¡è§’è‰² | è¿è¥è§’è‰²ï¼Œä¸å½±å“ç³»ç»Ÿè¿è¡Œ |
| å…¶ä»–è§’è‰² | âœï¸ å¯ç¼–è¾‘å¯åˆ é™¤ | ä¸šåŠ¡è§’è‰² | ä¸šåŠ¡å®šä¹‰çš„è§’è‰²ï¼Œå…è®¸å¢åˆ æ”¹ |

**å†³ç­–ä¾æ®**ï¼š
- æŠ€æœ¯å¿…éœ€è§’è‰²åœ¨ä»£ç é€»è¾‘ä¸­è¢«ç¡¬ç¼–ç å¼•ç”¨ï¼Œåˆ é™¤ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ
- ä¸šåŠ¡è§’è‰²ï¼ˆå¦‚ opsï¼‰åªå½±å“ä¸šåŠ¡æƒé™ï¼Œä¸å½±å“ç³»ç»Ÿæ ¸å¿ƒè¿è¡Œ

---

### ã€å†³ç­–ç‚¹ 3ã€‘åˆ é™¤è§’è‰²æ—¶çš„ç”¨æˆ·å¤„ç†ç­–ç•¥ âœ… å·²ç¡®è®¤

**é—®é¢˜**ï¼šå¦‚æœåˆ é™¤çš„è§’è‰²æœ‰ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ

**æœ€ç»ˆå†³ç­–**ï¼šé‡‡ç”¨ **æ–¹æ¡ˆ Cï¼ˆè½¯åˆ é™¤ï¼‰**

| æ–¹æ¡ˆ | è¯´æ˜ | æœ¬é¡¹ç›®é€‰æ‹© |
|------|------|------------|
| **æ–¹æ¡ˆ Aï¼šç¦æ­¢åˆ é™¤** | å¿…é¡»å…ˆæ‰‹åŠ¨è¿ç§»ç”¨æˆ· | âŒ ä¸é‡‡ç”¨ |
| **æ–¹æ¡ˆ Bï¼šå¼ºåˆ¶åˆ é™¤** | è‡ªåŠ¨è¿ç§»ç”¨æˆ·åˆ° user | âŒ ä¸é‡‡ç”¨ |
| **æ–¹æ¡ˆ Cï¼šè½¯åˆ é™¤** | è®¾ç½® `is_active=false` | âœ… **é‡‡ç”¨** |

**å†³ç­–ä¾æ®**ï¼š
- è½¯åˆ é™¤åªä¿®æ”¹ `is_active` å­—æ®µï¼Œè§’è‰²æ•°æ®ä¿ç•™
- ç°æœ‰ç”¨æˆ·ä¿æŒåŸæƒé™ä¸å—å½±å“
- è§’è‰²ä»"å¯åˆ†é…åˆ—è¡¨"ä¸­æ¶ˆå¤±ï¼Œæ–°ç”¨æˆ·æ— æ³•ä½¿ç”¨
- æ•°æ®å¯è¿½æº¯ï¼Œç¬¦åˆå®¡è®¡è¦æ±‚
- è¯¯åˆ é™¤å¯é€šè¿‡æ¢å¤ `is_active=true` æ¢å¤

---

### ã€å†³ç­–ç‚¹ 4ã€‘æƒé™ç¼–è¾‘çš„ UI äº¤äº’æ–¹å¼ âœ… å·²ç¡®è®¤

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨å‰ç«¯ç¼–è¾‘è§’è‰²çš„ `permissions` JSON å­—æ®µï¼Ÿ

**æœ€ç»ˆå†³ç­–**ï¼šé‡‡ç”¨ **æ–¹æ¡ˆ Aï¼ˆæ ‘å½¢å¤é€‰æ¡†ï¼‰+ å¢å¼ºåŠŸèƒ½**

---

### ã€å†³ç­–ç‚¹ 5ã€‘æƒé™èµ„æºå®šä¹‰çš„æ•°æ®æ¥æº âœ… å·²ç¡®è®¤

**é—®é¢˜**ï¼š`PermissionResources.js` ä¸­åº”å®šä¹‰å“ªäº›èµ„æºåç§°ï¼Ÿ

**æœ€ç»ˆå†³ç­–**ï¼šé‡‡ç”¨ **æ–¹æ¡ˆ Aï¼ˆä»¥åç«¯æ•°æ®åº“ä¸ºæƒå¨ï¼‰**

| æ–¹æ¡ˆ | è¯´æ˜ | æœ¬é¡¹ç›®é€‰æ‹© |
|------|------|------------|
| **æ–¹æ¡ˆ Aï¼šä½¿ç”¨ç°æœ‰èµ„æº** | ä»æ•°æ®åº“æå–ç°æœ‰çš„ 28 ä¸ªèµ„æºä½œä¸ºå®šä¹‰ | âœ… **é‡‡ç”¨** |
| æ–¹æ¡ˆ Bï¼šä½¿ç”¨æ–¹æ¡ˆå®šä¹‰ | æŒ‰æ–°è®¾è®¡çš„ 12 ä¸ªèµ„æºå®šä¹‰ | âŒ ä¸é‡‡ç”¨ |
| æ–¹æ¡ˆ Cï¼šåˆå¹¶æ•´åˆ | åˆå¹¶ä¸¤è€…å¹¶ç»Ÿä¸€æ ¼å¼ | âŒ ä¸é‡‡ç”¨ |

**å†³ç­–ä¾æ®**ï¼š
- ç°æœ‰ç³»ç»Ÿå·²è¿è¡Œï¼Œæ•°æ®åº“ä¸­çš„ 28 ä¸ªèµ„æºåç§°æ˜¯çœŸå®ä¸šåŠ¡éœ€æ±‚çš„ä½“ç°
- ä»¥æ•°æ®åº“ä¸ºæƒå¨å¯ç¡®ä¿ 100% å…¼å®¹ï¼Œæ— éœ€æ•°æ®è¿ç§»
- é¿å…æ–°æ—§èµ„æºåç§°æ˜ å°„çš„å¤æ‚æ€§å’Œé£é™©

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| âœ… èµ„æº-æ“ä½œçš„æ ‘å½¢ç»“æ„ | æ¯ä¸ªèµ„æºå±•å¼€æ˜¾ç¤ºå…¶ä¸‹æ‰€æœ‰æ“ä½œ |
| âœ… å¤é€‰æ¡†æ‰¹é‡å‹¾é€‰ | ç‚¹å‡»æ“ä½œå¤é€‰æ¡†å³å¯é€‰ä¸­/å–æ¶ˆ |
| âœ… æ¯ä¸ªèµ„æºæ”¯æŒ"å…¨é€‰/å…¨ä¸é€‰" | èµ„æºè¡Œå³ä¾§æœ‰å¿«æ·æŒ‰é’® |
| âœ… æƒé™ JSON å®æ—¶é¢„è§ˆ | åº•éƒ¨æ˜¾ç¤ºå½“å‰é…ç½®çš„ JSONï¼Œä¾›æŠ€æœ¯äººå‘˜æ ¸å¯¹ |

**UI ç¤ºæ„å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æƒé™é…ç½®                                                [å…¨é€‰] [æ¸…ç©º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â˜‘ï¸ ç”¨æˆ·ç®¡ç† (users)                                    [å…¨é€‰/å–æ¶ˆ] â”‚
â”‚     â”œâ”€ â˜‘ï¸ æŸ¥çœ‹ (read)                                              â”‚
â”‚     â”œâ”€ â˜‘ï¸ åˆ›å»º (create)                                            â”‚
â”‚     â”œâ”€ â˜‘ï¸ æ›´æ–° (update)                                            â”‚
â”‚     â””â”€ â˜ åˆ é™¤ (delete)                                             â”‚
â”‚                                                                     â”‚
â”‚  â˜‘ï¸ æŠ½å¥–ç®¡ç† (lottery)                                  [å…¨é€‰/å–æ¶ˆ] â”‚
â”‚     â”œâ”€ â˜‘ï¸ æŸ¥çœ‹ (read)                                              â”‚
â”‚     â”œâ”€ â˜‘ï¸ åˆ›å»º (create)                                            â”‚
â”‚     â”œâ”€ â˜‘ï¸ æ›´æ–° (update)                                            â”‚
â”‚     â”œâ”€ â˜ åˆ é™¤ (delete)                                             â”‚
â”‚     â””â”€ â˜‘ï¸ å‚ä¸ (participate)                                       â”‚
â”‚                                                                     â”‚
â”‚  â˜ æ•°æ®åˆ†æ (analytics)                                 [å…¨é€‰/å–æ¶ˆ] â”‚
â”‚     â”œâ”€ â˜ æŸ¥çœ‹ (read)                                               â”‚
â”‚     â””â”€ â˜ å¯¼å‡º (export)                                             â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ æƒé™ JSON é¢„è§ˆ                                          [å¤åˆ¶]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  {                                                                  â”‚
â”‚    "users": ["read", "create", "update"],                          â”‚
â”‚    "lottery": ["read", "create", "update", "participate"]          â”‚
â”‚  }                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’é€»è¾‘**ï¼š
1. ç‚¹å‡»èµ„æºè¡Œçš„å¤é€‰æ¡† â†’ å…¨é€‰/å…¨ä¸é€‰è¯¥èµ„æºä¸‹æ‰€æœ‰æ“ä½œ
2. ç‚¹å‡»æ“ä½œå¤é€‰æ¡† â†’ å•ç‹¬é€‰ä¸­/å–æ¶ˆè¯¥æ“ä½œ
3. èµ„æºä¸‹æœ‰éƒ¨åˆ†æ“ä½œé€‰ä¸­æ—¶ â†’ èµ„æºå¤é€‰æ¡†æ˜¾ç¤ºä¸ºåŠé€‰çŠ¶æ€ï¼ˆindeterminateï¼‰
4. åº•éƒ¨ JSON é¢„è§ˆå®æ—¶æ›´æ–°ï¼Œç‚¹å‡»"å¤åˆ¶"å¯å¤åˆ¶åˆ°å‰ªè´´æ¿

---

## ğŸ› ï¸ äº”ã€æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 åç«¯ API è®¾è®¡

#### 5.1.1 åˆ›å»ºè§’è‰²

```
POST /api/v4/console/user-management/roles
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "role_name": "content_editor",
  "description": "å†…å®¹ç¼–è¾‘å‘˜",
  "role_level": 45,
  "permissions": {
    "lottery": ["read", "create", "update"],
    "prizes": ["read"],
    "analytics": ["read"]
  }
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "code": "ROLE_CREATED",
  "message": "è§’è‰²åˆ›å»ºæˆåŠŸ",
  "data": {
    "role_id": 12,
    "role_uuid": "xxxx-xxxx-xxxx",
    "role_name": "content_editor",
    "role_level": 45,
    "permissions": { ... },
    "is_active": true,
    "created_at": "2026-01-26T10:00:00+08:00"
  }
}
```

#### 5.1.2 ç¼–è¾‘è§’è‰²

```
PUT /api/v4/console/user-management/roles/:role_id
```

**è¯·æ±‚ä½“**ï¼ˆéƒ¨åˆ†æ›´æ–°ï¼‰ï¼š
```json
{
  "description": "å†…å®¹ç¼–è¾‘å‘˜ï¼ˆå·²æ›´æ–°ï¼‰",
  "role_level": 50,
  "permissions": {
    "lottery": ["read", "create", "update", "delete"],
    "prizes": ["read", "create"]
  }
}
```

**ä¸šåŠ¡è§„åˆ™**ï¼š
- ä¸èƒ½ä¿®æ”¹ `role_uuid`
- ä¸èƒ½å°† `role_level` è®¾ç½®ä¸ºé«˜äºæ“ä½œè€…çš„ç­‰çº§
- ç³»ç»Ÿå†…ç½®è§’è‰²ä¸å¯ç¼–è¾‘

#### 5.1.3 åˆ é™¤è§’è‰²ï¼ˆè½¯åˆ é™¤ï¼‰

```
DELETE /api/v4/console/user-management/roles/:role_id
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "code": "ROLE_DELETED",
  "message": "è§’è‰²å·²åˆ é™¤",
  "data": {
    "role_id": 12,
    "affected_users": 0
  }
}
```

**é”™è¯¯å“åº”ï¼ˆç³»ç»Ÿè§’è‰²ï¼‰**ï¼š
```json
{
  "success": false,
  "code": "SYSTEM_ROLE_PROTECTED",
  "message": "ç³»ç»Ÿå†…ç½®è§’è‰²ä¸å¯åˆ é™¤ï¼šadmin"
}
```

#### 5.1.4 è·å–æƒé™èµ„æºåˆ—è¡¨

```
GET /api/v4/console/user-management/permission-resources
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "resources": [
      {
        "code": "users",
        "name": "ç”¨æˆ·ç®¡ç†",
        "actions": [
          { "code": "read", "name": "æŸ¥çœ‹" },
          { "code": "create", "name": "åˆ›å»º" },
          { "code": "update", "name": "æ›´æ–°" },
          { "code": "delete", "name": "åˆ é™¤" }
        ]
      }
      // ... å…¶ä»–èµ„æº
    ]
  }
}
```

### 5.2 åç«¯ Service å±‚æ–¹æ³•

åœ¨ `services/UserRoleService.js` ä¸­æ–°å¢ï¼š

```javascript
/**
 * åˆ›å»ºè§’è‰²
 * @param {Object} roleData - è§’è‰²æ•°æ®
 * @param {number} operator_id - æ“ä½œè€…ID
 * @param {Object} options - é€‰é¡¹ï¼ˆå¿…é¡»åŒ…å« transactionï¼‰
 */
static async createRole(roleData, operator_id, options = {})

/**
 * æ›´æ–°è§’è‰²
 * @param {number} role_id - è§’è‰²ID
 * @param {Object} updateData - æ›´æ–°æ•°æ®
 * @param {number} operator_id - æ“ä½œè€…ID
 * @param {Object} options - é€‰é¡¹ï¼ˆå¿…é¡»åŒ…å« transactionï¼‰
 */
static async updateRole(role_id, updateData, operator_id, options = {})

/**
 * åˆ é™¤è§’è‰²ï¼ˆè½¯åˆ é™¤ï¼‰
 * @param {number} role_id - è§’è‰²ID
 * @param {number} operator_id - æ“ä½œè€…ID
 * @param {Object} options - é€‰é¡¹ï¼ˆå¿…é¡»åŒ…å« transactionï¼‰
 */
static async deleteRole(role_id, operator_id, options = {})

/**
 * è·å–æƒé™èµ„æºåˆ—è¡¨
 * @returns {Array} æƒé™èµ„æºæ•°ç»„
 */
static getPermissionResources()
```

### 5.3 æƒé™èµ„æºå®šä¹‰ï¼ˆä»¥æ•°æ®åº“ä¸ºæƒå¨ï¼‰

æ–°å¢å¸¸é‡æ–‡ä»¶ `constants/PermissionResources.js`ï¼š

> âš ï¸ **æ³¨æ„**ï¼šä»¥ä¸‹èµ„æºå®šä¹‰æ¥æºäºæ•°æ®åº“å®é™…ä½¿ç”¨çš„ 28 ä¸ªèµ„æºåç§°ï¼ˆ2026-01-26 æŸ¥è¯¢ï¼‰ï¼Œç¡®ä¿ä¸ç°æœ‰ç³»ç»Ÿ 100% å…¼å®¹ã€‚

```javascript
/**
 * ç³»ç»Ÿæƒé™èµ„æºå®šä¹‰ï¼ˆä»¥æ•°æ®åº“ä¸ºæƒå¨ï¼‰
 * 
 * æ•°æ®æ¥æºï¼šä» roles è¡¨çš„ permissions å­—æ®µæå–çš„å®é™…ä½¿ç”¨èµ„æº
 * æŸ¥è¯¢æ—¶é—´ï¼š2026-01-26
 * 
 * ç”¨äºè§’è‰²æƒé™é…ç½®ç•Œé¢å±•ç¤º
 */
const PERMISSION_RESOURCES = [
  // ==================== æ ¸å¿ƒä¸šåŠ¡æ¨¡å— ====================
  {
    code: 'users',
    name: 'ç”¨æˆ·ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'create', name: 'åˆ›å»º' },
      { code: 'update', name: 'æ›´æ–°' },
      { code: 'delete', name: 'åˆ é™¤' }
    ]
  },
  {
    code: 'user-management',
    name: 'ç”¨æˆ·ç®¡ç†ï¼ˆæ§åˆ¶å°ï¼‰',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'lottery',
    name: 'æŠ½å¥–æ´»åŠ¨',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'participate', name: 'å‚ä¸' }
    ]
  },
  {
    code: 'lottery-management',
    name: 'æŠ½å¥–ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'lottery-quota',
    name: 'æŠ½å¥–é…é¢',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'prize-pool',
    name: 'å¥–æ± ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'stores',
    name: 'é—¨åº—ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'create', name: 'åˆ›å»º' },
      { code: 'update', name: 'æ›´æ–°' },
      { code: 'delete', name: 'åˆ é™¤' }
    ]
  },
  {
    code: 'store',
    name: 'é—¨åº—ï¼ˆå•æ•°ï¼‰',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'staff',
    name: 'å‘˜å·¥ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'create', name: 'åˆ›å»º' },
      { code: 'update', name: 'æ›´æ–°' },
      { code: 'delete', name: 'åˆ é™¤' },
      { code: 'manage', name: 'ç®¡ç†' }
    ]
  },
  {
    code: 'consumption',
    name: 'æ¶ˆè´¹ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'create', name: 'å½•å…¥' },
      { code: 'update', name: 'æ›´æ–°' },
      { code: 'delete', name: 'åˆ é™¤' },
      { code: 'scan_user', name: 'æ‰«ç ' }
    ]
  },
  {
    code: 'hierarchy',
    name: 'å±‚çº§ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'create', name: 'åˆ›å»º' },
      { code: 'update', name: 'æ›´æ–°' },
      { code: 'delete', name: 'åˆ é™¤' }
    ]
  },
  {
    code: 'reports',
    name: 'æŠ¥è¡¨ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  
  // ==================== èµ„äº§ä¸ç§¯åˆ†æ¨¡å— ====================
  {
    code: 'points',
    name: 'ç§¯åˆ†ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'assets',
    name: 'èµ„äº§ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'asset-adjustment',
    name: 'èµ„äº§è°ƒæ•´',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'marketplace',
    name: 'å¸‚åœºäº¤æ˜“',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'material',
    name: 'ç´ æç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  
  // ==================== è¥é”€æ´»åŠ¨æ¨¡å— ====================
  {
    code: 'campaign',
    name: 'æ´»åŠ¨ç®¡ç†',
    actions: [
      { code: 'access', name: 'è®¿é—®' }
    ]
  },
  {
    code: 'campaign-budget',
    name: 'æ´»åŠ¨é¢„ç®—',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'popup-banners',
    name: 'å¼¹çª—æ¨ªå¹…',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  
  // ==================== ç³»ç»Ÿé…ç½®æ¨¡å— ====================
  {
    code: 'profile',
    name: 'ä¸ªäººèµ„æ–™',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'update', name: 'æ›´æ–°' }
    ]
  },
  {
    code: 'settings',
    name: 'ç³»ç»Ÿè®¾ç½®',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'config',
    name: 'é…ç½®ç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'auth',
    name: 'è®¤è¯æˆæƒ',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'analytics',
    name: 'æ•°æ®åˆ†æ',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'customer-service',
    name: 'å®¢æœç³»ç»Ÿ',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' }
    ]
  },
  {
    code: 'system',
    name: 'ç³»ç»Ÿç®¡ç†',
    actions: [
      { code: 'read', name: 'æŸ¥çœ‹' },
      { code: 'execute_scheduled_tasks', name: 'æ‰§è¡Œå®šæ—¶ä»»åŠ¡' },
      { code: 'manage_frozen_assets', name: 'ç®¡ç†å†»ç»“èµ„äº§' },
      { code: 'audit_log_write', name: 'å†™å…¥å®¡è®¡æ—¥å¿—' }
    ]
  }
]

/**
 * ç³»ç»Ÿå†…ç½®è§’è‰²ï¼ˆæŠ€æœ¯å¿…éœ€ï¼Œä¸å¯åˆ é™¤/é‡å‘½åï¼‰
 * 
 * ğŸ”’ è¿™3ä¸ªè§’è‰²åœ¨ä»£ç ä¸­è¢«ç¡¬ç¼–ç å¼•ç”¨ï¼Œåˆ é™¤ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼š
 * - admin: ç®¡ç†åå°å…¥å£æƒé™åŸºå‡† (role_level >= 100)
 * - user: æ–°ç”¨æˆ·æ³¨å†Œè‡ªåŠ¨åˆ†é…çš„é»˜è®¤è§’è‰²
 * - system_job: å®šæ—¶ä»»åŠ¡/åå°Jobæ‰§è¡Œä¸“ç”¨è§’è‰²
 */
const SYSTEM_ROLES = ['admin', 'user', 'system_job']

module.exports = { PERMISSION_RESOURCES, SYSTEM_ROLES }
```

### 5.4 å‰ç«¯æ”¹é€ 

#### 5.4.1 API ç«¯ç‚¹é…ç½®

åœ¨ `admin/src/api/user.js` çš„ `USER_ENDPOINTS` ä¸­æ–°å¢ï¼š

```javascript
// è§’è‰²ç®¡ç† CRUD
ROLE_CREATE: '/api/v4/console/user-management/roles',
ROLE_UPDATE: '/api/v4/console/user-management/roles/:role_id',
ROLE_DELETE: '/api/v4/console/user-management/roles/:role_id',

// æƒé™èµ„æºåˆ—è¡¨
PERMISSION_RESOURCES: '/api/v4/console/user-management/permission-resources'
```

#### 5.4.2 Composables æ–¹æ³•æ›´æ–°

æ›´æ–° `admin/src/modules/user/composables/roles-permissions.js`ï¼š

- `openCreateRoleModal()` â†’ æ‰“å¼€åˆ›å»ºè§’è‰²æ¨¡æ€æ¡†ï¼ŒåŠ è½½æƒé™èµ„æº
- `editRole(role)` â†’ æ‰“å¼€ç¼–è¾‘è§’è‰²æ¨¡æ€æ¡†ï¼Œå›å¡«æ•°æ®
- `submitRoleForm()` â†’ è°ƒç”¨ POST/PUT API
- `deleteRole(role)` â†’ è°ƒç”¨ DELETE API
- `loadPermissionResources()` â†’ åŠ è½½æƒé™èµ„æºåˆ—è¡¨

#### 5.4.3 HTML æ¨¡æ€æ¡†

åœ¨ `admin/user-management.html` ä¸­æ·»åŠ è§’è‰²ç¼–è¾‘æ¨¡æ€æ¡†å’Œæƒé™é…ç½®é¢æ¿ã€‚

---

## ğŸ“Š å…­ã€æ¥å£æƒé™çŸ©é˜µ

| API | æ‰€éœ€æƒé™ | æœ€ä½è§’è‰²çº§åˆ« |
|-----|----------|--------------|
| `POST /roles` | `roles:create` | 100 (admin) |
| `PUT /roles/:id` | `roles:update` | 100 (admin) |
| `DELETE /roles/:id` | `roles:delete` | 100 (admin) |
| `GET /permission-resources` | `roles:read` | 30 (ops) |

---

## ğŸ”’ ä¸ƒã€å®‰å…¨è€ƒè™‘

### 7.1 æƒé™æå‡æ”»å‡»é˜²æŠ¤

```javascript
// ç¦æ­¢åˆ›å»º/ç¼–è¾‘æ¯”è‡ªå·±æƒé™ç­‰çº§é«˜çš„è§’è‰²
if (newRoleLevel > operatorRoleLevel) {
  throw new Error('ä¸èƒ½åˆ›å»ºæƒé™ç­‰çº§é«˜äºè‡ªå·±çš„è§’è‰²')
}
```

### 7.2 ç³»ç»Ÿè§’è‰²ä¿æŠ¤

```javascript
const { SYSTEM_ROLES } = require('../constants/PermissionResources')

if (SYSTEM_ROLES.includes(role.role_name)) {
  throw new Error('ç³»ç»Ÿå†…ç½®è§’è‰²ä¸å¯ä¿®æ”¹/åˆ é™¤')
}
```

### 7.3 å®¡è®¡æ—¥å¿—

æ‰€æœ‰è§’è‰²å˜æ›´å¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—ï¼š

```javascript
await AuditLogService.logOperation({
  admin_user_id: operator_id,
  operation_type: 'role_created', // æˆ– role_updated, role_deleted
  target_type: 'role',
  target_id: role_id,
  new_value: JSON.stringify(roleData),
  ip_address: options.ip_address
})
```

---

## ğŸ“… å…«ã€æ‰§è¡Œæ­¥éª¤

### 8.1 åç«¯å¼€å‘ï¼ˆé¢„ä¼° 4hï¼‰

| æ­¥éª¤ | ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|------|
| 1 | åˆ›å»ºæƒé™èµ„æºå¸¸é‡ | `constants/PermissionResources.js` | å®šä¹‰ 28 ä¸ªèµ„æºï¼ˆä»¥æ•°æ®åº“ä¸ºæƒå¨ï¼‰ |
| 2 | æ–°å¢å®¡è®¡æ“ä½œç±»å‹ | `constants/AuditOperationTypes.js` | æ–°å¢ `ROLE_CREATE`ã€`ROLE_UPDATE`ã€`ROLE_DELETE` |
| 3 | å®ç° `createRole()` | `services/UserRoleService.js` | å«äº‹åŠ¡ã€å®¡è®¡æ—¥å¿—ã€æƒé™æ ¡éªŒ |
| 4 | å®ç° `updateRole()` | `services/UserRoleService.js` | å«äº‹åŠ¡ã€å®¡è®¡æ—¥å¿—ã€ç³»ç»Ÿè§’è‰²ä¿æŠ¤ |
| 5 | å®ç° `deleteRole()` | `services/UserRoleService.js` | è½¯åˆ é™¤ï¼Œå«å®¡è®¡æ—¥å¿—ã€ç³»ç»Ÿè§’è‰²ä¿æŠ¤ |
| 6 | å®ç° `getPermissionResources()` | `services/UserRoleService.js` | è¿”å› `PERMISSION_RESOURCES` å¸¸é‡ |
| 7 | æ–°å¢è·¯ç”± POST /roles | `routes/v4/console/user_management.js` | åˆ›å»ºè§’è‰² API |
| 8 | æ–°å¢è·¯ç”± PUT /roles/:role_id | `routes/v4/console/user_management.js` | ç¼–è¾‘è§’è‰² API |
| 9 | æ–°å¢è·¯ç”± DELETE /roles/:role_id | `routes/v4/console/user_management.js` | åˆ é™¤è§’è‰² APIï¼ˆè½¯åˆ é™¤ï¼‰ |
| 10 | æ–°å¢è·¯ç”± GET /permission-resources | `routes/v4/console/user_management.js` | è·å–æƒé™èµ„æºåˆ—è¡¨ API |

#### 8.1.1 å®¡è®¡æ“ä½œç±»å‹æ–°å¢å†…å®¹

åœ¨ `constants/AuditOperationTypes.js` çš„ `OPERATION_TYPES` å¯¹è±¡ä¸­æ–°å¢ï¼š

```javascript
// ==================== è§’è‰²ç®¡ç†ç±»ï¼ˆæ–°å¢ï¼‰====================
/**
 * è§’è‰²åˆ›å»º
 * @description ç®¡ç†å‘˜åˆ›å»ºæ–°è§’è‰²
 */
ROLE_CREATE: 'role_create',

/**
 * è§’è‰²æ›´æ–°
 * @description ç®¡ç†å‘˜ç¼–è¾‘è§’è‰²ä¿¡æ¯æˆ–æƒé™é…ç½®
 */
ROLE_UPDATE: 'role_update',

/**
 * è§’è‰²åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
 * @description ç®¡ç†å‘˜åˆ é™¤è§’è‰²ï¼ˆè®¾ç½® is_active=falseï¼‰
 */
ROLE_DELETE: 'role_delete',
```

åœ¨ `OPERATION_TYPE_NAMES` å¯¹è±¡ä¸­æ–°å¢ï¼š

```javascript
[OPERATION_TYPES.ROLE_CREATE]: 'è§’è‰²åˆ›å»º',
[OPERATION_TYPES.ROLE_UPDATE]: 'è§’è‰²æ›´æ–°',
[OPERATION_TYPES.ROLE_DELETE]: 'è§’è‰²åˆ é™¤',
```

### 8.2 å‰ç«¯å¼€å‘ï¼ˆé¢„ä¼° 4hï¼‰

| æ­¥éª¤ | ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|------|
| 1 | æ–°å¢ API ç«¯ç‚¹å¸¸é‡ | `admin/src/api/user.js` | æ·»åŠ  `ROLE_CREATE`ã€`ROLE_UPDATE`ã€`ROLE_DELETE`ã€`PERMISSION_RESOURCES` |
| 2 | æ–°å¢çŠ¶æ€å­—æ®µ | `admin/src/modules/user/composables/roles-permissions.js` | æ·»åŠ  `permissionResources` æ•°ç»„ |
| 3 | å®ç° `loadPermissionResources()` | `admin/src/modules/user/composables/roles-permissions.js` | è°ƒç”¨ GET /permission-resources API |
| 4 | ä¿®æ”¹ `openCreateRoleModal()` | `admin/src/modules/user/composables/roles-permissions.js` | ç§»é™¤"åç«¯æš‚æœªå¼€æ”¾"æç¤ºï¼Œæ”¹ä¸ºæ‰“å¼€æ¨¡æ€æ¡† |
| 5 | ä¿®æ”¹ `editRole()` | `admin/src/modules/user/composables/roles-permissions.js` | ç§»é™¤"åç«¯æš‚æœªå¼€æ”¾"æç¤ºï¼Œæ”¹ä¸ºæ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡† |
| 6 | å®ç° `submitRoleForm()` | `admin/src/modules/user/composables/roles-permissions.js` | è°ƒç”¨ POST/PUT APIï¼Œæ ¹æ® isEditRole åˆ¤æ–­ |
| 7 | å®ç° `deleteRole()` | `admin/src/modules/user/composables/roles-permissions.js` | è°ƒç”¨ DELETE APIï¼Œå«ç¡®è®¤å¯¹è¯æ¡† |
| 8 | æ·»åŠ è§’è‰²ç¼–è¾‘æ¨¡æ€æ¡† HTML | `admin/user-management.html` | åŒ…å«åç§°ã€æè¿°ã€æƒé™ç­‰çº§è¡¨å•å­—æ®µ |
| 9 | æ·»åŠ æƒé™é…ç½®æ ‘å½¢é¢æ¿ HTML | `admin/user-management.html` | èµ„æº-æ“ä½œå¤é€‰æ¡†æ ‘ + JSON é¢„è§ˆåŒº |
| 10 | æ·»åŠ åˆ é™¤æŒ‰é’®å’Œç¡®è®¤äº¤äº’ | `admin/user-management.html` | ç³»ç»Ÿè§’è‰²æ˜¾ç¤º"ä¸å¯åˆ é™¤"æ ‡è¯† |
| 11 | é‡æ–°æ„å»º | `admin/` | æ‰§è¡Œ `npm run build` |

#### 8.2.1 å‰ç«¯ API ç«¯ç‚¹æ–°å¢å†…å®¹

åœ¨ `admin/src/api/user.js` çš„ `USER_ENDPOINTS` å¯¹è±¡ä¸­æ–°å¢ï¼š

```javascript
// è§’è‰²ç®¡ç† CRUDï¼ˆæ–°å¢ï¼‰
/** @type {string} [POST] åˆ›å»ºè§’è‰² - Body: { role_name, description, role_level, permissions } */
ROLE_CREATE: '/api/v4/console/user-management/roles',
/** @type {string} [PUT] æ›´æ–°è§’è‰² - Path: :role_id, Body: { description?, role_level?, permissions? } */
ROLE_UPDATE: '/api/v4/console/user-management/roles/:role_id',
/** @type {string} [DELETE] åˆ é™¤è§’è‰²ï¼ˆè½¯åˆ é™¤ï¼‰ - Path: :role_id */
ROLE_DELETE: '/api/v4/console/user-management/roles/:role_id',
/** @type {string} [GET] è·å–æƒé™èµ„æºåˆ—è¡¨ */
PERMISSION_RESOURCES: '/api/v4/console/user-management/permission-resources',
```

### 8.3 æµ‹è¯•éªŒè¯ï¼ˆé¢„ä¼° 2hï¼‰

| æµ‹è¯•é¡¹ | è¯´æ˜ |
|--------|------|
| åˆ›å»ºè§’è‰² | å¡«å†™è¡¨å•ã€é…ç½®æƒé™ã€æäº¤æˆåŠŸ |
| ç¼–è¾‘è§’è‰² | ä¿®æ”¹åç§°ã€æƒé™ç­‰çº§ã€æƒé™é…ç½® |
| åˆ é™¤è§’è‰² | è½¯åˆ é™¤ã€éªŒè¯ is_active=false |
| ç³»ç»Ÿè§’è‰²ä¿æŠ¤ | å°è¯•åˆ é™¤ admin/userï¼ŒéªŒè¯æŠ¥é”™ |
| æƒé™ç­‰çº§é™åˆ¶ | å°è¯•åˆ›å»ºé«˜äºè‡ªå·±ç­‰çº§çš„è§’è‰² |
| å®¡è®¡æ—¥å¿— | éªŒè¯æ“ä½œè®°å½•æ­£ç¡®å†™å…¥ |

---

## âœ… ä¹ã€éªŒæ”¶æ ‡å‡†

1. âœ… èƒ½é€šè¿‡ç®¡ç†åå°åˆ›å»ºæ–°è§’è‰²ï¼ˆå¡«å†™åç§°ã€æè¿°ã€æƒé™ç­‰çº§ã€æƒé™é…ç½®ï¼‰
2. âœ… èƒ½é€šè¿‡ç®¡ç†åå°ç¼–è¾‘ç°æœ‰è§’è‰²ï¼ˆåç§°ã€æè¿°ã€æƒé™ç­‰çº§ã€æƒé™é…ç½®ï¼‰
3. âœ… èƒ½é€šè¿‡ç®¡ç†åå°åˆ é™¤è§’è‰²ï¼ˆè½¯åˆ é™¤ï¼Œç³»ç»Ÿè§’è‰²ä¸å¯åˆ ï¼‰
4. âœ… æƒé™é…ç½®é¢æ¿æ­£ç¡®å±•ç¤ºæ‰€æœ‰èµ„æºå’Œæ“ä½œ
5. âœ… è§’è‰²å˜æ›´è‡ªåŠ¨è®°å½•å®¡è®¡æ—¥å¿—
6. âœ… ä¸èƒ½åˆ›å»º/ç¼–è¾‘æƒé™ç­‰çº§é«˜äºè‡ªå·±çš„è§’è‰²
7. âœ… ç³»ç»Ÿå†…ç½®è§’è‰²ï¼ˆadminã€userã€system_jobï¼‰ä¸å¯åˆ é™¤/é‡å‘½å
8. âœ… æ‰€æœ‰æ“ä½œæœ‰ç›¸åº”çš„æˆåŠŸ/å¤±è´¥æç¤º

---

## ğŸ“ åã€å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|----------|
| V1.0 | 2026-01-26 | åˆå§‹ç‰ˆæœ¬ |
| V2.0 | 2026-01-26 | åŸºäºçœŸå®æ•°æ®åº“å’Œä»£ç åˆ†ææ›´æ–°ï¼Œæ·»åŠ å†³ç­–ç‚¹å’Œè¯¦ç»†æ‰§è¡Œæ­¥éª¤ |
| V2.1 | 2026-01-26 | ã€å†³ç­–ç‚¹2ã€‘ç¡®è®¤ï¼šåªä¿æŠ¤3ä¸ªæŠ€æœ¯å¿…éœ€è§’è‰²ï¼ˆadminã€userã€system_jobï¼‰ï¼ŒopsåŠå…¶ä»–ä¸ºä¸šåŠ¡è§’è‰²å¯å¢åˆ æ”¹ |
| V2.2 | 2026-01-26 | ã€å†³ç­–ç‚¹4ã€‘ç¡®è®¤ï¼šé‡‡ç”¨æ ‘å½¢å¤é€‰æ¡†+å¢å¼ºåŠŸèƒ½ï¼ˆå…¨é€‰/å–æ¶ˆã€JSONå®æ—¶é¢„è§ˆï¼‰ |
| V3.0 | 2026-01-26 | ã€å†³ç­–ç‚¹1ã€‘ç¡®è®¤ï¼šé‡‡ç”¨ç¡¬ç¼–ç æ–¹æ¡ˆï¼›ã€å†³ç­–ç‚¹3ã€‘ç¡®è®¤ï¼šé‡‡ç”¨è½¯åˆ é™¤æ–¹æ¡ˆ |
| V3.1 | 2026-01-26 | ã€å†³ç­–ç‚¹5ã€‘ç¡®è®¤ï¼šä»¥åç«¯æ•°æ®åº“ä¸ºæƒå¨ï¼Œä»ç°æœ‰ 28 ä¸ªèµ„æºåç§°ç”Ÿæˆ PermissionResources.jsã€‚**å…¨éƒ¨ 5 ä¸ªå†³ç­–ç‚¹å·²ç¡®è®¤ï¼Œæ–¹æ¡ˆå®šç¨¿** |
