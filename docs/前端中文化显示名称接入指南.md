# 前端中文化显示名称接入指南

> 本文档面向前端开发人员，说明后端中文化显示名称系统完成后，前端需要做的适配工作。

## 一、后端变更概述

### 1.1 核心变化

后端已实现基于数据库字典表的中文显示名称系统，替代原有硬编码常量。所有 API 返回的数据将自动附带以下字段：

| 原字段 | 新增字段 | 说明 |
|--------|----------|------|
| `status` | `status_display` | 中文显示名称（如：正常、已取消） |
| `status` | `status_color` | 前端显示颜色类名（如：bg-success、bg-danger） |

**示例 - 用户数据返回格式**：
```json
{
  "user_id": 1,
  "username": "张三",
  "status": "active",
  "status_display": "正常",
  "status_color": "bg-success"
}
```

### 1.2 影响范围

以下类型的字段都会附带 `_display` 和 `_color` 后缀字段：

- `status` - 各类状态字段
- `order_status` - 订单状态
- `operation_type` - 操作类型
- `prize_type` - 奖品类型
- `campaign_status` - 活动状态
- `user_level` - 用户等级
- 等 56 种字典类型（见附录）

---

## 二、后端 API 端点

### 2.1 公开接口（无需登录）

#### 获取所有字典类型
```
GET /api/v4/system/dictionaries/types
```

**响应示例**：
```json
{
  "success": true,
  "code": "DICT_TYPES_SUCCESS",
  "data": {
    "types": ["user_status", "trade_order_status", "operation_type", ...],
    "count": 56
  }
}
```

#### 获取指定类型的字典项
```
GET /api/v4/system/dictionaries/type/:dictType
```

**请求示例**：
```
GET /api/v4/system/dictionaries/type/user_status
```

**响应示例**：
```json
{
  "success": true,
  "code": "DICT_ITEMS_SUCCESS",
  "data": {
    "dict_type": "user_status",
    "items": [
      { "code": "active", "name": "正常", "color": "bg-success" },
      { "code": "inactive", "name": "未激活", "color": "bg-warning" },
      { "code": "banned", "name": "已封禁", "color": "bg-danger" }
    ],
    "count": 3
  }
}
```

### 2.2 下拉选项接口（推荐用于表单）
```
GET /api/v4/system/dictionaries/options/:dictType
```

**响应示例**：
```json
{
  "success": true,
  "code": "DICT_OPTIONS_SUCCESS",
  "data": {
    "options": [
      { "value": "active", "label": "正常" },
      { "value": "inactive", "label": "未激活" },
      { "value": "banned", "label": "已封禁" }
    ]
  }
}
```

### 2.3 管理接口（需要 admin 角色）

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/v4/system/dictionaries/:dictId` | GET | 获取字典详情 |
| `/api/v4/system/dictionaries/:dictId` | PUT | 更新字典项 |
| `/api/v4/system/dictionaries/:dictId/rollback` | POST | 版本回滚 |
| `/api/v4/system/dictionaries/cache/refresh` | POST | 刷新缓存 |
| `/api/v4/system/dictionaries/history/:dictId` | GET | 获取修改历史 |

---

## 三、前端适配工作清单

### 3.1 必须删除的代码

#### 3.1.1 删除本地常量映射

**删除以下文件/代码**：
- `constants/DisplayNames.js` 或类似的硬编码映射文件
- 各组件中的 `statusMap`、`colorMap` 等本地映射对象

**示例（需要删除）**：
```javascript
// ❌ 删除这类代码
const statusMap = {
  active: '正常',
  inactive: '未激活',
  banned: '已封禁'
};

const colorMap = {
  active: 'bg-success',
  inactive: 'bg-warning',
  banned: 'bg-danger'
};
```

#### 3.1.2 删除 fallback 逻辑

**删除以下模式的代码**：
```javascript
// ❌ 删除这类代码
function getDisplayName(status) {
  return statusMap[status] || status; // 删除 fallback
}
```

### 3.2 必须修改的代码

#### 3.2.1 数据展示组件

**修改前**：
```javascript
// ❌ 旧代码
<span className={colorMap[user.status]}>
  {statusMap[user.status]}
</span>
```

**修改后**：
```javascript
// ✅ 新代码（直接使用后端返回的字段）
<span className={user.status_color}>
  {user.status_display}
</span>
```

#### 3.2.2 下拉选择框

**修改前**：
```javascript
// ❌ 旧代码
const statusOptions = Object.entries(statusMap).map(([value, label]) => ({
  value,
  label
}));
```

**修改后**：
```javascript
// ✅ 新代码（调用 API 获取选项）
const fetchStatusOptions = async () => {
  const response = await fetch('/api/v4/system/dictionaries/options/user_status');
  const data = await response.json();
  return data.data.options; // [{ value: 'active', label: '正常' }, ...]
};
```

#### 3.2.3 表格列渲染

**修改前**：
```javascript
// ❌ 旧代码
{
  title: '状态',
  dataIndex: 'status',
  render: (status) => (
    <Tag color={colorMap[status]}>{statusMap[status]}</Tag>
  )
}
```

**修改后**：
```javascript
// ✅ 新代码
{
  title: '状态',
  dataIndex: 'status',
  render: (_, record) => (
    <Tag color={record.status_color}>{record.status_display}</Tag>
  )
}
```

### 3.3 缓存下拉选项（可选优化）

前端可以缓存常用的字典选项，避免重复请求：

```javascript
// 字典选项缓存 Hook（示例）
const useDictOptions = (dictType) => {
  const [options, setOptions] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const cacheKey = `dict_options_${dictType}`;
    const cached = sessionStorage.getItem(cacheKey);

    if (cached) {
      setOptions(JSON.parse(cached));
      setLoading(false);
      return;
    }

    fetch(`/api/v4/system/dictionaries/options/${dictType}`)
      .then(res => res.json())
      .then(data => {
        setOptions(data.data.options);
        sessionStorage.setItem(cacheKey, JSON.stringify(data.data.options));
        setLoading(false);
      });
  }, [dictType]);

  return { options, loading };
};
```

---

## 四、字典类型完整列表

### 4.1 用户相关
| dict_type | 说明 |
|-----------|------|
| `user_status` | 用户状态（active/inactive/banned） |
| `user_level` | 用户等级（normal/vip/vvip） |
| `account_status` | 账户状态（active/frozen） |
| `account_type` | 账户类型（points/cash） |

### 4.2 订单相关
| dict_type | 说明 |
|-----------|------|
| `trade_order_status` | 交易订单状态 |
| `listing_status` | 挂牌状态 |
| `listing_kind` | 挂牌类型 |
| `exchange_status` | 兑换状态 |
| `redemption_status` | 核销状态 |

### 4.3 活动相关
| dict_type | 说明 |
|-----------|------|
| `campaign_status` | 活动状态 |
| `campaign_type` | 活动类型 |
| `prize_type` | 奖品类型 |
| `reward_tier` | 奖励档位 |
| `draw_type` | 抽奖类型 |

### 4.4 操作相关
| dict_type | 说明 |
|-----------|------|
| `operation_type` | 操作类型（30种） |
| `operation_result` | 操作结果 |
| `target_type` | 操作对象类型（12种） |

### 4.5 其他
| dict_type | 说明 |
|-----------|------|
| `store_status` | 门店状态 |
| `store_staff_status` | 门店员工状态 |
| `consumption_status` | 消费状态 |
| `risk_alert_type` | 风险告警类型 |
| `message_type` | 消息类型 |
| `feedback_status` | 反馈状态 |
| `enabled_status` | 启用状态 |
| `yes_no` | 是/否 |

> 完整列表共 56 种字典类型，可通过 `/api/v4/system/dictionaries/types` 接口获取。

---

## 五、颜色类名对照表

后端返回的 `*_color` 字段使用以下 CSS 类名：

| 颜色类名 | 含义 | 推荐使用场景 |
|----------|------|--------------|
| `bg-success` | 成功/正常 | 已完成、正常、启用 |
| `bg-warning` | 警告 | 待处理、未激活 |
| `bg-danger` | 危险/错误 | 失败、已封禁、异常 |
| `bg-info` | 信息 | 进行中、处理中 |
| `bg-secondary` | 次要/中性 | 已取消、未知 |
| `bg-primary` | 主要 | 默认、普通 |

**CSS 样式建议**：
```css
.bg-success { background-color: #28a745; color: white; }
.bg-warning { background-color: #ffc107; color: black; }
.bg-danger { background-color: #dc3545; color: white; }
.bg-info { background-color: #17a2b8; color: white; }
.bg-secondary { background-color: #6c757d; color: white; }
.bg-primary { background-color: #007bff; color: white; }
```

---

## 六、测试验证

### 6.1 验证 API 可用
```bash
# 获取字典类型列表
curl http://localhost:3000/api/v4/system/dictionaries/types

# 获取用户状态选项
curl http://localhost:3000/api/v4/system/dictionaries/type/user_status
```

### 6.2 验证数据返回

检查任意业务 API 返回数据是否包含 `*_display` 和 `*_color` 字段：

```bash
# 示例：获取用户列表
curl http://localhost:3000/api/v4/users

# 预期返回包含：
# {
#   "user_id": 1,
#   "status": "active",
#   "status_display": "正常",    <-- 新增
#   "status_color": "bg-success" <-- 新增
# }
```

---

## 七、FAQ

### Q1: 如果 `*_display` 字段为 null 怎么办？
A: 后端会确保所有已知的枚举值都有对应的中文名称。如果出现 null：
1. 检查该枚举值是否是新增的
2. 联系后端在字典表中添加映射

### Q2: 前端需要做颜色自定义吗？
A: 不需要。颜色由后端字典表统一管理，前端直接使用 `*_color` 字段的类名即可。

### Q3: 字典数据多久更新一次？
A: 字典数据存储在 Redis 缓存中，TTL 为 7 天。管理员可以通过后台刷新缓存。

### Q4: 可以添加新的状态值吗？
A: 可以。通过管理后台 `/api/v4/system/dictionaries` 接口添加，支持版本管理和回滚。

---

## 八、联系方式

如有问题，请联系后端开发团队。

---

**文档版本**：V1.0.0  
**创建时间**：2026-01-22  
**适用后端版本**：V4.7.0+

