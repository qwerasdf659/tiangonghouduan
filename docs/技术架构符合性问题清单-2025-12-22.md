# æŠ€æœ¯æ¶æ„ç¬¦åˆæ€§é—®é¢˜æ¸…å•

> åŸºå‡†æ–‡æ¡£ï¼š`docs/01-æŠ€æœ¯æ¶æ„æ ‡å‡†-æƒå¨ç‰ˆ.md`
> å®¡æŸ¥æ—¥æœŸï¼š2025-12-22
> å®¡æŸ¥èŒƒå›´ï¼šåç«¯ä»£ç  + æ•°æ®åº“è¡¨ç»“æ„

---

## ğŸ“‹ æœªå®Œæˆé—®é¢˜æ±‡æ€»ï¼ˆå…±10é¡¹ï¼‰

| ä¼˜å…ˆçº§ | é—®é¢˜                                       | æ–‡ä»¶/ä½ç½®                                 | çŠ¶æ€        |
| ------ | ------------------------------------------ | ----------------------------------------- | ----------- |
| **P0** | ğŸš¨ å‘½åæ··æ·†ï¼šexchange/market/tradeæ¦‚å¿µä¸æ¸… | è·¯ç”±/æœåŠ¡/æ¨¡å‹å±‚                          | âŒ å¾…ä¿®å¤   |
| **P1** | Controllerè¶…å¤§ï¼š1024è¡Œ                     | `routes/v4/shop/points.js`                | âŒ å¾…ä¿®å¤   |
| **P1** | Controllerè¶…å¤§ï¼š851è¡Œ                      | `routes/v4/shop/consumption.js`           | âŒ å¾…ä¿®å¤   |
| **P1** | Controllerè¶…å¤§ï¼š669è¡Œ                      | `routes/v4/inventory/inventory-market.js` | âŒ å¾…ä¿®å¤   |
| **P1** | Controllerè¶…å¤§ï¼š530è¡Œ                      | `routes/v4/market/exchange_market.js`     | âŒ å¾…ä¿®å¤   |
| **P1** | æµ‹è¯•ä½¿ç”¨axiosè€Œésupertest                 | `tests/api/core/base_test_manager.js`     | âŒ å¾…ä¿®å¤   |
| **P2** | Controllerè¶…å¤§ï¼š498è¡Œ                      | `routes/v4/shop/assets.js`                | âŒ å¾…ä¿®å¤   |
| **P2** | Controllerè¶…å¤§ï¼š451è¡Œ                      | `routes/v4/shop/redemption.js`            | âŒ å¾…ä¿®å¤   |
| **P2** | é‡å¤è·¯ç”±æ–‡ä»¶ï¼ˆæœªä½¿ç”¨ï¼‰                     | `routes/v4/admin/lottery-management.js`   | âŒ å¾…åˆ é™¤   |
| **P3** | åŸºç¡€è®¾æ–½ä»£ç ä½¿ç”¨console                    | `utils/UnifiedRedisClient.js` ç­‰          | âš ï¸ ä½ä¼˜å…ˆçº§ |

---

## âœ… å·²ç¬¦åˆæ ‡å‡†çš„é¡¹ç›®ï¼ˆå…±18é¡¹ï¼‰

### 1. é›¶å…¼å®¹åŸåˆ™

| æ£€æŸ¥é¡¹           | çŠ¶æ€      | è¯´æ˜                 |
| ---------------- | --------- | -------------------- |
| ç¦æ­¢410 Gone     | âœ… å·²ç¬¦åˆ | æœªå‘ç°410çŠ¶æ€ç       |
| ç¦æ­¢å¤§æ®µæ³¨é‡Šä»£ç  | âœ… å·²ç¬¦åˆ | æœªå‘ç°è¢«æ³¨é‡Šçš„ä»£ç å— |

### 2. APIæ¶æ„

| æ£€æŸ¥é¡¹         | çŠ¶æ€      | è¯´æ˜                    |
| -------------- | --------- | ----------------------- |
| ç»Ÿä¸€å“åº”æ ¼å¼   | âœ… å·²ç¬¦åˆ | ApiResponseæä¾›æ ‡å‡†æ ¼å¼ |
| ç”¨æˆ·ç«¯æ— IDå‚æ•° | âœ… å·²ç¬¦åˆ | ä½¿ç”¨/meæ¨¡å¼             |
| HTTPçŠ¶æ€ç è§„èŒƒ | âœ… å·²ç¬¦åˆ | æ­£ç¡®ä½¿ç”¨400/500ç³»åˆ—     |
| APIåŸŸåˆ’åˆ†      | âœ… å·²ç¬¦åˆ | /api/v4/æŒ‰é¢†åŸŸåˆ’åˆ†      |

### 3. èµ„äº§äº¤æ˜“

| æ£€æŸ¥é¡¹               | çŠ¶æ€      | è¯´æ˜                          |
| -------------------- | --------- | ----------------------------- |
| å¹‚ç­‰æ€§business_id    | âœ… å·²ç¬¦åˆ | NOT NULL + UNIQUEçº¦æŸ         |
| äº‹åŠ¡è¾¹ç•Œæ¸…æ™°         | âœ… å·²ç¬¦åˆ | æ”¯æŒå¤–éƒ¨äº‹åŠ¡ä¼ å…¥              |
| AssetServiceå‚æ•°å®Œæ•´ | âœ… å·²ç¬¦åˆ | å¼ºåˆ¶business_id/business_type |
| æ•°æ®åº“çº¦æŸ           | âœ… å·²ç¬¦åˆ | å¤–é”®+ç´¢å¼•å®Œå¤‡                 |

### 4. èº«ä»½æƒé™

| æ£€æŸ¥é¡¹        | çŠ¶æ€      | è¯´æ˜                     |
| ------------- | --------- | ------------------------ |
| JWTç²¾ç®€       | âœ… å·²ç¬¦åˆ | æ— is_adminå­—æ®µ           |
| å®æ—¶æƒé™æŸ¥è¯¢  | âœ… å·²ç¬¦åˆ | getUserRoles()æ•°æ®åº“æŸ¥è¯¢ |
| WebSocketé‰´æƒ | âœ… å·²ç¬¦åˆ | æ¡æ‰‹é˜¶æ®µJWTéªŒè¯          |

### 5. æ—¶é—´å¤„ç†

| æ£€æŸ¥é¡¹       | çŠ¶æ€      | è¯´æ˜               |
| ------------ | --------- | ------------------ |
| ç»Ÿä¸€åŒ—äº¬æ—¶é—´ | âœ… å·²ç¬¦åˆ | TZ=Asia/Shanghai   |
| æ•°æ®åº“æ—¶åŒº   | âœ… å·²ç¬¦åˆ | timezone: '+08:00' |
| APIæ—¶é—´æ ¼å¼  | âœ… å·²ç¬¦åˆ | ISO8601 +08:00åç¼€ |

### 6. ä»£ç è´¨é‡

| æ£€æŸ¥é¡¹       | çŠ¶æ€      | è¯´æ˜               |
| ------------ | --------- | ------------------ |
| ç»“æ„åŒ–æ—¥å¿—   | âœ… å·²ç¬¦åˆ | Winston loggerå®ç° |
| é”™è¯¯æŠ›å‡ºæ¨¡å¼ | âœ… å·²ç¬¦åˆ | throw new Error()  |
| æ— N+1æŸ¥è¯¢    | âœ… å·²ç¬¦åˆ | æœªå‘ç°å¾ªç¯æŸ¥è¯¢     |

### 7. é…ç½®ç®¡ç†

| æ£€æŸ¥é¡¹   | çŠ¶æ€      | è¯´æ˜                 |
| -------- | --------- | -------------------- |
| å¯åŠ¨æ ¡éªŒ | âœ… å·²ç¬¦åˆ | validateConfig()æ‰§è¡Œ |
| å¥åº·æ£€æŸ¥ | âœ… å·²ç¬¦åˆ | çœŸå®æ£€æŸ¥DB+Redis     |

---

## âŒ å¾…ä¿®å¤é—®é¢˜è¯¦æƒ…

### P0-1: ğŸš¨ å‘½åæ··æ·†é—®é¢˜ï¼ˆæ¶æ„çº§åˆ«ï¼‰

**é—®é¢˜ä¸¥é‡æ€§**: P0 - å½±å“ä»£ç å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œ

#### å½“å‰å‘½åç°çŠ¶

**ä¸‰å¥—"å¸‚åœº"ç›¸å…³åŠŸèƒ½ï¼Œå‘½åæ··ä¹±ï¼š**

| ä¸šåŠ¡åŠŸèƒ½    | APIè·¯ç”±                      | è·¯ç”±æ–‡ä»¶                        | Service                  | Model                                    | è¡¨å                                          |
| ----------- | ---------------------------- | ------------------------------- | ------------------------ | ---------------------------------------- | --------------------------------------------- |
| B2Cå…‘æ¢å¸‚åœº | `/api/v4/market/*`           | `market/exchange_market.js`     | `ExchangeMarketService`  | `ExchangeItem`<br>`ExchangeMarketRecord` | `exchange_items`<br>`exchange_market_records` |
| C2Cäº¤æ˜“å¸‚åœº | `/api/v4/inventory/market/*` | `inventory/inventory-market.js` | `TradeOrderService`      | `MarketListing`<br>`TradeOrder`          | `market_listings`<br>`trade_orders`           |
| æ ¸é”€ç³»ç»Ÿ    | `/api/v4/shop/redemption/*`  | `shop/redemption.js`            | `RedemptionOrderService` | `RedemptionOrder`                        | `redemption_orders`                           |

#### æ ¸å¿ƒé—®é¢˜åˆ†æ

**é—®é¢˜1: è·¯ç”±è·¯å¾„ vs æ–‡ä»¶åä¸ä¸€è‡´**

```
è·¯ç”±: /api/v4/market/*
æ–‡ä»¶: routes/v4/market/exchange_market.js
é—®é¢˜: è·¯ç”±å«"market"ï¼Œæ–‡ä»¶å«"exchange_market"ï¼Œå“ªä¸ªæ‰æ˜¯æ­£ç¡®çš„ï¼Ÿ
```

**é—®é¢˜2: ä¸¤ä¸ª"market"å«ä¹‰å®Œå…¨ä¸åŒ**

```
/api/v4/market/*           â†’ B2Cå…‘æ¢ï¼ˆå¹³å°â†’ç”¨æˆ·ï¼Œç”¨ææ–™æ¢å•†å“ï¼‰
/api/v4/inventory/market/* â†’ C2Cäº¤æ˜“ï¼ˆç”¨æˆ·â†’ç”¨æˆ·ï¼Œç”¨DIAMONDä¹°å–ï¼‰

å¤–éƒ¨è°ƒç”¨è€…æ— æ³•åŒºåˆ†ï¼šéƒ½å«"market"ï¼Œä½†ä¸šåŠ¡å®Œå…¨ä¸åŒï¼
```

**é—®é¢˜3: æ¨¡å‹å‘½å vs è·¯ç”±ä¸ä¸€è‡´**

```
ExchangeMarketRecord æ¨¡å‹ â†’ ç”¨äº /api/v4/market/ è·¯ç”±ï¼ˆè·¯ç”±ä¸å«exchangeï¼‰
MarketListing æ¨¡å‹ â†’ ç”¨äº /api/v4/inventory/market/ è·¯ç”±ï¼ˆæ¨¡å‹å«marketï¼‰
TradeOrder æ¨¡å‹ â†’ ç”¨äº /api/v4/inventory/market/ è·¯ç”±ï¼ˆæ¨¡å‹å«tradeï¼‰
```

**é—®é¢˜4: æœåŠ¡å‘½åæ··ä¹±**

```
ExchangeMarketService â†’ æœåŠ¡B2Cå…‘æ¢ï¼ˆæ–‡ä»¶1241è¡Œï¼Œä¹Ÿè¶…æ ‡ï¼‰
TradeOrderService â†’ æœåŠ¡C2Cäº¤æ˜“ï¼ˆä½†è·¯ç”±å«marketä¸å«tradeï¼‰
```

#### ä¸šåŠ¡è¯­ä¹‰å¯¹ç…§è¡¨

| ä¸­æ–‡æ¦‚å¿µ        | è‹±æ–‡æœ¯è¯­            | å½“å‰ä»£ç ä½¿ç”¨                                  | é—®é¢˜                 |
| --------------- | ------------------- | --------------------------------------------- | -------------------- |
| å…‘æ¢å¸‚åœºï¼ˆB2Cï¼‰ | Exchange            | `ExchangeMarketService`ã€`exchange_items`     | âœ… ä¸€è‡´              |
| äº¤æ˜“å¸‚åœºï¼ˆC2Cï¼‰ | Trade / Marketplace | `TradeOrderService`ã€`market_listings`        | âŒ æ··ç”¨tradeå’Œmarket |
| æ ¸é”€            | Redemption          | `RedemptionOrderService`ã€`redemption_orders` | âœ… ä¸€è‡´              |

#### å»ºè®®ä¿®å¤æ–¹æ¡ˆ

**æ–¹æ¡ˆA: ç»Ÿä¸€ä½¿ç”¨ä¸šåŠ¡è¯­ä¹‰å‘½åï¼ˆæ¨èï¼‰**

```
å½“å‰                              â†’  å»ºè®®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/api/v4/market/*                  â†’  /api/v4/exchange/*     (B2Cå…‘æ¢)
market/exchange_market.js         â†’  exchange/items.js
ExchangeMarketService             â†’  ExchangeService

/api/v4/inventory/market/*        â†’  /api/v4/trade/*        (C2Cäº¤æ˜“)
inventory/inventory-market.js     â†’  trade/listings.js
TradeOrderService                 â†’  TradeService

/api/v4/shop/redemption/*         â†’  ä¿æŒä¸å˜              (æ ¸é”€)
```

**æ–¹æ¡ˆB: ä¿æŒAPIè·¯å¾„ä¸å˜ï¼Œä»…ç»Ÿä¸€å†…éƒ¨å‘½å**

```
# å¦‚æœAPIè·¯å¾„ä¸èƒ½æ”¹ï¼ˆå‰ç«¯å·²ä¸Šçº¿ï¼‰ï¼Œè‡³å°‘ç»Ÿä¸€å†…éƒ¨å‘½åï¼š

routes/v4/market/exchange_market.js  â†’  routes/v4/market/items.js
routes/v4/inventory/inventory-market.js  â†’  routes/v4/inventory/trade.js
```

#### å½±å“èŒƒå›´è¯„ä¼°

| å±‚çº§   | éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶æ•° | é£é™©ç­‰çº§                  |
| ------ | ---------------- | ------------------------- |
| è·¯ç”±å±‚ | 3ä¸ªç›®å½•          | é«˜ï¼ˆAPIè·¯å¾„å˜åŒ–å½±å“å‰ç«¯ï¼‰ |
| æœåŠ¡å±‚ | 3ä¸ªæœåŠ¡          | ä¸­ï¼ˆå†…éƒ¨é‡æ„ï¼‰            |
| æ¨¡å‹å±‚ | 6ä¸ªæ¨¡å‹          | é«˜ï¼ˆè¡¨åå˜åŒ–éœ€è¦è¿ç§»ï¼‰    |
| æ•°æ®åº“ | 6å¼ è¡¨            | é«˜ï¼ˆéœ€è¦æ•°æ®è¿ç§»ï¼‰        |

**å»ºè®®**: å…ˆç»Ÿä¸€ä»£ç å‘½åè§„èŒƒæ–‡æ¡£ï¼Œæ–°åŠŸèƒ½æŒ‰è§„èŒƒå¼€å‘ï¼Œæ—§åŠŸèƒ½é€æ­¥è¿ç§»ã€‚

---

### P1-1: shop/points.js è¶…å¤§ï¼ˆ1024è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ 150-250è¡Œæ­£å¸¸, >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**:

```
routes/v4/shop/points.js: 1024è¡Œ (è¶…æ ‡3.4å€)
```

**é—®é¢˜åˆ†æ**:

- å¤´éƒ¨æ³¨é‡Šå 80+è¡Œ
- æ··åˆç”¨æˆ·ç«¯APIå’Œç®¡ç†å‘˜API
- åŒ…å«ä½™é¢æŸ¥è¯¢ã€äº¤æ˜“å†å²ã€ç»Ÿè®¡åˆ†æã€ç®¡ç†å‘˜æ“ä½œç­‰å¤šä¸ªåŠŸèƒ½

**å»ºè®®æ‹†åˆ†æ–¹æ¡ˆ**:

```
routes/v4/shop/points/
â”œâ”€â”€ index.js          # èšåˆå…¥å£ (~20è¡Œ)
â”œâ”€â”€ balance.js        # ä½™é¢æŸ¥è¯¢ (~100è¡Œ)
â”œâ”€â”€ transactions.js   # äº¤æ˜“å†å² (~150è¡Œ)
â”œâ”€â”€ statistics.js     # ç»Ÿè®¡åˆ†æ (~150è¡Œ)
â””â”€â”€ admin.js          # ç®¡ç†å‘˜æ“ä½œ (~200è¡Œ)
```

---

### P1-2: shop/consumption.js è¶…å¤§ï¼ˆ851è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ 150-250è¡Œæ­£å¸¸, >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**:

```
routes/v4/shop/consumption.js: 851è¡Œ (è¶…æ ‡2.8å€)
```

**é—®é¢˜åˆ†æ**:

- å•†å®¶æäº¤ã€ç”¨æˆ·æŸ¥è¯¢ã€ç®¡ç†å‘˜å®¡æ ¸æ··åœ¨ä¸€èµ·
- äºŒç»´ç ç”Ÿæˆé€»è¾‘ä¹ŸåŒ…å«åœ¨å†…

**å»ºè®®æ‹†åˆ†æ–¹æ¡ˆ**:

```
routes/v4/shop/consumption/
â”œâ”€â”€ index.js      # èšåˆå…¥å£ (~20è¡Œ)
â”œâ”€â”€ submit.js     # å•†å®¶æäº¤æ¶ˆè´¹ (~200è¡Œ)
â”œâ”€â”€ query.js      # æŸ¥è¯¢æ¶ˆè´¹è®°å½• (~150è¡Œ)
â”œâ”€â”€ review.js     # ç®¡ç†å‘˜å®¡æ ¸ (~200è¡Œ)
â””â”€â”€ qrcode.js     # äºŒç»´ç ç›¸å…³ (~100è¡Œ)
```

---

### P1-3: inventory-market.js è¶…å¤§ï¼ˆ669è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ 150-250è¡Œæ­£å¸¸, >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**:

```
routes/v4/inventory/inventory-market.js: 669è¡Œ (è¶…æ ‡2.2å€)
```

**é—®é¢˜åˆ†æ**:

- å¸‚åœºåˆ—è¡¨ã€ä¸Šæ¶ã€è´­ä¹°ã€æ’¤å›ç­‰åŠŸèƒ½æ··åˆ
- 2025-12-21åˆšé‡æ„è¿‡ï¼Œä½†æœªæ‹†åˆ†

**å»ºè®®æ‹†åˆ†æ–¹æ¡ˆ**:

```
routes/v4/inventory/market/
â”œâ”€â”€ index.js       # èšåˆå…¥å£ (~20è¡Œ)
â”œâ”€â”€ listings.js    # å¸‚åœºåˆ—è¡¨æŸ¥è¯¢ (~150è¡Œ)
â”œâ”€â”€ sell.js        # ä¸Šæ¶å•†å“ (~200è¡Œ)
â”œâ”€â”€ buy.js         # è´­ä¹°å•†å“ (~200è¡Œ)
â””â”€â”€ manage.js      # æ’¤å›/ç®¡ç† (~100è¡Œ)
```

---

### P1-4: æµ‹è¯•ä½¿ç”¨axiosè€Œésupertest

**è¿åæ ‡å‡†**: æµ‹è¯•ç­–ç•¥ - å¿…é¡»ä½¿ç”¨supertest + in-process

**å½“å‰çŠ¶æ€**:

```javascript
// tests/api/core/base_test_manager.js
const axios = require('axios')
this.client = axios.create({ baseURL: this.baseURL })
```

**é—®é¢˜åˆ†æ**:

- axioså‘èµ·çœŸå®HTTPè¯·æ±‚åˆ°å¤–éƒ¨ç«¯å£
- ä¸æ˜¯in-processæµ‹è¯•ï¼Œä¾èµ–æœåŠ¡å®é™…è¿è¡Œ
- æ— æ³•åˆ©ç”¨supertestçš„æ–­è¨€èƒ½åŠ›

**å»ºè®®ä¿®å¤**:

```javascript
// æ”¹ä¸ºsupertest
const request = require('supertest')
const app = require('../../../app')

// æµ‹è¯•ä¸­ä½¿ç”¨
const response = await request(app).get('/api/v4/health')
```

---

### P1-5: market/exchange_market.js è¶…å¤§ï¼ˆ530è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ 150-250è¡Œæ­£å¸¸, >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**:

```
routes/v4/market/exchange_market.js: 530è¡Œ (è¶…æ ‡1.8å€)
```

**é—®é¢˜åˆ†æ**:

- å•†å“åˆ—è¡¨ã€å•†å“è¯¦æƒ…ã€å…‘æ¢ã€è®¢å•æŸ¥è¯¢æ··åœ¨ä¸€èµ·
- ç®¡ç†å‘˜æ¥å£å’Œç”¨æˆ·æ¥å£æ··åˆ

**å»ºè®®æ‹†åˆ†æ–¹æ¡ˆ**:

```
routes/v4/market/  (æˆ–æ”¹ä¸º routes/v4/exchange/)
â”œâ”€â”€ index.js       # èšåˆå…¥å£ (~20è¡Œ)
â”œâ”€â”€ items.js       # å•†å“åˆ—è¡¨/è¯¦æƒ… (~150è¡Œ)
â”œâ”€â”€ exchange.js    # å…‘æ¢æ“ä½œ (~200è¡Œ)
â””â”€â”€ orders.js      # è®¢å•æŸ¥è¯¢ (~150è¡Œ)
```

---

### P2-1: shop/assets.js è¶…å¤§ï¼ˆ498è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**: 498è¡Œ (è¶…æ ‡1.6å€)

**å»ºè®®**: æ‹†åˆ†ä¸º `assets-query.js` + `assets-manage.js`

---

### P2-2: shop/redemption.js è¶…å¤§ï¼ˆ451è¡Œï¼‰

**è¿åæ ‡å‡†**: Controlleræ–‡ä»¶å¤§å°é™åˆ¶ >300è¡Œå¿…é¡»æ‹†åˆ†

**å½“å‰çŠ¶æ€**: 451è¡Œ (è¶…æ ‡1.5å€)

**å»ºè®®**: æ‹†åˆ†ä¸º `redemption-use.js` + `redemption-admin.js`

---

### P2-3: é‡å¤è·¯ç”±æ–‡ä»¶

**è¿åæ ‡å‡†**: é›¶å…¼å®¹åŸåˆ™ - ç¦æ­¢ä¿ç•™æ—§æ–‡ä»¶

**å½“å‰çŠ¶æ€**:

```bash
# ä¸¤ä¸ªæ–‡ä»¶å†…å®¹ä¸åŒï¼Œä½†åªæœ‰ä¸€ä¸ªè¢«ä½¿ç”¨
routes/v4/admin/lottery_management.js  # âœ… è¢«index.jså¼•ç”¨
routes/v4/admin/lottery-management.js  # âŒ æœªè¢«å¼•ç”¨ï¼Œåº”åˆ é™¤
```

**MD5æ ¡éªŒ**:

```
f673d692c81326d2ff65dcb2a5fb79ef  lottery_management.js (ä½¿ç”¨ä¸­)
87278dd1fe2ce92d73404ee97e5b54f6  lottery-management.js (åº”åˆ é™¤)
```

**å»ºè®®**: ç›´æ¥åˆ é™¤ `lottery-management.js`

---

### P3-1: åŸºç¡€è®¾æ–½ä»£ç ä½¿ç”¨console

**è¿åæ ‡å‡†**: ç¦æ­¢åœ¨æœåŠ¡ä»£ç ä¸­ä½¿ç”¨console.\*

**å½“å‰çŠ¶æ€**:

- `utils/UnifiedRedisClient.js`: 9å¤„consoleè°ƒç”¨
- `utils/ApiResponse.js`: 1å¤„console.error
- å…¶ä»–utilsæ–‡ä»¶: çº¦10å¤„

**ç¬¦åˆä¾‹å¤–æ¡ä»¶**: æ ‡å‡†å…è®¸"å¯åŠ¨é˜¶æ®µ"å’Œ"ç´§æ€¥é™çº§åœºæ™¯"ä½¿ç”¨console

**å»ºè®®**: ä½ä¼˜å…ˆçº§æ”¹è¿›ï¼Œå¯ç»Ÿä¸€ä½¿ç”¨loggeræˆ–æ·»åŠ `[Infrastructure]`å‰ç¼€

---

## ğŸ“Š ç¬¦åˆæ€§è¯„åˆ†

| ç±»åˆ«       | ç¬¦åˆé¡¹ | é—®é¢˜é¡¹ | ç¬¦åˆç‡  |
| ---------- | ------ | ------ | ------- |
| é›¶å…¼å®¹åŸåˆ™ | 2      | 1      | 67%     |
| APIæ¶æ„    | 4      | 1      | 80%     |
| ç›®å½•ç»“æ„   | 0      | 7      | 0%      |
| æµ‹è¯•ç­–ç•¥   | 0      | 1      | 0%      |
| èµ„äº§äº¤æ˜“   | 4      | 0      | 100%    |
| èº«ä»½æƒé™   | 3      | 0      | 100%    |
| æ—¶é—´å¤„ç†   | 3      | 0      | 100%    |
| ä»£ç è´¨é‡   | 3      | 1      | 75%     |
| é…ç½®ç®¡ç†   | 2      | 0      | 100%    |
| **æ€»è®¡**   | **21** | **11** | **66%** |

---

## ğŸ”§ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ç´§æ€¥ä¿®å¤ï¼ˆP0ï¼‰- æ¶æ„çº§é—®é¢˜

0. [ ] ğŸ“Œ è§£å†³å‘½åæ··æ·†ï¼šåˆ¶å®šexchange/trade/redemptionå‘½åè§„èŒƒ

### ç«‹å³ä¿®å¤ï¼ˆP1ï¼‰- å½±å“æ¶æ„è§„èŒƒ

1. [ ] æ‹†åˆ† `shop/points.js` (1024è¡Œ)
2. [ ] æ‹†åˆ† `shop/consumption.js` (851è¡Œ)
3. [ ] æ‹†åˆ† `inventory-market.js` (669è¡Œ)
4. [ ] æ‹†åˆ† `market/exchange_market.js` (530è¡Œ)
5. [ ] é‡æ„æµ‹è¯•åŸºç±»ä½¿ç”¨supertest

### è¿‘æœŸä¿®å¤ï¼ˆP2ï¼‰- å½±å“ä»£ç è´¨é‡

6. [ ] æ‹†åˆ† `shop/assets.js` (498è¡Œ)
7. [ ] æ‹†åˆ† `shop/redemption.js` (451è¡Œ)
8. [ ] åˆ é™¤ `lottery-management.js` é‡å¤æ–‡ä»¶

### åç»­æ”¹è¿›ï¼ˆP3ï¼‰- å¯é€‰ä¼˜åŒ–

9. [ ] åŸºç¡€è®¾æ–½ä»£ç ç»Ÿä¸€ä½¿ç”¨logger

---

## ğŸ“ ä¿®å¤è¿›åº¦è·Ÿè¸ª

| æ—¥æœŸ       | é—®é¢˜ID | æ“ä½œ         | æ“ä½œäºº   |
| ---------- | ------ | ------------ | -------- |
| 2025-12-22 | -      | åˆ›å»ºé—®é¢˜æ¸…å• | ç³»ç»Ÿå®¡æŸ¥ |
|            |        |              |          |

---

_æœ¬æ–‡æ¡£åŸºäºå½“å‰ä»£ç çŠ¶æ€ç”Ÿæˆï¼Œéœ€æŒç»­æ›´æ–°ä¿®å¤è¿›åº¦_
