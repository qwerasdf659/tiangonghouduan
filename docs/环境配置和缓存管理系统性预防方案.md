# ç¯å¢ƒé…ç½®å’Œç¼“å­˜ç®¡ç†ç³»ç»Ÿæ€§é¢„é˜²æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¶é—´**: 2025-11-23  
**é¡¹ç›®**: Restaurant Lottery System V4  
**é—®é¢˜ç±»å‹**: å‰ç«¯æµè§ˆå™¨ç¼“å­˜æ—§ç‰ˆæœ¬ä»£ç å¯¼è‡´503é”™è¯¯

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜ä¸æ ¹æœ¬åŸå› ](#é—®é¢˜ä¸æ ¹æœ¬åŸå› )
2. [ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ](#ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ)
3. [ç¯å¢ƒé…ç½®æ ‡å‡†åŒ–](#ç¯å¢ƒé…ç½®æ ‡å‡†åŒ–)
4. [ç¼“å­˜ç­–ç•¥ç®¡ç†](#ç¼“å­˜ç­–ç•¥ç®¡ç†)
5. [é¢„é˜²æœºåˆ¶å››å±‚ä½“ç³»](#é¢„é˜²æœºåˆ¶å››å±‚ä½“ç³»)
6. [å®æ–½æ£€æŸ¥æ¸…å•](#å®æ–½æ£€æŸ¥æ¸…å•)
7. [é…ç½®ç®¡ç†æœ€ä½³å®è·µ](#é…ç½®ç®¡ç†æœ€ä½³å®è·µ)

---

## ğŸ¯ é—®é¢˜ä¸æ ¹æœ¬åŸå› 

### é‡åˆ°çš„é—®é¢˜

**é—®é¢˜è¡¨ç°**:
```
âŒ æµè§ˆå™¨æ˜¾ç¤ºï¼šHTTP 503é”™è¯¯
   GET https://omqktqrtntnn.sealosbja.site/api/system/dashboard 503
   
   é”™è¯¯ä¿¡æ¯ï¼š
   - upstream connect error or disconnect/reset before headers
   - remote connection failure, transport failure reason: delayed connect error: 111
```

**ç”¨æˆ·å½±å“**:
- Webç®¡ç†åå°dashboardé¡µé¢æ— æ³•åŠ è½½æ•°æ®
- å‰ç«¯æ˜¾ç¤ºç©ºç™½æ•°æ®ï¼ˆæ€»ç”¨æˆ·æ•°: --ï¼Œä»Šæ—¥æŠ½å¥–: ä¸­å¥–--ï¼‰
- æµè§ˆå™¨Consoleæ˜¾ç¤ºAPIè¯·æ±‚å¤±è´¥

### æ ¹æœ¬åŸå› åˆ†æ

#### ç›´æ¥åŸå› 
```
æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„å‰ç«¯ä»£ç 
   â†“
å‰ç«¯ä»£ç ä½¿ç”¨æ—§çš„APIè·¯å¾„: /api/system/dashboard
   â†“
åç«¯å®é™…APIè·¯å¾„: /api/v4/admin/system/dashboard
   â†“
è·¯å¾„ä¸åŒ¹é…å¯¼è‡´503é”™è¯¯
```

#### æ·±å±‚åŸå› 

| å±‚é¢ | é—®é¢˜ | å½±å“ |
|------|------|------|
| **é…ç½®å±‚é¢** | app.jsé™æ€æ–‡ä»¶é…ç½®è®¾ç½®`maxAge: '1h'` | å¼€å‘ç¯å¢ƒä¹Ÿç¼“å­˜1å°æ—¶ |
| **ç¯å¢ƒå±‚é¢** | æœªåŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ç¼“å­˜ç­–ç•¥ | å¼€å‘æ—¶ä»£ç æ›´æ–°ä½†æµè§ˆå™¨ä»ä½¿ç”¨ç¼“å­˜ |
| **æ¶æ„å±‚é¢** | ç¼ºä¹ç¯å¢ƒæ„ŸçŸ¥çš„é…ç½®ç®¡ç†æœºåˆ¶ | æ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒé…ç½® |
| **æµç¨‹å±‚é¢** | ä»£ç æ›´æ–°åæœªæ¸…ç†æµè§ˆå™¨ç¼“å­˜ | ç”¨æˆ·ç»§ç»­ä½¿ç”¨æ—§ç‰ˆæœ¬ä»£ç  |
| **ç›‘æ§å±‚é¢** | æ²¡æœ‰ç¼“å­˜é—®é¢˜çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ | æ— æ³•åŠæ—¶å‘ç°å’Œå®šä½é—®é¢˜ |

### é—®é¢˜ä»£ç å¯¹æ¯”

**ğŸ”´ é—®é¢˜ä»£ç ï¼ˆä¿®å¤å‰ï¼‰**:
```javascript
// app.js - ç¬¬439-446è¡Œ
app.use('/admin', express.static(path.join(__dirname, 'public/admin'), {
  index: false,
  maxAge: '1h',                    // âŒ æ‰€æœ‰ç¯å¢ƒéƒ½ç¼“å­˜1å°æ—¶
  etag: true,                      // âŒ æ‰€æœ‰ç¯å¢ƒéƒ½å¯ç”¨ETag
  lastModified: true,
  dotfiles: 'ignore',
  redirect: false
}))
```

**å“åº”å¤´ï¼ˆå¼€å‘ç¯å¢ƒï¼‰**:
```http
HTTP/1.1 200 OK
Cache-Control: public, max-age=3600    âŒ ç¼“å­˜1å°æ—¶
ETag: W/"5f4-18c4e1234"                âŒ å¯ç”¨ETag
Last-Modified: Sat, 23 Nov 2025 14:00:00 GMT
```

**ç»“æœ**:
- âŒ ä»£ç æ›´æ–°åï¼Œæµè§ˆå™¨ä»ä½¿ç”¨ç¼“å­˜çš„æ—§ç‰ˆæœ¬
- âŒ å‰ç«¯APIè·¯å¾„æœªæ›´æ–°ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥
- âŒ ç”¨æˆ·éœ€è¦æ‰‹åŠ¨æ¸…ç†ç¼“å­˜æ‰èƒ½çœ‹åˆ°æ–°ç‰ˆæœ¬

**âœ… ä¿®å¤ä»£ç ï¼ˆä¿®å¤åï¼‰**:
```javascript
// app.js - ç¬¬439-454è¡Œ
app.use('/admin', express.static(path.join(__dirname, 'public/admin'), {
  index: false,
  // âœ… å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜ï¼Œç”Ÿäº§ç¯å¢ƒç¼“å­˜1å°æ—¶
  maxAge: process.env.NODE_ENV === 'production' ? '1h' : 0,
  // âœ… ç”Ÿäº§ç¯å¢ƒå¯ç”¨ETagç¼“å­˜
  etag: process.env.NODE_ENV === 'production',
  lastModified: true,
  dotfiles: 'ignore',
  redirect: false,
  // âœ… å¼€å‘ç¯å¢ƒå¼ºåˆ¶ä¸ç¼“å­˜
  setHeaders: (res, _filePath) => {
    if (process.env.NODE_ENV !== 'production') {
      res.set('Cache-Control', 'no-cache, no-store, must-revalidate')
      res.set('Pragma', 'no-cache')
      res.set('Expires', '0')
    }
  }
}))
```

**å“åº”å¤´ï¼ˆå¼€å‘ç¯å¢ƒï¼‰**:
```http
HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, must-revalidate    âœ… ç¦ç”¨ç¼“å­˜
Pragma: no-cache                                       âœ… å…¼å®¹æ—§æµè§ˆå™¨
Expires: 0                                             âœ… ç«‹å³è¿‡æœŸ
Last-Modified: Sat, 23 Nov 2025 14:00:00 GMT
```

**ç»“æœ**:
- âœ… ä»£ç æ›´æ–°åï¼Œæµè§ˆå™¨ç«‹å³è·å–æœ€æ–°ç‰ˆæœ¬
- âœ… å‰ç«¯å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„APIè·¯å¾„
- âœ… æ— éœ€æ‰‹åŠ¨æ¸…ç†ç¼“å­˜

---

## ğŸ”§ ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒç†å¿µï¼šç¯å¢ƒæ„ŸçŸ¥é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç¯å¢ƒæ„ŸçŸ¥é…ç½®ç®¡ç†                       â”‚
â”‚                                                 â”‚
â”‚  Development  â†’  æ— ç¼“å­˜ã€å¿«é€Ÿè¿­ä»£               â”‚
â”‚  Staging      â†’  çŸ­ç¼“å­˜ã€æµ‹è¯•éªŒè¯               â”‚
â”‚  Production   â†’  é•¿ç¼“å­˜ã€æ€§èƒ½ä¼˜åŒ–               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§£å†³æ–¹æ¡ˆæ¶æ„

```
                 é—®é¢˜é¢„é˜²ä½“ç³»
                      â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚               â”‚               â”‚
   è§„èŒƒå±‚          å·¥å…·å±‚          æµç¨‹å±‚
      â”‚               â”‚               â”‚
      â”œâ”€ é…ç½®æ ‡å‡†    â”œâ”€ è‡ªåŠ¨æ£€æŸ¥    â”œâ”€ å¼€å‘æµç¨‹
      â”œâ”€ å‘½åè§„èŒƒ    â”œâ”€ é…ç½®éªŒè¯    â”œâ”€ Code Review
      â”œâ”€ æœ€ä½³å®è·µ    â”œâ”€ ç¼“å­˜ç›‘æ§    â”œâ”€ æµ‹è¯•éªŒè¯
      â””â”€ æ–‡æ¡£æ¨¡æ¿    â””â”€ å‘Šè­¦ç³»ç»Ÿ    â””â”€ éƒ¨ç½²æ£€æŸ¥
```

---

## ğŸŒ ç¯å¢ƒé…ç½®æ ‡å‡†åŒ–

### 1. ç¯å¢ƒå®šä¹‰å’Œåˆ†ç±»

```javascript
/**
 * æ ‡å‡†ç¯å¢ƒåˆ†ç±»
 */
const ENVIRONMENTS = {
  // å¼€å‘ç¯å¢ƒ - æœ¬åœ°å¼€å‘ã€DevBox
  development: {
    description: 'æœ¬åœ°å¼€å‘ç¯å¢ƒ',
    cache: {
      enabled: false,              // ç¦ç”¨æ‰€æœ‰ç¼“å­˜
      maxAge: 0,
      etag: false
    },
    features: {
      hotReload: true,             // å¯ç”¨çƒ­æ›´æ–°
      debugging: true,             // å¯ç”¨è°ƒè¯•
      errorDetails: true           // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯
    }
  },

  // æµ‹è¯•ç¯å¢ƒ - é›†æˆæµ‹è¯•ã€é¢„å‘å¸ƒ
  staging: {
    description: 'æµ‹è¯•/é¢„å‘å¸ƒç¯å¢ƒ',
    cache: {
      enabled: true,
      maxAge: '5m',                // 5åˆ†é’ŸçŸ­ç¼“å­˜
      etag: true
    },
    features: {
      hotReload: false,
      debugging: true,             // ä¿ç•™è°ƒè¯•èƒ½åŠ›
      errorDetails: true
    }
  },

  // ç”Ÿäº§ç¯å¢ƒ - æ­£å¼å¯¹å¤–æœåŠ¡
  production: {
    description: 'ç”Ÿäº§ç¯å¢ƒ',
    cache: {
      enabled: true,
      maxAge: '1h',                // 1å°æ—¶é•¿ç¼“å­˜
      etag: true
    },
    features: {
      hotReload: false,
      debugging: false,            // å…³é—­è°ƒè¯•
      errorDetails: false          // éšè—è¯¦ç»†é”™è¯¯
    }
  }
}
```

### 2. ç¯å¢ƒå˜é‡é…ç½®æ ‡å‡†

**`.env`æ–‡ä»¶ç»“æ„**:
```bash
# ============================================
# åŸºç¡€ç¯å¢ƒé…ç½®
# ============================================
NODE_ENV=development                    # development | staging | production
PORT=3000

# ============================================
# é™æ€æ–‡ä»¶ç¼“å­˜é…ç½®ï¼ˆæ ¹æ®ç¯å¢ƒè‡ªåŠ¨è°ƒæ•´ï¼‰
# ============================================
# å¼€å‘ç¯å¢ƒ: æ— ç¼“å­˜
# æµ‹è¯•ç¯å¢ƒ: 5åˆ†é’Ÿç¼“å­˜
# ç”Ÿäº§ç¯å¢ƒ: 1å°æ—¶ç¼“å­˜
STATIC_CACHE_ENABLED=auto              # auto | true | false
STATIC_CACHE_MAX_AGE=auto              # auto | 0 | 5m | 1h

# ============================================
# APIé…ç½®
# ============================================
API_BASE_URL=/api/v4
API_TIMEOUT=30000

# ============================================
# æ•°æ®åº“é…ç½®
# ============================================
DB_HOST=dbconn.sealosbja.site
DB_PORT=42569
DB_NAME=restaurant_points_dev
DB_USER=root
DB_PASSWORD=your_password

# ============================================
# Redisé…ç½®
# ============================================
REDIS_URL=redis://localhost:6379
REDIS_TTL=3600

# ============================================
# ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®
# ============================================
SEALOS_ACCESS_KEY=your_access_key
SEALOS_SECRET_KEY=your_secret_key
```

### 3. é…ç½®åŠ è½½å’ŒéªŒè¯

**`config/environment.js`** - ç¯å¢ƒé…ç½®ç®¡ç†å™¨:
```javascript
/**
 * ç¯å¢ƒé…ç½®ç®¡ç†å™¨
 * 
 * @description ç»Ÿä¸€ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ï¼Œæä¾›ç¯å¢ƒæ„ŸçŸ¥èƒ½åŠ›
 * @file config/environment.js
 */

const path = require('path')
require('dotenv').config()

/**
 * å½“å‰ç¯å¢ƒ
 */
const NODE_ENV = process.env.NODE_ENV || 'development'

/**
 * ç¯å¢ƒé…ç½®æ˜ å°„
 */
const ENV_CONFIG = {
  development: {
    name: 'development',
    displayName: 'å¼€å‘ç¯å¢ƒ',
    cache: {
      static: {
        enabled: false,
        maxAge: 0,
        etag: false
      },
      api: {
        enabled: true,
        ttl: 300  // 5åˆ†é’Ÿ
      }
    },
    debug: true,
    verbose: true
  },

  staging: {
    name: 'staging',
    displayName: 'æµ‹è¯•ç¯å¢ƒ',
    cache: {
      static: {
        enabled: true,
        maxAge: '5m',
        etag: true
      },
      api: {
        enabled: true,
        ttl: 600  // 10åˆ†é’Ÿ
      }
    },
    debug: true,
    verbose: false
  },

  production: {
    name: 'production',
    displayName: 'ç”Ÿäº§ç¯å¢ƒ',
    cache: {
      static: {
        enabled: true,
        maxAge: '1h',
        etag: true
      },
      api: {
        enabled: true,
        ttl: 3600  // 1å°æ—¶
      }
    },
    debug: false,
    verbose: false
  }
}

/**
 * è·å–å½“å‰ç¯å¢ƒé…ç½®
 */
function getCurrentConfig() {
  const config = ENV_CONFIG[NODE_ENV]
  
  if (!config) {
    console.warn(`âš ï¸ æœªçŸ¥ç¯å¢ƒ: ${NODE_ENV}ï¼Œä½¿ç”¨developmenté…ç½®`)
    return ENV_CONFIG.development
  }
  
  return config
}

/**
 * éªŒè¯ç¯å¢ƒé…ç½®
 */
function validateConfig() {
  const required = [
    'NODE_ENV',
    'PORT',
    'DB_HOST',
    'DB_PORT',
    'DB_NAME',
    'REDIS_URL'
  ]
  
  const missing = required.filter(key => !process.env[key])
  
  if (missing.length > 0) {
    console.error('âŒ ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡:')
    missing.forEach(key => console.error(`   - ${key}`))
    process.exit(1)
  }
  
  console.log(`âœ… ç¯å¢ƒé…ç½®éªŒè¯é€šè¿‡: ${getCurrentConfig().displayName}`)
}

/**
 * è·å–é™æ€æ–‡ä»¶ç¼“å­˜é…ç½®ï¼ˆexpress.static optionsï¼‰
 */
function getStaticCacheConfig() {
  const config = getCurrentConfig()
  const staticConfig = config.cache.static
  
  return {
    index: false,
    maxAge: staticConfig.enabled ? staticConfig.maxAge : 0,
    etag: staticConfig.enabled ? staticConfig.etag : false,
    lastModified: true,
    dotfiles: 'ignore',
    redirect: false,
    setHeaders: (res, filePath) => {
      // å¼€å‘ç¯å¢ƒå¼ºåˆ¶ç¦ç”¨ç¼“å­˜
      if (!staticConfig.enabled) {
        res.set('Cache-Control', 'no-cache, no-store, must-revalidate')
        res.set('Pragma', 'no-cache')
        res.set('Expires', '0')
      }
      
      // ç”Ÿäº§ç¯å¢ƒå¯¹ä¸åŒæ–‡ä»¶ç±»å‹è®¾ç½®ä¸åŒç¼“å­˜ç­–ç•¥
      if (NODE_ENV === 'production') {
        const ext = path.extname(filePath)
        
        // HTMLæ–‡ä»¶ï¼šçŸ­ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
        if (ext === '.html') {
          res.set('Cache-Control', 'public, max-age=300')
        }
        // CSS/JSæ–‡ä»¶ï¼šé•¿ç¼“å­˜ï¼ˆ1å°æ—¶ï¼‰
        else if (ext === '.css' || ext === '.js') {
          res.set('Cache-Control', 'public, max-age=3600')
        }
        // å›¾ç‰‡æ–‡ä»¶ï¼šè¶…é•¿ç¼“å­˜ï¼ˆ1å¤©ï¼‰
        else if (['.jpg', '.jpeg', '.png', '.gif', '.svg', '.ico'].includes(ext)) {
          res.set('Cache-Control', 'public, max-age=86400')
        }
      }
    }
  }
}

/**
 * æ‰“å°ç¯å¢ƒé…ç½®ä¿¡æ¯
 */
function printConfig() {
  const config = getCurrentConfig()
  
  console.log('\n' + '='.repeat(50))
  console.log(`  ç¯å¢ƒé…ç½®ä¿¡æ¯`)
  console.log('='.repeat(50))
  console.log(`ç¯å¢ƒ: ${config.displayName} (${config.name})`)
  console.log(`ç«¯å£: ${process.env.PORT}`)
  console.log(`é™æ€æ–‡ä»¶ç¼“å­˜: ${config.cache.static.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`)
  
  if (config.cache.static.enabled) {
    console.log(`  - ç¼“å­˜æ—¶é•¿: ${config.cache.static.maxAge}`)
    console.log(`  - ETag: ${config.cache.static.etag ? 'å¯ç”¨' : 'ç¦ç”¨'}`)
  } else {
    console.log(`  - Cache-Control: no-cache, no-store, must-revalidate`)
  }
  
  console.log(`APIç¼“å­˜TTL: ${config.cache.api.ttl}ç§’`)
  console.log(`è°ƒè¯•æ¨¡å¼: ${config.debug ? 'å¯ç”¨' : 'ç¦ç”¨'}`)
  console.log('='.repeat(50) + '\n')
}

module.exports = {
  NODE_ENV,
  ENV_CONFIG,
  getCurrentConfig,
  validateConfig,
  getStaticCacheConfig,
  printConfig,
  
  // ä¾¿æ·æ–¹æ³•
  isDevelopment: () => NODE_ENV === 'development',
  isStaging: () => NODE_ENV === 'staging',
  isProduction: () => NODE_ENV === 'production'
}
```

---

## ğŸ¯ ç¼“å­˜ç­–ç•¥ç®¡ç†

### 1. åˆ†å±‚ç¼“å­˜ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é™æ€æ–‡ä»¶ç¼“å­˜ç­–ç•¥                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ç±»å‹    â”‚ å¼€å‘ç¯å¢ƒ  â”‚ æµ‹è¯•ç¯å¢ƒ  â”‚ ç”Ÿäº§ç¯å¢ƒ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HTMLæ–‡ä»¶    â”‚ 0ç§’      â”‚ 5åˆ†é’Ÿ     â”‚ 5åˆ†é’Ÿ    â”‚
â”‚ CSS/JSæ–‡ä»¶  â”‚ 0ç§’      â”‚ 5åˆ†é’Ÿ     â”‚ 1å°æ—¶    â”‚
â”‚ å›¾ç‰‡æ–‡ä»¶    â”‚ 0ç§’      â”‚ 5åˆ†é’Ÿ     â”‚ 1å¤©      â”‚
â”‚ å­—ä½“æ–‡ä»¶    â”‚ 0ç§’      â”‚ 5åˆ†é’Ÿ     â”‚ 7å¤©      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç¼“å­˜æ§åˆ¶å“åº”å¤´æ ‡å‡†

**å¼€å‘ç¯å¢ƒï¼ˆç¦ç”¨ç¼“å­˜ï¼‰**:
```http
Cache-Control: no-cache, no-store, must-revalidate
Pragma: no-cache
Expires: 0
```

**æµ‹è¯•ç¯å¢ƒï¼ˆçŸ­ç¼“å­˜ï¼‰**:
```http
Cache-Control: public, max-age=300
ETag: W/"5f4-18c4e1234"
Last-Modified: Sat, 23 Nov 2025 14:00:00 GMT
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆé•¿ç¼“å­˜ï¼‰**:
```http
Cache-Control: public, max-age=3600
ETag: W/"5f4-18c4e1234"
Last-Modified: Sat, 23 Nov 2025 14:00:00 GMT
```

### 3. ç¼“å­˜ç­–ç•¥å†³ç­–æ ‘

```
                ç”¨æˆ·è¯·æ±‚é™æ€æ–‡ä»¶
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æ£€æŸ¥ç¯å¢ƒå˜é‡   â”‚
              â”‚ NODE_ENV=?     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼
   development    staging    production
         â”‚            â”‚            â”‚
         â–¼            â–¼            â–¼
    ç¦ç”¨ç¼“å­˜      çŸ­ç¼“å­˜       é•¿ç¼“å­˜
    Cache: 0s    Cache: 5m    Cache: 1h
```

---

## ğŸ›¡ï¸ é¢„é˜²æœºåˆ¶å››å±‚ä½“ç³»

### ç¬¬ä¸€å±‚ï¼šè§„èŒƒå±‚ï¼ˆé˜²æ­¢å¼•å…¥é—®é¢˜ï¼‰

```javascript
/**
 * âœ… è§„èŒƒ1ï¼šæ‰€æœ‰ç¯å¢ƒé…ç½®å¿…é¡»ä½¿ç”¨ç¯å¢ƒå˜é‡
 */
// âŒ é”™è¯¯ï¼šç¡¬ç¼–ç é…ç½®
const config = {
  cache: true,
  maxAge: '1h'
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒæ„ŸçŸ¥é…ç½®
const config = {
  cache: process.env.NODE_ENV === 'production',
  maxAge: process.env.NODE_ENV === 'production' ? '1h' : 0
}

/**
 * âœ… è§„èŒƒ2ï¼šå¿…é¡»åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ
 */
// âŒ é”™è¯¯ï¼šæ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒé…ç½®
app.use(express.static('public', { maxAge: '1h' }))

// âœ… æ­£ç¡®ï¼šæ ¹æ®ç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
const envConfig = require('./config/environment')
app.use(express.static('public', envConfig.getStaticCacheConfig()))

/**
 * âœ… è§„èŒƒ3ï¼šå¼€å‘ç¯å¢ƒå¿…é¡»ç¦ç”¨ç¼“å­˜
 */
if (process.env.NODE_ENV !== 'production') {
  res.set('Cache-Control', 'no-cache, no-store, must-revalidate')
  res.set('Pragma', 'no-cache')
  res.set('Expires', '0')
}
```

### ç¬¬äºŒå±‚ï¼šå·¥å…·å±‚ï¼ˆè‡ªåŠ¨æ£€æµ‹é—®é¢˜ï¼‰

**`scripts/check-cache-config.js`** - ç¼“å­˜é…ç½®æ£€æŸ¥å·¥å…·:
```javascript
#!/usr/bin/env node

/**
 * ç¼“å­˜é…ç½®è‡ªåŠ¨æ£€æŸ¥å·¥å…·
 * 
 * @description æ£€æŸ¥é¡¹ç›®ä¸­çš„ç¼“å­˜é…ç½®æ˜¯å¦ç¬¦åˆè§„èŒƒ
 */

const fs = require('fs')
const path = require('path')

console.log('ğŸ” ç¼“å­˜é…ç½®æ£€æŸ¥å·¥å…· v1.0.0')
console.log('='.repeat(50))

/**
 * æ£€æŸ¥app.jsä¸­çš„é™æ€æ–‡ä»¶é…ç½®
 */
function checkAppConfig() {
  const appFile = path.join(process.cwd(), 'app.js')
  const content = fs.readFileSync(appFile, 'utf8')
  
  const issues = []
  
  // æ£€æŸ¥1ï¼šæ˜¯å¦ä½¿ç”¨äº†ç¯å¢ƒæ„ŸçŸ¥é…ç½®
  if (!content.includes('process.env.NODE_ENV')) {
    issues.push({
      type: 'ERROR',
      file: 'app.js',
      message: 'æœªä½¿ç”¨ç¯å¢ƒæ„ŸçŸ¥é…ç½®ï¼ˆç¼ºå°‘process.env.NODE_ENVæ£€æŸ¥ï¼‰'
    })
  }
  
  // æ£€æŸ¥2ï¼šæ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜
  if (!content.includes('no-cache, no-store, must-revalidate')) {
    issues.push({
      type: 'WARNING',
      file: 'app.js',
      message: 'æœªæ˜ç¡®ç¦ç”¨å¼€å‘ç¯å¢ƒç¼“å­˜ï¼ˆç¼ºå°‘Cache-Controlå“åº”å¤´è®¾ç½®ï¼‰'
    })
  }
  
  // æ£€æŸ¥3ï¼šæ˜¯å¦ç¡¬ç¼–ç äº†maxAge
  const hardcodedMaxAge = content.match(/maxAge:\s*['"]?\d+/g)
  if (hardcodedMaxAge && !content.includes('NODE_ENV === \'production\'')) {
    issues.push({
      type: 'ERROR',
      file: 'app.js',
      message: 'ç¡¬ç¼–ç äº†maxAgeå€¼ï¼Œæœªæ ¹æ®ç¯å¢ƒè°ƒæ•´'
    })
  }
  
  return issues
}

/**
 * æ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶
 */
function checkEnvFile() {
  const envFile = path.join(process.cwd(), '.env')
  
  if (!fs.existsSync(envFile)) {
    return [{
      type: 'ERROR',
      file: '.env',
      message: '.envæ–‡ä»¶ä¸å­˜åœ¨'
    }]
  }
  
  const content = fs.readFileSync(envFile, 'utf8')
  const issues = []
  
  // æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡
  const required = ['NODE_ENV', 'PORT']
  required.forEach(key => {
    if (!content.includes(`${key}=`)) {
      issues.push({
        type: 'ERROR',
        file: '.env',
        message: `ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: ${key}`
      })
    }
  })
  
  return issues
}

/**
 * è¿è¡Œæ‰€æœ‰æ£€æŸ¥
 */
function runChecks() {
  const allIssues = [
    ...checkAppConfig(),
    ...checkEnvFile()
  ]
  
  if (allIssues.length === 0) {
    console.log('âœ… æ‰€æœ‰ç¼“å­˜é…ç½®æ£€æŸ¥é€šè¿‡ï¼')
    console.log('='.repeat(50))
    return 0
  }
  
  console.log(`âŒ å‘ç° ${allIssues.length} ä¸ªé—®é¢˜:\n`)
  
  allIssues.forEach((issue, index) => {
    const icon = issue.type === 'ERROR' ? 'âŒ' : 'âš ï¸ '
    console.log(`${index + 1}. ${icon} [${issue.file}] ${issue.message}`)
  })
  
  console.log('\n' + '='.repeat(50))
  console.log('è¯·ä¿®å¤ä»¥ä¸Šé—®é¢˜åå†æäº¤ä»£ç ')
  console.log('='.repeat(50))
  
  return 1
}

// æ‰§è¡Œæ£€æŸ¥
const exitCode = runChecks()
process.exit(exitCode)
```

**`package.json`é…ç½®**:
```json
{
  "scripts": {
    "check:cache": "node scripts/check-cache-config.js",
    "check:env": "node scripts/check-env-config.js",
    "check:config": "npm run check:cache && npm run check:env",
    "prestart": "npm run check:config",
    "predeploy": "npm run check:config"
  }
}
```

### ç¬¬ä¸‰å±‚ï¼šæµç¨‹å±‚ï¼ˆç¡®ä¿é—®é¢˜ä¸è¿›å…¥ç”Ÿäº§ï¼‰

**å¼€å‘æµç¨‹é›†æˆ**:
```bash
# 1. ä»£ç æäº¤å‰ï¼ˆGit Hooksï¼‰
.husky/pre-commit
â”œâ”€â”€ npm run check:cache        # æ£€æŸ¥ç¼“å­˜é…ç½®
â”œâ”€â”€ npm run check:env          # æ£€æŸ¥ç¯å¢ƒå˜é‡
â””â”€â”€ npm run lint              # ä»£ç è´¨é‡æ£€æŸ¥

# 2. ä»£ç å®¡æŸ¥æ—¶ï¼ˆCode Reviewï¼‰
- æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ç¯å¢ƒæ„ŸçŸ¥é…ç½®
- ç¡®è®¤å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜
- éªŒè¯ç”Ÿäº§ç¯å¢ƒå¯ç”¨ç¼“å­˜

# 3. éƒ¨ç½²å‰ï¼ˆCI/CDï¼‰
deploy.yml
â”œâ”€â”€ ç¯å¢ƒå˜é‡éªŒè¯
â”œâ”€â”€ ç¼“å­˜é…ç½®æ£€æŸ¥
â”œâ”€â”€ é›†æˆæµ‹è¯•
â””â”€â”€ å¥åº·æ£€æŸ¥
```

### ç¬¬å››å±‚ï¼šç›‘æ§å±‚ï¼ˆåŠæ—¶å‘ç°ç”Ÿäº§é—®é¢˜ï¼‰

**ç¼“å­˜æ•ˆæœç›‘æ§**:
```javascript
/**
 * ç¼“å­˜ç›‘æ§ä¸­é—´ä»¶
 */
function cacheMonitoringMiddleware(req, res, next) {
  const startTime = Date.now()
  
  // ç›‘å¬å“åº”å®Œæˆ
  res.on('finish', () => {
    const duration = Date.now() - startTime
    
    // è®°å½•ç¼“å­˜ç›¸å…³æŒ‡æ ‡
    if (req.path.startsWith('/admin')) {
      console.log({
        timestamp: new Date().toISOString(),
        method: req.method,
        path: req.path,
        status: res.statusCode,
        duration: `${duration}ms`,
        cacheControl: res.get('Cache-Control'),
        etag: res.get('ETag'),
        ifNoneMatch: req.get('If-None-Match')
      })
    }
  })
  
  next()
}

app.use(cacheMonitoringMiddleware)
```

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### å¼€å‘é˜¶æ®µ
- [ ] **é…ç½®ç¯å¢ƒå˜é‡**: ç¡®ä¿`.env`æ–‡ä»¶åŒ…å«`NODE_ENV`
- [ ] **ä½¿ç”¨ç¯å¢ƒæ„ŸçŸ¥é…ç½®**: é™æ€æ–‡ä»¶é…ç½®æ ¹æ®ç¯å¢ƒè°ƒæ•´
- [ ] **ç¦ç”¨å¼€å‘ç¯å¢ƒç¼“å­˜**: è®¾ç½®`Cache-Control: no-cache`
- [ ] **è¿è¡Œé…ç½®æ£€æŸ¥**: `npm run check:config`
- [ ] **æœ¬åœ°æµ‹è¯•**: éªŒè¯ç¼“å­˜é…ç½®ç”Ÿæ•ˆ

### Code Reviewé˜¶æ®µ
- [ ] **æ£€æŸ¥ç¡¬ç¼–ç é…ç½®**: ç¡®è®¤æ²¡æœ‰ç¡¬ç¼–ç ç¼“å­˜æ—¶é—´
- [ ] **éªŒè¯ç¯å¢ƒåˆ¤æ–­**: ç¡®è®¤ä½¿ç”¨`process.env.NODE_ENV`
- [ ] **ç¡®è®¤å“åº”å¤´è®¾ç½®**: æ£€æŸ¥`setHeaders`å‡½æ•°å®ç°
- [ ] **å®¡æŸ¥é…ç½®æ–‡ä»¶**: æ£€æŸ¥`config/`ç›®å½•ä¸‹çš„é…ç½®
- [ ] **æµ‹è¯•ä¸åŒç¯å¢ƒ**: éªŒè¯developmentå’Œproductioné…ç½®

### æµ‹è¯•é˜¶æ®µ
- [ ] **æµ‹è¯•ç¯å¢ƒåˆ‡æ¢**: éªŒè¯ä¸åŒ`NODE_ENV`çš„è¡Œä¸º
- [ ] **éªŒè¯å“åº”å¤´**: æ£€æŸ¥å®é™…çš„`Cache-Control`å“åº”å¤´
- [ ] **æµè§ˆå™¨æµ‹è¯•**: ç¡®è®¤å¼€å‘æ—¶æ— ç¼“å­˜ï¼Œç”Ÿäº§æ—¶æœ‰ç¼“å­˜
- [ ] **æ€§èƒ½æµ‹è¯•**: éªŒè¯ç”Ÿäº§ç¯å¢ƒç¼“å­˜æ•ˆæœ
- [ ] **é™çº§æµ‹è¯•**: æµ‹è¯•ç¼“å­˜å¤±æ•ˆçš„é™çº§æ–¹æ¡ˆ

### éƒ¨ç½²é˜¶æ®µ
- [ ] **ç¯å¢ƒå˜é‡æ£€æŸ¥**: ç¡®è®¤ç”Ÿäº§ç¯å¢ƒè®¾ç½®æ­£ç¡®çš„`NODE_ENV`
- [ ] **é…ç½®æ–‡ä»¶éªŒè¯**: è¿è¡Œè‡ªåŠ¨åŒ–é…ç½®æ£€æŸ¥
- [ ] **å¥åº·æ£€æŸ¥**: éªŒè¯æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] **ç¼“å­˜éªŒè¯**: æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒç¼“å­˜å“åº”å¤´
- [ ] **ç›‘æ§å‘Šè­¦**: é…ç½®ç¼“å­˜ç›¸å…³ç›‘æ§æŒ‡æ ‡

---

## ğŸ“ é…ç½®ç®¡ç†æœ€ä½³å®è·µ

### å®è·µ1ï¼šæ°¸è¿œä¸è¦ç¡¬ç¼–ç ç¯å¢ƒç›¸å…³é…ç½®

**âŒ åé¢æ•™æ**:
```javascript
// ç¡¬ç¼–ç é…ç½® - æ‰€æœ‰ç¯å¢ƒéƒ½ä¸€æ ·
const config = {
  cache: true,
  maxAge: 3600,
  debug: false
}
```

**âœ… æœ€ä½³å®è·µ**:
```javascript
// ç¯å¢ƒæ„ŸçŸ¥é…ç½®
const config = {
  cache: process.env.NODE_ENV === 'production',
  maxAge: process.env.NODE_ENV === 'production' ? 3600 : 0,
  debug: process.env.NODE_ENV !== 'production'
}
```

### å®è·µ2ï¼šä½¿ç”¨é…ç½®ç®¡ç†å™¨ç»Ÿä¸€ç®¡ç†

**âœ… æ¨èç»“æ„**:
```
config/
â”œâ”€â”€ index.js              # é…ç½®å…¥å£
â”œâ”€â”€ environment.js        # ç¯å¢ƒé…ç½®ç®¡ç†å™¨
â”œâ”€â”€ database.js           # æ•°æ®åº“é…ç½®
â”œâ”€â”€ cache.js              # ç¼“å­˜é…ç½®
â”œâ”€â”€ security.js           # å®‰å…¨é…ç½®
â””â”€â”€ defaults.js           # é»˜è®¤é…ç½®
```

### å®è·µ3ï¼šé…ç½®åˆ†å±‚å’Œç»§æ‰¿

```javascript
// config/defaults.js - é»˜è®¤é…ç½®
const defaults = {
  port: 3000,
  cache: {
    enabled: false,
    ttl: 0
  }
}

// config/production.js - ç”Ÿäº§ç¯å¢ƒé…ç½®
const production = {
  ...defaults,
  cache: {
    enabled: true,
    ttl: 3600
  }
}

// config/index.js - é…ç½®å…¥å£
const env = process.env.NODE_ENV || 'development'
module.exports = require(`./${env}`)
```

### å®è·µ4ï¼šé…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†

```javascript
/**
 * é…ç½®éªŒè¯å‡½æ•°
 */
function validateConfig(config) {
  const errors = []
  
  // éªŒè¯å¿…éœ€å­—æ®µ
  if (!config.port) {
    errors.push('ç¼ºå°‘porté…ç½®')
  }
  
  // éªŒè¯å­—æ®µç±»å‹
  if (typeof config.cache.ttl !== 'number') {
    errors.push('cache.ttlå¿…é¡»æ˜¯æ•°å­—')
  }
  
  // éªŒè¯å­—æ®µèŒƒå›´
  if (config.port < 1024 || config.port > 65535) {
    errors.push('portå¿…é¡»åœ¨1024-65535èŒƒå›´å†…')
  }
  
  if (errors.length > 0) {
    throw new Error(`é…ç½®éªŒè¯å¤±è´¥:\n${errors.join('\n')}`)
  }
  
  return true
}
```

### å®è·µ5ï¼šé…ç½®æ–‡æ¡£åŒ–

```javascript
/**
 * é…ç½®è¯´æ˜æ–‡æ¡£
 * 
 * @typedef {Object} AppConfig
 * @property {number} port - åº”ç”¨ç«¯å£ï¼ˆ1024-65535ï¼‰
 * @property {CacheConfig} cache - ç¼“å­˜é…ç½®
 * @property {DatabaseConfig} database - æ•°æ®åº“é…ç½®
 */

/**
 * @typedef {Object} CacheConfig
 * @property {boolean} enabled - æ˜¯å¦å¯ç”¨ç¼“å­˜
 * @property {number} ttl - ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
 * @property {string} [prefix] - ç¼“å­˜é”®å‰ç¼€ï¼ˆå¯é€‰ï¼‰
 */
```

---

## ğŸš€ å¿«é€Ÿå®æ–½æŒ‡å—

### æ­¥éª¤1ï¼šåˆ›å»ºç¯å¢ƒé…ç½®ç®¡ç†å™¨ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. åˆ›å»ºé…ç½®ç›®å½•
mkdir -p config

# 2. åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
cat > config/environment.js << 'EOF'
// ç²˜è´´ä¸Šé¢"ç¯å¢ƒé…ç½®ç®¡ç†å™¨"ä»£ç 
EOF

# 3. éªŒè¯é…ç½®æ–‡ä»¶
node -e "require('./config/environment').printConfig()"
```

### æ­¥éª¤2ï¼šä¿®æ”¹app.jsä½¿ç”¨ç¯å¢ƒé…ç½®ï¼ˆ2åˆ†é’Ÿï¼‰

```javascript
// 1. å¼•å…¥ç¯å¢ƒé…ç½®ç®¡ç†å™¨
const envConfig = require('./config/environment')

// 2. éªŒè¯ç¯å¢ƒé…ç½®
envConfig.validateConfig()

// 3. æ‰“å°é…ç½®ä¿¡æ¯ï¼ˆå¼€å‘é˜¶æ®µï¼‰
if (envConfig.isDevelopment()) {
  envConfig.printConfig()
}

// 4. ä½¿ç”¨ç¯å¢ƒé…ç½®
app.use('/admin', express.static(
  path.join(__dirname, 'public/admin'),
  envConfig.getStaticCacheConfig()  // âœ… ä½¿ç”¨ç¯å¢ƒæ„ŸçŸ¥é…ç½®
))
```

### æ­¥éª¤3ï¼šåˆ›å»ºé…ç½®æ£€æŸ¥å·¥å…·ï¼ˆ3åˆ†é’Ÿï¼‰

```bash
# 1. åˆ›å»ºè„šæœ¬ç›®å½•
mkdir -p scripts

# 2. åˆ›å»ºæ£€æŸ¥è„šæœ¬
cat > scripts/check-cache-config.js << 'EOF'
// ç²˜è´´ä¸Šé¢"ç¼“å­˜é…ç½®æ£€æŸ¥å·¥å…·"ä»£ç 
EOF

# 3. æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/check-cache-config.js

# 4. æ·»åŠ npmå‘½ä»¤
npm pkg set scripts.check:cache="node scripts/check-cache-config.js"
```

### æ­¥éª¤4ï¼šè¿è¡Œæ£€æŸ¥å’Œæµ‹è¯•ï¼ˆ3åˆ†é’Ÿï¼‰

```bash
# 1. è¿è¡Œé…ç½®æ£€æŸ¥
npm run check:cache

# 2. é‡å¯æœåŠ¡
npm run pm:restart

# 3. éªŒè¯å“åº”å¤´ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
curl -I http://localhost:3000/admin/js/admin-common.js | grep -i cache

# 4. é¢„æœŸè¾“å‡º
# Cache-Control: no-cache, no-store, must-revalidate
# Pragma: no-cache
# Expires: 0
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹è¿› |
|------|--------|--------|------|
| å¼€å‘ç¯å¢ƒç¼“å­˜ | 1å°æ—¶ | 0ç§’ï¼ˆç¦ç”¨ï¼‰ | âœ… 100%æ”¹è¿› |
| ä»£ç æ›´æ–°å»¶è¿Ÿ | éœ€æ‰‹åŠ¨æ¸…ç¼“å­˜ | ç«‹å³ç”Ÿæ•ˆ | âœ… æ— å»¶è¿Ÿ |
| ç¯å¢ƒé…ç½®ç»Ÿä¸€æ€§ | æ‰€æœ‰ç¯å¢ƒç›¸åŒ | ç¯å¢ƒæ„ŸçŸ¥ | âœ… æ ‡å‡†åŒ– |
| é—®é¢˜å‘ç°æ—¶é—´ | è¿è¡Œæ—¶ | å¼€å‘é˜¶æ®µ | âœ… æå‰å‘ç° |
| æŠ€æœ¯å€ºåŠ¡ | æ‰“è¡¥ä¸ç´¯ç§¯ | ç³»ç»Ÿæ€§é¢„é˜² | âœ… ä¸å¢åŠ  |

---

## ğŸ”— ç›¸å…³èµ„æº

### æ ¸å¿ƒæ–‡ä»¶
- **ç¯å¢ƒé…ç½®ç®¡ç†å™¨**: `config/environment.js`
- **ç¼“å­˜é…ç½®æ£€æŸ¥å·¥å…·**: `scripts/check-cache-config.js`
- **åº”ç”¨ä¸»æ–‡ä»¶**: `app.js`ï¼ˆç¬¬439-454è¡Œï¼‰

### ç›¸å…³æ–‡æ¡£
- [å‰ç«¯é™æ€èµ„æºç®¡ç†å®Œæ•´æŒ‡å—](./å‰ç«¯é™æ€èµ„æºç®¡ç†å®Œæ•´æŒ‡å—.md)
- [ç³»ç»Ÿæ€§é—®é¢˜é¢„é˜²å’Œè§£å†³æ–¹æ¡ˆ](./ç³»ç»Ÿæ€§é—®é¢˜é¢„é˜²å’Œè§£å†³æ–¹æ¡ˆ.md)
- [Webç®¡ç†åå°å®Œæ•´æ–¹æ¡ˆ](./Webç®¡ç†åå°å®Œæ•´æ–¹æ¡ˆ(æœ€ç»ˆç‰ˆ).md)

### å­¦ä¹ èµ„æº
- [Express.js static middlewareæ–‡æ¡£](https://expressjs.com/en/starter/static-files.html)
- [HTTPç¼“å­˜æœ€ä½³å®è·µ](https://web.dev/http-cache/)
- [Node.jsç¯å¢ƒå˜é‡ç®¡ç†](https://nodejs.org/en/learn/command-line/how-to-read-environment-variables-from-nodejs)

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

é‡åˆ°é—®é¢˜ï¼Ÿ

1. è¿è¡Œ `npm run check:cache` æ£€æŸ¥é…ç½®
2. æŸ¥çœ‹ç¯å¢ƒå˜é‡: `echo $NODE_ENV`
3. éªŒè¯å“åº”å¤´: `curl -I http://localhost:3000/admin/`
4. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ

---

## ğŸ¯ æ€»ç»“

**æ ¸å¿ƒç†å¿µ**:
- âœ… **ç¯å¢ƒæ„ŸçŸ¥**: ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
- âœ… **å¼€å‘ä¼˜å…ˆ**: å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜ï¼Œå¿«é€Ÿè¿­ä»£
- âœ… **ç”Ÿäº§ä¼˜åŒ–**: ç”Ÿäº§ç¯å¢ƒå¯ç”¨ç¼“å­˜ï¼Œæå‡æ€§èƒ½
- âœ… **ç³»ç»Ÿé¢„é˜²**: é€šè¿‡å·¥å…·å’Œæµç¨‹é¢„é˜²é—®é¢˜
- âœ… **æŒç»­æ”¹è¿›**: ç›‘æ§ã€åˆ†æã€ä¼˜åŒ–é…ç½®ç­–ç•¥

**ä»"ä¸´æ—¶æ‰“è¡¥ä¸"åˆ°"ç³»ç»Ÿæ€§é¢„é˜²"**:
```
ä¸´æ—¶ä¿®å¤ï¼ˆâŒï¼‰           ç³»ç»Ÿé¢„é˜²ï¼ˆâœ…ï¼‰
    â”‚                        â”‚
é‡åˆ°é—®é¢˜                  è§„èŒƒçº¦æŸ
    â”‚                        â”‚
æ‰“è¡¥ä¸                    å·¥å…·æ£€æŸ¥
    â”‚                        â”‚
ä¸‹æ¬¡åˆé‡åˆ°                æµç¨‹ä¿éšœ
    â”‚                        â”‚
æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯              ç›‘æ§å‘Šè­¦
                             â”‚
                        é—®é¢˜ä¸å†å‘ç”Ÿ
```

---

**æ–‡æ¡£ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-23  
**çŠ¶æ€**: âœ… ç”Ÿæ•ˆä¸­

---

**è¿™ä¸ä»…æ˜¯è§£å†³ä¸€ä¸ªç¼“å­˜é—®é¢˜ï¼Œè€Œæ˜¯å»ºç«‹äº†ä¸€å¥—å®Œæ•´çš„ç¯å¢ƒé…ç½®ç®¡ç†ä½“ç³»ï¼** ğŸ‰

