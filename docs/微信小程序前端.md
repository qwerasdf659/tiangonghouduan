# ğŸ“‹ åç«¯éœ€æ±‚ â€” èƒŒåŒ…ï¼ˆåº“å­˜ï¼‰é¡µé¢å‰ç«¯å¯¹æ¥é—®é¢˜

> ğŸ“… æ›´æ–°æ—¶é—´ï¼š2026-02-15
> ğŸ¯ å¯¹åº”æ–‡æ¡£ï¼š`docs/å¾®ä¿¡å°ç¨‹åºå‰ç«¯é¡¹ç›®æ±‚è¯.md`
> ğŸ”— å¯¹åº”å‰ç«¯é¡µé¢ï¼š`pages/trade/inventory/inventory`

---

## ä¸€ã€å‰ç«¯å·²å®Œæˆå¯¹æ¥æ¸…å•

ä»¥ä¸‹ API å‰ç«¯å·²å®Œæˆå¯¹æ¥ï¼ŒWXMLæ¨¡æ¿ç›´æ¥ä½¿ç”¨åç«¯snake_caseå­—æ®µåï¼Œä¸åšæ˜ å°„ã€‚

| åŠŸèƒ½ | HTTPæ–¹æ³• | APIè·¯å¾„ | å‰ç«¯æ–¹æ³• | å‰ç«¯çŠ¶æ€ |
|------|---------|---------|----------|---------|
| è·å–èƒŒåŒ…ï¼ˆèµ„äº§+ç‰©å“ï¼‰ | GET | `/api/v4/backpack/` | `API.getUserInventory()` | âœ… å·²å¯¹æ¥ |
| èƒŒåŒ…ç»Ÿè®¡ | GET | `/api/v4/backpack/stats` | `API.getBackpackStats()` | âœ… å·²å¯¹æ¥ |
| ç‰©å“è¯¦æƒ… | GET | `/api/v4/backpack/items/:item_instance_id` | `API.getInventoryItem()` | âœ… å·²å¯¹æ¥ |
| ä½¿ç”¨ç‰©å“ | POST | `/api/v4/backpack/items/:item_instance_id/use` | `API.useInventoryItem()` | âœ… å·²å¯¹æ¥ |
| ç”Ÿæˆæ ¸é”€ç  | POST | `/api/v4/backpack/items/:item_instance_id/redeem` | `API.redeemInventoryItem()` | âœ… å·²å¯¹æ¥ |
| ä¸Šæ¶ç‰©å“åˆ°å¸‚åœº | POST | `/api/v4/market/list` | `API.sellToMarket()` | âœ… å·²å¯¹æ¥ï¼ˆå«Idempotency-Keyï¼‰ |
| ä¸Šæ¶å¯å åŠ èµ„äº§åˆ°å¸‚åœº | POST | `/api/v4/market/fungible-assets/list` | `API.sellFungibleAssets()` | âœ… å·²å¯¹æ¥ï¼ˆå«Idempotency-Keyï¼‰ |

---

## äºŒã€éœ€è¦åç«¯ååŠ©çš„äº‹é¡¹

### ğŸ”´ é—®é¢˜1ï¼šGET /api/v4/backpack/ çš„ assets[] ç¼ºå°‘ `is_tradable` å­—æ®µ

**é—®é¢˜æè¿°**ï¼š

å½“å‰ `GET /api/v4/backpack/` è¿”å›çš„ `assets[]` ä¸­æ¯ä¸ªèµ„äº§å¯¹è±¡åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```
asset_code, display_name, total_amount, frozen_amount, available_amount,
category, rarity, rarity_display, rarity_color
```

ä½†ç¼ºå°‘ `is_tradable`ï¼ˆæ˜¯å¦å¯äº¤æ˜“ï¼‰å­—æ®µã€‚æ ¹æ®å¯¹æ¥æ–‡æ¡£ï¼Œ`material_asset_types` è¡¨ä¸­å­˜åœ¨ `is_tradable` å­—æ®µï¼š

| asset_code | display_name | is_tradable |
|-----------|-------------|------------|
| `red_shard` | çº¢è‰²ç¢ç‰‡ | âœ… å¯äº¤æ˜“ |
| `BUDGET_POINTS` | é¢„ç®—ç§¯åˆ† | âŒ ä¸å¯äº¤æ˜“ |
| `DIAMOND` | é’»çŸ³ | âœ… å¯äº¤æ˜“ |
| `POINTS` | ç§¯åˆ† | â“ æœªé…ç½®ï¼ˆä¸åœ¨material_asset_typesä¸­ï¼‰ |

**å‰ç«¯éœ€è¦ä»€ä¹ˆ**ï¼š

è¯·åœ¨ `GET /api/v4/backpack/` è¿”å›çš„ `assets[]` ä¸­å¢åŠ  `is_tradable` å­—æ®µï¼ˆbooleanç±»å‹ï¼‰ï¼Œä»¥ä¾¿å‰ç«¯ç²¾ç¡®æ§åˆ¶"ä¸Šæ¶åˆ°å¸‚åœº"æŒ‰é’®çš„æ˜¾ç¤º/éšè—ã€‚

**å½“å‰å‰ç«¯ä¸´æ—¶æ–¹æ¡ˆ**ï¼š

å‰ç«¯å¯¹æ‰€æœ‰ `available_amount > 0` çš„èµ„äº§å‡å±•ç¤º"ä¸Šæ¶åˆ°å¸‚åœº"æŒ‰é’®ï¼Œç”±åç«¯ `POST /api/v4/market/fungible-assets/list` æ¥å£è¿›è¡Œäº¤æ˜“åˆè§„æ ¡éªŒã€‚å¦‚æœèµ„äº§ä¸å¯äº¤æ˜“ï¼Œåç«¯éœ€è¿”å›æ˜ç¡®çš„é”™è¯¯æç¤ºä¿¡æ¯ã€‚

**æœŸæœ›åç«¯è¿”å›æ ¼å¼**ï¼š

```json
{
  "assets": [
    {
      "asset_code": "red_shard",
      "display_name": "çº¢è‰²ç¢ç‰‡",
      "total_amount": 100,
      "frozen_amount": 0,
      "available_amount": 100,
      "category": "red",
      "rarity": "common",
      "rarity_display": "æ™®é€š",
      "rarity_color": null,
      "is_tradable": true
    }
  ]
}
```

**ä¼˜å…ˆçº§**ï¼šä¸­ç­‰ â€” åŠŸèƒ½å·²å¯ç”¨ï¼ˆåç«¯æ ¡éªŒå…œåº•ï¼‰ï¼Œä½†UXä½“éªŒéœ€è¦æ­¤å­—æ®µä¼˜åŒ–

---

### ğŸŸ¡ é—®é¢˜2ï¼šPOST /api/v4/market/fungible-assets/list çš„é”™è¯¯æç¤ºéœ€æ˜ç¡®

**é—®é¢˜æè¿°**ï¼š

å½“ç”¨æˆ·å°è¯•ä¸Šæ¶ä¸å¯äº¤æ˜“çš„èµ„äº§ï¼ˆå¦‚ `BUDGET_POINTS`ï¼‰æ—¶ï¼Œåç«¯éœ€è¿”å›æ¸…æ™°çš„ä¸šåŠ¡é”™è¯¯ä¿¡æ¯ã€‚

**å‰ç«¯æœŸæœ›çš„é”™è¯¯å“åº”æ ¼å¼**ï¼š

```json
{
  "success": false,
  "message": "é¢„ç®—ç§¯åˆ†ä¸æ”¯æŒäº¤æ˜“",
  "code": "ASSET_NOT_TRADABLE"
}
```

**è¯·ç¡®è®¤åç«¯åœ¨ä»¥ä¸‹åœºæ™¯çš„é”™è¯¯å“åº”**ï¼š

| åœºæ™¯ | æœŸæœ›çš„ code | æœŸæœ›çš„ message |
|------|-----------|---------------|
| èµ„äº§ä¸å¯äº¤æ˜“ | `ASSET_NOT_TRADABLE` | `{display_name}ä¸æ”¯æŒäº¤æ˜“` |
| å¯ç”¨ä½™é¢ä¸è¶³ | `INSUFFICIENT_BALANCE` | `å¯ç”¨ä½™é¢ä¸è¶³` |
| è¶…è¿‡ä¸Šæ¶æ•°é‡é™åˆ¶ï¼ˆ10ä»¶ï¼‰ | `LISTING_LIMIT_EXCEEDED` | `å·²è¾¾åˆ°æœ€å¤§ä¸Šæ¶æ•°é‡é™åˆ¶` |
| é‡å¤ä¸Šæ¶ï¼ˆå¹‚ç­‰é”®å‘½ä¸­ï¼‰ | `IDEMPOTENCY_HIT` | è¿”å›é¦–æ¬¡æ“ä½œç»“æœ |

**ä¼˜å…ˆçº§**ï¼šä¸­ç­‰

---

### ğŸŸ¢ é—®é¢˜3ï¼šPOINTS èµ„äº§åœ¨ material_asset_types è¡¨ä¸­æœªé…ç½®

**é—®é¢˜æè¿°**ï¼š

æ ¹æ®å¯¹æ¥æ–‡æ¡£è¯´æ˜ï¼š
> âš ï¸ æ³¨æ„ï¼šPOINTSï¼ˆç§¯åˆ†ï¼‰åœ¨ account_asset_balances ä¸­å­˜åœ¨ä½™é¢æ•°æ®ï¼Œä½† material_asset_types è¡¨ä¸­æœªé…ç½®å¯¹åº”è®°å½•ï¼Œdisplay_name ä¼šå›é€€ä¸º asset_code æœ¬èº«ã€‚

**å‰ç«¯å½±å“**ï¼š

- `POINTS` èµ„äº§çš„ `display_name` ä¼šæ˜¾ç¤ºä¸º `"POINTS"` è€Œä¸æ˜¯ `"ç§¯åˆ†"`
- `is_tradable` å­—æ®µæ— æ³•ç¡®å®šï¼ˆå¦‚æœåç«¯å¢åŠ äº†è¯¥å­—æ®µï¼‰

**è¯·åç«¯ç¡®è®¤**ï¼š

1. `POINTS` æ˜¯å¦éœ€è¦åœ¨ `material_asset_types` è¡¨ä¸­è¡¥å……é…ç½®ï¼Ÿ
2. `POINTS` æ˜¯å¦å…è®¸åœ¨äº¤æ˜“å¸‚åœºä¸Šæ¶ï¼Ÿ

**ä¼˜å…ˆçº§**ï¼šä½

---

## ä¸‰ã€å‰ç«¯æ— éœ€åç«¯å¤„ç†çš„å·²ç¡®è®¤äº‹é¡¹

| äº‹é¡¹ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| åŒè½¨ç»“æ„è§£æ | å‰ç«¯æ­£ç¡®è§£æ `assets[]` + `items[]` | âœ… å·²å®Œæˆ |
| snake_caseå­—æ®µ | WXMLæ¨¡æ¿ç›´æ¥ä½¿ç”¨åç«¯å­—æ®µå | âœ… å·²å®Œæˆ |
| åˆ†ç±»ç»Ÿè®¡ï¼ˆå‰ç«¯è®¡ç®—ï¼‰ | å‰ç«¯ä» `items[]` æŒ‰ `item_type` åˆ†ç»„ç»Ÿè®¡ | âœ… å·²å®Œæˆï¼ˆæ–¹æ¡ˆAï¼‰ |
| æ“ä½œæ ‡å¿—è®¡ç®— | `can_use` / `can_generate_code` / `can_sell` ç”±å‰ç«¯æ ¹æ® status è®¡ç®— | âœ… å·²å®Œæˆ |
| JWT Tokenè®¤è¯ | æ‰€æœ‰APIè¯·æ±‚è‡ªåŠ¨æºå¸¦ `Authorization: Bearer <token>` | âœ… å·²å®Œæˆ |
| Tokenè‡ªåŠ¨åˆ·æ–° | 401 TOKEN_EXPIRED æ—¶è‡ªåŠ¨è°ƒç”¨ `/auth/refresh` åˆ·æ–° | âœ… å·²å®Œæˆ |
| Idempotency-Key | å¸‚åœºä¸Šæ¶æ¥å£æºå¸¦å”¯ä¸€å¹‚ç­‰é”® | âœ… å·²å®Œæˆ |
| æ ¸é”€ç ä¸€æ¬¡æ€§æ˜¾ç¤º | æ ¸é”€ç ç”Ÿæˆåå¼¹çª—å±•ç¤ºï¼Œæä¾›å¤åˆ¶åŠŸèƒ½ï¼Œæç¤ºä»…æ˜¾ç¤ºä¸€æ¬¡ | âœ… å·²å®Œæˆ |
| *_displayå­—æ®µä½¿ç”¨ | ç±»å‹ã€çŠ¶æ€ã€ç¨€æœ‰åº¦ç»Ÿä¸€ä½¿ç”¨åç«¯è¿”å›çš„ *_display ä¸­æ–‡å | âœ… å·²å®Œæˆ |

---

## å››ã€éœ€è¦è¿è¥äººå‘˜å¡«å†™çš„çœŸå®æ•°æ®

| ä½ç½® | å½“å‰å ä½å€¼ | è¯´æ˜ |
|------|----------|------|
| `inventory.ts` L810 å®¢æœç”µè¯ | `400-000-0000` | éœ€è¦è¿è¥æä¾›çœŸå®å®¢æœç”µè¯å·ç  |

éœ€è¦ä½ è½¬å‘Šåç«¯çš„äº‹é¡¹ï¼ˆå£å¤´å³å¯ï¼‰
ğŸ”´ Bug: services/CustomerServiceSessionService.js ç¬¬191è¡Œ message_id â†’ chat_message_idï¼ˆå¯¼è‡´ GET /api/v4/system/chat/sessions è¿”å›500ï¼‰
ğŸŸ¡ ç¼ºå¤±: ç®¡ç†å‘˜å®¢æœç»Ÿè®¡APIï¼ˆGET /api/v4/console/customer-service/statsï¼‰
ğŸŸ¡ ç¼ºå¤±: ç®¡ç†å‘˜åœ¨çº¿çŠ¶æ€APIï¼ˆPOST /api/v4/console/customer-service/statusï¼‰
ğŸŸ¡ ç¼ºå¤±: èŠå¤©æœç´¢APIï¼ˆGET /api/v4/system/chat/searchï¼‰

é—®é¢˜ ä½ç½® è¯´æ˜ è°å¤„ç†
åç«¯Bug: å®¢æœä¼šè¯åˆ—è¡¨500é”™è¯¯ åç«¯ services/CustomerServiceSessionService.js message_id åº”ä¸º chat_message_id ğŸ”´ åç«¯å¤„ç†
ç¼ºå¤±API: ç®¡ç†å‘˜å®¢æœç»Ÿè®¡æ¥å£ GET /api/v4/console/customer-service/stats ç®¡ç†å‘˜å®¢æœå·¥ä½œå°ç»Ÿè®¡é¢æ¿æ— æ•°æ® ğŸ”´ åç«¯å¤„ç†
ç¼ºå¤±API: ç®¡ç†å‘˜åœ¨çº¿çŠ¶æ€æ›´æ–° POST /api/v4/console/customer-service/status æ— æ³•åŒæ­¥åœ¨çº¿/å¿™ç¢Œ/ç¦»çº¿çŠ¶æ€åˆ°åç«¯ ğŸ”´ åç«¯å¤„ç†
ç¼ºå¤±API: èŠå¤©æœç´¢ GET /api/v4/system/chat/search?keyword=xxx æœç´¢åŠŸèƒ½UIå·²é¢„ç•™ä½†æ— åç«¯æ”¯æŒ ğŸ”´ åç«¯å¤„ç†
å®¢æœç”µè¯å ä½ inventory.ts â†’ onContactService 400-000-0000 éœ€æ›¿æ¢ä¸ºçœŸå®å·ç  ğŸŸ¡ ä½ æ¥å¡«å†™
statsæ¥å£åˆ†ç»„ç»Ÿè®¡ç¼ºå¤± GET /api/v4/backpack/stats æ–‡æ¡£æŒ‡å‡º items_by_type/items_b
