# æµ‹è¯•ç¯å¢ƒæ•°æ®åº“å½»åº•æ¸…ç†æ‰‹å†Œ

**ç”Ÿæˆæ—¶é—´**: 2026-02-16ï¼ˆåˆç‰ˆï¼‰â†’ **2026-02-18 ä¸‰æ¬¡æ ¡éªŒæ›´æ–°**ï¼ˆNode.js è¿æ¥çœŸå®æ•°æ®åº“å®æ—¶æŸ¥è¯¢ï¼‰  
**æ•°æ®åº“**: restaurant_points_dev (æµ‹è¯•ç¯å¢ƒï¼Œè¿œç¨‹ dbconn.sealosbja.site:42569)  
**æ€»è¡¨æ•°**: 79 å¼ è¡¨ï¼ˆ`products` è¡¨å·²åˆ é™¤ï¼Œè¾ƒä¸Šæ¬¡å‡å°‘1å¼ ï¼‰  
**æ•°æ®åº“å¤§å°**: 118.77 MB  
**å¤–é”®çº¦æŸ**: 114 æ¡  
**è¿ç§»è®°å½•**: 336 æ¡ï¼ˆsequelizemetaï¼Œæ–¹æ¡ˆBä¿ç•™ï¼‰  
**æ–‡æ¡£ç”¨é€”**: é€šç”¨çš„æµ‹è¯•ç¯å¢ƒæ•°æ®æ¸…ç†æ ‡å‡†æ“ä½œæ‰‹å†Œï¼ˆçº¯æ¸…å•æ ¼å¼ï¼‰

---

## ğŸ“ 2026-02-16 æ›´æ–°è®°å½•ï¼ˆä¸æ—§æ–‡æ¡£å·®å¼‚ï¼‰

> æœ¬æ¬¡æ›´æ–°é€šè¿‡ Node.js è¿æ¥çœŸå®æ•°æ®åº“ `restaurant_points_dev` å®æ—¶æŸ¥è¯¢ï¼Œä¿®æ­£äº†æ—§æ–‡æ¡£ä¸­æ‰€æœ‰ä¸å‡†ç¡®çš„æ•°æ®ã€‚

### äºŒæ¬¡æ ¡éªŒä¿®æ­£ï¼ˆ2026-02-16 21:00ï¼‰

| ç»´åº¦ | åˆç‰ˆå€¼ | äºŒæ¬¡æ ¡éªŒå®é™…å€¼ | ä¿®æ­£ |
|------|--------|---------------|------|
| `system_dictionaries` å­—å…¸ç±»å‹æ•° | 69ç§ | **73ç§** | +4ç§æ–°å¢å­—å…¸ç±»å‹ |
| `authentication_sessions` | 2 | **5** | è¿è¡Œæ—¶ç´¯å¢ |
| `chat_messages` | 446 | **448** | è¿è¡Œæ—¶ç´¯å¢ |
| `websocket_startup_logs` | 1,920 | **1,921** | è¿è¡Œæ—¶ç´¯å¢ |
| marketplace é…ç½®é¡¹ | ä»…åˆ—1æ¡ | **å®é™…20æ¡** | è¡¥å…¨å®Œæ•´åˆ—è¡¨ |
| å¥–å“æ± é€ŸæŸ¥æ¨¡æ¿ prize_type | `empty`/`asset` | `virtual`/`points`/`coupon`/`physical` | ä¿®æ­£ä¸ºå®é™…æšä¸¾ |
| ç³»ç»Ÿè´¦æˆ·é‡å»ºæ–¹å¼ | å¯é‡è·‘è¿ç§» | **ä¸å¯é‡è·‘**ï¼ˆsequelizemetaå·²è®°å½•ï¼‰ | å¿…é¡»æ‰‹åŠ¨INSERT |
| `preset_debt_limits` é¢„ç®—æè¿° | é¢„ç®—10000å…ƒ | `budget_debt_limit=1000000` | ä¿®æ­£ä¸ºå®é™…å€¼ |
| æ´»åŠ¨1 budget_mode | æŸå¤„æš—ç¤º`none` | å®é™…ä¸º **`user`** | ä¿®æ­£ |
| `material_asset_types` å­—æ®µå | `asset_name` | å®é™…ä¸º **`display_name`** | ä¿®æ­£å­—æ®µå |

### æ•°æ®åº“ç»“æ„å˜æ›´

| ç»´åº¦ | æ—§æ–‡æ¡£(2025-01-30) | å®é™…æ•°æ®åº“(2026-02-16) |
|------|---------------------|----------------------|
| æ€»è¡¨æ•° | 72 å¼  | **79 å¼ **ï¼ˆæ–°å¢8å¼ ï¼Œåˆ é™¤1å¼ `products`ï¼‰ |
| æ•°æ®åº“å | restaurant_lottery | **restaurant_points_dev** |
| å¤–é”®çº¦æŸ | æœªè®°å½• | **114 æ¡** |
| æ•°æ®åº“å¤§å° | æœªè®°å½• | **118.77 MB** |
| åƒåœ¾è¡¨ `deadlock_test_1769781752856` | æ ‡è®°ä¸ºéœ€åˆ é™¤ | **å·²ä¸å­˜åœ¨**ï¼ˆå·²æ¸…ç†ï¼‰ |
| æ–¹æ¡ˆBæ¸…ç©ºè¡¨æ•° | 69 å¼  | **77 å¼ ** |
| æ–¹æ¡ˆAæ¸…ç©ºè¡¨æ•° | 43 å¼  | **48 å¼ ** |

### æ–°å¢8å¼ è¡¨ï¼ˆæ—§æ–‡æ¡£ä¸­æœªæ”¶å½•ï¼‰

| è¡¨å | å®é™…è¡Œæ•° | å½’ç±» | æ–¹æ¡ˆBå¤„ç† |
|------|----------|------|-----------|
| `admin_notifications` | 0 | ç®¡ç†å‘˜é€šçŸ¥ | æ¸…ç©º |
| `alert_silence_rules` | 0 | å‘Šè­¦é™é»˜è§„åˆ™ | æ¸…ç©º |
| `bid_products` | 0 | ç«æ‹å•†å“ | æ¸…ç©º |
| `bid_records` | 0 | ç«æ‹è®°å½• | æ¸…ç©º |
| `reminder_rules` | 3 | æé†’è§„åˆ™é…ç½® | æ¸…ç©º |
| `reminder_history` | 357 | æé†’å†å² | æ¸…ç©º |
| `report_templates` | 2 | æŠ¥å‘Šæ¨¡æ¿ | æ¸…ç©º |
| `user_behavior_tracks` | 0 | ç”¨æˆ·è¡Œä¸ºè¿½è¸ª | æ¸…ç©º |

### æ•°æ®é‡ä¿®æ­£

| è¡¨å | æ—§å€¼ | å®é™…å€¼ | å˜åŒ– |
|------|------|--------|------|
| `system_settings` | 39 | **42** | +3 |
| `system_dictionaries` | 244 | **371** | +127ï¼ˆ74ç§å­—å…¸ç±»å‹ï¼‰ |
| `system_configs` | 6 | **9** | +3 |
| `lottery_draw_quota_rules` | 7 | **11** | +4 |
| `category_defs` | 8 | **9** | +1 |
| `rarity_defs` | 6 | **5** | -1 |
| `exchange_items` | 35 | **89** | +54ï¼ˆå« space/tags æ–°å­—æ®µï¼‰ |
| `lottery_campaign_pricing_config` | 11 | **14** | +3ï¼ˆç‰ˆæœ¬åŒ–JSONé…ç½®ï¼‰ |

### åŠŸèƒ½å¼€å…³ `feature_flags` ä¿®æ­£ï¼ˆflag_key å®Œå…¨ä¸åŒï¼‰

| æ—§æ–‡æ¡£ flag_keyï¼ˆé”™è¯¯ï¼‰ | å®é™…æ•°æ®åº“ flag_keyï¼ˆæ­£ç¡®ï¼‰ | è¯´æ˜ |
|------------------------|---------------------------|------|
| `lottery_anti_streak` | **`lottery_anti_empty_streak`** | é˜²è¿ç»­ç©ºå¥– |
| _(æ— )_ | **`lottery_anti_high_streak`** | é˜²è¿ç»­é«˜ä»·å€¼ï¼ˆæ—§æ–‡æ¡£æ¼æ‰ï¼‰ |
| `lottery_dynamic_probability` | _(å·²ä¸å­˜åœ¨)_ | æ—§æ–‡æ¡£æœ‰ï¼Œå®é™…åº“ä¸­æ—  |
| `lottery_budget_filter` | **`lottery_budget_tier`** | é¢„ç®—åˆ†å±‚æ§åˆ¶ |
| `lottery_quota_system` | **`lottery_pressure_tier`** | æ´»åŠ¨å‹åŠ›åˆ†å±‚ |

### å…¶ä»–å…³é”®ä¿®æ­£

- **è§’è‰²æ•°æ®**ï¼šå®é™…å«11æ¡ï¼ˆ9æ¡æ­£å¼ + `campaign_2` + `test_role_api` ä¸¤æ¡æµ‹è¯•æ•°æ®ï¼‰
- **ç®¡ç†å‘˜ç”¨æˆ·**ï¼šå®é™…æœ‰4ä¸ª admin è§’è‰²ç”¨æˆ·ï¼ˆuser_id=31, 135, 11114, 11132ï¼‰
- **æ´»åŠ¨æ•°æ®**ï¼šæ´»åŠ¨IDå®é™…ä¸º 1/25/26/27ï¼ˆéè¿ç»­1-4ï¼‰ï¼Œä»…æ´»åŠ¨1ä¸ºæ­£å¼æ•°æ®
- **å¥–å“ç±»å‹**ï¼šå®é™… prize_type æšä¸¾ä¸º `points/coupon/physical/virtual/service/product/special`ï¼ˆæ—§æ–‡æ¡£å†™çš„ `empty/asset/item` ä¸æ­£ç¡®ï¼‰

---

## ğŸ”´ å·²é€‰å®šï¼šæ–¹æ¡ˆ Bï¼ˆæ¿€è¿›æ¸…ç†ï¼‰

> **å†³ç­–æ—¶é—´**ï¼š2026-02-16  
> **æ¸…ç†èŒƒå›´**ï¼š77 å¼ è¡¨ TRUNCATEï¼ˆä»…ä¿ç•™ `sequelizemeta` + `administrative_regions`ï¼›`products`è¡¨å·²åˆ é™¤ï¼‰  
> **æ¢å¤æ—¶é—´**ï¼š2-4 å°æ—¶ï¼ˆéœ€é‡å»ºæ‰€æœ‰é…ç½®ã€ç”¨æˆ·ã€æ´»åŠ¨ï¼‰

### âš ï¸ æ–¹æ¡ˆBä¼šæ¸…ç©ºçš„é…ç½®è¡¨ï¼ˆå…±24ä¸ªï¼Œå«ä¸šåŠ¡æ ¸å¿ƒé…ç½®æ•°æ®ï¼‰

| è¡¨å | å®é™…æ•°æ®é‡ | é‡è¦æ€§ | è¯´æ˜ |
|------|-----------|--------|------|
| `roles` | 11 æ¡ | ğŸ”´ å¿…éœ€ | è§’è‰²å®šä¹‰ï¼ˆå«1æ¡æµ‹è¯•è§’è‰² `test_role_api`ï¼‰ |
| `system_settings` | 42 æ¡ | ğŸ”´ å¿…éœ€ | ç³»ç»Ÿé…ç½®ï¼ˆç§¯åˆ†/å®‰å…¨/é€šçŸ¥/å¸‚åœºç­‰ï¼‰ |
| `system_configs` | 9 æ¡ | ğŸ”´ å¿…éœ€ | æ‰¹é‡é™æµ/æ´»åŠ¨ä½ç½®/å•†å“ç­›é€‰/åé¦ˆé…ç½® |
| `material_asset_types` | 4 æ¡ | ğŸ”´ å¿…éœ€ | èµ„äº§ç±»å‹å®šä¹‰ï¼ˆPOINTS/BUDGET_POINTS/DIAMOND/red_shardï¼‰ |
| `feature_flags` | 7 æ¡ | ğŸ”´ å¿…éœ€ | åŠŸèƒ½å¼€å…³ï¼ˆæŠ½å¥–ç­–ç•¥å¼•æ“ï¼‰ |
| `lottery_campaigns` | 4 æ¡ | ğŸ”´ å¿…éœ€ | æ´»åŠ¨é…ç½®ï¼ˆID=1 activeï¼Œ25/27 endedï¼Œ26 pausedï¼‰ |
| `lottery_prizes` | 30 æ¡ | ğŸ”´ å¿…éœ€ | å¥–å“æ± å®šä¹‰ï¼ˆ15ä¸ªå±äºæ´»åŠ¨1ï¼Œ7+8ä¸ªå±äºæµ‹è¯•æ´»åŠ¨ï¼‰ |
| `category_defs` | 9 æ¡ | ğŸŸ¡ å»ºè®® | ç‰©å“ç±»ç›®å­—å…¸ |
| `rarity_defs` | 5 æ¡ | ğŸŸ¡ å»ºè®® | ç¨€æœ‰åº¦å­—å…¸ï¼ˆcommon/uncommon/rare/epic/legendaryï¼‰ |
| `asset_group_defs` | 8 æ¡ | ğŸŸ¡ å»ºè®® | èµ„äº§ç»„å­—å…¸ |
| `lottery_tier_rules` | 9 æ¡ | ğŸŸ¡ å»ºè®® | æ¡£ä½æ¦‚ç‡è§„åˆ™ |
| `lottery_strategy_config` | 17 æ¡ | ğŸŸ¡ å»ºè®® | ç­–ç•¥å…¨å±€é…ç½® |
| `lottery_tier_matrix_config` | 12 æ¡ | ğŸŸ¡ å»ºè®® | BxPxçŸ©é˜µé…ç½® |
| `lottery_draw_quota_rules` | 11 æ¡ | ğŸŸ¡ å»ºè®® | é…é¢è§„åˆ™ |
| `preset_debt_limits` | 1 æ¡ | ğŸŸ¡ å»ºè®® | æ¬ è´¦ä¸Šé™ï¼ˆå…¨å±€é»˜è®¤ï¼šåº“å­˜1000ä»¶ï¼Œé¢„ç®—1000000åˆ†ï¼‰ |
| `item_templates` | 16 æ¡ | ğŸŸ¡ å»ºè®® | ç‰©å“æ¨¡æ¿ï¼ˆç‰©å“å¥–å“éœ€è¦ï¼‰ |
| `stores` | 5 æ¡ | ğŸŸ¡ å»ºè®® | é—¨åº—é…ç½®ï¼ˆå…¨éƒ¨ä¸ºæµ‹è¯•é—¨åº—ï¼‰ |
| ~~`products`~~ | ~~52 æ¡~~ | ~~å·²åˆ é™¤~~ | ~~å•†å“é…ç½®ï¼ˆè¡¨å·²ä»æ•°æ®åº“åˆ é™¤ï¼‰~~ |
| `exchange_items` | **89** æ¡ | ğŸŸ¡ å»ºè®® | å…‘æ¢å•†å“ï¼ˆæ–°å¢ space/tags/å±•ç¤ºå­—æ®µï¼›lucky=81, premium=4, both=4ï¼‰ |
| `system_dictionaries` | **371** æ¡ | ğŸŸ¡ å»ºè®® | ç³»ç»Ÿå­—å…¸ï¼ˆ**74**ç§å­—å…¸ç±»å‹çš„ä¸­æ–‡æ˜ å°„ï¼‰ |
| `lottery_campaign_pricing_config` | **14** æ¡ | ğŸŸ¡ å»ºè®® | æ´»åŠ¨å®šä»·é…ç½®ï¼ˆç‰ˆæœ¬åŒ–JSONï¼Œæ´»åŠ¨1æœ€æ–°v11 base_cost=100ï¼‰ |
| `material_conversion_rules` | 1 æ¡ | ğŸŸ¡ å»ºè®® | èµ„äº§è½¬æ¢è§„åˆ™ï¼ˆçº¢æ°´æ™¶ç¢ç‰‡â†’é’»çŸ³ 1:20ï¼Œæ–°å¢è´¹ç‡/å±•ç¤ºå­—æ®µï¼‰ |
| `user_risk_profiles` | 3 æ¡ | ğŸŸ¡ å»ºè®® | é£æ§çº§åˆ«é…ç½® |
| `reminder_rules` | 3 æ¡ | ğŸŸ¡ å»ºè®® | æé†’è§„åˆ™é…ç½® |

**ğŸŸ¡ å»ºè®®æ•°æ®ä¸é…ç½®çš„åæœ**ï¼š
| ç¼ºå¤±æ•°æ® | å½±å“ |
|----------|------|
| æŠ½å¥–ç­–ç•¥é…ç½® | æŠ½å¥–ä»…ä½¿ç”¨åŸºç¡€æ¦‚ç‡ï¼Œæ— Pity/LuckDebtç­‰é«˜çº§ç­–ç•¥ |
| ç‰©å“æ¨¡æ¿ | æ— æ³•å‘æ”¾ç‰©å“ç±»å‹å¥–å“ï¼Œåªèƒ½å‘æ”¾èµ„äº§ |
| é—¨åº— | æ¶ˆè´¹åŠŸèƒ½ä¸å¯ç”¨ï¼Œç”¨æˆ·æ— æ³•é€šè¿‡æ¶ˆè´¹è·å¾—ç§¯åˆ† |
| å…‘æ¢å•†å“ | å…‘æ¢åŠŸèƒ½ä¸å¯ç”¨ |
| ç³»ç»Ÿå­—å…¸ | éƒ¨åˆ†ç•Œé¢æ˜¾ç¤ºè‹±æ–‡ä»£ç è€Œéä¸­æ–‡ï¼ˆ74ç§å­—å…¸ç±»å‹ä¸¢å¤±ï¼‰ |
| ç³»ç»Ÿé…ç½® | æ‰¹é‡æ“ä½œé™æµ/æ´»åŠ¨ä½ç½®/å•†å“ç­›é€‰ç­‰é…ç½®ä¸¢å¤± |
| æ´»åŠ¨å®šä»· | æŠ½å¥–å®šä»·é…ç½®ä¸¢å¤± |
| é£æ§é…ç½® | é£æ§çº§åˆ«è§„åˆ™ä¸¢å¤± |
| è½¬æ¢è§„åˆ™ | çº¢æ°´æ™¶ç¢ç‰‡â†’é’»çŸ³è½¬æ¢åŠŸèƒ½ä¸å¯ç”¨ |
| æé†’è§„åˆ™ | ç³»ç»Ÿæé†’åŠŸèƒ½ä¸å¯ç”¨ |

---

### âš ï¸ é‡å»ºæ•°æ®çš„æ‰§è¡Œé¡ºåºï¼ˆæœ‰å¤–é”®ä¾èµ–ï¼Œ114æ¡FKçº¦æŸï¼‰

```
ç¬¬ä¸€æ‰¹ï¼šæ— å¤–é”®ä¾èµ–çš„åŸºç¡€å­—å…¸ï¼ˆå¯å¹¶è¡Œï¼‰
  1. roles              â† æœ€å…ˆæ’å…¥ï¼ˆuser_rolesã€user_hierarchy ä¾èµ–å®ƒï¼‰
  2. asset_group_defs   â† èµ„äº§ç»„å­—å…¸ï¼ˆmaterial_asset_types ä¾èµ–å®ƒï¼‰
  3. rarity_defs        â† ç¨€æœ‰åº¦å­—å…¸ï¼ˆitem_templatesã€lottery_prizes ä¾èµ–å®ƒï¼‰
  4. category_defs      â† ç±»ç›®å­—å…¸ï¼ˆitem_templates ä¾èµ–å®ƒï¼‰
  5. system_settings    â† ç³»ç»Ÿé…ç½®ï¼ˆ42æ¡ï¼‰
  6. system_configs     â† ç³»ç»Ÿé…ç½®ï¼ˆ9æ¡JSONï¼‰
  7. feature_flags      â† åŠŸèƒ½å¼€å…³ï¼ˆ7æ¡ï¼‰
  8. system_dictionaries â† ç³»ç»Ÿå­—å…¸ï¼ˆ369æ¡/73ç§ç±»å‹ï¼Œå¯é€‰ä½†æ¨èï¼‰
  9. user_risk_profiles â† é£æ§çº§åˆ«ï¼ˆ3æ¡ï¼‰

ç¬¬äºŒæ‰¹ï¼šä¾èµ–ç¬¬ä¸€æ‰¹çš„é…ç½®è¡¨
  10. material_asset_types â† èµ„äº§ç±»å‹ï¼ˆä¾èµ– asset_group_defs.group_codeï¼‰
  11. accounts           â† ğŸ”´ æ‰‹åŠ¨INSERT 6ä¸ªç³»ç»Ÿè´¦æˆ·ï¼ˆä¸å¯è¿ç§»é‡å»ºï¼‰
  12. lottery_campaigns  â† æ´»åŠ¨é…ç½®ï¼ˆlottery_prizes ä¾èµ–å®ƒï¼‰
  13. lottery_strategy_config â† ç­–ç•¥é…ç½®ï¼ˆ17æ¡ï¼‰
  14. lottery_tier_matrix_config â† BxPxçŸ©é˜µï¼ˆ12æ¡ï¼‰
  15. lottery_draw_quota_rules â† é…é¢è§„åˆ™ï¼ˆ11æ¡ï¼‰
  16. preset_debt_limits â† æ¬ è´¦ä¸Šé™ï¼ˆ1æ¡ï¼‰

ç¬¬ä¸‰æ‰¹ï¼šä¾èµ–ç¬¬äºŒæ‰¹çš„ä¸šåŠ¡æ•°æ®
  17. lottery_prizes    â† å¥–å“æ± ï¼ˆä¾èµ– lottery_campaigns + rarity_defsï¼‰
  18. lottery_campaign_pricing_config â† å®šä»·é…ç½®ï¼ˆä¾èµ– lottery_campaignsï¼‰
  19. item_templates    â† ç‰©å“æ¨¡æ¿ï¼ˆä¾èµ– category_defs + rarity_defsï¼‰
  20. material_conversion_rules â† è½¬æ¢è§„åˆ™ï¼ˆä¾èµ– material_asset_typesï¼‰
  21. stores            â† é—¨åº—é…ç½®ï¼ˆå¯é€‰ï¼‰
  22. lottery_tier_rules â† æ¡£ä½è§„åˆ™ï¼ˆä¾èµ– lottery_campaignsï¼‰

ç¬¬å››æ‰¹ï¼šç”¨æˆ·æ•°æ®
  23. [ç®¡ç†å‘˜æ‰‹æœºå·ç™»å½•] â† ç³»ç»Ÿè‡ªåŠ¨åˆ›å»º users è®°å½•
  24. user_roles        â† å…³è”ç®¡ç†å‘˜è§’è‰²ï¼ˆä¾èµ– users å’Œ rolesï¼‰
```

---

### ğŸ”´ å¿…é¡»å‡†å¤‡çš„æ•°æ®ï¼ˆå¦åˆ™ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼‰

#### 1ï¸âƒ£ ç®¡ç†å‘˜æ‰‹æœºå·
`____________`

âš ï¸ **é‡è¦**ï¼šç”¨æˆ·ç™»å½•ä¼šè‡ªåŠ¨åˆ›å»º `users` è®°å½•ï¼Œä½†**ä¸ä¼šè‡ªåŠ¨èµ‹äºˆadminè§’è‰²**ï¼

**å½“å‰æ•°æ®åº“ä¸­çš„ç®¡ç†å‘˜**ï¼ˆæ¸…ç†åå…¨éƒ¨ä¸¢å¤±ï¼‰ï¼š
- user_id=31, 135, 11114, 11132ï¼ˆå…±4ä¸ªadminè§’è‰²ç”¨æˆ·ï¼‰

**æ¸…ç©ºåæˆæƒç®¡ç†å‘˜çš„å®Œæ•´æ­¥éª¤**ï¼š
```bash
# æ­¥éª¤1ï¼šç®¡ç†å‘˜ç”¨æ‰‹æœºå·ç™»å½•ç³»ç»Ÿï¼ˆéªŒè¯ç 123456ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºç”¨æˆ·

# æ­¥éª¤2ï¼šæŸ¥è¯¢æ–°å»ºç”¨æˆ·çš„user_idå’Œadminè§’è‰²çš„role_id
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  const [[user]] = await sequelize.query(\"SELECT user_id FROM users WHERE mobile='ä½ çš„æ‰‹æœºå·'\");
  const [[role]] = await sequelize.query(\"SELECT role_id FROM roles WHERE role_name='admin'\");
  console.log('user_id:', user?.user_id, 'role_id:', role?.role_id);
  if (user && role) {
    console.log('æ‰§è¡ŒSQL: INSERT INTO user_roles (user_id, role_id) VALUES (' + user.user_id + ', ' + role.role_id + ');');
  }
  await sequelize.close();
})();
"

# æ­¥éª¤3ï¼šæ‰§è¡ŒINSERTå…³è”ç”¨æˆ·å’Œè§’è‰²
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  await sequelize.query('INSERT INTO user_roles (user_id, role_id) SELECT u.user_id, r.role_id FROM users u, roles r WHERE u.mobile=\"ä½ çš„æ‰‹æœºå·\" AND r.role_name=\"admin\"');
  console.log('âœ… ç®¡ç†å‘˜è§’è‰²å·²æˆæƒ');
  await sequelize.close();
})();
"
```

#### 2ï¸âƒ£ è§’è‰²å®šä¹‰ï¼ˆ9æ¡æ­£å¼è§’è‰² + 2æ¡å…¶ä»–ï¼Œæ¸…ç†åéœ€é‡å»º9æ¡æ­£å¼è§’è‰²ï¼‰

**å­—æ®µè¯´æ˜**ï¼š
- `role_name`ï¼šè§’è‰²å”¯ä¸€æ ‡è¯†ï¼ˆä»£ç ä¸­ç”¨æ­¤å€¼åˆ¤æ–­æƒé™ï¼‰
- `role_level`ï¼šè§’è‰²ç­‰çº§æ•°å€¼ï¼ˆæ•°å€¼è¶Šé«˜æƒé™è¶Šå¤§ï¼Œç”¨äºæƒé™å±‚çº§åˆ¤æ–­ï¼‰

| role_name | role_level | è¯´æ˜ |
|-----------|------------|------|
| `admin` | 100 | ç®¡ç†å‘˜ï¼ˆæœ€é«˜æƒé™ï¼‰ |
| `regional_manager` | 80 | åŒºåŸŸç»ç† |
| `business_manager` | 60 | ä¸šåŠ¡ç»ç† |
| `merchant_manager` | 40 | å•†æˆ·ç®¡ç† |
| `sales_staff` | 40 | ä¸šåŠ¡å‘˜ |
| `ops` | 30 | è¿è¥ï¼ˆåªè¯»ï¼‰ |
| `merchant_staff` | 20 | å•†æˆ·å‘˜å·¥ |
| `user` | 0 | æ™®é€šç”¨æˆ·ï¼ˆé»˜è®¤è§’è‰²ï¼‰ |
| `system_job` | -1 | ç³»ç»Ÿä½œä¸šï¼ˆåå°å®šæ—¶ä»»åŠ¡ä¸“ç”¨ï¼Œrole_id=100ï¼‰ |

> âš ï¸ å½“å‰æ•°æ®åº“è¿˜æœ‰: `campaign_2`(level=10, id=5) å’Œ `test_role_api`(level=15, id=107)ï¼Œå‡ä¸ºæµ‹è¯•æ•°æ®ï¼Œé‡å»ºæ—¶å¯å¿½ç•¥ã€‚

#### 3ï¸âƒ£ å…³é”®ç³»ç»Ÿé…ç½®ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼Œç¼ºå¤±ä¼šæŠ¥é”™ï¼‰

**`system_settings` è¡¨å½“å‰å®é™…æ•°æ®ï¼ˆ42æ¡ï¼ŒæŒ‰categoryåˆ†ç»„ï¼‰**ï¼š

**basic åŸºç¡€é…ç½®ï¼ˆ7é¡¹ï¼‰**ï¼š
| setting_key | setting_value | è¯´æ˜ |
|-------------|---------------|------|
| `system_name` | `æµ‹è¯•` | ç³»ç»Ÿåç§° |
| `system_version` | `v1.0.0` | ç³»ç»Ÿç‰ˆæœ¬ |
| `customer_phone` | `400-999-8888` | å®¢æœç”µè¯ |
| `customer_email` | `support@example.com` | å®¢æœé‚®ç®± |
| `maintenance_mode` | `false` | ç»´æŠ¤æ¨¡å¼å¼€å…³ |
| `maintenance_message` | `ç³»ç»Ÿæ­£åœ¨å‡çº§ç»´æŠ¤ä¸­...` | ç»´æŠ¤æç¤ºä¿¡æ¯ |
| `maintenance_end_time` | _(ç©º)_ | ç»´æŠ¤ç»“æŸæ—¶é—´ |

**points ç§¯åˆ†é…ç½®ï¼ˆæ ¸å¿ƒï¼‰**ï¼š
| setting_key | setting_value | è¯´æ˜ | ä¸¥æ ¼æ¨¡å¼ |
|-------------|---------------|------|----------|
| `lottery_cost_points` | `100` | å•æŠ½æ¶ˆè€—100ç§¯åˆ† | âœ… |
| `budget_allocation_ratio` | `0.22` | æ¶ˆè´¹è¿”é¢„ç®—æ¯”ä¾‹22% | âœ… |
| `daily_lottery_limit` | `10` | æ¯æ—¥æŠ½å¥–ä¸Šé™ | âš ï¸ å»ºè®® |
| `initial_points` | `200` | æ–°ç”¨æˆ·åˆå§‹ç§¯åˆ† | |
| `sign_in_points` | `0` | ç­¾åˆ°è·å¾—ç§¯åˆ† | |
| `points_expire_days` | `365` | ç§¯åˆ†æœ‰æ•ˆå¤©æ•° | |
| `merchant_review_budget_ratio` | `0.24` | å•†æˆ·å®¡æ ¸é¢„ç®—æ¯”ä¾‹ | |
| `merchant_review_campaign_id` | `MERCHANT_REVIEW_DEFAULT` | å•†æˆ·å®¡æ ¸æ´»åŠ¨ID | |

**notification é€šçŸ¥é…ç½®**ï¼š
| setting_key | setting_value | è¯´æ˜ |
|-------------|---------------|------|
| `sms_enabled` | `true` | çŸ­ä¿¡é€šçŸ¥ |
| `email_enabled` | `false` | é‚®ä»¶é€šçŸ¥ |
| `app_notification_enabled` | `true` | APPé€šçŸ¥ |

**security å®‰å…¨é…ç½®**ï¼š
| setting_key | setting_value | è¯´æ˜ |
|-------------|---------------|------|
| `max_login_attempts` | `5` | æœ€å¤§ç™»å½•å°è¯• |
| `lockout_duration` | `30` | é”å®šæ—¶é—´(åˆ†é’Ÿ) |
| `password_min_length` | `6` | å¯†ç æœ€å°é•¿åº¦ |
| `api_rate_limit` | `100` | APIé™æµ |

**marketplace å¸‚åœºé…ç½®ï¼ˆ20æ¡ï¼‰**ï¼š
| setting_key | setting_value | è¯´æ˜ |
|-------------|---------------|------|
| `allowed_listing_assets` | `["DIAMOND","red_shard"]` | å…è®¸æŒ‚ç‰Œçš„èµ„äº§ç±»å‹ |
| `allowed_settlement_assets` | `["DIAMOND","red_shard"]` | å…è®¸ç»“ç®—çš„èµ„äº§ç±»å‹ |
| `max_active_listings` | `10` | æœ€å¤§åŒæ—¶æŒ‚å•æ•° |
| `listing_expiry_days` | `3` | æŒ‚ç‰Œè¿‡æœŸå¤©æ•° |
| `fee_rate_DIAMOND` | `0.05` | é’»çŸ³æ‰‹ç»­è´¹ç‡(5%) |
| `fee_rate_red_shard` | `0.05` | çº¢æ™¶ç‰‡æ‰‹ç»­è´¹ç‡(5%) |
| `fee_min_DIAMOND` | `1` | é’»çŸ³æœ€ä½æ‰‹ç»­è´¹ |
| `fee_min_red_shard` | `1` | çº¢æ™¶ç‰‡æœ€ä½æ‰‹ç»­è´¹ |
| `daily_max_listings_DIAMOND` | `20` | é’»çŸ³æ¯æ—¥æœ€å¤§æŒ‚ç‰Œæ•° |
| `daily_max_listings_red_shard` | `20` | çº¢æ™¶ç‰‡æ¯æ—¥æœ€å¤§æŒ‚ç‰Œæ•° |
| `daily_max_trades_DIAMOND` | `10` | é’»çŸ³æ¯æ—¥æœ€å¤§äº¤æ˜“æ•° |
| `daily_max_trades_red_shard` | `10` | çº¢æ™¶ç‰‡æ¯æ—¥æœ€å¤§äº¤æ˜“æ•° |
| `daily_max_amount_DIAMOND` | `100000` | é’»çŸ³æ¯æ—¥æœ€å¤§äº¤æ˜“é‡ |
| `daily_max_amount_red_shard` | `50000` | çº¢æ™¶ç‰‡æ¯æ—¥æœ€å¤§äº¤æ˜“é‡ |
| `min_price_red_shard` | `1` | çº¢æ™¶ç‰‡æœ€ä½ä»·æ ¼ |
| `max_price_red_shard` | `1000000` | çº¢æ™¶ç‰‡æœ€é«˜ä»·æ ¼ |
| `monitor_alert_enabled` | `true` | å¸‚åœºç›‘æ§å‘Šè­¦å¼€å…³ |
| `monitor_long_listing_days` | `7` | é•¿æœŸæŒ‚ç‰Œå‘Šè­¦å¤©æ•° |
| `monitor_price_high_threshold` | `3.0` | ä»·æ ¼åé«˜å‘Šè­¦é˜ˆå€¼ |
| `monitor_price_low_threshold` | `0.1` | ä»·æ ¼åä½å‘Šè­¦é˜ˆå€¼ |

> æ€»è®¡42æ¡ï¼šbasic(**7**) + points(8) + notification(3) + security(4) + marketplace(20)ã€‚

#### 4ï¸âƒ£ èµ„äº§ç±»å‹å®šä¹‰ï¼ˆ4æ¡ï¼‰

**å­—æ®µè¯´æ˜**ï¼š
- `asset_code`ï¼šèµ„äº§å”¯ä¸€æ ‡è¯†ï¼ˆä»£ç ä¸­å¼•ç”¨æ­¤å€¼ï¼‰
- `display_name`ï¼šä¸­æ–‡æ˜¾ç¤ºåç§°
- `group_code`ï¼šæ‰€å±èµ„äº§ç»„ï¼ˆFK â†’ `asset_group_defs.group_code`ï¼‰
- `is_tradable`ï¼šæ˜¯å¦å¯äº¤æ˜“ï¼ˆ1=æ˜¯ï¼Œ0=å¦ï¼‰

| asset_code | display_name | group_code | is_tradable | ç”¨é€” |
|------------|-------------|------------|-------------|------|
| `POINTS` | æ™®é€šç§¯åˆ† | `points` | 0 | æ¶ˆè´¹è·å¾—ï¼Œç”¨äºæŠ½å¥–ï¼Œis_enabled=0ï¼ˆé€šè¿‡system_settingsæ§åˆ¶ï¼‰ |
| `BUDGET_POINTS` | é¢„ç®—ç§¯åˆ† | `points` | 0 | é¢„ç®—çº¦æŸæŠ½å¥–ï¼ŒæŒ‰æ´»åŠ¨éš”ç¦»ï¼ˆlottery_campaign_idï¼‰ |
| `DIAMOND` | é’»çŸ³ | `currency` | 1 | æŠ½å¥–è·å¾—ï¼Œå¯åœ¨å¸‚åœºæŒ‚å•äº¤æ˜“ï¼Œform=currencyï¼Œtier=10 |
| `red_shard` | **çº¢æ°´æ™¶ç¢ç‰‡** | `red` | 1 | æŠ½å¥–è·å¾—ï¼Œå¯äº¤æ˜“ï¼Œå¯åˆ†è§£ï¼ˆ1:20â†’é’»çŸ³ï¼‰ï¼Œform=shardï¼Œtier=1 |

#### 5ï¸âƒ£ åŠŸèƒ½å¼€å…³ï¼ˆ7æ¡ï¼Œæ§åˆ¶æŠ½å¥–ç­–ç•¥å¼•æ“ï¼‰

**å­—æ®µè¯´æ˜**ï¼š
- `flag_key`ï¼šåŠŸèƒ½å¼€å…³å”¯ä¸€æ ‡è¯†
- `is_enabled`ï¼šæ˜¯å¦å¯ç”¨ï¼ˆ`1`=å¯ç”¨ï¼Œ`0`=ç¦ç”¨ï¼‰
- `rollout_strategy`ï¼šå½“å‰å…¨éƒ¨ä¸º `all`ï¼ˆå…¨é‡å‘å¸ƒï¼‰

| flag_key | is_enabled | related_config_group | è¯´æ˜ |
|----------|------------|---------------------|------|
| `lottery_pity_system` | `1` | `pity` | **Pityä¿åº•**ï¼šè¿ç»­ç©ºå¥–æ—¶é€æ­¥æå‡éç©ºå¥–æ¦‚ç‡ |
| `lottery_luck_debt` | `1` | `luck_debt` | **è¿æ°”å€ºåŠ¡**ï¼šåŸºäºç”¨æˆ·å†å²ç©ºå¥–ç‡çš„é•¿æœŸå¹³è¡¡è°ƒæ•´ |
| `lottery_anti_empty_streak` | `1` | `anti_empty` | **é˜²è¿ç»­ç©ºå¥–**ï¼šè¿ç»­Kæ¬¡ç©ºå¥–åå¼ºåˆ¶å‘æ”¾éç©ºå¥– |
| `lottery_anti_high_streak` | `1` | `anti_high` | **é˜²è¿ç»­é«˜ä»·å€¼**ï¼šé˜²æ­¢çŸ­æ—¶é—´å†…è¿ç»­è·å¾—é«˜ä»·å€¼å¥–å“ |
| `lottery_bxpx_matrix` | `1` | (null) | **BxPxçŸ©é˜µè°ƒæƒ**ï¼šæ ¹æ®é¢„ç®—åˆ†å±‚å’Œæ´»åŠ¨å‹åŠ›åŠ¨æ€è°ƒæ•´æƒé‡ |
| `lottery_budget_tier` | `1` | `budget_tier` | **é¢„ç®—åˆ†å±‚æ§åˆ¶**ï¼šB0-B3 å››å±‚é¢„ç®—åˆ†å±‚æœºåˆ¶ |
| `lottery_pressure_tier` | `1` | `pressure_tier` | **æ´»åŠ¨å‹åŠ›åˆ†å±‚**ï¼šP0-P2 ä¸‰å±‚æ´»åŠ¨å‹åŠ›æ§åˆ¶ |

#### 6ï¸âƒ£ æ´»åŠ¨ä¸å¥–å“

**å½“å‰æ´»åŠ¨æ•°æ®ï¼ˆ`lottery_campaigns`ï¼Œ4æ¡ï¼‰**ï¼š
| lottery_campaign_id | campaign_name | status | å¥–å“æ•° | æŠ½å¥–è®°å½•æ•° |
|---------------------|---------------|--------|--------|------------|
| 1 | é¤å…ç§¯åˆ†æŠ½å¥– | `active`ï¼ˆbudget_mode=`user`ï¼‰ | 15 | 2177 |
| 25 | èµ°èµ°èµ° | `ended` | 0 | 0 |
| 26 | å†æ‰¾æ‰¾ | `paused` | 7 | 0 |
| 27 | 12312 | `ended` | 8 | 0 |

> æ´»åŠ¨1æ˜¯ä¸»æ´»åŠ¨ï¼ŒID 25/26/27 å‡ä¸ºæµ‹è¯•æ´»åŠ¨ã€‚é‡å»ºæ—¶ä»…éœ€åˆ›å»ºä¸»æ´»åŠ¨ã€‚

**æ´»åŠ¨1çš„å¥–å“æ± ï¼ˆ`lottery_prizes`ï¼Œ15æ¡ï¼‰**ï¼š
| lottery_prize_id | prize_name | prize_type | reward_tier | è¯´æ˜ |
|-----------------|------------|------------|-------------|------|
| 1 | å…«å…«æŠ˜ | coupon | high | ä¼˜æƒ åˆ¸ |
| 2 | 100ç§¯åˆ† | points | mid | ç§¯åˆ†å¥–å“ |
| 3 | ç”œå“1ä»½ | physical | mid | å®ç‰© |
| 4 | é’èœ1ä»½ | physical | low | å®ç‰© |
| 5 | 2000ç§¯åˆ†åˆ¸ | points | high | é«˜ä»·å€¼ç§¯åˆ† |
| 6 | 500ç§¯åˆ†åˆ¸ | points | high | ä¸­ä»·å€¼ç§¯åˆ† |
| 7 | ç²¾å“é¦–é¥°ä¸€ä¸ª | physical | mid | å®ç‰© |
| 8 | ç”Ÿè…Œæ‹¼ç›˜158 | physical | mid | å®ç‰© |
| 9 | ä¹å…«æŠ˜åˆ¸ | coupon | high | ä¼˜æƒ åˆ¸ |
| 114 | ç¥ç§˜å½©è›‹ | virtual | low | è™šæ‹Ÿç©ºå¥– |
| 115 | å¥½è¿åŠ æŒ | virtual | low | è™šæ‹Ÿç©ºå¥– |
| 116 | ç¾é£Ÿæ¨è | virtual | low | è™šæ‹Ÿç©ºå¥– |
| 117 | å¨å¸ˆç¥ç¦ | virtual | low | è™šæ‹Ÿç©ºå¥– |
| 118 | ä¸‹æ¬¡å¥½è¿ | virtual | low | è™šæ‹Ÿç©ºå¥– |
| 119 | å‚ä¸æœ‰ç¤¼ | virtual | low | è™šæ‹Ÿç©ºå¥– |

> æµ‹è¯•æ´»åŠ¨ 26/27 çš„å¥–å“ï¼ˆ15æ¡ï¼‰å‡ä¸ºæµ‹è¯•æ•°æ®ï¼ˆ"æµ‹è¯•å¥–å“""è‡ªæ²»å·""123"ç­‰ï¼‰ï¼Œé‡å»ºæ—¶å¯å¿½ç•¥ã€‚

**é‡å»ºæ´»åŠ¨é…ç½®å­—æ®µè¯´æ˜**ï¼š
- `campaign_code`ï¼šæ´»åŠ¨å”¯ä¸€æ ‡è¯†
- `campaign_type`ï¼šæ´»åŠ¨ç±»å‹ï¼ˆå½“å‰å‡ä¸º `event`ï¼‰
- `budget_mode`ï¼šé¢„ç®—æ¨¡å¼ï¼ˆ`none`/`user`/`pool`ï¼‰
- `status`ï¼šæ´»åŠ¨çŠ¶æ€ï¼ˆ`active`/`paused`/`ended`ï¼‰

#### 7ï¸âƒ£ ç³»ç»Ÿè´¦æˆ·ï¼ˆè¿ç§»è„šæœ¬è‡ªåŠ¨åˆ›å»ºï¼‰

**è¯´æ˜**ï¼šç³»ç»Ÿè´¦æˆ·æ˜¯èµ„äº§æµè½¬çš„"å¯¹æ‰‹æ–¹"ï¼Œç”¨äºè®°è´¦å’Œå®¡è®¡ã€‚

| system_code | è¯´æ˜ | ç”¨é€”åœºæ™¯ |
|-------------|------|----------|
| `SYSTEM_PLATFORM_FEE` | å¹³å°æ‰‹ç»­è´¹è´¦æˆ· | å¸‚åœºäº¤æ˜“æŠ½å–æ‰‹ç»­è´¹æ—¶è®°å…¥ |
| `SYSTEM_MINT` | ç³»ç»Ÿå‘æ”¾è´¦æˆ· | æŠ½å¥–å‘æ”¾å¥–å“ã€æ´»åŠ¨èµ é€èµ„äº§æ—¶ä½œä¸ºæ¥æº |
| `SYSTEM_BURN` | ç³»ç»Ÿé”€æ¯è´¦æˆ· | èµ„äº§é”€æ¯ã€è¿‡æœŸå›æ”¶æ—¶ä½œä¸ºå»å‘ |
| `SYSTEM_ESCROW` | æ‰˜ç®¡è´¦æˆ· | å¸‚åœºæŒ‚å•å†»ç»“èµ„äº§æ—¶æš‚å­˜ |
| `SYSTEM_RESERVE` | å‚¨å¤‡é‡‘è´¦æˆ· | ç³»ç»Ÿé¢„ç•™èµ„äº§æ±  |
| `SYSTEM_CAMPAIGN_POOL` | æ´»åŠ¨æ± é¢„ç®—è´¦æˆ· | æ´»åŠ¨é¢„ç®—æ± æ¨¡å¼ä¸‹çš„é¢„ç®—æ¥æº |

---

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

æœ¬æ–‡æ¡£é€‚ç”¨äºä»¥ä¸‹ä»»ä½•éœ€è¦"æ¢å¤å¹²å‡€æµ‹è¯•ç¯å¢ƒ"çš„åœºæ™¯ï¼š

1. **æ¶æ„é‡æ„å‰**ï¼šå¦‚å®æ–½é¢„ç®—ç§¯åˆ†ä½“ç³»ã€èµ„äº§ä½“ç³»å‡çº§ç­‰
2. **è„æ•°æ®æ¸…ç†**ï¼šæµ‹è¯•è¿‡ç¨‹ä¸­äº§ç”Ÿå¤§é‡è„æ•°æ®ï¼Œå½±å“åç»­æµ‹è¯•
3. **åŠŸèƒ½éªŒè¯å‡†å¤‡**ï¼šéœ€è¦å¹²å‡€çš„åˆå§‹çŠ¶æ€éªŒè¯æ–°åŠŸèƒ½
4. **ç¯å¢ƒé‡ç½®**ï¼šå®šæœŸæ¢å¤æµ‹è¯•ç¯å¢ƒåˆ°å·²çŸ¥çŠ¶æ€
5. **æ€§èƒ½æµ‹è¯•å‡†å¤‡**ï¼šæ¸…ç†å†å²æ•°æ®ï¼Œä»å·²çŸ¥åŸºçº¿å¼€å§‹æµ‹è¯•

---

## ğŸ”´ æ–¹æ¡ˆBå¿…éœ€ä¿¡æ¯é€ŸæŸ¥ï¼ˆæ¿€è¿›æ¸…ç†ï¼‰

> å¦‚æœé€‰æ‹©æ–¹æ¡ˆBï¼ˆæ¿€è¿›æ¸…ç†ï¼‰ï¼Œæ‰§è¡Œå‰å¿…é¡»å‡†å¤‡ä»¥ä¸‹ä¿¡æ¯ï¼Œå¦åˆ™ç³»ç»Ÿæ— æ³•æ­£å¸¸è¿è¡Œã€‚

### 1ï¸âƒ£ ç®¡ç†å‘˜è´¦å·ï¼ˆå¿…éœ€ï¼‰

> é¡¹ç›®ä½¿ç”¨**æ‰‹æœºå·+éªŒè¯ç **ç™»å½•ã€‚å¼€å‘ç¯å¢ƒéªŒè¯ç å›ºå®šä¸º `123456`ã€‚

| å­—æ®µ | ä½ çš„è¾“å…¥ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ |
|------|----------|----------|--------|
| æ‰‹æœºå· | `____________` | âœ… å¿…å¡« | - |
| æ˜µç§° | `____________` | âšª å¯é€‰ | `ç”¨æˆ·` + æ‰‹æœºå·å4ä½ |
| è§’è‰² | `____________` | âœ… å¿…å¡« | æ™®é€šç”¨æˆ·éœ€æ‰‹åŠ¨æˆæƒä¸º `admin` |

### 2ï¸âƒ£ å…³é”®é…ç½®å‚æ•°ï¼ˆå¿…éœ€ï¼‰

| é…ç½®é¡¹ | ä½ çš„è¾“å…¥ | æ¨èå€¼ | è¯´æ˜ |
|--------|----------|--------|------|
| `lottery_cost_points` | `____________` | `100` | å•æŠ½æ¶ˆè€—ç§¯åˆ† |
| `budget_allocation_ratio` | `____________` | `0.22` | æ¶ˆè´¹è¿”é¢„ç®—æ¯”ä¾‹(22%) |
| `daily_lottery_limit` | `____________` | `10` | æ¯æ—¥æŠ½å¥–ä¸Šé™ |

### 3ï¸âƒ£ æ´»åŠ¨é…ç½®ï¼ˆå¿…éœ€ï¼‰

| å­—æ®µ | ä½ çš„è¾“å…¥ | ç¤ºä¾‹ |
|------|----------|------|
| æ´»åŠ¨ä»£ç  | `____________` | `BASIC_LOTTERY` |
| æ´»åŠ¨åç§° | `____________` | `åŸºç¡€æŠ½å¥–æ´»åŠ¨` |
| é¢„ç®—æ¨¡å¼ | `____________` | `none` / `user` / `pool` |
| å•æŠ½æ¶ˆè€— | `____________` | `100` |

### 4ï¸âƒ£ å¥–å“æ± é…ç½®ï¼ˆå¿…éœ€ï¼Œè‡³å°‘5ä¸ªï¼‰

> âš ï¸ **prize_type å®é™…æšä¸¾**ï¼š`points`/`coupon`/`physical`/`virtual`/`service`/`product`/`special`

| å¥–å“åç§° | prize_type | reward_tier | è¯´æ˜ |
|----------|-----------|-------------|------|
| `____________` | `virtual` | `low` | ç©ºå¥–/å®‰æ…°å¥–ï¼ˆå¿…éœ€ï¼Œå å¤§æ¯”ä¾‹ï¼‰ |
| `____________` | `points` | `mid` | ç§¯åˆ†å¥–å“ |
| `____________` | `points` | `high` | é«˜ä»·å€¼ç§¯åˆ† |
| `____________` | `coupon` | `high` | ä¼˜æƒ åˆ¸ |
| `____________` | `physical` | `mid` | å®ç‰©å¥–å“ |

### 5ï¸âƒ£ èµ„äº§ç±»å‹ï¼ˆå¿…éœ€ï¼‰

| asset_code | æ˜¾ç¤ºåç§° | æ˜¯å¦å¿…éœ€ |
|------------|----------|----------|
| `POINTS` | æ™®é€šç§¯åˆ† | âœ… å¿…éœ€ |
| `BUDGET_POINTS` | é¢„ç®—ç§¯åˆ† | âœ… å¿…éœ€ |
| `DIAMOND` | é’»çŸ³ | âš ï¸ æœ‰äº¤æ˜“å¸‚åœºåˆ™å¿…éœ€ |
| `red_shard` | çº¢è‰²ç¢ç‰‡ | âš ï¸ æœ‰åˆæˆåŠŸèƒ½åˆ™å¿…éœ€ |

### 6ï¸âƒ£ ç³»ç»Ÿè´¦æˆ·ï¼ˆâš ï¸ å¿…é¡»æ‰‹åŠ¨é‡å»ºï¼Œä¸å¯é‡è·‘è¿ç§»ï¼‰

> ğŸ”´ **å…³é”®è­¦å‘Š**ï¼š`sequelizemeta` ä¿ç•™äº† 336 æ¡è¿ç§»è®°å½•ï¼ŒSequelize è®¤ä¸ºæ‰€æœ‰è¿ç§»å·²æ‰§è¡Œè¿‡ï¼Œ`db:migrate` ä¸ä¼šé‡æ–°åˆ›å»ºç³»ç»Ÿè´¦æˆ·ã€‚  
> åŸå§‹è¿ç§»æ–‡ä»¶å·²å½’æ¡£åˆ° `migrations/archive/v1-legacy/`ã€‚  
> `BalanceService.getOrCreateAccount({system_code})` **ä¸ä¼šè‡ªåŠ¨åˆ›å»º**ç³»ç»Ÿè´¦æˆ·ï¼Œç¼ºå¤±ä¼šç›´æ¥æŠ¥é”™ï¼š  
> `ç³»ç»Ÿè´¦æˆ·ä¸å­˜åœ¨ï¼šsystem_code=xxxï¼Œè¯·æ£€æŸ¥æ•°æ®åº“åˆå§‹åŒ–`

**å¿…é¡»æ‰‹åŠ¨ INSERT 6 ä¸ªç³»ç»Ÿè´¦æˆ·**ï¼ˆaccount_id è®©æ•°æ®åº“è‡ªå¢ï¼‰ï¼š

| system_code | account_type | è¯´æ˜ |
|-------------|-------------|------|
| `SYSTEM_PLATFORM_FEE` | `system` | å¹³å°æ‰‹ç»­è´¹è´¦æˆ·ï¼ˆäº¤æ˜“æ‰‹ç»­è´¹å…¥è´¦ï¼‰ |
| `SYSTEM_MINT` | `system` | ç³»ç»Ÿå‘æ”¾è´¦æˆ·ï¼ˆæŠ½å¥–å‘æ”¾ã€æ´»åŠ¨èµ é€æ¥æºï¼‰ |
| `SYSTEM_BURN` | `system` | ç³»ç»Ÿé”€æ¯è´¦æˆ·ï¼ˆè¿‡æœŸå›æ”¶å»å‘ï¼‰ |
| `SYSTEM_ESCROW` | `system` | æ‰˜ç®¡è´¦æˆ·ï¼ˆå¸‚åœºæŒ‚å•å†»ç»“æš‚å­˜ï¼‰ |
| `SYSTEM_RESERVE` | `system` | å‚¨å¤‡é‡‘è´¦æˆ·ï¼ˆç³»ç»Ÿé¢„ç•™èµ„äº§æ± ï¼‰ |
| `SYSTEM_CAMPAIGN_POOL` | `system` | æ´»åŠ¨æ± é¢„ç®—è´¦æˆ·ï¼ˆpoolé¢„ç®—æ¨¡å¼æ¥æºï¼‰ |

---

## ğŸ¯ æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ Aï¼šä¿å®ˆæ¸…ç†ï¼ˆæ—¥å¸¸æ¨èï¼‰

**ä¿ç•™**ï¼šé…ç½®æ•°æ®ã€ç®¡ç†å‘˜è´¦å·ã€æ´»åŠ¨é…ç½®ã€ç”¨æˆ·åŸºç¡€ä¿¡æ¯ã€ç³»ç»Ÿè´¦æˆ·ã€ç­–ç•¥é…ç½®ã€åŠŸèƒ½å¼€å…³ã€å­—å…¸æ•°æ®  
**æ¸…ç†**ï¼šç”¨æˆ·èµ„äº§ä½™é¢/æµæ°´ã€æŠ½å¥–è®°å½•ã€æ¶ˆè´¹è®°å½•ã€äº¤æ˜“è®°å½•ã€ç›‘æ§æŒ‡æ ‡ã€æ“ä½œæ—¥å¿—ã€**è¿è¥å†…å®¹**ï¼ˆå…¬å‘Š/Bannerï¼‰ã€**ç”¨æˆ·å…³ç³»æ•°æ®**ï¼ˆå±‚çº§/å‘˜å·¥ï¼‰

**é€‚åˆåœºæ™¯**ï¼š

- æ—¥å¸¸æµ‹è¯•åæ¢å¤å¹²å‡€ç¯å¢ƒ
- éªŒè¯æ–°åŠŸèƒ½ä½†ä¸æƒ³é‡æ–°é…ç½®ç³»ç»Ÿ
- ä¿ç•™æµ‹è¯•è´¦å·å’Œç³»ç»Ÿé…ç½®

**æ‰§è¡Œæ—¶é—´**ï¼š5-10 åˆ†é’Ÿ  
**æ¢å¤æ—¶é—´**ï¼šæ— éœ€æ¢å¤ï¼ˆé…ç½®å’Œè´¦å·éƒ½ä¿ç•™ï¼‰

---

### æ–¹æ¡ˆ Bï¼šæ¿€è¿›æ¸…ç†ï¼ˆæ·±åº¦é‡ç½®ï¼‰

**ä¿ç•™**ï¼šä»…ä¿ç•™æ•°æ®åº“ç»“æ„ï¼ˆ79 å¼ è¡¨çš„ schemaï¼‰+ è¿ç§»è®°å½• + è¡Œæ”¿åŒºåˆ’å­—å…¸  
**æ¸…ç†**ï¼šæ‰€æœ‰ä¸šåŠ¡æ•°æ®ï¼ˆåŒ…æ‹¬é…ç½®ã€ç®¡ç†å‘˜ã€ç”¨æˆ·ã€æ´»åŠ¨ï¼‰

**é€‚åˆåœºæ™¯**ï¼š

- å®Œå…¨ä»é›¶å¼€å§‹
- ç³»ç»Ÿé…ç½®æœ¬èº«æœ‰é—®é¢˜éœ€è¦é‡å»º
- æ¨¡æ‹Ÿ"æ–°ç³»ç»Ÿé¦–æ¬¡å¯åŠ¨"

**æ‰§è¡Œæ—¶é—´**ï¼š10-15 åˆ†é’Ÿ  
**æ¢å¤æ—¶é—´**ï¼š2-4 å°æ—¶ï¼ˆéœ€è¦é‡å»ºæ‰€æœ‰é…ç½®ã€ç”¨æˆ·ã€æ´»åŠ¨ï¼‰

---

## ğŸ“Š æ•°æ®åº“è¡¨åˆ†ç±»æ¦‚è§ˆï¼ˆ79å¼ è¡¨ï¼‰

### ğŸ—ï¸ è¡¨åˆ†ç±»é€ŸæŸ¥

#### ä¸€ã€è´¦æˆ·ä¸èµ„äº§ä½“ç³»ï¼ˆ6å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `users` | ç”¨æˆ·åŸºç¡€ä¿¡æ¯ | 60 | ä¿ç•™ | æ¸…ç©º |
| `accounts` | è´¦æˆ·ä¸»ä½“ï¼ˆç”¨æˆ·56+ç³»ç»Ÿï¼‰ | 56 | ä¿ç•™ç³»ç»Ÿè´¦æˆ· | æ¸…ç©º |
| `account_asset_balances` | èµ„äº§ä½™é¢ | **43** | æ¸…ç©º | æ¸…ç©º |
| `asset_transactions` | èµ„äº§æµæ°´ | **25,090** | æ¸…ç©º | æ¸…ç©º |
| `user_premium_status` | é«˜çº§ç©ºé—´çŠ¶æ€ | 1 | æ¸…ç©º | æ¸…ç©º |
| `user_risk_profiles` | é£æ§é…ç½® | 3 | ä¿ç•™ | æ¸…ç©º |

#### äºŒã€è§’è‰²æƒé™ä½“ç³»ï¼ˆ4å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `roles` | è§’è‰²å®šä¹‰ | 11 | ä¿ç•™ | æ¸…ç©º |
| `user_roles` | ç”¨æˆ·è§’è‰²å…³ç³» | 53 | ä¿ç•™ | æ¸…ç©º |
| `user_role_change_records` | è§’è‰²å˜æ›´è®°å½• | 237 | æ¸…ç©º | æ¸…ç©º |
| `user_status_change_records` | çŠ¶æ€å˜æ›´è®°å½• | 237 | æ¸…ç©º | æ¸…ç©º |

#### ä¸‰ã€æŠ½å¥–æ ¸å¿ƒç³»ç»Ÿï¼ˆ8å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `lottery_campaigns` | æ´»åŠ¨é…ç½® | 4 | ä¿ç•™ | æ¸…ç©º |
| `lottery_prizes` | å¥–å“æ± å®šä¹‰ | 30 | ä¿ç•™ | æ¸…ç©º |
| `lottery_draws` | æŠ½å¥–è®°å½• | **2,280** | æ¸…ç©º | æ¸…ç©º |
| `lottery_draw_decisions` | æŠ½å¥–å†³ç­–å¿«ç…§ | **2,280** | æ¸…ç©º | æ¸…ç©º |
| `lottery_presets` | é¢„è®¾é…ç½® | 3 | æ¸…ç©º | æ¸…ç©º |
| `lottery_management_settings` | ç®¡ç†å‘˜å¹²é¢„è§„åˆ™ | 2,814 | æ¸…ç©º | æ¸…ç©º |
| `lottery_clear_setting_records` | æ¸…é™¤è®¾ç½®è®°å½• | 634 | æ¸…ç©º | æ¸…ç©º |
| `lottery_campaign_pricing_config` | æ´»åŠ¨å®šä»·é…ç½®ï¼ˆç‰ˆæœ¬åŒ–JSONï¼‰ | **14** | ä¿ç•™ | æ¸…ç©º |

#### å››ã€æŠ½å¥–ç­–ç•¥å¼•æ“ï¼ˆ10å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `lottery_tier_rules` | æ¡£ä½æ¦‚ç‡è§„åˆ™ | 9 | ä¿ç•™ | æ¸…ç©º |
| `lottery_strategy_config` | ç­–ç•¥å…¨å±€é…ç½® | 17 | ä¿ç•™ | æ¸…ç©º |
| `lottery_tier_matrix_config` | BxPxçŸ©é˜µé…ç½® | 12 | ä¿ç•™ | æ¸…ç©º |
| `lottery_draw_quota_rules` | é…é¢è§„åˆ™ | 11 | ä¿ç•™ | æ¸…ç©º |
| `lottery_user_daily_draw_quota` | æ¯æ—¥æŠ½å¥–é…é¢ | **17** | æ¸…ç©º | æ¸…ç©º |
| `lottery_campaign_user_quota` | æ´»åŠ¨ç”¨æˆ·é…é¢ | 0 | æ¸…ç©º | æ¸…ç©º |
| `lottery_campaign_quota_grants` | é…é¢èµ é€è®°å½• | 0 | æ¸…ç©º | æ¸…ç©º |
| `lottery_user_experience_state` | ç”¨æˆ·ä½“éªŒçŠ¶æ€(Pity) | 1 | æ¸…ç©º | æ¸…ç©º |
| `lottery_user_global_state` | å…¨å±€ç»Ÿè®¡(LuckDebt) | 1 | æ¸…ç©º | æ¸…ç©º |
| `feature_flags` | åŠŸèƒ½å¼€å…³ | 7 | ä¿ç•™ | æ¸…ç©º |

#### äº”ã€æŠ½å¥–ç›‘æ§å‘Šè­¦ï¼ˆ4å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `lottery_hourly_metrics` | å°æ—¶çº§ç›‘æ§æŒ‡æ ‡ | **67** | æ¸…ç©º | æ¸…ç©º |
| `lottery_daily_metrics` | æ—¥æŠ¥ç»Ÿè®¡ | **12** | æ¸…ç©º | æ¸…ç©º |
| `lottery_alerts` | æŠ½å¥–ç³»ç»Ÿå‘Šè­¦ | 3 | æ¸…ç©º | æ¸…ç©º |
| `preset_debt_limits` | æ¬ è´¦ä¸Šé™é…ç½® | 1 | ä¿ç•™ | æ¸…ç©º |

#### å…­ã€ç³»ç»Ÿå«ä»˜ï¼ˆæ¬ è´¦ï¼‰ï¼ˆ2å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `preset_inventory_debt` | åº“å­˜æ¬ è´¦ | 0 | æ¸…ç©º | æ¸…ç©º |
| `preset_budget_debt` | é¢„ç®—æ¬ è´¦ | 0 | æ¸…ç©º | æ¸…ç©º |

#### ä¸ƒã€ç‰©å“ä¸èƒŒåŒ…ç³»ç»Ÿï¼ˆ6å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `item_templates` | ç‰©å“æ¨¡æ¿å®šä¹‰ | 16 | ä¿ç•™ | æ¸…ç©º |
| `item_instances` | ç‰©å“å®ä¾‹ | **6,187** | æ¸…ç©º | æ¸…ç©º |
| `item_instance_events` | ç‰©å“äº‹ä»¶æº¯æº | **4,840** | æ¸…ç©º | æ¸…ç©º |
| `category_defs` | ç±»ç›®å­—å…¸ | 9 | ä¿ç•™ | æ¸…ç©º |
| `rarity_defs` | ç¨€æœ‰åº¦å­—å…¸ | 5 | ä¿ç•™ | æ¸…ç©º |
| `asset_group_defs` | èµ„äº§ç»„å­—å…¸ | 8 | ä¿ç•™ | æ¸…ç©º |

#### å…«ã€äº¤æ˜“å¸‚åœºç³»ç»Ÿï¼ˆ3å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `market_listings` | å¸‚åœºæŒ‚ç‰Œ | **281** | æ¸…ç©º | æ¸…ç©º |
| `trade_orders` | äº¤æ˜“è®¢å• | **125** | æ¸…ç©º | æ¸…ç©º |
| `redemption_orders` | æ ¸é”€è®¢å• | 1,184 | æ¸…ç©º | æ¸…ç©º |

#### ä¹ã€å…‘æ¢ä¸æ¶ˆè´¹ç³»ç»Ÿï¼ˆ4å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `exchange_items` | å…‘æ¢å•†å“é…ç½®ï¼ˆå«space/tagså­—æ®µï¼‰ | **89** | ä¿ç•™ | æ¸…ç©º |
| `exchange_records` | å…‘æ¢è®°å½• | **2** | æ¸…ç©º | æ¸…ç©º |
| `consumption_records` | æ¶ˆè´¹è®°å½• | 48 | æ¸…ç©º | æ¸…ç©º |
| `content_review_records` | å†…å®¹å®¡æ ¸è®°å½• | 422 | æ¸…ç©º | æ¸…ç©º |

#### åã€å•†æˆ·ä¸é—¨åº—ç³»ç»Ÿï¼ˆ4å¼ ï¼Œ`products`è¡¨å·²åˆ é™¤ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `stores` | é—¨åº—é…ç½® | 5 | ä¿ç•™ | æ¸…ç©º |
| `store_staff` | é—¨åº—å‘˜å·¥å…³ç³» | 3 | æ¸…ç©º | æ¸…ç©º |
| `user_hierarchy` | ç”¨æˆ·å±‚çº§å…³ç³» | 9 | æ¸…ç©º | æ¸…ç©º |
| `administrative_regions` | è¡Œæ”¿åŒºåˆ’å­—å…¸ï¼ˆåªè¯»ï¼‰ | 44,703 | ä¿ç•™ | **ä¿ç•™** |

#### åä¸€ã€ææ–™èµ„äº§ç³»ç»Ÿï¼ˆ2å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `material_asset_types` | èµ„äº§ç±»å‹å®šä¹‰ | 4 | ä¿ç•™ | æ¸…ç©º |
| `material_conversion_rules` | èµ„äº§è½¬æ¢è§„åˆ™ï¼ˆå«è´¹ç‡/å±•ç¤ºå­—æ®µï¼‰ | 1 | ä¿ç•™ | æ¸…ç©º |

#### åäºŒã€ç³»ç»Ÿé…ç½®ï¼ˆ5å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `system_settings` | ç³»ç»Ÿè®¾ç½® | 42 | ä¿ç•™ | æ¸…ç©º |
| `system_configs` | ç³»ç»Ÿé…ç½® | 9 | ä¿ç•™ | æ¸…ç©º |
| `system_dictionaries` | ç³»ç»Ÿå­—å…¸ | **371** | ä¿ç•™ | æ¸…ç©º |
| `system_dictionary_history` | å­—å…¸å˜æ›´å†å² | 0 | æ¸…ç©º | æ¸…ç©º |
| `system_announcements` | ç³»ç»Ÿå…¬å‘Š | 73 | æ¸…ç©º | æ¸…ç©º |

#### åä¸‰ã€å®¢æœèŠå¤©ç³»ç»Ÿï¼ˆ2å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `customer_service_sessions` | å®¢æœä¼šè¯ | 15 | æ¸…ç©º | æ¸…ç©º |
| `chat_messages` | èŠå¤©æ¶ˆæ¯ | **598** | æ¸…ç©º | æ¸…ç©º |

#### åå››ã€å®¡è®¡ä¸æ—¥å¿—ç³»ç»Ÿï¼ˆ7å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `admin_operation_logs` | ç®¡ç†å‘˜æ“ä½œæ—¥å¿— | 5,540 | æ¸…ç©º | æ¸…ç©º |
| `merchant_operation_logs` | å•†æˆ·æ“ä½œæ—¥å¿— | 97 | æ¸…ç©º | æ¸…ç©º |
| `batch_operation_logs` | æ‰¹é‡æ“ä½œæ—¥å¿— | 11 | æ¸…ç©º | æ¸…ç©º |
| `risk_alerts` | é£æ§å‘Šè­¦ | 9 | æ¸…ç©º | æ¸…ç©º |
| `api_idempotency_requests` | å¹‚ç­‰è¯·æ±‚è®°å½• | **29,309** | æ¸…ç©º | æ¸…ç©º |
| `authentication_sessions` | è®¤è¯ä¼šè¯ | **2** | æ¸…ç©º | æ¸…ç©º |
| `websocket_startup_logs` | WebSocketå¯åŠ¨æ—¥å¿— | **1,942** | æ¸…ç©º | æ¸…ç©º |

#### åäº”ã€æé†’ä¸æŠ¥å‘Šç³»ç»Ÿï¼ˆ4å¼ ï¼Œæ–°å¢ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `reminder_rules` | æé†’è§„åˆ™é…ç½® | 3 | ä¿ç•™ | æ¸…ç©º |
| `reminder_history` | æé†’å†å²è®°å½• | **471** | æ¸…ç©º | æ¸…ç©º |
| `report_templates` | æŠ¥å‘Šæ¨¡æ¿ | 2 | ä¿ç•™ | æ¸…ç©º |
| `alert_silence_rules` | å‘Šè­¦é™é»˜è§„åˆ™ | 0 | æ¸…ç©º | æ¸…ç©º |

#### åå…­ã€ç«æ‹ç³»ç»Ÿï¼ˆ2å¼ ï¼Œæ–°å¢ï¼Œç©ºè¡¨ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `bid_products` | ç«æ‹å•†å“ | 0 | æ¸…ç©º | æ¸…ç©º |
| `bid_records` | ç«æ‹è®°å½• | 0 | æ¸…ç©º | æ¸…ç©º |

#### åä¸ƒã€å…¶ä»–ï¼ˆ6å¼ ï¼‰
| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | æ–¹æ¡ˆA | æ–¹æ¡ˆB |
|------|------|----------|-------|-------|
| `feedbacks` | ç”¨æˆ·åé¦ˆ | 153 | æ¸…ç©º | æ¸…ç©º |
| `popup_banners` | å¼¹çª—Banner | 2 | æ¸…ç©º | æ¸…ç©º |
| `image_resources` | å›¾ç‰‡èµ„æº | 0 | æ¸…ç©º | æ¸…ç©º |
| `admin_notifications` | ç®¡ç†å‘˜é€šçŸ¥ | 0 | æ¸…ç©º | æ¸…ç©º |
| `user_behavior_tracks` | ç”¨æˆ·è¡Œä¸ºè¿½è¸ª | 0 | æ¸…ç©º | æ¸…ç©º |
| `sequelizemeta` | è¿ç§»è®°å½•ï¼ˆ**336**æ¡ï¼‰ | **336** | **ä¿ç•™** | **ä¿ç•™** |

---

## ğŸ“Š æ–¹æ¡ˆ Aï¼šä¿å®ˆæ¸…ç†ï¼ˆè¯¦ç»†æ¸…å•ï¼‰

### âœ… ä¼šä¿ç•™çš„æ•°æ®ï¼ˆçº¦31å¼ è¡¨ï¼Œä¸å«å·²åˆ é™¤çš„`products`ï¼‰

#### 1. è´¦å·ä¸æƒé™ä½“ç³»ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ | æ¸…ç†è§„åˆ™ |
|------|------|----------|
| `users` | ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼ˆ60æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `roles` | è§’è‰²å®šä¹‰ï¼ˆ11ä¸ªè§’è‰²ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `user_roles` | ç”¨æˆ·è§’è‰²å…³ç³»ï¼ˆ53æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `accounts` | è´¦æˆ·ä¸»ä½“ï¼ˆ56æ¡ï¼‰ | **ä»…ä¿ç•™ç³»ç»Ÿè´¦æˆ·**ï¼ˆåˆ é™¤ç”¨æˆ·è´¦æˆ·ï¼‰ |

**ç³»ç»Ÿè´¦æˆ·æ¸…å•ï¼ˆ6ä¸ªï¼Œå¿…é¡»ä¿ç•™ï¼‰**ï¼š

| system_code | è¯´æ˜ | ç”¨é€” |
|-------------|------|------|
| `SYSTEM_PLATFORM_FEE` | å¹³å°æ‰‹ç»­è´¹è´¦æˆ· | äº¤æ˜“æ‰‹ç»­è´¹å…¥è´¦ |
| `SYSTEM_MINT` | ç³»ç»Ÿå‘æ”¾è´¦æˆ· | ç§¯åˆ†å‘æ”¾æºå¤´ |
| `SYSTEM_BURN` | ç³»ç»Ÿé”€æ¯è´¦æˆ· | ç§¯åˆ†é”€æ¯ç›®æ ‡ |
| `SYSTEM_ESCROW` | æ‰˜ç®¡è´¦æˆ· | äº¤æ˜“æ‰˜ç®¡/äº‰è®® |
| `SYSTEM_RESERVE` | å‚¨å¤‡é‡‘è´¦æˆ· | ç³»ç»Ÿå‚¨å¤‡ |
| `SYSTEM_CAMPAIGN_POOL` | æ´»åŠ¨æ± é¢„ç®—è´¦æˆ· | poolé¢„ç®—æ¨¡å¼ |

**ä¸ºä»€ä¹ˆä¿ç•™ç³»ç»Ÿè´¦æˆ·**ï¼š

- `AssetService.getOrCreateAccount({system_code})` **ä¸ä¼šè‡ªåŠ¨åˆ›å»º**ç³»ç»Ÿè´¦æˆ·ï¼Œç¼ºå¤±ä¼šç›´æ¥æŠ¥é”™ï¼š`ç³»ç»Ÿè´¦æˆ·ä¸å­˜åœ¨ï¼šsystem_code=xxxï¼Œè¯·æ£€æŸ¥æ•°æ®åº“åˆå§‹åŒ–`
- ç³»ç»Ÿè´¦æˆ·æ˜¯è¿ç§»æ—¶é€šè¿‡ `20251215160000-create-accounts-table.js` åˆå§‹åŒ–çš„ï¼ˆå·²å½’æ¡£åˆ° `migrations/archive/v1-legacy/`ï¼‰ï¼Œæ¸…ç©ºåå¿…é¡»æ‰‹åŠ¨INSERTé‡å»ºï¼ˆsequelizemetaå·²æœ‰è®°å½•ï¼Œä¸å¯é€šè¿‡ `db:migrate` é‡å»ºï¼‰

---

#### 2. ç³»ç»Ÿé…ç½®ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ | æ¸…ç†è§„åˆ™ |
|------|------|----------|
| `system_settings` | æ ¸å¿ƒé…ç½®å‚æ•°ï¼ˆ42æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `system_configs` | ç³»ç»Ÿé…ç½®ï¼ˆ9æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `system_dictionaries` | ç³»ç»Ÿå­—å…¸ï¼ˆ**371**æ¡ï¼Œ**74**ç§ç±»å‹ï¼‰ | å…¨éƒ¨ä¿ç•™ |

> âš ï¸ `system_announcements`ï¼ˆ73æ¡ç³»ç»Ÿå…¬å‘Šï¼‰å·²ç§»è‡³æ¸…ç©ºåˆ—è¡¨ï¼Œå› ä¸ºå®ƒæ˜¯è¿è¥å†…å®¹æ•°æ®è€Œéç³»ç»Ÿé…ç½®ã€‚

---

#### 3. æ´»åŠ¨ä¸å¥–å“å®šä¹‰ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ | æ¸…ç†è§„åˆ™ |
|------|------|----------|
| `lottery_campaigns` | æ´»åŠ¨é…ç½®ï¼ˆ4æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `lottery_prizes` | å¥–å“æ± å®šä¹‰ï¼ˆ30æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `lottery_campaign_pricing_config` | å®šä»·é…ç½®ï¼ˆ13æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |

---

#### 4. æŠ½å¥–ç­–ç•¥é…ç½®ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ | æ¸…ç†è§„åˆ™ |
|------|------|----------|
| `lottery_tier_rules` | æ¡£ä½æ¦‚ç‡è§„åˆ™ï¼ˆ9æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `lottery_strategy_config` | ç­–ç•¥å…¨å±€é…ç½®ï¼ˆ17æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `lottery_tier_matrix_config` | BxPxçŸ©é˜µé…ç½®ï¼ˆ12æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `lottery_draw_quota_rules` | é…é¢è§„åˆ™ï¼ˆ11æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `feature_flags` | åŠŸèƒ½å¼€å…³ï¼ˆ7æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |
| `preset_debt_limits` | æ¬ è´¦ä¸Šé™é…ç½®ï¼ˆ1æ¡ï¼‰ | å…¨éƒ¨ä¿ç•™ |

---

#### 5. å­—å…¸ä¸æ¨¡æ¿å®šä¹‰ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ |
|------|------|
| `item_templates` | ç‰©å“æ¨¡æ¿å®šä¹‰ï¼ˆ16æ¡ï¼‰ |
| `category_defs` | ç±»ç›®å­—å…¸ï¼ˆ9æ¡ï¼‰ |
| `rarity_defs` | ç¨€æœ‰åº¦å­—å…¸ï¼ˆ5æ¡ï¼‰ |
| `asset_group_defs` | èµ„äº§ç»„å­—å…¸ï¼ˆ8æ¡ï¼‰ |
| `material_asset_types` | èµ„äº§ç±»å‹å®šä¹‰ï¼ˆ4æ¡ï¼‰ |
| `material_conversion_rules` | èµ„äº§è½¬æ¢è§„åˆ™ï¼ˆ1æ¡ï¼‰ |

---

#### 6. å•†æˆ·ä¸é—¨åº—ï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ |
|------|------|
| `stores` | é—¨åº—é…ç½®ï¼ˆ5æ¡ï¼‰ |
| `exchange_items` | å…‘æ¢å•†å“é…ç½®ï¼ˆ**89**æ¡ï¼Œå« space/tags å­—æ®µï¼‰ |
| `administrative_regions` | è¡Œæ”¿åŒºåˆ’å­—å…¸ï¼ˆ44,703æ¡ï¼Œåªè¯»ï¼‰ |
| `user_risk_profiles` | ç”¨æˆ·é£æ§é…ç½®ï¼ˆ3æ¡ï¼‰ |

#### 7. æé†’ä¸æŠ¥å‘Šï¼ˆä¿ç•™ï¼‰

| è¡¨å | è¯´æ˜ |
|------|------|
| `reminder_rules` | æé†’è§„åˆ™é…ç½®ï¼ˆ3æ¡ï¼‰ |
| `report_templates` | æŠ¥å‘Šæ¨¡æ¿ï¼ˆ2æ¡ï¼‰ |

---

### ğŸ—‘ï¸ ä¼šæ¸…ç©ºçš„æ•°æ®ï¼ˆçº¦48å¼ è¡¨ï¼‰

#### 1. èµ„äº§è´¦æœ¬ï¼ˆæ ¸å¿ƒæ¸…ç†ï¼‰

| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | å½±å“ |
|------|------|----------|------|
| `accounts` | è´¦æˆ·ä¸»ä½“ | 56 | **ä»…åˆ é™¤ç”¨æˆ·è´¦æˆ·**ï¼Œä¿ç•™ç³»ç»Ÿè´¦æˆ· |
| `account_asset_balances` | èµ„äº§ä½™é¢ | **43** | æ‰€æœ‰ä½™é¢æ¸…é›¶ |
| `asset_transactions` | èµ„äº§æµæ°´ | **25,090** | æ‰€æœ‰æµæ°´æ¸…ç©º |
| `user_premium_status` | é«˜çº§ç©ºé—´çŠ¶æ€ | 1 | æ¸…ç©º |

---

#### 2. æŠ½å¥–è®°å½•ä¸çŠ¶æ€

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `lottery_draws` | **2,280** |
| `lottery_draw_decisions` | **2,280** |
| `lottery_management_settings` | 2,814 |
| `lottery_clear_setting_records` | 634 |
| `lottery_presets` | 3 |
| `lottery_user_daily_draw_quota` | 16 |
| `lottery_campaign_user_quota` | 0 |
| `lottery_campaign_quota_grants` | 0 |
| `lottery_user_experience_state` | 1 |
| `lottery_user_global_state` | 1 |

---

#### 3. ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `lottery_hourly_metrics` | **67** |
| `lottery_daily_metrics` | **12** |
| `lottery_alerts` | 3 |
| `preset_inventory_debt` | 0 |
| `preset_budget_debt` | 0 |

---

#### 4. ç‰©å“ä¸äº¤æ˜“

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `item_instances` | **6,187** |
| `item_instance_events` | **4,840** |
| `market_listings` | **281** |
| `trade_orders` | **125** |
| `redemption_orders` | 1,184 |
| `exchange_records` | **2** |

---

#### 5. æ¶ˆè´¹ä¸å®¡æ ¸

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `consumption_records` | 48 |
| `content_review_records` | 422 |

---

#### 6. å®¢æœèŠå¤©

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `chat_messages` | **598** |
| `customer_service_sessions` | **17** |

---

#### 7. å®¡è®¡ä¸æ—¥å¿—

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `admin_operation_logs` | 5,540 |
| `merchant_operation_logs` | 97 |
| `batch_operation_logs` | 11 |
| `risk_alerts` | 9 |
| `api_idempotency_requests` | **29,309** |
| `authentication_sessions` | 5 |
| `websocket_startup_logs` | 1,921 |
| `user_role_change_records` | 237 |
| `user_status_change_records` | 237 |
| `system_dictionary_history` | 0 |

---

#### 8. è¿è¥å†…å®¹ä¸åé¦ˆ

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `feedbacks` | 153 |
| `system_announcements` | 73 |
| `popup_banners` | 2 |
| `image_resources` | 0 |
| `admin_notifications` | 0 |

---

#### 9. ç”¨æˆ·å…³ç³»ã€æé†’ã€ç«æ‹ä¸è¡Œä¸ºè¿½è¸ª

| è¡¨å | å®é™…è¡Œæ•° |
|------|----------|
| `store_staff` | 3 |
| `user_hierarchy` | 9 |
| `reminder_history` | **471** |
| `alert_silence_rules` | 0 |
| `bid_products` | 0 |
| `bid_records` | 0 |
| `user_behavior_tracks` | 0 |

---

### âš ï¸ æ–¹æ¡ˆ A æ¸…ç†åéœ€è¦ä½ æä¾›çš„æ•°æ®

#### ğŸ¯ å¿…éœ€æä¾›ï¼ˆå¦åˆ™æ— æ³•éªŒè¯ï¼‰

1. **æµ‹è¯•ç”¨æˆ·ä¿¡æ¯**ï¼š
   - æä¾› 1-2 ä¸ªç”¨æˆ·çš„ `user_id` æˆ– `mobile`ï¼ˆä»ä¿ç•™çš„ç”¨æˆ·ä¸­é€‰ï¼‰
   - å½“å‰ç®¡ç†å‘˜ç”¨æˆ·ï¼š`user_id=31, 135, 11114, 11132`
   - ç”¨é€”ï¼šç”¨äºéªŒè¯"æ¶ˆè´¹â†’å®¡æ‰¹â†’å‘æ”¾â†’æŠ½å¥–"å®Œæ•´æµç¨‹

2. **ç¡®è®¤ç³»ç»Ÿè´¦æˆ·å­˜åœ¨**ï¼š
   ```bash
   node -e "
   require('dotenv').config();
   const { sequelize } = require('./config/database');
   (async () => {
     const [rows] = await sequelize.query(\"SELECT system_code FROM accounts WHERE account_type='system'\");
     console.log('ç³»ç»Ÿè´¦æˆ·:', rows.map(r => r.system_code));
     await sequelize.close();
   })();
   "
   ```
   - é¢„æœŸç»“æœï¼šè‡³å°‘åŒ…å« 6 ä¸ªç³»ç»Ÿè´¦æˆ·

---

### ğŸ” æ–¹æ¡ˆ A æ¸…ç†åéªŒè¯æ¸…å•

#### å¿…éœ€æ£€æŸ¥é¡¹ï¼ˆæ¸…ç†ç«‹å³åï¼‰

- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] è¡¨ç»“æ„å®Œæ•´ï¼ˆ**79** å¼ è¡¨ï¼‰
- [ ] ç³»ç»Ÿè´¦æˆ·å­˜åœ¨ï¼ˆ6 ä¸ªï¼šPLATFORM_FEE/MINT/BURN/ESCROW/RESERVE/CAMPAIGN_POOLï¼‰
- [ ] ç”¨æˆ·è´¦å·å­˜åœ¨
- [ ] ç®¡ç†å‘˜æƒé™æ­£å¸¸ï¼ˆuser_roles ä¿ç•™ï¼‰
- [ ] ç³»ç»Ÿé…ç½®å­˜åœ¨ï¼ˆsystem_settings 42æ¡ï¼‰
- [ ] æ´»åŠ¨å¥–å“é…ç½®å­˜åœ¨
- [ ] åŠŸèƒ½å¼€å…³é…ç½®å­˜åœ¨ï¼ˆfeature_flags 7ä¸ªï¼‰
- [ ] ç­–ç•¥é…ç½®å­˜åœ¨ï¼ˆlottery_strategy_configã€lottery_tier_matrix_configï¼‰

---

## ğŸ“Š æ–¹æ¡ˆ Bï¼šæ¿€è¿›æ¸…ç†ï¼ˆè¯¦ç»†æ¸…å•ï¼‰

### âœ… ä¼šä¿ç•™çš„æ•°æ®ï¼ˆä»…2å¼ è¡¨çš„æ•°æ®ï¼‰

| ä¿ç•™å†…å®¹ | è¯´æ˜ |
|----------|------|
| æ•°æ®åº“ç»“æ„ | **79** å¼ è¡¨çš„ schema ä¿ç•™ |
| è¿ç§»è®°å½• | `sequelizemeta` è¡¨ä¿ç•™ï¼ˆ**336**æ¡å·²æ‰§è¡Œçš„è¿ç§»è®°å½•ï¼‰ |
| è¡Œæ”¿åŒºåˆ’ | `administrative_regions` è¡¨ä¿ç•™ï¼ˆ44,703æ¡ï¼Œåªè¯»å­—å…¸ï¼‰ |

**å…¶ä½™æ‰€æœ‰ 77 å¼ ä¸šåŠ¡æ•°æ®è¡¨çš„æ•°æ®å…¨éƒ¨æ¸…ç©º**ã€‚

---

### ğŸ—‘ï¸ ä¼šæ¸…ç©ºçš„æ•°æ®ï¼ˆ77å¼ è¡¨ï¼‰

åœ¨æ–¹æ¡ˆ A çš„çº¦48å¼ è¡¨åŸºç¡€ä¸Šï¼Œé¢å¤–æ¸…ç©ºä»¥ä¸‹çº¦29å¼ é…ç½®/å®šä¹‰è¡¨ï¼ˆ`products`è¡¨å·²ä¸å­˜åœ¨ï¼‰ï¼š

| è¡¨å | è¯´æ˜ | å®é™…è¡Œæ•° | å½±å“ |
|------|------|----------|------|
| `users` | ç”¨æˆ·åŸºç¡€ä¿¡æ¯ | 60 | æ‰€æœ‰ç”¨æˆ·éœ€é‡æ–°æ³¨å†Œ |
| `user_roles` | ç”¨æˆ·è§’è‰²å…³ç³» | 53 | ç®¡ç†å‘˜éœ€é‡æ–°æˆæƒ |
| `roles` | è§’è‰²å®šä¹‰ | 11 | è§’è‰²éœ€é‡æ–°åˆ›å»º |
| `accounts`ï¼ˆå…¨éƒ¨ï¼‰ | è´¦æˆ·ä¸»ä½“ | 56 | ç³»ç»Ÿè´¦æˆ·ä¹Ÿæ¸…ç©ºï¼Œéœ€æ‰‹åŠ¨INSERTé‡å»ºï¼ˆä¸å¯é‡è·‘è¿ç§»ï¼‰ |
| `system_settings` | ç³»ç»Ÿé…ç½®å‚æ•° | 42 | å…³é”®é…ç½®éœ€é‡æ–°å†™å…¥ |
| `system_configs` | ç³»ç»Ÿé…ç½® | 9 | éœ€é‡æ–°é…ç½® |
| `system_dictionaries` | ç³»ç»Ÿå­—å…¸ | **371** | **74**ç§ç±»å‹çš„ä¸­æ–‡æ˜ å°„ä¸¢å¤± |
| `lottery_campaigns` | æ´»åŠ¨é…ç½® | 4 | éœ€é‡æ–°åˆ›å»ºæ´»åŠ¨ |
| `lottery_prizes` | å¥–å“æ± å®šä¹‰ | 30 | éœ€é‡æ–°é…ç½®å¥–å“ |
| `lottery_presets` | é¢„è®¾é…ç½® | 3 | éœ€é‡æ–°é…ç½® |
| `lottery_campaign_pricing_config` | å®šä»·é…ç½® | 13 | éœ€é‡æ–°é…ç½® |
| `lottery_tier_rules` | æ¡£ä½æ¦‚ç‡è§„åˆ™ | 9 | éœ€é‡æ–°é…ç½® |
| `lottery_strategy_config` | ç­–ç•¥å…¨å±€é…ç½® | 17 | éœ€é‡æ–°é…ç½® |
| `lottery_tier_matrix_config` | BxPxçŸ©é˜µé…ç½® | 12 | éœ€é‡æ–°é…ç½® |
| `lottery_draw_quota_rules` | é…é¢è§„åˆ™ | 11 | éœ€é‡æ–°é…ç½® |
| `feature_flags` | åŠŸèƒ½å¼€å…³ | 7 | éœ€é‡æ–°é…ç½® |
| `preset_debt_limits` | æ¬ è´¦ä¸Šé™é…ç½® | 1 | éœ€é‡æ–°é…ç½® |
| `item_templates` | ç‰©å“æ¨¡æ¿å®šä¹‰ | 16 | éœ€é‡æ–°é…ç½® |
| `category_defs` | ç±»ç›®å­—å…¸ | 9 | éœ€é‡æ–°åˆå§‹åŒ– |
| `rarity_defs` | ç¨€æœ‰åº¦å­—å…¸ | 5 | éœ€é‡æ–°åˆå§‹åŒ– |
| `asset_group_defs` | èµ„äº§ç»„å­—å…¸ | 8 | éœ€é‡æ–°åˆå§‹åŒ– |
| `material_asset_types` | èµ„äº§ç±»å‹å®šä¹‰ | 4 | éœ€é‡æ–°é…ç½® |
| `material_conversion_rules` | èµ„äº§è½¬æ¢è§„åˆ™ | 1 | éœ€é‡æ–°é…ç½® |
| `stores` | é—¨åº—é…ç½® | 5 | éœ€é‡æ–°é…ç½® |
| `exchange_items` | å…‘æ¢å•†å“é…ç½® | **89** | éœ€é‡æ–°é…ç½® |
| `user_risk_profiles` | ç”¨æˆ·é£æ§é…ç½® | 3 | éœ€é‡æ–°é…ç½® |
| `reminder_rules` | æé†’è§„åˆ™ | 3 | éœ€é‡æ–°é…ç½® |
| `report_templates` | æŠ¥å‘Šæ¨¡æ¿ | 2 | éœ€é‡æ–°é…ç½® |

---

### âš ï¸ æ–¹æ¡ˆ B æ¸…ç†åéœ€è¦ä½ æä¾›çš„æ•°æ®ï¼ˆå®Œæ•´é‡å»ºåŒ…ï¼‰

#### ğŸ”´ å¿…éœ€æä¾›ï¼ˆå¦åˆ™ç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼‰

##### 1. ç®¡ç†å‘˜è´¦å·ä¿¡æ¯ï¼ˆè‡³å°‘ 1 ä¸ªï¼‰

> é¡¹ç›®ä½¿ç”¨**æ‰‹æœºå·+éªŒè¯ç **ç™»å½•ã€‚å¼€å‘ç¯å¢ƒéªŒè¯ç å›ºå®šä¸º `123456`ã€‚

| å­—æ®µ | è¯´æ˜ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼ |
|------|------|----------|--------|
| mobile | ç®¡ç†å‘˜æ‰‹æœºå· | âœ… å¿…å¡« | - |
| nickname | æ˜¾ç¤ºåç§° | âšª å¯é€‰ | `ç”¨æˆ·` + æ‰‹æœºå·å4ä½ |
| role | ç®¡ç†å‘˜è§’è‰² | âœ… å¿…å¡« | æ–°ç”¨æˆ·é»˜è®¤ `user`ï¼Œéœ€æ‰‹åŠ¨æˆæƒ `admin` |

**é‡å»ºæ­¥éª¤**ï¼š
1. ç”¨ç®¡ç†å‘˜æ‰‹æœºå·ç™»å½•ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰
2. é€šè¿‡æ•°æ®åº“æˆ–è¿ç§»è„šæœ¬å°†è¯¥ç”¨æˆ·æˆæƒä¸º `admin` è§’è‰²

---

##### 2. ç³»ç»Ÿé…ç½®å‚æ•°ï¼ˆå…³é”®é…ç½®é¡¹ï¼‰

**`system_settings` è¡¨ï¼ˆ42æ¡ï¼‰â€” å…³é”®é¡¹**ï¼š

| é…ç½®é¡¹ | æ¨èå€¼ | å€¼ç±»å‹ | è¯´æ˜ | æ˜¯å¦ä¸¥æ ¼ |
|--------|--------|--------|------|----------|
| `lottery_cost_points` | `100` | number | å•æŠ½ç§¯åˆ†æ¶ˆè€— | âœ… ä¸¥æ ¼æ¨¡å¼ |
| `budget_allocation_ratio` | `0.22` | number | æ¶ˆè´¹è¿”é¢„ç®—æ¯”ä¾‹(22%) | âœ… ä¸¥æ ¼æ¨¡å¼ |
| `daily_lottery_limit` | `10` | number | æ¯æ—¥æŠ½å¥–æ¬¡æ•°ä¸Šé™ | âš ï¸ å»ºè®® |
| `initial_points` | `200` | number | æ–°ç”¨æˆ·åˆå§‹ç§¯åˆ† | âš ï¸ å»ºè®® |

> å®Œæ•´42æ¡é…ç½®æŒ‰categoryåˆ†ç»„ï¼šbasic(**7**ï¼Œå«3æ¡ç»´æŠ¤æ¨¡å¼é…ç½®) + points(8) + notification(3) + security(4) + marketplace(20)ï¼Œè¯¦è§ä¸Šæ–¹"å…³é”®ç³»ç»Ÿé…ç½®"ç« èŠ‚ã€‚

**`system_configs` è¡¨ï¼ˆ9æ¡JSONé…ç½®ï¼‰â€” å…¨éƒ¨éœ€é‡å»º**ï¼š

| config_key | config_category | è¯´æ˜ |
|-----------|-----------------|------|
| `batch_rate_limit_quota_grant` | batch_operation | æ‰¹é‡èµ é€æŠ½å¥–æ¬¡æ•°é™æµ |
| `batch_rate_limit_preset` | batch_operation | æ‰¹é‡è®¾ç½®å¹²é¢„è§„åˆ™é™æµ |
| `batch_rate_limit_redemption` | batch_operation | æ‰¹é‡æ ¸é”€ç¡®è®¤é™æµ |
| `batch_rate_limit_campaign_status` | batch_operation | æ‰¹é‡æ´»åŠ¨çŠ¶æ€åˆ‡æ¢é™æµ |
| `batch_rate_limit_budget` | batch_operation | æ‰¹é‡é¢„ç®—è°ƒæ•´é™æµ |
| `batch_operation_global` | batch_operation | æ‰¹é‡æ“ä½œå…¨å±€é…ç½®ï¼ˆå¹¶å‘/é‡è¯•/å¹‚ç­‰é”®ï¼‰ |
| `campaign_placement` | feature | æ´»åŠ¨ä½ç½®é…ç½®ï¼ˆå°ç¨‹åºå±•ç¤ºä½ç½®ï¼‰ |
| `product_filter` | general | å…‘æ¢å•†å“ç­›é€‰é…ç½®ï¼ˆä»·æ ¼åŒºé—´/æ’åº/åº“å­˜çŠ¶æ€ï¼‰ |
| `feedback_config` | general | åé¦ˆè¡¨å•é…ç½®ï¼ˆç±»åˆ«/ä¼˜å…ˆçº§/å†…å®¹é™åˆ¶/é™„ä»¶ï¼‰ |

> âš ï¸ `system_configs.config_value` å­—æ®µç±»å‹ä¸º **JSON**ï¼ˆéçº¯å­—ç¬¦ä¸²ï¼‰ï¼Œé‡å»ºæ—¶éœ€ç”¨å®Œæ•´JSONå¯¹è±¡ã€‚

---

##### 3. æ´»åŠ¨ä¸å¥–å“å®šä¹‰ï¼ˆè‡³å°‘ 1 å¥—ï¼‰

**æ´»åŠ¨å®šä¹‰**ï¼ˆ`lottery_campaigns` è¡¨ï¼‰ï¼š

| å­—æ®µ | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| campaign_code | å­—ç¬¦ä¸²ï¼ˆå”¯ä¸€ï¼‰ | `BASIC_LOTTERY` |
| campaign_name | å­—ç¬¦ä¸² | `åŸºç¡€æŠ½å¥–æ´»åŠ¨` |
| campaign_type | æšä¸¾ | `event` |
| start_time | æ—¥æœŸæ—¶é—´ | `2026-01-01 00:00:00` |
| end_time | æ—¥æœŸæ—¶é—´ | `2026-12-31 23:59:59` |
| status | æšä¸¾ | `active` |
| budget_mode | æšä¸¾ | `'user'`/`'pool'`/`'none'` |

**å¥–å“å®šä¹‰**ï¼ˆ`lottery_prizes` è¡¨ï¼Œè‡³å°‘ 5-10 ä¸ªï¼‰ï¼š

| å¥–å“åç§° | prize_type | reward_tier | è¯´æ˜ |
|----------|------------|-------------|------|
| è°¢è°¢å‚ä¸ | `virtual` | `low` | ç©ºå¥–ç±»å‹ |
| 100ç§¯åˆ† | `points` | `mid` | ç§¯åˆ†å¥–å“ |
| 500ç§¯åˆ†åˆ¸ | `points` | `high` | é«˜ä»·å€¼ç§¯åˆ† |
| å…«å…«æŠ˜åˆ¸ | `coupon` | `high` | ä¼˜æƒ åˆ¸ |
| ç”œå“1ä»½ | `physical` | `mid` | å®ç‰©å¥–å“ |

> å‚è€ƒå½“å‰æ´»åŠ¨1çš„15ä¸ªå¥–å“é…ç½®ï¼ˆè§ä¸Šæ–¹"æ´»åŠ¨1çš„å¥–å“æ± "è¡¨æ ¼ï¼‰ã€‚

---

##### 4. èµ„äº§ç±»å‹å®šä¹‰ï¼ˆå¿…éœ€4æ¡ï¼‰

| asset_code | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|------------|------|----------|
| `POINTS` | æŠ½å¥–é—¨ç¥¨ã€æ¶ˆè´¹è¿”è¿˜ | âœ… å¿…éœ€ |
| `BUDGET_POINTS` | é¢„ç®—çº¦æŸæŠ½å¥– | âœ… å¿…éœ€ |
| `DIAMOND` | äº¤æ˜“å¸‚åœºè´§å¸ | âš ï¸ å¦‚æœ‰äº¤æ˜“å¸‚åœºåŠŸèƒ½å¿…éœ€ |
| `red_shard` | ææ–™èµ„äº§ã€å¯åˆæˆ | âš ï¸ å¦‚æœ‰åˆæˆåŠŸèƒ½å¿…éœ€ |

---

##### 5. ç³»ç»Ÿè´¦æˆ·ï¼ˆæ¸…ç†åå¿…é¡»æ‰‹åŠ¨é‡å»ºï¼‰

> ğŸ”´ **ä¸å¯é‡è·‘è¿ç§»**ï¼š`sequelizemeta` è¡¨ä¿ç•™ï¼ˆ336æ¡è®°å½•ï¼‰ï¼ŒSequelize CLI è®¤ä¸ºè¿ç§»å·²æ‰§è¡Œè¿‡ã€‚  
> åŸå§‹è¿ç§»æ–‡ä»¶ `20251215160000-create-accounts-table.js` å·²å½’æ¡£åˆ° `migrations/archive/v1-legacy/`ã€‚  
> **å¿…é¡»é€šè¿‡ Node.js è„šæœ¬æ‰‹åŠ¨ INSERT 6 ä¸ªç³»ç»Ÿè´¦æˆ·**ï¼ˆSYSTEM_PLATFORM_FEE / SYSTEM_MINT / SYSTEM_BURN / SYSTEM_ESCROW / SYSTEM_RESERVE / SYSTEM_CAMPAIGN_POOLï¼‰ã€‚

---

##### 6. è§’è‰²å®šä¹‰ï¼ˆå¿…éœ€9æ¡æ­£å¼è§’è‰²ï¼‰

| role_name | description | role_level |
|-----------|-------------|------------|
| `admin` | ç®¡ç†å‘˜ | 100 |
| `regional_manager` | åŒºåŸŸç»ç† | 80 |
| `business_manager` | ä¸šåŠ¡ç»ç† | 60 |
| `sales_staff` | ä¸šåŠ¡å‘˜ | 40 |
| `merchant_manager` | å•†æˆ·ç®¡ç† | 40 |
| `ops` | è¿è¥ï¼ˆåªè¯»ï¼‰ | 30 |
| `merchant_staff` | å•†æˆ·å‘˜å·¥ | 20 |
| `user` | æ™®é€šç”¨æˆ· | 0 |
| `system_job` | ç³»ç»Ÿä½œä¸šï¼ˆrole_id å»ºè®®è®¾ä¸º100ï¼‰ | -1 |

---

##### 7. åŠŸèƒ½å¼€å…³ï¼ˆ7æ¡æŠ½å¥–ç­–ç•¥å¼€å…³ï¼‰

| flag_key | flag_name | is_enabled | related_config_group |
|----------|-----------|------------|---------------------|
| `lottery_pity_system` | Pity è½¯ä¿åº•æœºåˆ¶ | `1` | `pity` |
| `lottery_luck_debt` | è¿æ°”å€ºåŠ¡æœºåˆ¶ | `1` | `luck_debt` |
| `lottery_anti_empty_streak` | é˜²è¿ç»­ç©ºå¥–æœºåˆ¶ | `1` | `anti_empty` |
| `lottery_anti_high_streak` | é˜²è¿ç»­é«˜ä»·å€¼æœºåˆ¶ | `1` | `anti_high` |
| `lottery_bxpx_matrix` | BxPx çŸ©é˜µè°ƒæƒ | `1` | (null) |
| `lottery_budget_tier` | é¢„ç®—åˆ†å±‚æ§åˆ¶ | `1` | `budget_tier` |
| `lottery_pressure_tier` | æ´»åŠ¨å‹åŠ›åˆ†å±‚ | `1` | `pressure_tier` |

##### 8. æŠ½å¥–ç­–ç•¥é…ç½®ï¼ˆ17æ¡ï¼ŒåŠŸèƒ½å¼€å…³ä¾èµ–çš„è¯¦ç»†å‚æ•°ï¼‰

**`lottery_strategy_config` è¡¨ï¼ˆ17æ¡ï¼ŒæŒ‰ config_group åˆ†ç»„ï¼‰**ï¼š

| config_group | config_key | config_value | è¯´æ˜ |
|-------------|-----------|-------------|------|
| `budget_tier` | `threshold_high` | `1000` | é¢„ç®—é«˜é˜ˆå€¼ |
| `budget_tier` | `threshold_mid` | `500` | é¢„ç®—ä¸­é˜ˆå€¼ |
| `budget_tier` | `threshold_low` | `100` | é¢„ç®—ä½é˜ˆå€¼ |
| `pressure_tier` | `threshold_high` | `0.8` | å‹åŠ›é«˜é˜ˆå€¼ |
| `pressure_tier` | `threshold_low` | `0.5` | å‹åŠ›ä½é˜ˆå€¼ |
| `pity` | `enabled` | `true` | Pityå¼€å…³ |
| `pity` | `hard_guarantee_threshold` | `10` | ç¡¬ä¿åº•é˜ˆå€¼ï¼ˆè¿ç»­10æ¬¡ç©ºå¥–å¿…ä¸­ï¼‰ |
| `pity` | `min_non_empty_cost` | `10` | æœ€ä½éç©ºå¥–æˆæœ¬ |
| `pity` | `multiplier_table` | `{"0":1,"1":1,"2":1.2,...,"9":10}` | è¿ç»­ç©ºå¥–æ¦‚ç‡æå‡è¡¨ |
| `luck_debt` | `enabled` | `true` | è¿æ°”å€ºåŠ¡å¼€å…³ |
| `luck_debt` | `expected_empty_rate` | `0.3` | é¢„æœŸç©ºå¥–ç‡(30%) |
| `luck_debt` | `min_draw_count` | `10` | æœ€å°‘æŠ½å¥–æ¬¡æ•°ï¼ˆä½äºæ­¤æ•°ä¸è§¦å‘ï¼‰ |
| `anti_empty` | `enabled` | `true` | é˜²è¿ç»­ç©ºå¥–å¼€å…³ |
| `anti_empty` | `empty_streak_threshold` | `3` | è¿ç»­ç©ºå¥–é˜ˆå€¼ï¼ˆ3æ¬¡åå¼ºåˆ¶éç©ºï¼‰ |
| `anti_high` | `enabled` | `true` | é˜²è¿ç»­é«˜ä»·å€¼å¼€å…³ |
| `anti_high` | `recent_draw_window` | `5` | è¿‘æœŸæŠ½å¥–çª—å£(5æ¬¡) |
| `anti_high` | `high_streak_threshold` | `2` | é«˜ä»·å€¼è¿ç»­é˜ˆå€¼(2æ¬¡) |

> âš ï¸ ç¼ºå°‘ç­–ç•¥é…ç½®ä¸ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œä½†æŠ½å¥–ä»…ä½¿ç”¨åŸºç¡€æ¦‚ç‡ï¼Œæ—  Pity/LuckDebt/é˜²è¿ç»­ç©ºå¥–ç­‰é«˜çº§ç­–ç•¥ã€‚

---

### ğŸ” æ–¹æ¡ˆ B æ¸…ç†åéªŒè¯æ¸…å•

#### å¿…éœ€æ£€æŸ¥é¡¹ï¼ˆæä¾›æ•°æ®å¹¶é‡å»ºåï¼‰

- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] è¡¨ç»“æ„å®Œæ•´ï¼ˆ**79** å¼ è¡¨ï¼‰
- [ ] **ç³»ç»Ÿè´¦æˆ·å·²æ‰‹åŠ¨INSERTé‡å»º**ï¼ˆ6 ä¸ªï¼Œä¸å¯é€šè¿‡db:migrateé‡å»ºï¼‰
- [ ] **ç®¡ç†å‘˜è´¦å·å·²åˆ›å»º**ï¼ˆè‡³å°‘ 1 ä¸ªï¼‰
- [ ] **ç³»ç»Ÿé…ç½®å·²å†™å…¥**ï¼ˆè‡³å°‘ lottery_cost_points + budget_allocation_ratioï¼‰
- [ ] **æ´»åŠ¨å¥–å“å·²é…ç½®**ï¼ˆè‡³å°‘ 1 ä¸ªæ´»åŠ¨ + å¥–å“æ± ï¼‰
- [ ] **èµ„äº§ç±»å‹å·²å®šä¹‰**ï¼ˆè‡³å°‘ POINTS/BUDGET_POINTSï¼‰
- [ ] **è§’è‰²å®šä¹‰å·²åˆ›å»º**ï¼ˆè‡³å°‘9æ¡æ­£å¼è§’è‰²ï¼‰
- [ ] **åŠŸèƒ½å¼€å…³å·²é…ç½®**ï¼ˆ7ä¸ªæŠ½å¥–ç­–ç•¥å¼€å…³ï¼‰
- [ ] è¿ç§»è®°å½•å®Œæ•´ï¼ˆ`sequelizemeta` **336**æ¡ï¼‰
- [ ] è¡Œæ”¿åŒºåˆ’å®Œæ•´ï¼ˆ`administrative_regions` 44,703æ¡ï¼‰

#### åŠŸèƒ½éªŒè¯ï¼ˆå¿…éœ€ï¼‰

- [ ] ç®¡ç†å‘˜å¯ç™»å½•ç®¡ç†åå°
- [ ] ç”¨æˆ·å¯æ³¨å†Œæ–°è´¦å·
- [ ] æ¶ˆè´¹å®¡æ‰¹å¯å‘æ”¾ç§¯åˆ†
- [ ] æŠ½å¥–åŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨
- [ ] äº¤æ˜“å¸‚åœºå¯æ­£å¸¸ä½¿ç”¨ï¼ˆå¦‚æœæœ‰æ­¤åŠŸèƒ½ï¼‰

---

## ğŸ“‹ æ–¹æ¡ˆ A vs æ–¹æ¡ˆ B å¯¹æ¯”æ¸…å•

| ç»´åº¦ | æ–¹æ¡ˆ Aï¼ˆä¿å®ˆï¼‰ | æ–¹æ¡ˆ Bï¼ˆæ¿€è¿›ï¼‰ |
|------|----------------|----------------|
| **æ¸…ç†è¡¨æ•°** | çº¦48å¼ ï¼ˆåªæ¸…ä¸šåŠ¡æ•°æ®ï¼‰ | 77å¼ ï¼ˆæ¸…é…ç½®+ä¸šåŠ¡ï¼‰ |
| **ä¿ç•™ç”¨æˆ·è´¦å·** | âœ… æ˜¯ï¼ˆ60ä¸ªç”¨æˆ·ï¼‰ | âŒ å¦ |
| **ä¿ç•™ç®¡ç†å‘˜** | âœ… æ˜¯ï¼ˆ4ä¸ªadminï¼‰ | âŒ å¦ |
| **ä¿ç•™ç³»ç»Ÿè´¦æˆ·** | âœ… æ˜¯ï¼ˆ6 ä¸ªï¼‰ | âŒ å¦ |
| **ä¿ç•™ç³»ç»Ÿé…ç½®** | âœ… æ˜¯ï¼ˆ42+9æ¡ï¼‰ | âŒ å¦ |
| **ä¿ç•™æ´»åŠ¨é…ç½®** | âœ… æ˜¯ï¼ˆ4æ´»åŠ¨30å¥–å“ï¼‰ | âŒ å¦ |
| **ä¿ç•™ç­–ç•¥é…ç½®** | âœ… æ˜¯ | âŒ å¦ |
| **ä¿ç•™åŠŸèƒ½å¼€å…³** | âœ… æ˜¯ï¼ˆ7ä¸ªï¼‰ | âŒ å¦ |
| **ä¿ç•™å­—å…¸æ•°æ®** | âœ… æ˜¯ï¼ˆ371æ¡/74ç§ç±»å‹ï¼‰ | âŒ å¦ |
| **æ¸…ç†ç”¨æˆ·èµ„äº§** | âœ… æ˜¯ | âœ… æ˜¯ |
| **æ¸…ç†æŠ½å¥–è®°å½•** | âœ… æ˜¯ï¼ˆ2,280æ¡ï¼‰ | âœ… æ˜¯ |
| **æ¸…ç†æ“ä½œæ—¥å¿—** | âœ… æ˜¯ï¼ˆ5540+æ¡ï¼‰ | âœ… æ˜¯ |
| **æ‰§è¡Œåå¯ç™»å½•** | âœ… æ˜¯ï¼ˆéœ€é‡æ–°ç™»å½•ï¼‰ | âŒ å¦ï¼ˆéœ€é‡å»ºç®¡ç†å‘˜ï¼‰ |
| **æ‰§è¡Œåå¯æŠ½å¥–** | âœ… æ˜¯ï¼ˆéœ€å……å€¼èµ„äº§ï¼‰ | âŒ å¦ï¼ˆéœ€é‡å»ºæ´»åŠ¨ï¼‰ |
| **æ¢å¤æˆæœ¬** | æ— ï¼ˆé…ç½®éƒ½ä¿ç•™ï¼‰ | æé«˜ï¼ˆ2-4 å°æ—¶ï¼‰ |

---

## ğŸ› ï¸ é¡¹ç›®å·²æœ‰çš„æ¸…ç†è„šæœ¬

### å†å²æ•°æ®æ¸…ç†è„šæœ¬

é¡¹ç›®ä¸­å·²å­˜åœ¨ `scripts/database/cleanup_historical_data.js`ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š

- **ç”¨é€”**ï¼šæŒ‰æ—¶é—´åˆ†ç•Œçº¿æ¸…ç†å†å²æ•°æ®
- **æ”¯æŒé¢„è§ˆæ¨¡å¼**ï¼š`DRY_RUN=true` æŸ¥çœ‹å½±å“ä½†ä¸å®é™…åˆ é™¤
- **æŒ‰å¤–é”®ä¾èµ–é¡ºåºåˆ é™¤**ï¼šé¿å…å¤–é”®çº¦æŸæŠ¥é”™

**ä½¿ç”¨æ–¹å¼**ï¼š

```bash
# é¢„è§ˆæ¨¡å¼ï¼ˆæŸ¥çœ‹å½±å“ï¼‰
DRY_RUN=true node scripts/database/cleanup_historical_data.js

# å®é™…æ‰§è¡Œ
node scripts/database/cleanup_historical_data.js
```

**æ¶‰åŠè¡¨**ï¼š
- `item_instance_events`
- `redemption_orders`
- `market_listings`
- `trade_orders`
- `item_instances`
- `exchange_records`
- `content_review_records`
- `consumption_records`
- `lottery_draws`

---

## ğŸš¨ é£é™©æç¤º

### æ–¹æ¡ˆ A çš„é£é™©

| é£é™©ç±»å‹ | å½±å“ | è¯´æ˜ |
|----------|------|------|
| èµ„äº§æ•°æ®ä¸¢å¤± | âš ï¸ ä¸­ç­‰ | æ‰€æœ‰ç”¨æˆ·çš„èµ„äº§ä½™é¢å’Œæµæ°´æ¸…é›¶ï¼ˆ25,090æ¡æµæ°´ï¼‰ |
| å†å²è®°å½•ä¸¢å¤± | âš ï¸ ä¸­ç­‰ | æŠ½å¥–/æ¶ˆè´¹/äº¤æ˜“/èŠå¤©çš„å†å²è®°å½•ä¸¢å¤± |
| ç­–ç•¥çŠ¶æ€é‡ç½® | âš ï¸ ä½ | Pityè®¡æ•°å™¨ã€LuckDebtä¹˜æ•°é‡ç½® |
| è´¦æˆ·å…³è”é‡å»º | âš ï¸ ä½ | ç”¨æˆ·çš„ `account_id` ä¼šå˜åŒ– |
| ä¼šè¯å¤±æ•ˆ | âš ï¸ ä½ | ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½• |
| ç³»ç»Ÿè´¦æˆ·ä¸¢å¤± | âŒ æ—  | **ç³»ç»Ÿè´¦æˆ·ä¿ç•™**ï¼Œä¸å—å½±å“ |

---

### æ–¹æ¡ˆ B çš„é¢å¤–é£é™©

| é£é™©ç±»å‹ | å½±å“ | è¯´æ˜ |
|----------|------|------|
| æ— æ³•ç™»å½•ç®¡ç†åå° | ğŸ”´ é«˜ | ç®¡ç†å‘˜è´¦å·è¢«æ¸…ç©ºï¼Œå¿…é¡»é‡å»º |
| ç³»ç»Ÿé…ç½®ä¸¢å¤± | ğŸ”´ é«˜ | 42+9æ¡é…ç½®å‚æ•°ä¸¢å¤±ï¼Œå¿…é¡»é‡æ–°å†™å…¥ |
| æ´»åŠ¨å¥–å“ä¸¢å¤± | ğŸ”´ é«˜ | 4ä¸ªæ´»åŠ¨å’Œ30ä¸ªå¥–å“å®šä¹‰ä¸¢å¤±ï¼Œå¿…é¡»é‡æ–°åˆ›å»º |
| ç­–ç•¥é…ç½®ä¸¢å¤± | ğŸ”´ é«˜ | æŠ½å¥–ç­–ç•¥é…ç½®ä¸¢å¤±ï¼ˆ17+12+11+9æ¡+14ç‰ˆå®šä»·é…ç½®ï¼‰ï¼Œå¿…é¡»é‡æ–°é…ç½® |
| åŠŸèƒ½å¼€å…³ä¸¢å¤± | ğŸ”´ é«˜ | 7ä¸ªåŠŸèƒ½å¼€å…³ä¸¢å¤±ï¼Œå¿…é¡»é‡æ–°é…ç½® |
| ç³»ç»Ÿè´¦æˆ·ä¸¢å¤± | ğŸ”´ é«˜ | ç³»ç»Ÿè´¦æˆ·è¢«æ¸…ç©ºï¼Œå¿…é¡»æ‰‹åŠ¨INSERTé‡å»ºï¼ˆä¸å¯é‡è·‘è¿ç§»ï¼‰ |
| ç³»ç»Ÿå­—å…¸ä¸¢å¤± | ğŸ”´ é«˜ | 74ç§å­—å…¸ç±»å‹ï¼ˆ371æ¡ï¼‰ä¸¢å¤±ï¼Œç•Œé¢æ˜¾ç¤ºè‹±æ–‡ä»£ç  |
| æ¢å¤æˆæœ¬ | ğŸ”´ æé«˜ | éœ€è¦ 2-4 å°æ—¶é‡å»ºæ•´ä¸ªç³»ç»Ÿ |

---

## ğŸ“ æ‰§è¡Œæ¸…ç†çš„æ–¹å¼ï¼ˆNode.js onlyï¼‰

### æ‰§è¡Œçº¦æŸ

1. **ä¸ä½¿ç”¨ mysql å®¢æˆ·ç«¯**ï¼šæ‰€æœ‰æ“ä½œé€šè¿‡ Node.js æ‰§è¡Œ
2. **è¿æ¥çœŸå® `.env` åº“**ï¼šä½¿ç”¨ `require('dotenv').config()` + `require('./config/database').sequelize`
3. **æ‰§è¡Œå‰æ ¸å¯¹**ï¼šå…ˆè¿è¡Œæ•°æ®åº“è¿æ¥æµ‹è¯•ç¡®è®¤è¿æ¥çš„æ˜¯æµ‹è¯•åº“

### æ‰§è¡ŒåŸåˆ™ï¼ˆä¸å«ä»£ç å®ç°ï¼‰

**æ–¹æ¡ˆ A æ‰§è¡Œæ­¥éª¤**ï¼š

1. è¿æ¥ `.env` æŒ‡å‘çš„çœŸå®æ•°æ®åº“
2. æ‰§è¡Œ `SET FOREIGN_KEY_CHECKS = 0;`
3. å¯¹çº¦48å¼ ä¸šåŠ¡è¡¨æ‰§è¡Œ `TRUNCATE TABLE`ï¼ˆä½† `accounts` åªåˆ  `account_type='user'` çš„è®°å½•ï¼‰
4. æ‰§è¡Œ `SET FOREIGN_KEY_CHECKS = 1;`
5. éªŒè¯ç³»ç»Ÿè´¦æˆ·ä»å­˜åœ¨ï¼ˆ6 ä¸ªï¼‰
6. éªŒè¯ç³»ç»Ÿé…ç½®ä»å­˜åœ¨ï¼ˆå…³é”®é…ç½®ï¼‰

**æ–¹æ¡ˆ B æ‰§è¡Œæ­¥éª¤**ï¼š

1. è¿æ¥ `.env` æŒ‡å‘çš„çœŸå®æ•°æ®åº“ï¼ˆ`restaurant_points_dev @ dbconn.sealosbja.site:42569`ï¼‰
2. æ‰§è¡Œ `SET FOREIGN_KEY_CHECKS = 0;`
3. å¯¹ 77 å¼ è¡¨æ‰§è¡Œ `TRUNCATE TABLE`ï¼ˆä¿ç•™ `sequelizemeta` å’Œ `administrative_regions`ï¼‰
4. æ‰§è¡Œ `SET FOREIGN_KEY_CHECKS = 1;`
5. **æ‰‹åŠ¨ INSERT ç³»ç»Ÿè´¦æˆ·**ï¼ˆâš ï¸ ä¸å¯é‡è·‘è¿ç§»ï¼Œsequelizemeta å·²è®°å½• 336 æ¡è¿ç§»ï¼‰
6. æ ¹æ®ä½ æä¾›çš„æ•°æ®æŒ‰å¤–é”®ä¾èµ–é¡ºåºé‡å»ºï¼šè§’è‰² â†’ èµ„äº§ç»„å­—å…¸ â†’ ç¨€æœ‰åº¦å­—å…¸ â†’ ç±»ç›®å­—å…¸ â†’ èµ„äº§ç±»å‹ â†’ ç³»ç»Ÿé…ç½® â†’ åŠŸèƒ½å¼€å…³ â†’ æ´»åŠ¨ â†’ å¥–å“ â†’ ç®¡ç†å‘˜ç™»å½•+æˆæƒ

> âš ï¸ æ³¨æ„å¤–é”®ä¾èµ–é¡ºåºï¼šæ•°æ®åº“æœ‰ 114 æ¡ FK çº¦æŸï¼ŒTRUNCATE å‰å¿…é¡»ç¦ç”¨ FK æ£€æŸ¥ã€‚

---

### éªŒè¯è„šæœ¬å‘½ä»¤

```bash
# 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œè¡¨æ•°é‡
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  await sequelize.authenticate();
  const [tables] = await sequelize.query('SHOW TABLES');
  console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼Œè¡¨æ•°é‡:', tables.length, '(é¢„æœŸ79)');
  await sequelize.close();
})();
"

# 2. æ£€æŸ¥ç³»ç»Ÿè´¦æˆ·å®Œæ•´æ€§
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  const [rows] = await sequelize.query(\"SELECT system_code FROM accounts WHERE account_type='system'\");
  console.log('ç³»ç»Ÿè´¦æˆ·:', rows.map(r => r.system_code));
  await sequelize.close();
})();
"

# 3. æ£€æŸ¥å…³é”®é…ç½®
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  const [rows] = await sequelize.query(\"SELECT setting_key, setting_value FROM system_settings WHERE setting_key IN('lottery_cost_points','budget_allocation_ratio','daily_lottery_limit')\");
  console.table(rows);
  await sequelize.close();
})();
"

# 4. æ£€æŸ¥åŠŸèƒ½å¼€å…³
node -e "
require('dotenv').config();
const { sequelize } = require('./config/database');
(async () => {
  const [rows] = await sequelize.query('SELECT flag_key, is_enabled FROM feature_flags');
  console.table(rows);
  await sequelize.close();
})();
"

# 5. èµ„äº§åŸŸä¸€è‡´æ€§éªŒè¯
node scripts/verify-asset-domain.js

# 6. æŠ½å¥–è´¦æœ¬ä¸€è‡´æ€§éªŒè¯
node scripts/diagnostic/verify_lottery_ledger.js
```

---

## ğŸ¯ å¿«é€Ÿå†³ç­–æŒ‡å—

### åœºæ™¯ 1ï¼šæ—¥å¸¸æµ‹è¯•åæ¢å¤ç¯å¢ƒ

**æ¨èæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ A  
**ç†ç”±**ï¼šä¿ç•™é…ç½®å’Œç”¨æˆ·ï¼Œåªæ¸…ç†ä¸šåŠ¡æ•°æ®  
**ä½ éœ€è¦æä¾›**ï¼šæµ‹è¯•ç”¨æˆ· IDï¼ˆå½“å‰ç®¡ç†å‘˜ï¼š`user_id=31, 135, 11114, 11132`ï¼‰

---

### åœºæ™¯ 2ï¼šé‡å¤§æ¶æ„é‡æ„

**æ¨èæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ A  
**ç†ç”±**ï¼šæ¸…ç†èµ„äº§å’Œä¸šåŠ¡æ•°æ®ï¼Œä¸ºæ–°æ¶æ„æä¾›å¹²å‡€åŸºç¡€  
**ä½ éœ€è¦æä¾›**ï¼šæµ‹è¯•ç”¨æˆ· IDã€æ´»åŠ¨é¢„ç®—æ¨¡å¼ç¡®è®¤

---

### åœºæ™¯ 3ï¼šç³»ç»Ÿé…ç½®æœ¬èº«æœ‰é—®é¢˜

**æ¨èæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ B  
**ç†ç”±**ï¼šå®Œå…¨é‡ç½®ï¼Œé‡æ–°é…ç½®æ‰€æœ‰å‚æ•°  
**ä½ éœ€è¦æä¾›**ï¼šå®Œæ•´é‡å»ºåŒ…ï¼ˆç®¡ç†å‘˜ã€è§’è‰²ã€é…ç½®ã€åŠŸèƒ½å¼€å…³ã€æ´»åŠ¨ã€å¥–å“ã€èµ„äº§ç±»å‹ï¼‰

---

## ğŸ”‘ æ ¸å¿ƒè¦ç‚¹æ€»ç»“

### æ–¹æ¡ˆ Aï¼ˆä¿å®ˆæ¸…ç†ï¼‰

**æ¸…ç†å¯¹è±¡**ï¼šçº¦48å¼ ä¸šåŠ¡æ•°æ®è¡¨  
**ä¿ç•™å¯¹è±¡**ï¼šé…ç½®ã€ç”¨æˆ·ã€ç³»ç»Ÿè´¦æˆ·ã€æ´»åŠ¨å®šä¹‰ã€ç­–ç•¥é…ç½®ã€åŠŸèƒ½å¼€å…³ã€å­—å…¸æ•°æ®ï¼ˆä¸å«è¿è¥å†…å®¹å’Œç”¨æˆ·å…³ç³»æ•°æ®ï¼‰

**ä½ éœ€è¦æä¾›**ï¼š
- âœ… æµ‹è¯•ç”¨æˆ· IDï¼ˆ1-2 ä¸ªï¼Œå½“å‰ç®¡ç†å‘˜ `user_id=31, 135, 11114, 11132`ï¼‰
- å¯é€‰ï¼šåˆå§‹èµ„äº§å……å€¼é‡‘é¢
- å¯é€‰ï¼šæ´»åŠ¨é¢„ç®—æ¨¡å¼ç¡®è®¤

**æ¸…ç†åçŠ¶æ€**ï¼š
- âœ… å¯ä»¥ç™»å½•ï¼ˆéœ€é‡æ–°ç™»å½•ï¼‰
- âœ… å¯ä»¥æŠ½å¥–ï¼ˆéœ€å…ˆå……å€¼èµ„äº§ï¼‰
- âœ… é…ç½®å®Œæ•´ï¼ˆæ— éœ€é‡å»ºï¼‰
- âœ… ç­–ç•¥é…ç½®ä¿ç•™ï¼ˆç”¨æˆ·ä½“éªŒçŠ¶æ€é‡ç½®ï¼‰

---

### æ–¹æ¡ˆ Bï¼ˆæ¿€è¿›æ¸…ç†ï¼‰

**æ¸…ç†å¯¹è±¡**ï¼š77å¼ è¡¨ï¼ˆé…ç½®+ä¸šåŠ¡ï¼‰  
**ä¿ç•™å¯¹è±¡**ï¼šä»…è¡¨ç»“æ„ + è¿ç§»è®°å½•(**336**æ¡) + è¡Œæ”¿åŒºåˆ’å­—å…¸(44,703æ¡)

**ä½ éœ€è¦æä¾›**ï¼š
- âœ… ç®¡ç†å‘˜è´¦å·ï¼ˆmobile/nickname/roleï¼ŒéªŒè¯ç ç™»å½•æ— éœ€å¯†ç ï¼‰
- âœ… è§’è‰²å®šä¹‰ï¼ˆ9æ¡æ­£å¼è§’è‰²ï¼‰
- âœ… å…³é”®é…ç½®ï¼ˆlottery_cost_points / budget_allocation_ratio ç­‰42æ¡ï¼Œå«20æ¡marketplaceé…ç½®+3æ¡ç»´æŠ¤æ¨¡å¼é…ç½®ï¼‰
- âœ… åŠŸèƒ½å¼€å…³é…ç½®ï¼ˆ7ä¸ªæŠ½å¥–ç­–ç•¥å¼€å…³ï¼‰
- âœ… æ´»åŠ¨ä¸å¥–å“ï¼ˆè‡³å°‘ 1 å¥—å®Œæ•´å®šä¹‰ï¼‰
- âœ… èµ„äº§ç±»å‹ï¼ˆPOINTS/BUDGET_POINTS/DIAMOND/red_shard å…±4æ¡ï¼Œred_shard æ˜¾ç¤ºåå·²æ”¹ä¸º"çº¢æ°´æ™¶ç¢ç‰‡"ï¼‰

**æ¸…ç†åçŠ¶æ€**ï¼š
- âŒ æ— æ³•ç™»å½•ï¼ˆéœ€é‡å»ºç®¡ç†å‘˜ï¼‰
- âŒ æ— æ³•æŠ½å¥–ï¼ˆéœ€é‡å»ºæ´»åŠ¨ï¼‰
- âŒ é…ç½®ä¸¢å¤±ï¼ˆéœ€å…¨éƒ¨é‡å»ºï¼‰

---

## ğŸ“Œ ä½ çš„å†³ç­–

**è¯·æ˜ç¡®å‘ŠçŸ¥ä»¥ä¸‹ä¿¡æ¯**ï¼š

### 1. é€‰æ‹©æ–¹æ¡ˆ

- [ ] æ–¹æ¡ˆ Aï¼ˆä¿å®ˆæ¸…ç†ï¼‰
- [x] æ–¹æ¡ˆ Bï¼ˆæ¿€è¿›æ¸…ç†ï¼‰

---

### 2. å¦‚æœé€‰æ–¹æ¡ˆ Aï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

**å¿…éœ€æä¾›**ï¼š

- æµ‹è¯•ç”¨æˆ· ID æˆ– mobileï¼š`_____________`
  - **æ¨è**ï¼š`31`ï¼ˆç®¡ç†å‘˜ç”¨æˆ·ï¼‰æˆ– `135`ï¼ˆç®¡ç†å‘˜ç”¨æˆ·ï¼‰

**å¯é€‰æä¾›**ï¼š

- åˆå§‹ POINTS å……å€¼ï¼š`_____________`ï¼ˆå»ºè®® 1000-5000ï¼‰
- åˆå§‹ DIAMOND å……å€¼ï¼š`_____________`ï¼ˆå»ºè®® 500-2000ï¼‰
- æ´»åŠ¨é¢„ç®—æ¨¡å¼ï¼š`_____________`ï¼ˆå½“å‰æ´»åŠ¨1ä¸º `'user'`ï¼‰

---

### 3. å¦‚æœé€‰æ–¹æ¡ˆ Bï¼Œæä¾›å®Œæ•´é‡å»ºåŒ…

ï¼ˆè§ä¸Šæ–¹è¯¦ç»†æ¸…å•ï¼‰

---

**æä¾›ä»¥ä¸Šä¿¡æ¯åï¼Œæˆ‘ä¼šç”Ÿæˆç²¾ç¡®çš„æ¸…ç†è„šæœ¬å’ŒéªŒè¯æ­¥éª¤ã€‚**
