# æ•°æ®åº“è¿ç§»ç®¡ç†ç°çŠ¶æ ¸å¯¹æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2026å¹´01æœˆ03æ—¥  
**æ ¸å¯¹æ–¹å¼**: å½“å‰ä»£ç  + çœŸå®æ•°æ®åº“ï¼ˆrestaurant_points_devï¼‰  
**æ ¸å¯¹å·¥å…·**: Node.js + Sequelize + information_schema  
**æ•°æ®æ¥æº**: ä¸å¼•ç”¨å†å²æŠ¥å‘Šï¼Œå®Œå…¨åŸºäºå®é™…ä»£ç çŠ¶æ€å’Œæ•°æ®åº“çœŸå®æ•°æ®

---

## ğŸ“Š æ ¸å¯¹ç»“è®ºæ€»è§ˆ

### ğŸ”´ P0çº§é—®é¢˜ï¼šè¿ç§»å†å²æ–­è£‚ï¼ˆç¡®è®¤å­˜åœ¨ï¼‰

**é—®é¢˜æè¿°**ï¼š

- çœŸå®æ•°æ®åº“ `sequelizemeta` è¡¨è®°å½•äº† **196 æ¡è¿ç§»**
- å½“å‰ä»“åº“ `migrations/` é¡¶å±‚åªæœ‰ **89 ä¸ª .js è¿ç§»æ–‡ä»¶**
- **DB å·²è®°å½•ä½†ä»“åº“é¡¶å±‚ç¼ºå¤±çš„è¿ç§»ï¼š107 æ¡**
- **DB å·²è®°å½•ä½†æ–‡ä»¶è¢«ç§»å…¥ archived/ çš„è¿ç§»ï¼š18 æ¡**

**é£é™©è¯„ä¼°**ï¼šğŸ”´ ä¸¥é‡

- æ–°ç¯å¢ƒéƒ¨ç½²æ—¶æ— æ³•å®Œæ•´é‡æ”¾è¿ç§»å†å²
- ç¾å¤‡æ¢å¤æ—¶è¿ç§»é“¾æ–­è£‚
- å›æ»šæ“ä½œå›°éš¾ï¼ˆç¼ºå°‘å†å²è¿ç§»çš„ down æ–¹æ³•ï¼‰
- æ•°æ®åº“çŠ¶æ€ä¸å¯é¢„æµ‹ï¼ˆæ— æ³•ä»è¿ç§»æ–‡ä»¶æ¨å¯¼å½“å‰ç»“æ„ï¼‰

---

## 1ï¸âƒ£ è¿ç§»ä½“ç³»ç°çŠ¶ç›˜ç‚¹

### 1.1 æ–‡ä»¶ç³»ç»Ÿç°çŠ¶

**è¿ç§»ç›®å½•ç»“æ„**ï¼š

```
/home/devbox/project/migrations/
â”œâ”€â”€ é¡¶å±‚è¿ç§»æ–‡ä»¶
â”‚   â”œâ”€â”€ .js æ–‡ä»¶ï¼š89 ä¸ª
â”‚   â”œâ”€â”€ .sql æ–‡ä»¶ï¼š1 ä¸ªï¼ˆ20251206_dual_account_system.sqlï¼‰
â”‚   â””â”€â”€ å…¶ä»–æ–‡ä»¶ï¼š5 ä¸ªï¼ˆREADME.mdã€DEPRECATED_EXCHANGE_RECORDS.mdç­‰ï¼‰
â”œâ”€â”€ manual/ å­ç›®å½•
â”‚   â””â”€â”€ .sql æ–‡ä»¶ï¼š9 ä¸ªï¼ˆæ‰‹åŠ¨è¿ç§»è„šæœ¬ï¼‰
â””â”€â”€ archived/ å­ç›®å½•
    â””â”€â”€ .js æ–‡ä»¶ï¼š18 ä¸ªï¼ˆå·²å½’æ¡£çš„è¿ç§»ï¼‰

æ€»æ–‡ä»¶æ•°ï¼ˆé€’å½’ï¼‰ï¼š122
```

**å‘½åè§„èŒƒé—®é¢˜**ï¼š

- æ ‡å‡†æ ¼å¼ï¼š`{YYYYMMDD}{HHMMSS}-{action}-{target}.js`
- ä¸ç¬¦åˆè§„èŒƒï¼š1 ä¸ªæ–‡ä»¶
  - `20251226203441-remove_probability_column.js`ï¼ˆä½¿ç”¨ä¸‹åˆ’çº¿è€Œéè¿å­—ç¬¦ï¼‰

**åŒæ—¶é—´æˆ³å†²çª**ï¼š

- é‡å¤æ—¶é—´æˆ³ç»„æ•°ï¼š**3 ç»„**
- é—®é¢˜é›†ä¸­åœ¨ï¼š**20251215** æ®µ

**å†²çªç¤ºä¾‹**ï¼š

```javascript
// æ—¶é—´æˆ³ï¼š20251215180000ï¼ˆ3ä¸ªæ–‡ä»¶åŒæ—¶ï¼‰
20251215180000 - add - cost - asset - fields - to - exchange - items.js
20251215180000 - add - material - fields - to - lottery - prizes.js
20251215180000 - create - market - listings - table.js

// æ—¶é—´æˆ³ï¼š20251215180100ï¼ˆ2ä¸ªæ–‡ä»¶åŒæ—¶ï¼‰
20251215180100 - add - pay - asset - fields - to - exchange - market - records.js
20251215180100 - create - trade - orders - table.js

// æ—¶é—´æˆ³ï¼š20251215230000ï¼ˆ2ä¸ªæ–‡ä»¶åŒæ—¶ï¼‰
20251215230000 - alter - column - asset - transactions - user - id - nullable.js
20251215230000 - fix - asset - transactions - user - id - nullable.js
```

**é£é™©è¯´æ˜**ï¼š

- sequelize-cli æŒ‰æ–‡ä»¶åå­—å…¸åºæ‰§è¡Œ
- åŒæ—¶é—´æˆ³æ—¶æ‰§è¡Œé¡ºåºä¾èµ–æ–‡ä»¶åæ’åº
- å¦‚æœå­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆå¦‚å…ˆå»ºè¡¨å†åŠ å­—æ®µï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ‰§è¡Œå¤±è´¥
- åæœŸéš¾ä»¥å®¡è®¡"å“ªä¸ªå…ˆæ‰§è¡Œ"

### 1.2 çœŸå®æ•°æ®åº“è¿ç§»è®°å½•

**è¿æ¥ä¿¡æ¯**ï¼š

- æ•°æ®åº“ï¼š`restaurant_points_dev`
- è¿ç§»è®°å½•è¡¨ï¼š`sequelizemeta`ï¼ˆå°å†™ï¼‰
- è®°å½•æ€»æ•°ï¼š**196 æ¡**

**è¿ç§»è®°å½•ä¸æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹                      | æ•°é‡    | è¯´æ˜                    |
| --------------------------- | ------- | ----------------------- |
| DB å·²è®°å½•çš„è¿ç§»             | 196     | å†å²æ‰§è¡Œè¿‡çš„æ‰€æœ‰è¿ç§»    |
| ä»“åº“é¡¶å±‚ .js è¿ç§»           | 89      | å½“å‰å¯æ‰§è¡Œçš„è¿ç§»æ–‡ä»¶    |
| DB å·²è®°å½•ä½†ä»“åº“é¡¶å±‚ç¼ºå¤±     | **107** | ğŸ”´ è¿ç§»å†å²æ–­è£‚         |
| ä»“åº“é¡¶å±‚å­˜åœ¨ä½† DB æœªè®°å½•    | 0       | âœ… æ— æœªæ‰§è¡Œè¿ç§»         |
| DB å·²è®°å½•ä¸”æ–‡ä»¶åœ¨ archived/ | 18      | âš ï¸ å·²å½’æ¡£ä½† DB ä»æœ‰è®°å½• |

**DB å·²è®°å½•ä½†ä»“åº“é¡¶å±‚ç¼ºå¤±çš„è¿ç§»ï¼ˆå‰20æ¡ç¤ºä¾‹ï¼‰**ï¼š

```
20250110_add_idempotency_index.js
20250121000000-fix-field-inconsistencies.js
20250121000001-exchange-records-to-exchange-id.js
20250121120000-fix-null-constraints-comprehensive.js
20250121180713-create-prize-distribution-table.js
20250121200000-create-admin-security-tables.js
20250123-simplify-image-resources.js
20250128000000-fix-database-consistency.js
20250130000000-unify-primary-keys.js
20250804215008-upgrade-products-table.js
20250804215013-create-exchange-records.js
20250805154928-add-consecutive-fail-count-to-users.js
20250811211941-create-chat-system-tables.js
20250814154700-add-message-source-to-chat-messages.js
20250814211437-add-history-total-points-and-update-premium-config.js
20250819173637-create-new-separated-architecture.js
20250819211009-fix-null-constraints-v3.js
20250819225427-create-analytics-tables.js
20250820175943-fix-database-consistency-v3-correct.js
20250820180135-cleanup-duplicate-indexes-v3.js
```

**DB å·²è®°å½•ä¸”æ–‡ä»¶åœ¨ archived/ çš„è¿ç§»ï¼ˆå…¨éƒ¨18æ¡ï¼‰**ï¼š

```
20251108234905-add-column-withdraw-fields-to-user-inventory.js
20251109152918-add-operator-id-to-user-inventory.js
20251109234220-add-transfer-tracking-fields-to-user-inventory.js
20251208234550-remove-price-type-points-mixed.js
20251209002100-remove-payment-type-points-mixed-from-records.js
20251215160300-migrate-user-asset-accounts-to-account-balances.js
20251215165621-create-user-material-balances.js
20251215165623-create-material-transactions.js
20251215165624-create-user-diamond-accounts.js
20251215165625-create-diamond-transactions.js
20251215170000-add-selling-asset-fields-to-user-inventory.js
20251215170000-phase4-set-old-material-tables-readonly.js
20251215170200-migrate-selling-points-to-selling-amount.js
20251215180000-phase4-drop-old-material-diamond-tables.js
20251215220102-migrate-user-inventory-to-item-instances.js
20251218230000-migrate-virtual-price-to-material-cost.js
20251219000000-final-cleanup-virtual-points-fields.js
20251222000100-drop-column-asset-transactions-user-id.js
```

### 1.3 manual/ æ‰‹åŠ¨è¿ç§»è„šæœ¬

**æ–‡ä»¶åˆ—è¡¨**ï¼ˆ9ä¸ª .sql æ–‡ä»¶ï¼‰ï¼š

```
migrations/manual/remove_duplicate_pity_field_from_lottery_records.sql
migrations/manual/20251102_add_soft_delete_to_records_tables.sql
migrations/manual/migrate_to_uuid_roles.sql
migrations/manual/20251110_add_deletion_audit_fields_to_points_transactions.sql
migrations/manual/remove_duplicate_fields_from_lottery_records.sql
migrations/manual/migrate_to_uuid_roles_fixed.sql
migrations/manual/add_soft_delete_to_lottery_records.sql
migrations/manual/20250121_update_admin_id_fields.sql
migrations/manual/20251108_add_unique_index_user_active_session.sql
```

**é—®é¢˜è¯´æ˜**ï¼š

- è¿™äº› SQL è„šæœ¬ç»•è¿‡äº† sequelize-cli è¿ç§»ç³»ç»Ÿ
- æ— æ³•é€šè¿‡ `npm run db:migrate` è‡ªåŠ¨æ‰§è¡Œ
- æ²¡æœ‰å¯¹åº”çš„ `sequelizemeta` è®°å½•
- æ–°ç¯å¢ƒéƒ¨ç½²æ—¶å®¹æ˜“é—æ¼
- æ— æ³•å›æ»šï¼ˆæ²¡æœ‰ down é€»è¾‘ï¼‰

---

## 2ï¸âƒ£ çœŸå®æ•°æ®åº“è¡¨ç»“æ„æ ¸å¯¹

### 2.1 æ ¸å¿ƒä¸šåŠ¡è¡¨çŠ¶æ€

**æ•°æ®åº“åç§°**ï¼š`restaurant_points_dev`  
**æ€»è¡¨æ•°**ï¼š45

**å½“å‰ä»£ç ä¾èµ–çš„æ ¸å¿ƒè¡¨ï¼ˆå…¨éƒ¨å­˜åœ¨ âœ…ï¼‰**ï¼š

| è¡¨å                          | è¡Œæ•°     | ä¸šåŠ¡è¯´æ˜                  |
| ----------------------------- | -------- | ------------------------- |
| users                         | 22       | ç”¨æˆ·åŸºç¡€ä¿¡æ¯              |
| roles                         | 6        | è§’è‰²å®šä¹‰ï¼ˆUUIDè§’è‰²ç³»ç»Ÿï¼‰  |
| user_roles                    | 13       | ç”¨æˆ·è§’è‰²å…³è”              |
| authentication_sessions       | 0        | JWTè®¤è¯ä¼šè¯               |
| lottery_campaigns             | 1        | æŠ½å¥–æ´»åŠ¨                  |
| lottery_prizes                | 9        | å¥–å“é…ç½®                  |
| lottery_draws                 | **2841** | æŠ½å¥–è®°å½•ï¼ˆé«˜é¢‘ä¸šåŠ¡ï¼‰      |
| lottery_management_settings   | 342      | æŠ½å¥–ç®¡ç†è®¾ç½®              |
| lottery_draw_quota_rules      | 1        | æŠ½å¥–é…é¢è§„åˆ™              |
| lottery_user_daily_draw_quota | 6        | ç”¨æˆ·æ¯æ—¥é…é¢              |
| item_instances                | **1211** | ç‰©å“å®ä¾‹ï¼ˆä¸å¯å åŠ ç‰©å“ï¼‰  |
| item_instance_events          | 301      | ç‰©å“äº‹ä»¶æº¯æº              |
| redemption_orders             | **397**  | æ ¸é”€è®¢å•                  |
| accounts                      | 13       | ç»Ÿä¸€è´¦æˆ·ä½“ç³»              |
| account_asset_balances        | 11       | è´¦æˆ·èµ„äº§ä½™é¢              |
| asset_transactions            | **216**  | èµ„äº§æµæ°´ï¼ˆç»Ÿä¸€è´¦æœ¬ï¼‰      |
| api_idempotency_requests      | 69       | APIå¹‚ç­‰è¯·æ±‚è®°å½•           |
| exchange_items                | 24       | B2Cå…‘æ¢å•†å“é…ç½®           |
| exchange_records              | **0**    | B2Cå…‘æ¢è®¢å•ï¼ˆå½“å‰æ— æ•°æ®ï¼‰ |
| market_listings               | 1        | C2Cå¸‚åœºæŒ‚ç‰Œ               |
| trade_orders                  | 0        | C2Cäº¤æ˜“è®¢å•               |
| trade_records                 | 2        | äº¤æ˜“è®°å½•                  |
| consumption_records           | **184**  | æ¶ˆè´¹è®°å½•ï¼ˆå•†å®¶æ‰«ç ï¼‰      |
| content_review_records        | **184**  | å†…å®¹å®¡æ ¸è®°å½•              |
| merchant_points_reviews       | 0        | å•†å®¶ç§¯åˆ†å®¡æ ¸              |
| customer_service_sessions     | 1        | å®¢æœä¼šè¯                  |
| chat_messages                 | 0        | èŠå¤©æ¶ˆæ¯                  |
| admin_operation_logs          | **1006** | ç®¡ç†å‘˜æ“ä½œæ—¥å¿—            |
| system_settings               | 18       | ç³»ç»Ÿè®¾ç½®                  |
| websocket_startup_logs        | **735**  | WebSocketå¯åŠ¨æ—¥å¿—         |
| material_asset_types          | 3        | ææ–™èµ„äº§ç±»å‹              |
| material_conversion_rules     | 1        | ææ–™è½¬æ¢è§„åˆ™              |

### 2.2 Legacyè¡¨æ¸…ç†çŠ¶æ€ï¼ˆâœ… å·²æ¸…ç†ï¼‰

**å·²åºŸå¼ƒçš„æ—§è¡¨ï¼ˆå‡ä¸å­˜åœ¨ï¼‰**ï¼š

| è¡¨å                    | å­˜åœ¨çŠ¶æ€  | è¯´æ˜                                        |
| ----------------------- | --------- | ------------------------------------------- |
| user_inventory          | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° item_instances + redemption_orders |
| exchange_market_records | âŒ ä¸å­˜åœ¨ | å·²é‡å‘½åä¸º exchange_records                 |
| user_points_accounts    | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ°ç»Ÿä¸€èµ„äº§ä½“ç³»                        |
| points_transactions     | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° asset_transactions                 |
| user_asset_accounts     | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° accounts + account_asset_balances  |
| asset_accounts          | âŒ ä¸å­˜åœ¨ | å·²åºŸå¼ƒ                                      |
| user_material_balances  | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° account_asset_balances             |
| material_transactions   | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° asset_transactions                 |
| user_diamond_accounts   | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° account_asset_balances             |
| diamond_transactions    | âŒ ä¸å­˜åœ¨ | å·²è¿ç§»åˆ° asset_transactions                 |

**ç»“è®º**ï¼šâœ… æ—§è¡¨æ¸…ç†å·¥ä½œå·²å®Œæˆï¼Œæ•°æ®åº“ä¸­ä¸å­˜åœ¨åºŸå¼ƒçš„ legacy è¡¨

### 2.3 å£å¾„ä¸ä¸€è‡´é—®é¢˜

**é—®é¢˜1ï¼šexchange_records åºŸå¼ƒæ ‡è®°ä¸å®é™…ä½¿ç”¨ä¸ç¬¦**

**æ–‡æ¡£æ ‡è®°**ï¼š

- `migrations/DEPRECATED_EXCHANGE_RECORDS.md` å£°æ˜è¯¥è¡¨å·²åºŸå¼ƒ
- æ–‡æ¡£å†…å®¹ï¼š
  ```
  The 'exchange_records' table is DEPRECATED and no longer used in the application.
  All references to ExchangeRecords model have been removed from the codebase.
  ```

**å®é™…ä»£ç çŠ¶æ€**ï¼š

- âœ… æ¨¡å‹å­˜åœ¨ï¼š`models/ExchangeRecord.js`ï¼ˆæ´»è·ƒä½¿ç”¨ä¸­ï¼‰
- âœ… è·¯ç”±å­˜åœ¨ï¼š`routes/v4/shop/exchange/` å®Œæ•´è·¯ç”±æ¨¡å—
  - `exchange.js` - å…‘æ¢æ“ä½œï¼ˆPOST /exchangeï¼‰
  - `items.js` - å•†å“åˆ—è¡¨ï¼ˆGET /itemsï¼‰
  - `orders.js` - è®¢å•æŸ¥è¯¢ï¼ˆGET /ordersï¼‰
  - `statistics.js` - ç»Ÿè®¡æ•°æ®
- âœ… è¡¨å­˜åœ¨ï¼šçœŸå®æ•°æ®åº“ä¸­ `exchange_records` è¡¨å­˜åœ¨
- âœ… APIè·¯ç”±ï¼š`/api/v4/shop/exchange/*` å®Œæ•´ä¸šåŠ¡é“¾è·¯

**çœŸå®æ•°æ®åº“çŠ¶æ€**ï¼š

- è¡¨åï¼š`exchange_records`
- å½“å‰è¡Œæ•°ï¼š**0**ï¼ˆæ— æ•°æ®ï¼Œä½†è¡¨ç»“æ„å­˜åœ¨ï¼‰
- è¡¨æ³¨é‡Šï¼š`B2Cå…‘æ¢è®°å½•è¡¨ï¼ˆåŸexchange_market_recordsï¼Œ2025-12-22é‡å‘½åï¼‰`

**ç»“è®º**ï¼šâŒ åºŸå¼ƒæ ‡è®°ä¸å®é™…ä¸ç¬¦

- ä»£ç ä»åœ¨ä½¿ç”¨è¯¥è¡¨å’Œæ¨¡å‹
- åº”åˆ é™¤ `DEPRECATED_EXCHANGE_RECORDS.md` æˆ–æ›´æ–°å…¶å†…å®¹

---

## 2ï¸âƒ£ è¿ç§»è®°å½•ä¸€è‡´æ€§æ ¸å¯¹

### 2.1 æ•°æ®åº“è¿ç§»è®°å½•è¡¨

**è¡¨å**ï¼š`sequelizemeta`ï¼ˆå°å†™ï¼‰  
**è®°å½•æ•°**ï¼š196 æ¡  
**å­—æ®µç»“æ„**ï¼š

```sql
CREATE TABLE `sequelizemeta` (
  `name` VARCHAR(255) NOT NULL PRIMARY KEY
)
```

### 2.2 è¿ç§»è®°å½•ä¸æ–‡ä»¶ç³»ç»Ÿ Diff

**æ ¸å¯¹ç»“æœ**ï¼š

| å¯¹æ¯”ç»´åº¦                    | æ•°é‡    | é£é™©ç­‰çº§ |
| --------------------------- | ------- | -------- |
| DB å·²è®°å½•çš„è¿ç§»æ€»æ•°         | 196     | -        |
| ä»“åº“é¡¶å±‚ .js è¿ç§»æ–‡ä»¶       | 89      | -        |
| **DB å·²è®°å½•ä½†ä»“åº“é¡¶å±‚ç¼ºå¤±** | **107** | ğŸ”´ ä¸¥é‡  |
| ä»“åº“é¡¶å±‚å­˜åœ¨ä½† DB æœªè®°å½•    | 0       | âœ… æ­£å¸¸  |
| DB å·²è®°å½•ä¸”æ–‡ä»¶åœ¨ archived/ | 18      | âš ï¸ è­¦å‘Š  |

**DB å·²è®°å½•ä½†ä»“åº“é¡¶å±‚ç¼ºå¤±çš„è¿ç§»ï¼ˆå‰20æ¡ï¼‰**ï¼š

```
20250110_add_idempotency_index.js
20250121000000-fix-field-inconsistencies.js
20250121000001-exchange-records-to-exchange-id.js
20250121120000-fix-null-constraints-comprehensive.js
20250121180713-create-prize-distribution-table.js
20250121200000-create-admin-security-tables.js
20250123-simplify-image-resources.js
20250128000000-fix-database-consistency.js
20250130000000-unify-primary-keys.js
20250804215008-upgrade-products-table.js
20250804215013-create-exchange-records.js
20250805154928-add-consecutive-fail-count-to-users.js
20250811211941-create-chat-system-tables.js
20250814154700-add-message-source-to-chat-messages.js
20250814211437-add-history-total-points-and-update-premium-config.js
20250819173637-create-new-separated-architecture.js
20250819211009-fix-null-constraints-v3.js
20250819225427-create-analytics-tables.js
20250820175943-fix-database-consistency-v3-correct.js
20250820180135-cleanup-duplicate-indexes-v3.js
```

**DB å·²è®°å½•ä¸”æ–‡ä»¶åœ¨ archived/ çš„è¿ç§»ï¼ˆå…¨éƒ¨18æ¡ï¼‰**ï¼š

```
20251108234905-add-column-withdraw-fields-to-user-inventory.js
20251109152918-add-operator-id-to-user-inventory.js
20251109234220-add-transfer-tracking-fields-to-user-inventory.js
20251208234550-remove-price-type-points-mixed.js
20251209002100-remove-payment-type-points-mixed-from-records.js
20251215160300-migrate-user-asset-accounts-to-account-balances.js
20251215165621-create-user-material-balances.js
20251215165623-create-material-transactions.js
20251215165624-create-user-diamond-accounts.js
20251215165625-create-diamond-transactions.js
20251215170000-add-selling-asset-fields-to-user-inventory.js
20251215170000-phase4-set-old-material-tables-readonly.js
20251215170200-migrate-selling-points-to-selling-amount.js
20251215180000-phase4-drop-old-material-diamond-tables.js
20251215220102-migrate-user-inventory-to-item-instances.js
20251218230000-migrate-virtual-price-to-material-cost.js
20251219000000-final-cleanup-virtual-points-fields.js
20251222000100-drop-column-asset-transactions-user-id.js
```

---

## 3ï¸âƒ£ å½“å‰ä¸šåŠ¡é€»è¾‘ä¸å•†ä¸šæ¨¡å¼

### 3.1 æ ¸å¿ƒä¸šåŠ¡åŸŸï¼ˆä» routes/v4 + models + çœŸå®æ•°æ®å½’çº³ï¼‰

**1. æŠ½å¥–ç³»ç»Ÿï¼ˆ/api/v4/lotteryï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`lottery_campaigns`ã€`lottery_prizes`ã€`lottery_draws`
- æ•°æ®é‡ï¼š2841 æ¬¡æŠ½å¥–è®°å½•ï¼ˆé«˜é¢‘ä¸šåŠ¡ï¼‰
- ä¸šåŠ¡æ¨¡å¼ï¼šç”¨æˆ·æ¶ˆè€—ç§¯åˆ†/èµ„äº§æŠ½å¥– â†’ è·å¾—å¥–å“ â†’ å¥–å“è¿›å…¥èƒŒåŒ…æˆ–ç›´æ¥è½¬åŒ–ä¸ºææ–™èµ„äº§
- ç®¡ç†å¹²é¢„ï¼š`lottery_management_settings` 342 æ¡ï¼ˆç®¡ç†å‘˜å¯è®¾ç½®å¼ºåˆ¶ä¸­å¥–/ä¸ä¸­å¥–/æ¦‚ç‡è°ƒæ•´ï¼‰
- é…é¢æ§åˆ¶ï¼š`lottery_draw_quota_rules` + `lottery_user_daily_draw_quota`ï¼ˆé˜²åˆ·æœºåˆ¶ï¼‰

**2. ç»Ÿä¸€èµ„äº§ä½“ç³»ï¼ˆ/api/v4/shop/assets + /api/v4/assetsï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`accounts`ã€`account_asset_balances`ã€`asset_transactions`
- æ•°æ®é‡ï¼š13 ä¸ªè´¦æˆ·ã€11 ä¸ªä½™é¢è®°å½•ã€216 æ¡èµ„äº§æµæ°´
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - ç»Ÿä¸€è´¦æˆ·ä½“ç³»ï¼ˆç”¨æˆ·è´¦æˆ· + ç³»ç»Ÿè´¦æˆ·ï¼‰
  - æ”¯æŒå¯ç”¨ä½™é¢ + å†»ç»“ä½™é¢
  - æ‰€æœ‰èµ„äº§å˜åŠ¨è®°å½•æµæ°´ï¼ˆå®¡è®¡è¿½æº¯ï¼‰
- èµ„äº§ç±»å‹ï¼šææ–™èµ„äº§ï¼ˆ`material_asset_types`ï¼š3ç§ï¼‰ã€DIAMOND ç­‰
- å¹‚ç­‰ä¿è¯ï¼š`api_idempotency_requests` 69 æ¡ï¼ˆä¸šç•Œæ ‡å‡†å¹‚ç­‰æ¶æ„ï¼‰

**3. B2Cå®˜æ–¹å…‘æ¢ï¼ˆ/api/v4/shop/exchangeï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`exchange_items`ï¼ˆå•†å“é…ç½®ï¼‰ã€`exchange_records`ï¼ˆå…‘æ¢è®¢å•ï¼‰
- æ•°æ®é‡ï¼š24 ä¸ªå•†å“é…ç½®ã€0 æ¡å…‘æ¢è®¢å•ï¼ˆåŠŸèƒ½å·²ä¸Šçº¿ä½†æš‚æ— æ•°æ®ï¼‰
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - ç”¨æˆ·ä½¿ç”¨ææ–™èµ„äº§å…‘æ¢å•†å“
  - æ”¯ä»˜æ–¹å¼ï¼š`pay_asset_code` + `pay_amount`ï¼ˆææ–™èµ„äº§ï¼‰
  - èµ„äº§æ‰£å‡é€šè¿‡ `AssetService.changeBalance()` ç»Ÿä¸€æ‰§è¡Œ
  - è®¢å•ç®¡ç†ï¼špending â†’ shipped â†’ completed
- å¹‚ç­‰æ§åˆ¶ï¼šHeader `Idempotency-Key` å¿…å¡«

**4. C2Cäº¤æ˜“å¸‚åœºï¼ˆ/api/v4/marketï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`market_listings`ï¼ˆæŒ‚ç‰Œï¼‰ã€`trade_orders`ï¼ˆè®¢å•ï¼‰
- æ•°æ®é‡ï¼š1 ä¸ªæŒ‚ç‰Œã€0 ä¸ªè®¢å•ï¼ˆåŠŸèƒ½å·²ä¸Šçº¿ä½†æš‚æ— äº¤æ˜“ï¼‰
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - ç”¨æˆ·æŒ‚ç‰Œå‡ºå”®ç‰©å“ï¼ˆä¸å¯å åŠ ç‰©å“ + å¯å åŠ èµ„äº§ï¼‰
  - å…¶ä»–ç”¨æˆ·è´­ä¹°æŒ‚ç‰Œ
  - èµ„äº§å†»ç»“/è§£å†»/ç»“ç®—æœºåˆ¶
  - å¹³å°æ‰‹ç»­è´¹ï¼šå…¥ç³»ç»Ÿè´¦æˆ·ï¼ˆ`SYSTEM_PLATFORM_FEE`ï¼‰

**5. èƒŒåŒ…ä¸æ ¸é”€ç³»ç»Ÿï¼ˆ/api/v4/inventory + /api/v4/shop/redemptionï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`item_instances`ï¼ˆç‰©å“å®ä¾‹ï¼‰ã€`item_instance_events`ï¼ˆäº‹ä»¶æº¯æºï¼‰ã€`redemption_orders`ï¼ˆæ ¸é”€è®¢å•ï¼‰
- æ•°æ®é‡ï¼š1211 ä¸ªç‰©å“å®ä¾‹ã€301 ä¸ªäº‹ä»¶ã€397 ä¸ªæ ¸é”€è®¢å•
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - ä¸å¯å åŠ ç‰©å“ï¼šè£…å¤‡ã€å¡ç‰Œã€ä¼˜æƒ åˆ¸ç­‰
  - çŠ¶æ€æµè½¬ï¼šavailable â†’ locked â†’ transferred/used/expired
  - æ ¸é”€ç³»ç»Ÿï¼šç”Ÿæˆ 12 ä½ Base32 æ ¸é”€ç  â†’ æ ¸é”€éªŒè¯ â†’ 30 å¤© TTL

**6. å•†å®¶å®¡æ ¸ç³»ç»Ÿï¼ˆ/api/v4/merchantï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`consumption_records`ï¼ˆæ¶ˆè´¹è®°å½•ï¼‰ã€`merchant_points_reviews`ï¼ˆå•†å®¶å®¡æ ¸ï¼‰ã€`content_review_records`ï¼ˆå†…å®¹å®¡æ ¸ï¼‰
- æ•°æ®é‡ï¼š184 æ¡æ¶ˆè´¹è®°å½•ã€0 æ¡å•†å®¶å®¡æ ¸ã€184 æ¡å†…å®¹å®¡æ ¸
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - å•†å®¶æ‰«ç å½•å…¥æ¶ˆè´¹ â†’ å†»ç»“ç§¯åˆ† â†’ å®¡æ ¸æµç¨‹ â†’ ç§¯åˆ†ç»“ç®—
  - å®¡æ ¸æ‹’ç»/è¶…æ—¶ï¼šç§¯åˆ†ä¸é€€å›ï¼Œéœ€å®¢æœæ‰‹å·¥å¤„ç†

**7. å®¢æœä¸ç®¡ç†ç³»ç»Ÿï¼ˆ/api/v4/adminï¼‰**

- æ ¸å¿ƒè¡¨ï¼š`customer_service_sessions`ã€`chat_messages`ã€`admin_operation_logs`
- æ•°æ®é‡ï¼š1 ä¸ªä¼šè¯ã€0 æ¡æ¶ˆæ¯ã€1006 æ¡æ“ä½œæ—¥å¿—
- ä¸šåŠ¡æ¨¡å¼ï¼š
  - ç”¨æˆ·å‘èµ·å’¨è¯¢ â†’ å®¢æœæ¥å…¥ â†’ æ¶ˆæ¯æ”¶å‘ â†’ ä¼šè¯å…³é—­
  - æ‰€æœ‰æ•æ„Ÿæ“ä½œè®°å½•å®¡è®¡æ—¥å¿—ï¼ˆæ“ä½œå‰åæ•°æ®å¯¹æ¯”ï¼‰

### 3.2 å•†ä¸šæ¨¡å¼æ€»ç»“

**æ ¸å¿ƒé—­ç¯**ï¼š

```
ç”¨æˆ·æ¶ˆè´¹ï¼ˆå•†å®¶æ‰«ç ï¼‰ â†’ ç§¯åˆ†å¥–åŠ± â†’ æŠ½å¥–æ¶ˆè€—ç§¯åˆ† â†’ è·å¾—å¥–å“/ææ–™
                                    â†“
ææ–™èµ„äº§ â†’ B2Cå®˜æ–¹å…‘æ¢å•†å“ OR C2Cå¸‚åœºäº¤æ˜“ â†’ æ ¸é”€/ä½¿ç”¨
```

**å¢é•¿æœºåˆ¶**ï¼š

- æŠ½å¥–é«˜é¢‘ï¼ˆ2841 æ¬¡ï¼‰é©±åŠ¨ç”¨æˆ·æ´»è·ƒ
- ææ–™èµ„äº§ä½“ç³»ï¼ˆ3 ç§ææ–™ï¼‰å¢åŠ ç©æ³•æ·±åº¦
- ä¼šå‘˜æƒç›Šï¼ˆ`user_premium_status`ï¼‰ä»˜è´¹è½¬åŒ–

**é£æ§æœºåˆ¶**ï¼š

- æŠ½å¥–é…é¢æ§åˆ¶ï¼ˆé˜²åˆ·ï¼‰
- å•†å®¶å®¡æ ¸æµç¨‹ï¼ˆé˜²æ¬ºè¯ˆï¼‰
- å¹‚ç­‰æ€§æ§åˆ¶ï¼ˆé˜²é‡å¤æäº¤ï¼‰
- æ“ä½œå®¡è®¡æ—¥å¿—ï¼ˆè´£ä»»è¿½æº¯ï¼‰

---

## 4ï¸âƒ£ å¯æ‰§è¡Œæ•´æ”¹æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šè¡¥é½è¿ç§»å†å²ï¼ˆæ¨èç”¨äºé•¿æœŸç»´æŠ¤ï¼‰

**ç›®æ ‡**ï¼šè®©ä»“åº“è¿ç§»æ–‡ä»¶ä¸æ•°æ®åº“è¿ç§»è®°å½•ä¿æŒä¸€è‡´

**æ‰§è¡Œæ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šä»ç‰ˆæœ¬åº“å†å²æ¢å¤ç¼ºå¤±çš„è¿ç§»æ–‡ä»¶**

```bash
# 1. æŸ¥çœ‹ Git å†å²ä¸­åˆ é™¤çš„è¿ç§»æ–‡ä»¶
git log --all --full-history --oneline -- migrations/ | head -50

# 2. æ‰¾åˆ°åˆ é™¤è¿ç§»æ–‡ä»¶çš„æäº¤
git log --all --full-history --diff-filter=D -- "migrations/*.js"

# 3. æ¢å¤ç‰¹å®šè¿ç§»æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰
git checkout <commit-hash>^ -- migrations/20250110_add_idempotency_index.js

# 4. æ‰¹é‡æ¢å¤ï¼ˆå¦‚æœæœ‰å¤‡ä»½åˆ†æ”¯ï¼‰
git checkout backup-branch -- migrations/
```

**æ­¥éª¤2ï¼šæ•´ç†æ¢å¤çš„è¿ç§»æ–‡ä»¶**

```bash
# 1. åˆ›å»º legacy ç›®å½•å­˜æ”¾å†å²è¿ç§»
mkdir -p migrations/legacy

# 2. å°†æ¢å¤çš„å†å²è¿ç§»ç§»å…¥ legacy/
# ï¼ˆä¿ç•™å†å²ï¼Œä½†ä¸å½±å“æ–°è¿ç§»çš„æ‰§è¡Œé¡ºåºï¼‰
mv migrations/2025*.js migrations/legacy/

# 3. æ›´æ–° .sequelizerc é…ç½®ï¼ˆå¯é€‰ï¼‰
# å¦‚æœéœ€è¦ sequelize-cli è¯†åˆ« legacy ç›®å½•
```

**æ­¥éª¤3ï¼šéªŒè¯è¿ç§»å®Œæ•´æ€§**

```bash
# 1. æ£€æŸ¥è¿ç§»çŠ¶æ€
npm run migration:status

# 2. éªŒè¯è¿ç§»æ–‡ä»¶
npm run migration:verify

# 3. å¯¹æ¯” DB è®°å½•ä¸æ–‡ä»¶ç³»ç»Ÿ
node scripts/check-migration-records.js
```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] DB `sequelizemeta` è®°å½•çš„è¿ç§»æ–‡ä»¶åœ¨ä»“åº“ä¸­éƒ½èƒ½æ‰¾åˆ°ï¼ˆå¯ä»¥åœ¨ legacy/ æˆ– archived/ï¼‰
- [ ] æ–°ç¯å¢ƒéƒ¨ç½²æ—¶å¯ä»¥é€‰æ‹©"å®Œæ•´é‡æ”¾"æˆ–"åŸºçº¿+å¢é‡"
- [ ] è¿ç§»å†å²å¯è¿½æº¯ã€å¯å®¡è®¡

---

### æ–¹æ¡ˆBï¼šå»ºç«‹æƒå¨åŸºçº¿è¿ç§»ï¼ˆæ¨èç”¨äºå·²å¤šæ¬¡é‡æ„çš„é¡¹ç›®ï¼‰

**ç›®æ ‡**ï¼šä»¥å½“å‰çœŸå®åº“ schema ä¸ºçœŸç›¸ï¼Œå»ºç«‹æ–°çš„è¿ç§»èµ·ç‚¹

**æ‰§è¡Œæ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šç”ŸæˆåŸºçº¿è¿ç§»**

```bash
# ä½¿ç”¨ä»“åº“ç°æœ‰çš„åŸºçº¿ç”Ÿæˆå·¥å…·
node scripts/database/generate-baseline-migration.js

# æˆ–æ‰‹åŠ¨ç”Ÿæˆï¼ˆå¦‚æœå·¥å…·ä¸å¯ç”¨ï¼‰
# 1. å¯¼å‡ºå½“å‰æ•°æ®åº“ç»“æ„
mysqldump -u<user> -p<password> -h<host> --no-data --skip-add-drop-table restaurant_points_dev > baseline_schema.sql

# 2. è½¬æ¢ä¸º Sequelize è¿ç§»æ ¼å¼
# ï¼ˆéœ€è¦æ‰‹åŠ¨ç¼–å†™æˆ–ä½¿ç”¨å·¥å…·è½¬æ¢ï¼‰
```

**æ­¥éª¤2ï¼šæ ‡è®°åŸºçº¿è¿ç§»**

```bash
# 1. åˆ›å»ºåŸºçº¿è¿ç§»æ–‡ä»¶
# migrations/20260103000000-baseline-v2.0.0-from-production.js

# 2. åœ¨åŸºçº¿è¿ç§»ä¸­æ·»åŠ è¯´æ˜
/**
 * åŸºçº¿è¿ç§» V2.0.0
 *
 * è¯´æ˜ï¼š
 * - åŸºäº 2026-01-03 ç”Ÿäº§æ•°æ®åº“ schema ç”Ÿæˆ
 * - åŒ…å«æ‰€æœ‰è¡¨ã€ç´¢å¼•ã€çº¦æŸçš„æœ€ç»ˆæ€
 * - æ–°ç¯å¢ƒéƒ¨ç½²ï¼šåªéœ€æ‰§è¡Œæ­¤åŸºçº¿ + ä¹‹åçš„å¢é‡è¿ç§»
 * - å†å²è¿ç§»ï¼ˆ196æ¡ï¼‰ä»…ä½œå­˜æ¡£ï¼Œä¸å†ç”¨äºé‡æ”¾
 *
 * ä½¿ç”¨æ–¹å¼ï¼š
 * - æ–°ç¯å¢ƒï¼šæ‰§è¡Œ baseline + å¢é‡è¿ç§»
 * - ç°æœ‰ç¯å¢ƒï¼šè·³è¿‡ baselineï¼ˆå·²åŒ…å«åœ¨å†å²è¿ç§»ä¸­ï¼‰
 */
```

**æ­¥éª¤3ï¼šå»ºç«‹è¿ç§»ç­–ç•¥æ–‡æ¡£**

```bash
# åˆ›å»º migrations/README.md
cat > migrations/README.md << 'EOF'
# è¿ç§»ç®¡ç†ç­–ç•¥

## è¿ç§»æ‰§è¡Œç­–ç•¥

### ç°æœ‰ç¯å¢ƒï¼ˆå·²æœ‰ 196 æ¡è¿ç§»è®°å½•ï¼‰
- æ‰§è¡Œç­–ç•¥ï¼šè·³è¿‡ baselineï¼Œåªæ‰§è¡Œå¢é‡è¿ç§»
- å‘½ä»¤ï¼š`npm run db:migrate`

### æ–°ç¯å¢ƒï¼ˆå…¨æ–°æ•°æ®åº“ï¼‰
- æ‰§è¡Œç­–ç•¥ï¼šæ‰§è¡Œ baseline + å¢é‡è¿ç§»
- å‘½ä»¤ï¼š
  1. `npx sequelize-cli db:migrate --to 20260103000000-baseline-v2.0.0-from-production.js`
  2. `npm run db:migrate`

## ç›®å½•è¯´æ˜

- `migrations/` - å½“å‰å¯æ‰§è¡Œè¿ç§»ï¼ˆ89ä¸ªï¼‰
- `migrations/legacy/` - å†å²è¿ç§»å­˜æ¡£ï¼ˆ107ä¸ªï¼Œä»…ä¾›å®¡è®¡ï¼‰
- `migrations/archived/` - å·²å½’æ¡£è¿ç§»ï¼ˆ18ä¸ªï¼ŒDB ä»æœ‰è®°å½•ï¼‰
- `migrations/manual/` - æ‰‹åŠ¨è¿ç§»è„šæœ¬ï¼ˆ9ä¸ªï¼Œéœ€è½¬æ¢ä¸ºæ ‡å‡†è¿ç§»ï¼‰

## è¿ç§»è®°å½•

- æ•°æ®åº“è¡¨ï¼š`sequelizemeta`
- å½“å‰è®°å½•æ•°ï¼š196
- åŸºçº¿ç‰ˆæœ¬ï¼šV2.0.0ï¼ˆ2026-01-03ï¼‰
EOF
```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] åŸºçº¿è¿ç§»åŒ…å«å½“å‰æ‰€æœ‰è¡¨ã€ç´¢å¼•ã€çº¦æŸ
- [ ] æ–°ç¯å¢ƒå¯ä»¥é€šè¿‡ baseline + å¢é‡è¿ç§»å®Œæ•´éƒ¨ç½²
- [ ] è¿ç§»ç­–ç•¥æ–‡æ¡£æ¸…æ™°ï¼Œå›¢é˜Ÿæˆå‘˜ç†è§£æ‰§è¡Œæ–¹å¼
- [ ] å†å²è¿ç§»å­˜æ¡£ï¼Œå¯ä¾›å®¡è®¡ä½†ä¸ç”¨äºé‡æ”¾

---

### æ–¹æ¡ˆCï¼šç»Ÿä¸€ manual/ æ‰‹åŠ¨è¿ç§»å£å¾„

**ç›®æ ‡**ï¼šæ¶ˆé™¤"ç»•è¿‡è¿ç§»ç³»ç»Ÿ"çš„æ‰‹åŠ¨ SQL è„šæœ¬

**æ‰§è¡Œæ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šå®¡è®¡ manual/ è„šæœ¬çš„æ‰§è¡ŒçŠ¶æ€**

```bash
# æ£€æŸ¥æ¯ä¸ª manual/ è„šæœ¬æ˜¯å¦å·²åœ¨æ•°æ®åº“ä¸­ç”Ÿæ•ˆ
node - <<'NODE'
const { sequelize } = require('./config/database');
const fs = require('fs');
const path = require('path');

async function checkManualScripts() {
  const manualDir = path.join(__dirname, 'migrations/manual');
  const files = fs.readdirSync(manualDir).filter(f => f.endsWith('.sql'));

  console.log('æ£€æŸ¥ manual/ è„šæœ¬æ‰§è¡ŒçŠ¶æ€ï¼š\n');

  for (const file of files) {
    console.log(`æ–‡ä»¶ï¼š${file}`);
    const content = fs.readFileSync(path.join(manualDir, file), 'utf8');

    // æå– SQL ä¸­æ¶‰åŠçš„è¡¨åå’Œæ“ä½œ
    const tables = [...content.matchAll(/(?:FROM|INTO|TABLE|UPDATE|ALTER)\s+`?(\w+)`?/gi)]
      .map(m => m[1])
      .filter((v, i, a) => a.indexOf(v) === i);

    console.log(`  æ¶‰åŠè¡¨ï¼š${tables.join(', ')}`);

    // æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
    for (const table of tables) {
      const [exists] = await sequelize.query(
        `SELECT 1 FROM information_schema.TABLES WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?`,
        { replacements: [process.env.DB_NAME, table] }
      );
      console.log(`    ${table}: ${exists.length > 0 ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);
    }
    console.log();
  }

  await sequelize.close();
}

checkManualScripts();
NODE
```

**æ­¥éª¤2ï¼šè½¬æ¢ä¸ºæ ‡å‡†è¿ç§»**

```bash
# å¯¹äºæ¯ä¸ª manual/ è„šæœ¬ï¼š

# 1. åˆ›å»ºå¯¹åº”çš„ Sequelize è¿ç§»
npm run migration:create

# 2. å°† SQL é€»è¾‘è½¬æ¢ä¸º queryInterface è°ƒç”¨
# ç¤ºä¾‹ï¼š
# SQL: ALTER TABLE users ADD COLUMN new_field VARCHAR(255);
# è½¬æ¢ä¸ºï¼š
# await queryInterface.addColumn('users', 'new_field', {
#   type: Sequelize.STRING(255),
#   allowNull: true
# });

# 3. æ·»åŠ å›æ»šé€»è¾‘ï¼ˆdown æ–¹æ³•ï¼‰

# 4. æ‰§è¡Œè¿ç§»å¹¶éªŒè¯
npm run migration:up
```

**æ­¥éª¤3ï¼šå»ºç«‹è§„èŒƒ**

```bash
# åœ¨ migrations/README.md ä¸­æ·»åŠ è§„èŒƒ
cat >> migrations/README.md << 'EOF'

## è¿ç§»åˆ›å»ºè§„èŒƒ

### âœ… æ¨èæ–¹å¼
- ä½¿ç”¨ `npm run migration:create` åˆ›å»ºè¿ç§»
- ä½¿ç”¨ queryInterface API ç¼–å†™è¿ç§»é€»è¾‘
- æä¾›å®Œæ•´çš„ up å’Œ down æ–¹æ³•
- é€šè¿‡ `npm run db:migrate` æ‰§è¡Œ

### âŒ ç¦æ­¢æ–¹å¼
- ç›´æ¥ç¼–å†™ SQL è„šæœ¬æ”¾åœ¨ manual/ ç›®å½•
- æ‰‹åŠ¨æ‰§è¡Œ SQL è€Œä¸è®°å½•åˆ° sequelizemeta
- ç»•è¿‡è¿ç§»ç³»ç»Ÿç›´æ¥ä¿®æ”¹æ•°æ®åº“ç»“æ„

### ä¾‹å¤–æƒ…å†µ
- ç´§æ€¥ä¿®å¤ï¼šå¯ä»¥å…ˆæ‰§è¡Œ SQLï¼Œä½†å¿…é¡»åœ¨24å°æ—¶å†…è¡¥å……æ ‡å‡†è¿ç§»
- æ•°æ®ä¿®å¤ï¼šå¯ä»¥ä½¿ç”¨ SQL è„šæœ¬ï¼Œä½†å¿…é¡»è®°å½•æ‰§è¡Œæ—¥å¿—
EOF
```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] manual/ ç›®å½•ä¸ºç©ºæˆ–åªåŒ…å«"å·²æ‰§è¡Œä¸”å·²è½¬æ¢"çš„å†å²å­˜æ¡£
- [ ] æ‰€æœ‰æ–°çš„æ•°æ®åº“å˜æ›´éƒ½é€šè¿‡æ ‡å‡†è¿ç§»æ‰§è¡Œ
- [ ] å›¢é˜Ÿæˆå‘˜ç†è§£å¹¶éµå®ˆè¿ç§»åˆ›å»ºè§„èŒƒ

---

### æ–¹æ¡ˆDï¼šä¿®å¤åŒæ—¶é—´æˆ³å†²çª

**ç›®æ ‡**ï¼šæ¶ˆé™¤åŒæ—¶é—´æˆ³è¿ç§»æ–‡ä»¶ï¼Œç¡®ä¿æ‰§è¡Œé¡ºåºæ˜ç¡®

**æ‰§è¡Œæ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šè¯†åˆ«å†²çªçš„è¿ç§»ç»„**

```bash
# å·²è¯†åˆ«çš„å†²çªç»„ï¼š
# 20251215180000ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
# 20251215180100ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
# 20251215230000ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
```

**æ­¥éª¤2ï¼šé‡æ–°åˆ†é…æ—¶é—´æˆ³**

```bash
# å¯¹äºæ¯ä¸ªå†²çªç»„ï¼ŒæŒ‰ä¸šåŠ¡ä¾èµ–å…³ç³»é‡æ–°åˆ†é…æ—¶é—´æˆ³

# ç¤ºä¾‹ï¼š20251215180000 ç»„
# åŸæ–‡ä»¶ï¼š
# - 20251215180000-add-cost-asset-fields-to-exchange-items.js
# - 20251215180000-add-material-fields-to-lottery-prizes.js
# - 20251215180000-create-market-listings-table.js

# åˆ†æä¾èµ–å…³ç³»ï¼š
# 1. create-market-listings-tableï¼ˆå»ºè¡¨ï¼Œæ— ä¾èµ–ï¼‰
# 2. add-cost-asset-fields-to-exchange-itemsï¼ˆåŠ å­—æ®µï¼Œæ— ä¾èµ–ï¼‰
# 3. add-material-fields-to-lottery-prizesï¼ˆåŠ å­—æ®µï¼Œæ— ä¾èµ–ï¼‰

# é‡æ–°åˆ†é…æ—¶é—´æˆ³ï¼ˆä¿æŒåŸæœ‰é¡ºåºï¼‰ï¼š
git mv migrations/20251215180000-create-market-listings-table.js \
       migrations/20251215180000-create-market-listings-table.js
# ï¼ˆç¬¬ä¸€ä¸ªä¿æŒä¸å˜ï¼‰

git mv migrations/20251215180000-add-cost-asset-fields-to-exchange-items.js \
       migrations/20251215180001-add-cost-asset-fields-to-exchange-items.js

git mv migrations/20251215180000-add-material-fields-to-lottery-prizes.js \
       migrations/20251215180002-add-material-fields-to-lottery-prizes.js
```

**æ­¥éª¤3ï¼šæ›´æ–° sequelizemeta è®°å½•**

```bash
# å¦‚æœè¿ç§»å·²æ‰§è¡Œï¼Œéœ€è¦åŒæ­¥æ›´æ–° DB è®°å½•
node - <<'NODE'
const { sequelize } = require('./config/database');

async function updateMigrationRecords() {
  await sequelize.authenticate();

  // æ›´æ–°è¿ç§»è®°å½•åç§°
  await sequelize.query(
    `UPDATE sequelizemeta
     SET name = '20251215180001-add-cost-asset-fields-to-exchange-items.js'
     WHERE name = '20251215180000-add-cost-asset-fields-to-exchange-items.js'`
  );

  await sequelize.query(
    `UPDATE sequelizemeta
     SET name = '20251215180002-add-material-fields-to-lottery-prizes.js'
     WHERE name = '20251215180000-add-material-fields-to-lottery-prizes.js'`
  );

  console.log('âœ… è¿ç§»è®°å½•å·²æ›´æ–°');
  await sequelize.close();
}

updateMigrationRecords();
NODE
```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] æ‰€æœ‰è¿ç§»æ–‡ä»¶æ—¶é—´æˆ³å”¯ä¸€
- [ ] sequelizemeta è®°å½•ä¸æ–‡ä»¶åä¸€è‡´
- [ ] è¿ç§»æ‰§è¡Œé¡ºåºæ˜ç¡®ä¸”å¯é¢„æµ‹

---

### æ–¹æ¡ˆEï¼šæ¸…ç†å£å¾„ä¸ä¸€è‡´é—®é¢˜

**ç›®æ ‡**ï¼šä¿®å¤ exchange_records åºŸå¼ƒæ ‡è®°ä¸å®é™…ä½¿ç”¨ä¸ç¬¦çš„é—®é¢˜

**æ‰§è¡Œæ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šç¡®è®¤ä¸šåŠ¡å†³ç­–**

- å¦‚æœ `exchange_records` ä»åœ¨ä½¿ç”¨ï¼ˆå½“å‰ä»£ç çŠ¶æ€ï¼‰ï¼š
  - åˆ é™¤ `migrations/DEPRECATED_EXCHANGE_RECORDS.md`
  - æ›´æ–°ç›¸å…³æ–‡æ¡£è¯´æ˜è¯¥è¡¨çš„å½“å‰ç”¨é€”

- å¦‚æœç¡®å®è¦åºŸå¼ƒï¼ˆéœ€è¦ä¸šåŠ¡ç¡®è®¤ï¼‰ï¼š
  - åˆ é™¤ `models/ExchangeRecord.js`
  - åˆ é™¤ `routes/v4/shop/exchange/` æ‰€æœ‰è·¯ç”±
  - åˆ é™¤ `services/` ä¸­ç›¸å…³æœåŠ¡
  - æ‰§è¡Œæ•°æ®è¿ç§»ï¼ˆå¦‚æœæœ‰æ•°æ®ï¼‰
  - DROP TABLEï¼ˆå¦‚æœç¡®è®¤ä¸éœ€è¦ï¼‰

**æ­¥éª¤2ï¼šæ‰§è¡Œæ¸…ç†ï¼ˆå‡è®¾ä¿ç•™ä½¿ç”¨ï¼‰**

```bash
# åˆ é™¤é”™è¯¯çš„åºŸå¼ƒæ ‡è®°
rm migrations/DEPRECATED_EXCHANGE_RECORDS.md

# æ›´æ–° models/ExchangeRecord.js æ³¨é‡Š
# ç¡®è®¤è¡¨åå’Œä¸šåŠ¡ç”¨é€”æ¸…æ™°
```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] åºŸå¼ƒæ ‡è®°ä¸å®é™…ä»£ç çŠ¶æ€ä¸€è‡´
- [ ] å›¢é˜Ÿæˆå‘˜æ¸…æ¥šå“ªäº›è¡¨åœ¨ç”¨ã€å“ªäº›å·²åºŸå¼ƒ
- [ ] é¿å…è¯¯åˆ æ­£åœ¨ä½¿ç”¨çš„è¡¨æˆ–æ¨¡å‹

---

## 5ï¸âƒ£ ä¸Šçº¿å‰ç¡¬æ ¡éªŒå»ºè®®

### 5.1 CI/CD é›†æˆæ£€æŸ¥

**åœ¨éƒ¨ç½²æµç¨‹ä¸­æ·»åŠ è¿ç§»ä¸€è‡´æ€§æ£€æŸ¥**ï¼š

```bash
# .github/workflows/deploy.yml æˆ– deploy.sh ä¸­æ·»åŠ 

echo "ğŸ” æ£€æŸ¥è¿ç§»ä¸€è‡´æ€§..."

# 1. æ£€æŸ¥è¿ç§»çŠ¶æ€
npm run migration:status

# 2. æ£€æŸ¥æ˜¯å¦æœ‰æœªæ‰§è¡Œçš„è¿ç§»
PENDING_MIGRATIONS=$(npx sequelize-cli db:migrate:status | grep -c "down" || echo "0")
if [ "$PENDING_MIGRATIONS" -gt 0 ]; then
  echo "âŒ å­˜åœ¨ $PENDING_MIGRATIONS ä¸ªæœªæ‰§è¡Œçš„è¿ç§»"
  exit 1
fi

# 3. å¯¹æ¯” DB è®°å½•ä¸æ–‡ä»¶ç³»ç»Ÿ
node scripts/check-migration-records.js

echo "âœ… è¿ç§»ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡"
```

### 5.2 å®šæœŸå®¡è®¡è„šæœ¬

**æ¯å‘¨/æ¯æœˆæ‰§è¡Œä¸€æ¬¡è¿ç§»å¥åº·æ£€æŸ¥**ï¼š

```bash
#!/bin/bash
# scripts/audit-migration-health.sh

echo "ğŸ“Š è¿ç§»ç³»ç»Ÿå¥åº·æ£€æŸ¥"
echo "===================="

# 1. ç»Ÿè®¡è¿ç§»æ–‡ä»¶æ•°é‡
TOTAL_MIGRATIONS=$(find migrations/ -maxdepth 1 -name "*.js" | wc -l)
echo "ä»“åº“è¿ç§»æ–‡ä»¶ï¼š$TOTAL_MIGRATIONS"

# 2. ç»Ÿè®¡ DB è¿ç§»è®°å½•
DB_RECORDS=$(node -e "
const { sequelize } = require('./config/database');
(async () => {
  await sequelize.authenticate();
  const [rows] = await sequelize.query('SELECT COUNT(*) as cnt FROM sequelizemeta');
  console.log(rows[0].cnt);
  await sequelize.close();
})();
")
echo "DB è¿ç§»è®°å½•ï¼š$DB_RECORDS"

# 3. è®¡ç®—å·®å¼‚
DIFF=$((DB_RECORDS - TOTAL_MIGRATIONS))
echo "è®°å½•å·®å¼‚ï¼š$DIFF"

if [ $DIFF -gt 0 ]; then
  echo "âš ï¸ DB è®°å½•å¤šäºä»“åº“æ–‡ä»¶ $DIFF æ¡"
  echo "å»ºè®®ï¼šæ‰§è¡Œæ–¹æ¡ˆAï¼ˆè¡¥é½å†å²ï¼‰æˆ–æ–¹æ¡ˆBï¼ˆå»ºç«‹åŸºçº¿ï¼‰"
elif [ $DIFF -lt 0 ]; then
  echo "âš ï¸ ä»“åº“æ–‡ä»¶å¤šäº DB è®°å½• $((0 - DIFF)) æ¡"
  echo "å»ºè®®ï¼šæ‰§è¡Œ npm run db:migrate"
else
  echo "âœ… è¿ç§»è®°å½•ä¸æ–‡ä»¶ç³»ç»Ÿä¸€è‡´"
fi

# 4. æ£€æŸ¥ manual/ ç›®å½•
MANUAL_COUNT=$(find migrations/manual/ -name "*.sql" 2>/dev/null | wc -l)
if [ $MANUAL_COUNT -gt 0 ]; then
  echo "âš ï¸ å­˜åœ¨ $MANUAL_COUNT ä¸ªæ‰‹åŠ¨è¿ç§»è„šæœ¬"
  echo "å»ºè®®ï¼šè½¬æ¢ä¸ºæ ‡å‡†è¿ç§»ï¼ˆæ–¹æ¡ˆCï¼‰"
fi

echo "===================="
```

---

## 6ï¸âƒ£ é£é™©è¯„ä¼°ä¸ä¼˜å…ˆçº§

### é£é™©çŸ©é˜µ

| é—®é¢˜                        | é£é™©ç­‰çº§ | å½±å“èŒƒå›´                       | æ•´æ”¹ä¼˜å…ˆçº§ |
| --------------------------- | -------- | ------------------------------ | ---------- |
| è¿ç§»å†å²æ–­è£‚ï¼ˆ107æ¡ç¼ºå¤±ï¼‰   | ğŸ”´ ä¸¥é‡  | æ–°ç¯å¢ƒéƒ¨ç½²ã€ç¾å¤‡æ¢å¤ã€å›æ»šæ“ä½œ | **P0**     |
| åŒæ—¶é—´æˆ³å†²çªï¼ˆ3ç»„ï¼‰         | ğŸŸ¡ ä¸­ç­‰  | è¿ç§»æ‰§è¡Œé¡ºåºã€å®¡è®¡è¿½æº¯         | **P1**     |
| manual/ ç»•è¿‡è¿ç§»ç³»ç»Ÿï¼ˆ9ä¸ªï¼‰ | ğŸŸ¡ ä¸­ç­‰  | æ–°ç¯å¢ƒéƒ¨ç½²ã€è¿ç§»å®Œæ•´æ€§         | **P1**     |
| å£å¾„ä¸ä¸€è‡´ï¼ˆåºŸå¼ƒæ ‡è®°é”™è¯¯ï¼‰  | ğŸŸ¢ è¾ƒä½  | å›¢é˜Ÿåä½œã€ä»£ç ç†è§£             | **P2**     |
| å‘½åè§„èŒƒé—®é¢˜ï¼ˆ1ä¸ªï¼‰         | ğŸŸ¢ è¾ƒä½  | ä»£ç è§„èŒƒã€å·¥å…·å…¼å®¹æ€§           | **P2**     |

### æ•´æ”¹ä¼˜å…ˆçº§å»ºè®®

**ç¬¬ä¸€é˜¶æ®µï¼ˆæœ¬å‘¨å†…ï¼‰**ï¼š

1. é€‰æ‹©æ–¹æ¡ˆAæˆ–æ–¹æ¡ˆBï¼Œè§£å†³è¿ç§»å†å²æ–­è£‚é—®é¢˜
2. å»ºç«‹è¿ç§»ç­–ç•¥æ–‡æ¡£ï¼ˆmigrations/README.mdï¼‰
3. æ·»åŠ  CI/CD è¿ç§»ä¸€è‡´æ€§æ£€æŸ¥

**ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨å†…ï¼‰**ï¼š

1. ä¿®å¤åŒæ—¶é—´æˆ³å†²çªï¼ˆæ–¹æ¡ˆDï¼‰
2. è½¬æ¢ manual/ è„šæœ¬ä¸ºæ ‡å‡†è¿ç§»ï¼ˆæ–¹æ¡ˆCï¼‰
3. æ¸…ç†å£å¾„ä¸ä¸€è‡´é—®é¢˜ï¼ˆæ–¹æ¡ˆEï¼‰

**ç¬¬ä¸‰é˜¶æ®µï¼ˆæŒç»­ä¼˜åŒ–ï¼‰**ï¼š

1. å»ºç«‹å®šæœŸå®¡è®¡æœºåˆ¶
2. å®Œå–„è¿ç§»åˆ›å»ºè§„èŒƒ
3. å›¢é˜ŸåŸ¹è®­å’Œæµç¨‹ä¼˜åŒ–

---

## 7ï¸âƒ£ é™„å½•ï¼šæ ¸å¯¹æ•°æ®è¯¦æƒ…

### 7.1 è¿ç§»å·¥å…·é…ç½®

**sequelize-cli é…ç½®**ï¼ˆ.sequelizercï¼‰ï¼š

```javascript
require('dotenv').config()
const path = require('path')

module.exports = {
  config: path.resolve('config', 'database.js'),
  'models-path': path.resolve('models'),
  'seeders-path': path.resolve('seeders'),
  'migrations-path': path.resolve('migrations')
}
```

**æ•°æ®åº“é…ç½®**ï¼ˆconfig/database.jsï¼‰ï¼š

- é…ç½®æºï¼š`.env` ç¯å¢ƒå˜é‡
- æ—¶åŒºè®¾ç½®ï¼š`timezone: '+08:00'`ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰
- è¿æ¥æ± ï¼šmax 40ã€min 5ã€acquire 10sã€idle 60s
- è¿ç§»è¡¨ï¼š`sequelizemeta`ï¼ˆsequelize-cli é»˜è®¤ï¼‰

### 7.2 å½“å‰ä»£ç ä½¿ç”¨çš„æ¨¡å‹æ¸…å•

**æ ¸å¿ƒæ¨¡å‹ï¼ˆ41ä¸ªï¼Œä» models/index.js æå–ï¼‰**ï¼š

```
User, Role, UserRole, AuthenticationSession, UserPremiumStatus,
LotteryCampaign, LotteryPrize, LotteryDraw, LotteryPreset, LotteryManagementSetting,
LotteryDrawQuotaRule, LotteryUserDailyDrawQuota,
Product, ItemInstance, ItemInstanceEvent,
TradeRecord, TradeOrder,
CustomerServiceSession, ChatMessage,
SystemAnnouncement, Feedback, SystemSettings, PopupBanner,
ImageResources, ExchangeItem, ExchangeRecord,
Account, AccountAssetBalance, AssetTransaction, ApiIdempotencyRequest,
Store, UserHierarchy, RoleChangeLog,
MerchantPointsReview, WebSocketStartupLog,
MaterialAssetType, MaterialConversionRule,
MarketListing, RedemptionOrder,
AdminOperationLog, ContentReviewRecord,
ConsumptionRecord
```

### 7.3 çœŸå®æ•°æ®åº“è¡¨è¡Œæ•°åˆ†å¸ƒ

**é«˜é¢‘ä¸šåŠ¡è¡¨ï¼ˆè¡Œæ•° > 100ï¼‰**ï¼š

- `lottery_draws`: 2841ï¼ˆæŠ½å¥–è®°å½•ï¼‰
- `item_instances`: 1211ï¼ˆç‰©å“å®ä¾‹ï¼‰
- `admin_operation_logs`: 1006ï¼ˆç®¡ç†å‘˜æ“ä½œæ—¥å¿—ï¼‰
- `websocket_startup_logs`: 735ï¼ˆWebSocketæ—¥å¿—ï¼‰
- `redemption_orders`: 397ï¼ˆæ ¸é”€è®¢å•ï¼‰
- `lottery_management_settings`: 342ï¼ˆæŠ½å¥–ç®¡ç†è®¾ç½®ï¼‰
- `item_instance_events`: 301ï¼ˆç‰©å“äº‹ä»¶ï¼‰
- `asset_transactions`: 216ï¼ˆèµ„äº§æµæ°´ï¼‰
- `consumption_records`: 184ï¼ˆæ¶ˆè´¹è®°å½•ï¼‰
- `content_review_records`: 184ï¼ˆå†…å®¹å®¡æ ¸ï¼‰

**ä½é¢‘/æ–°åŠŸèƒ½è¡¨ï¼ˆè¡Œæ•° = 0ï¼‰**ï¼š

- `authentication_sessions`: 0
- `exchange_records`: 0ï¼ˆè¡¨å­˜åœ¨ä½†æ— æ•°æ®ï¼‰
- `trade_orders`: 0
- `chat_messages`: 0
- `popup_banners`: 0
- `merchant_points_reviews`: 0
- `stores`: 0
- `user_hierarchy`: 0
- `role_change_logs`: 0

**è¯´æ˜**ï¼š

- æŠ½å¥–ã€ç‰©å“ã€æ ¸é”€æ˜¯é«˜é¢‘æ ¸å¿ƒä¸šåŠ¡
- äº¤æ˜“å¸‚åœºã€å•†å®¶å®¡æ ¸ç­‰åŠŸèƒ½å·²ä¸Šçº¿ä½†æš‚æ— æ•°æ®
- ç®¡ç†å‘˜æ“ä½œå’Œå®¡è®¡æ—¥å¿—æ´»è·ƒ

---

## 8ï¸âƒ£ æ€»ç»“

### æ ¸å¯¹ç»“è®º

1. **è¿ç§»ç®¡ç†æ··ä¹±é—®é¢˜ç¡®å®å­˜åœ¨**ï¼ˆâœ… ç¡®è®¤ï¼‰
   - è¿ç§»å†å²æ–­è£‚ï¼š107 æ¡ DB è®°å½•ç¼ºå¤±å¯¹åº”æ–‡ä»¶
   - å‘½åä¸è§„èŒƒï¼š1 ä¸ªæ–‡ä»¶ä¸ç¬¦åˆæ ‡å‡†
   - åŒæ—¶é—´æˆ³å†²çªï¼š3 ç»„é‡å¤æ—¶é—´æˆ³
   - æ‰‹åŠ¨è¿ç§»ï¼š9 ä¸ª SQL è„šæœ¬ç»•è¿‡ç³»ç»Ÿ
   - archived/ å½’æ¡£ï¼š18 ä¸ªæ–‡ä»¶ä½† DB ä»æœ‰è®°å½•

2. **åºŸå¼ƒæ ‡è®°ä¸å®é™…ä¸ç¬¦**ï¼ˆâœ… ç¡®è®¤ï¼‰
   - `DEPRECATED_EXCHANGE_RECORDS.md` å£°æ˜å·²åºŸå¼ƒ
   - ä½†ä»£ç ä»åœ¨ä½¿ç”¨ `ExchangeRecord` æ¨¡å‹å’Œè·¯ç”±
   - çœŸå®æ•°æ®åº“ä¸­ `exchange_records` è¡¨å­˜åœ¨

3. **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
   - ç”Ÿäº§ç¯å¢ƒè¿ç§»å¤±è´¥é£é™©é«˜
   - æ•°æ®åº“çŠ¶æ€ä¸å¯é¢„æµ‹
   - å›æ»šå›°éš¾
   - æ–°ç¯å¢ƒéƒ¨ç½²ä¸å¯é 

### æ¨èæ•´æ”¹è·¯å¾„

**ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰**ï¼š

1. é€‰æ‹©æ–¹æ¡ˆAï¼ˆè¡¥é½å†å²ï¼‰æˆ–æ–¹æ¡ˆBï¼ˆå»ºç«‹åŸºçº¿ï¼‰
2. å»ºç«‹è¿ç§»ç­–ç•¥æ–‡æ¡£
3. æ·»åŠ  CI/CD æ£€æŸ¥

**çŸ­æœŸä¼˜åŒ–ï¼ˆ2å‘¨å†…ï¼‰**ï¼š

1. ä¿®å¤åŒæ—¶é—´æˆ³å†²çª
2. è½¬æ¢ manual/ è„šæœ¬
3. æ¸…ç†å£å¾„ä¸ä¸€è‡´

**é•¿æœŸæœºåˆ¶ï¼ˆæŒç»­ï¼‰**ï¼š

1. å®šæœŸå®¡è®¡
2. è§„èŒƒåŸ¹è®­
3. æµç¨‹ä¼˜åŒ–

---

**æŠ¥å‘Šç”Ÿæˆæ–¹å¼**ï¼š

- æ•°æ®åº“è¿æ¥ï¼šé€šè¿‡ `.env` é…ç½®çš„çœŸå®æ•°æ®åº“
- è¿ç§»è®°å½•ï¼šç›´æ¥æŸ¥è¯¢ `sequelizemeta` è¡¨
- è¡¨ç»“æ„ï¼šé€šè¿‡ `information_schema` æŸ¥è¯¢
- è¡Œæ•°ç»Ÿè®¡ï¼šé€šè¿‡ `SELECT COUNT(*)` å®é™…ç»Ÿè®¡
- ä»£ç åˆ†æï¼šè¯»å–å½“å‰ models/ã€routes/ã€migrations/ ç›®å½•

**ä¸åŒ…å«**ï¼š

- å†å²æŠ¥å‘Šå¼•ç”¨
- æ¨æµ‹æ€§ç»“è®º
- æœªéªŒè¯çš„å‡è®¾
- ç”Ÿæˆçš„æ–°ä»£ç 
