# ğŸ” åç«¯æ•°æ®åº“é¡¹ç›®æŠ€æœ¯å€ºåŠ¡åˆ†ææŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´**: 2025å¹´12æœˆ27æ—¥  
**é¡¹ç›®**: é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ V4.0

---

## ğŸ”´ P0çº§é—®é¢˜(å½±å“å®‰å…¨/æ•°æ®ä¸€è‡´æ€§)

### 1. æ•°æ®åº“è¿ç§»ç®¡ç†æ··ä¹±

**é—®é¢˜æè¿°**:

- migrations/ç›®å½•åŒ…å«70+ä¸ªè¿ç§»æ–‡ä»¶
- å‘½åä¸è§„èŒƒ: æ··åˆæ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æ ¼å¼
- è¿ç§»å†²çª: 20251215å¼€å¤´çš„æ–‡ä»¶æœ‰å¤šä¸ªé‡å¤ä¸»é¢˜
- æ‰‹åŠ¨è¿ç§»: manual/ç›®å½•å­˜åœ¨,è¯´æ˜æœ‰ç»•è¿‡è¿ç§»ç³»ç»Ÿçš„æ“ä½œ
- åºŸå¼ƒæ ‡è®°: DEPRECATED_EXCHANGE_RECORDS.md ä½†æœªæ¸…ç†ç›¸å…³ä»£ç 

**é£é™©**: ğŸ”´ ä¸¥é‡ - ç”Ÿäº§ç¯å¢ƒè¿ç§»å¤±è´¥é£é™©é«˜ã€æ•°æ®åº“çŠ¶æ€ä¸å¯é¢„æµ‹ã€å›æ»šå›°éš¾

**ä¿®å¤æ–¹æ¡ˆ**:

```bash
# 1. åˆ›å»ºè¿ç§»å®¡è®¡è„šæœ¬
npm run migration:verify

# 2. æ•´ç†è¿ç§»æ–‡ä»¶
# - ç§»é™¤é‡å¤/å†²çªçš„è¿ç§»
# - ç»Ÿä¸€å‘½åè§„èŒƒ: YYYYMMDDHHMMSS-descriptive-name.js
# - æ¸…ç†manual/ç›®å½•,æ‰€æœ‰å˜æ›´èµ°æ­£è§„è¿ç§»

# 3. å»ºç«‹è¿ç§»é—¨ç¦
# - ç¦æ­¢ç›´æ¥ä¿®æ”¹æ•°æ®åº“
# - æ‰€æœ‰schemaå˜æ›´å¿…é¡»æœ‰è¿ç§»æ–‡ä»¶
# - è¿ç§»æ–‡ä»¶å¿…é¡»å¯å›æ»š(downæ–¹æ³•)
```

---

### 2. é¢„ç®—ç§¯åˆ†æ¶æ„è®¾è®¡é—®é¢˜

**é—®é¢˜æè¿°**:

- user_points_accounts åŒæ—¶å­˜å‚¨ä¸¤ç±»ç§¯åˆ†(available_points + budget_points)
- æŠ½å¥–ç­–ç•¥å®é™…ä½¿ç”¨ account_asset_balances(POINTS) åšæ‰£å‡å’Œé¢„ç®—ç­›å¥–
- çœŸå®æ•°æ®åº“å·²å‡ºç°ä¸ä¸€è‡´: user_id=31: available_points=10000 ä½† ledger POINTS=42352
- é¢„ç®—ç§¯åˆ†ç¼ºå°‘campaignç»´åº¦ï¼Œæ— æ³•æŒ‰æ´»åŠ¨ç‹¬ç«‹æ§åˆ¶

**é£é™©**: ğŸ”´ ä¸¥é‡ - æ•°æ®ä¸€è‡´æ€§åˆ†å‰ã€ä¸šåŠ¡é€»è¾‘æ··ä¹±ã€è¿è¥æ§åˆ¶ç¼ºå¤±ã€å®¡è®¡å›°éš¾

**ä¿®å¤æ–¹æ¡ˆ - ç»Ÿä¸€çœŸç›¸æºæ¶æ„**:

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**:

1. å•ä¸€çœŸç›¸æº: `account_asset_balances` æ˜¯æ‰€æœ‰èµ„äº§ä½™é¢çš„å”¯ä¸€çœŸç›¸æº
2. è¯­ä¹‰æ¸…æ™°: ç§¯åˆ†(POINTS)å’Œé¢„ç®—(BUDGET_POINTS)æ˜¯ä¸¤ç§ç‹¬ç«‹çš„èµ„äº§ç±»å‹
3. campaignç»´åº¦: é¢„ç®—æŒ‰æ´»åŠ¨ç»´åº¦éš”ç¦»ï¼Œæ”¯æŒå¤šæ´»åŠ¨å¹¶è¡Œ
4. ç ´åæ€§å˜æ›´: ç›´æ¥åˆ é™¤ `user_points_accounts` è¡¨ï¼Œæ‰€æœ‰æ¥å£è¯­ä¹‰æ”¹ä¸ºåŸºäºè´¦æœ¬

**æ•°æ®åº“Schemaå˜æ›´**:

```sql
-- åˆ é™¤æ—§è¡¨
DROP TABLE IF EXISTS user_points_accounts;
DROP TABLE IF EXISTS points_transactions;

-- åˆ é™¤å†—ä½™å­—æ®µ
ALTER TABLE lottery_draws
  DROP COLUMN budget_points_before,
  DROP COLUMN budget_points_after;

-- è´¦æœ¬è¡¨å¢å¼º(æ”¯æŒcampaignç»´åº¦)
ALTER TABLE account_asset_balances
  ADD COLUMN campaign_id VARCHAR(50) DEFAULT NULL COMMENT 'æ´»åŠ¨ID(ä»…é¢„ç®—èµ„äº§ä½¿ç”¨)',
  ADD UNIQUE KEY uk_account_asset_campaign (account_id, asset_code, campaign_id);

-- æµæ°´è¡¨å¢å¼º
ALTER TABLE asset_transactions
  ADD COLUMN campaign_id VARCHAR(50) DEFAULT NULL COMMENT 'å…³è”çš„æ´»åŠ¨ID',
  ADD INDEX idx_campaign (campaign_id);

-- æŠ½å¥–è®°å½•è¡¨æ”¹é€ 
ALTER TABLE lottery_draws
  ADD COLUMN campaign_id VARCHAR(50) NOT NULL DEFAULT 'default' COMMENT 'å…³è”çš„æ´»åŠ¨ID',
  ADD INDEX idx_campaign (campaign_id);
```

**Serviceå±‚é‡æ„**:

```javascript
// åˆ é™¤ PointsService (ä¸ä¿ç•™)
// AssetService æˆä¸ºå”¯ä¸€æ¥å£

class AssetService {
  // æŸ¥è¯¢ç”¨æˆ·èµ„äº§ä½™é¢(ç»Ÿä¸€æ¥å£)
  static async getBalance({ user_id, asset_code, campaign_id }) {
    // é¢„ç®—èµ„äº§å¿…é¡»æŒ‡å®šcampaign_id
    if (asset_code === 'BUDGET_POINTS' && !campaign_id) {
      throw new Error('BUDGET_POINTSå¿…é¡»æŒ‡å®šcampaign_id')
    }
    // ... å®ç°
  }

  // å˜æ›´èµ„äº§ä½™é¢(ç»Ÿä¸€æ¥å£)
  static async changeBalance(params, options = {}) {
    const {
      user_id,
      asset_code,
      campaign_id,
      delta_amount,
      idempotency_key,
      business_type,
      meta = {}
    } = params
    // ... å®ç°
  }
}
```

---

### 3. äº‹åŠ¡è¾¹ç•Œä¸æ¸…æ™°

**é—®é¢˜æè¿°**:

- å‘ç°å¤šç§äº‹åŠ¡å¤„ç†æ¨¡å¼å¹¶å­˜(è‡ªç®¡ç†ã€ä¼ é€’ã€åµŒå¥—)
- ä¼ é€’äº‹åŠ¡æ¨¡å¼: å¦‚æœè°ƒç”¨æ–¹å¿˜è®°ä¼ transaction,æ“ä½œä¸ä¼šåœ¨äº‹åŠ¡å†…æ‰§è¡Œ
- åµŒå¥—äº‹åŠ¡: å¤–å±‚äº‹åŠ¡å›æ»š,å†…å±‚å·²æäº¤çš„äº‹åŠ¡ä¸ä¼šå›æ»š

**é£é™©**: ğŸ”´ ä¸¥é‡ - æ•°æ®ä¸ä¸€è‡´ã€æ­»é”é£é™©

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// å»ºç«‹ç»Ÿä¸€äº‹åŠ¡åŒ…è£…å™¨
class TransactionManager {
  static async execute(operation, options = {}) {
    const { maxRetries = 3, timeout = 30000 } = options
    let transaction = null

    for (let attempt = 0; attempt < maxRetries; attempt++) {
      try {
        transaction = await sequelize.transaction()

        const timeoutPromise = new Promise((_, reject) =>
          setTimeout(() => reject(new Error('Transaction timeout')), timeout)
        )

        const result = await Promise.race([operation(transaction), timeoutPromise])

        if (!transaction.finished) {
          await transaction.commit()
        }

        return result
      } catch (error) {
        if (transaction && !transaction.finished) {
          await transaction.rollback()
        }

        if (this.isRetryable(error) && attempt < maxRetries - 1) {
          await this.backoff(attempt)
          continue
        }

        throw error
      }
    }
  }

  static isRetryable(error) {
    return error.message.includes('deadlock') || error.message.includes('timeout')
  }

  static async backoff(attempt) {
    const delay = Math.min(1000 * Math.pow(2, attempt), 5000)
    await new Promise(resolve => setTimeout(resolve, delay))
  }
}

// ä½¿ç”¨è§„èŒƒ: æ‰€æœ‰å¤šè¡¨æ“ä½œå¿…é¡»ä½¿ç”¨TransactionManager.execute()
```

---

### 4. å¹‚ç­‰æ€§ä¿æŠ¤ä¸å®Œæ•´

**é—®é¢˜æè¿°**:

- éƒ¨åˆ†è¡¨æœ‰business_idå¹‚ç­‰é”®(market_listings, lottery_draws, asset_transactions)
- éƒ¨åˆ†è¡¨ç¼ºå°‘å¹‚ç­‰é”®(consumption_records, exchange_records, points_transactions)
- ä»…ä»£ç å±‚æ£€æŸ¥ä¸å¯é : å¹¶å‘åœºæ™¯ä¸‹ä»å¯èƒ½æ’å…¥é‡å¤è®°å½•

**é£é™©**: ğŸ”´ ä¸¥é‡ - é‡å¤æ‰£æ¬¾/å‘è´§ã€è´¢åŠ¡å¯¹è´¦å›°éš¾

**ä¿®å¤æ–¹æ¡ˆ**:

```sql
-- ä¸ºæ‰€æœ‰å…³é”®ä¸šåŠ¡è¡¨æ·»åŠ å”¯ä¸€çº¦æŸ
ALTER TABLE consumption_records
  ADD UNIQUE KEY uk_business_id (business_id);

ALTER TABLE points_transactions
  ADD UNIQUE KEY uk_business_id (business_id);

-- åº”ç”¨å±‚å¼ºåˆ¶ç”Ÿæˆbusiness_id
-- ç¦æ­¢business_idä¸ºNULL
-- æ ¼å¼: {operation}_{resource_id}_{timestamp}_{random}
```

---

## ğŸŸ  P1çº§é—®é¢˜(å½±å“æ€§èƒ½/è¿ç»´)

### 5. æ•°æ®åº“è¿æ¥æ± é…ç½®ä¸åˆç†

**é—®é¢˜æè¿°**:

- max=40 å¯¹äºå•å®ä¾‹å¯èƒ½è¿‡é«˜(MySQLé»˜è®¤151è¿æ¥)
- acquire=30ç§’è¿‡é•¿,ç”¨æˆ·ä½“éªŒå·®
- ç¼ºå°‘è¿æ¥æ³„æ¼ç›‘æ§

**é£é™©**: ğŸŸ  é«˜ - è¿æ¥æ± è€—å°½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€æ…¢æŸ¥è¯¢å ç”¨è¿æ¥å¯¼è‡´é›ªå´©

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// æ ¹æ®å®ä¾‹æ•°è°ƒæ•´è¿æ¥æ± 
// å…¬å¼: max_connections = (MySQLæœ€å¤§è¿æ¥æ•° - ä¿ç•™) / å®ä¾‹æ•°
pool: {
  max: 30,
  min: 5,
  acquire: 10000,  // é™ä½åˆ°10ç§’
  idle: 120000,    // é™ä½åˆ°2åˆ†é’Ÿ
  evict: 30000,    // 30ç§’æ¸…ç†ä¸€æ¬¡
  handleDisconnects: true
}

// æ·»åŠ è¿æ¥æ± ç›‘æ§
setInterval(() => {
  const pool = sequelize.connectionManager.pool
  logger.info('è¿æ¥æ± çŠ¶æ€', {
    size: pool.size,
    available: pool.available,
    using: pool.using,
    waiting: pool.waiting
  })

  // å‘Šè­¦: ç­‰å¾…è¿æ¥æ•° > 5
  if (pool.waiting > 5) {
    logger.error('è¿æ¥æ± å‘Šè­¦: ç­‰å¾…è¿æ¥è¿‡å¤š', { waiting: pool.waiting })
  }
}, 60000)
```

---

### 6. ç¼ºå°‘æ…¢æŸ¥è¯¢ç´¢å¼•ä¼˜åŒ–

**é—®é¢˜æè¿°**:

- æ…¢æŸ¥è¯¢ç›‘æ§å·²å¯ç”¨,ä½†ç¼ºå°‘ç³»ç»Ÿæ€§ä¼˜åŒ–
- åªè®°å½•æ—¥å¿—,æ²¡æœ‰è‡ªåŠ¨åˆ†æ
- æ²¡æœ‰ç´¢å¼•ä½¿ç”¨ç‡ç›‘æ§
- ç¼ºå°‘æŸ¥è¯¢ä¼˜åŒ–å»ºè®®

**é£é™©**: ğŸŸ  é«˜ - æ…¢æŸ¥è¯¢å½±å“ç”¨æˆ·ä½“éªŒã€æ•°æ®åº“CPU/IOè´Ÿè½½é«˜

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// å»ºç«‹æ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿ
class SlowQueryAnalyzer {
  constructor() {
    this.queries = new Map()
  }

  record(sql, timing) {
    const pattern = this.extractPattern(sql)
    const existing = this.queries.get(pattern) || {
      count: 0,
      total_time: 0,
      examples: []
    }

    existing.count++
    existing.total_time += timing
    if (existing.examples.length < 3) {
      existing.examples.push({ sql, timing })
    }

    this.queries.set(pattern, existing)
  }

  extractPattern(sql) {
    return sql
      .replace(/\d+/g, '?')
      .replace(/'[^']*'/g, '?')
      .substring(0, 200)
  }

  getTopSlowQueries(limit = 10) {
    return Array.from(this.queries.entries())
      .sort((a, b) => b[1].total_time - a[1].total_time)
      .slice(0, limit)
      .map(([pattern, stats]) => ({
        pattern,
        count: stats.count,
        avg_time: stats.total_time / stats.count,
        total_time: stats.total_time,
        examples: stats.examples
      }))
  }
}

// å®šæœŸç”Ÿæˆä¼˜åŒ–å»ºè®®
setInterval(() => {
  const topQueries = analyzer.getTopSlowQueries(10)
  topQueries.forEach(query => {
    logger.warn('æ…¢æŸ¥è¯¢ä¼˜åŒ–å»ºè®®', {
      pattern: query.pattern,
      count: query.count,
      avg_time: query.avg_time
    })
  })
}, 3600000) // æ¯å°æ—¶
```

---

### 7. Redisç¼“å­˜ç­–ç•¥ä¸å®Œæ•´

**é—®é¢˜æè¿°**:

- å·²ä½¿ç”¨Redis: åˆ†å¸ƒå¼é”ã€ä¼šè¯å­˜å‚¨
- æœªä½¿ç”¨Redisç¼“å­˜: ç”¨æˆ·ä¿¡æ¯ã€æŠ½å¥–é…ç½®ã€å•†å“åˆ—è¡¨ã€æ’è¡Œæ¦œ

**é£é™©**: ğŸŸ  é«˜ - æ•°æ®åº“æŸ¥è¯¢å‹åŠ›å¤§ã€å“åº”æ—¶é—´æ…¢

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// å»ºç«‹åˆ†å±‚ç¼“å­˜ç­–ç•¥
class CacheStrategy {
  // L1: è¿›ç¨‹å†…å­˜ç¼“å­˜(æçƒ­æ•°æ®,TTL 1åˆ†é’Ÿ)
  static memoryCache = new Map()

  // L2: Redisç¼“å­˜(çƒ­æ•°æ®,TTL 5-60åˆ†é’Ÿ)
  static async get(key, fetchFunction, ttl = 300) {
    // å…ˆæŸ¥L1
    const cached = this.memoryCache.get(key)
    if (cached && Date.now() - cached.time < 60000) {
      return cached.value
    }

    // å†æŸ¥L2(Redis)
    const redis = await getRedisClient()
    const redisValue = await redis.get(key)
    if (redisValue) {
      const value = JSON.parse(redisValue)
      this.memoryCache.set(key, { value, time: Date.now() })
      return value
    }

    // æœ€åæŸ¥æ•°æ®åº“
    const value = await fetchFunction()
    await redis.setex(key, ttl, JSON.stringify(value))
    this.memoryCache.set(key, { value, time: Date.now() })
    return value
  }

  static async invalidate(key) {
    this.memoryCache.delete(key)
    const redis = await getRedisClient()
    await redis.del(key)
  }
}

// åº”ç”¨åˆ°é«˜é¢‘æŸ¥è¯¢
class UserService {
  static async getUserInfo(user_id) {
    return await CacheStrategy.get(
      `user:${user_id}`,
      () => User.findByPk(user_id),
      300 // 5åˆ†é’Ÿ
    )
  }
}

// æƒé™å˜æ›´æ—¶æ¸…é™¤ç¼“å­˜
class UserRoleService {
  static async updateUserRole(user_id, role) {
    await UserRole.update({ role }, { where: { user_id } })
    await CacheStrategy.invalidate(`user:${user_id}`)
  }
}
```

---

### 8. æ—¥å¿—ç³»ç»Ÿç»“æ„åŒ–ä¸è¶³

**é—®é¢˜æè¿°**:

- æ··åˆä½¿ç”¨console.logå’Œlogger
- ç¼ºå°‘request_idè¿½è¸ª
- æ—¥å¿—æ ¼å¼ä¸ç»Ÿä¸€
- éš¾ä»¥æœç´¢å’Œåˆ†æ

**é£é™©**: ğŸŸ  é«˜ - é—®é¢˜æ’æŸ¥å›°éš¾ã€æ— æ³•è¿½è¸ªè¯·æ±‚é“¾è·¯

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// 1. å¼ºåˆ¶ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—
// ç¦æ­¢åœ¨æœåŠ¡ä»£ç ä¸­ä½¿ç”¨console.log/warn/error

// 2. æ‰€æœ‰æ—¥å¿—å¿…é¡»åŒ…å«request_id
app.use((req, res, next) => {
  req.id = req.headers['x-request-id'] || generateRequestId()
  res.setHeader('X-Request-ID', req.id)
  next()
})

logger.info('å¤„ç†è¯·æ±‚', {
  request_id: req.id,
  method: req.method,
  path: req.path
})

// 3. æœåŠ¡å±‚æ–¹æ³•æ¥æ”¶request_id
class UserService {
  static async createUser(userData, { request_id }) {
    logger.info('åˆ›å»ºç”¨æˆ·', { request_id, user_data: userData })
    // ...
  }
}
```

---

## ğŸŸ¡ P2çº§é—®é¢˜(æŠ€æœ¯å€ºåŠ¡/å¯ç»´æŠ¤æ€§)

### 9. æ¨¡å‹å…³è”å®šä¹‰ä¸å®Œæ•´

**é—®é¢˜æè¿°**:

- models/ç›®å½•æœ‰43ä¸ªæ¨¡å‹æ–‡ä»¶,ä½†å…³è”å®šä¹‰åˆ†æ•£
- éƒ¨åˆ†æ¨¡å‹ç¼ºå°‘å…³è”: MarketListing å’Œ ItemInstanceã€TradeOrder å’Œ AssetTransaction

**é£é™©**: ğŸŸ¡ ä¸­ - æŸ¥è¯¢éœ€è¦æ‰‹åŠ¨JOINã€ä»£ç å¯è¯»æ€§å·®

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// åœ¨models/index.jsä¸­ç»Ÿä¸€å®šä¹‰æ‰€æœ‰å…³è”
const expectedAssociations = {
  User: {
    hasMany: ['LotteryDraw', 'PointsTransaction', 'ItemInstance'],
    belongsToMany: ['Role']
  },
  MarketListing: {
    belongsTo: ['User', 'ItemInstance'],
    hasMany: ['TradeOrder']
  }
}

function validateAssociations() {
  Object.entries(expectedAssociations).forEach(([modelName, assocs]) => {
    const model = models[modelName]

    assocs.hasMany?.forEach(target => {
      if (!model.associations[target]) {
        console.error(`ç¼ºå°‘å…³è”: ${modelName}.hasMany(${target})`)
      }
    })
  })
}
```

---

### 10. APIç‰ˆæœ¬ç®¡ç†ä¸è§„èŒƒ

**é—®é¢˜æè¿°**:

- APIè·¯å¾„æ··ä¹±: routes/v4/ å’Œ routes/
- æ²¡æœ‰æ˜ç¡®çš„ç‰ˆæœ¬åºŸå¼ƒç­–ç•¥
- æ—§ç‰ˆæœ¬APIå¯èƒ½ä»åœ¨ä½¿ç”¨
- ç¼ºå°‘ç‰ˆæœ¬å…¼å®¹æ€§æµ‹è¯•

**é£é™©**: ğŸŸ¡ ä¸­ - å®¢æˆ·ç«¯è°ƒç”¨æ—§APIå¯¼è‡´åŠŸèƒ½å¼‚å¸¸ã€æ— æ³•å¹³æ»‘å‡çº§

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// å»ºç«‹APIç‰ˆæœ¬ç®¡ç†ç­–ç•¥
const API_VERSIONS = {
  v3: {
    status: 'deprecated',
    sunset_date: '2025-12-31',
    replacement: 'v4'
  },
  v4: {
    status: 'current',
    min_client_version: '4.0.0'
  }
}

// æ—§ç‰ˆæœ¬APIè¿”å›åºŸå¼ƒè­¦å‘Š
app.use('/api/v3/*', (req, res, next) => {
  res.setHeader('X-API-Deprecated', 'true')
  res.setHeader('X-API-Sunset-Date', '2025-12-31')
  res.setHeader('X-API-Replacement', '/api/v4')
  next()
})
```

---

### 11. ç¯å¢ƒé…ç½®ç®¡ç†æ··ä¹±

**é—®é¢˜æè¿°**:

- é…ç½®åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶: .env, config.example, config/database.js, config/environment.js
- ç¼ºå°‘é…ç½®éªŒè¯
- å¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®å·®å¼‚ä¸æ˜ç¡®

**é£é™©**: ğŸŸ¡ ä¸­ - é…ç½®é”™è¯¯å¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥ã€ç”Ÿäº§ç¯å¢ƒé…ç½®æ³„éœ²

**ä¿®å¤æ–¹æ¡ˆ**:

```javascript
// ç»Ÿä¸€é…ç½®ç®¡ç†
class ConfigManager {
  static load() {
    require('dotenv').config()

    // å¼ºåˆ¶éªŒè¯å¿…éœ€é…ç½®
    this.validateRequired([
      'NODE_ENV',
      'PORT',
      'DB_HOST',
      'DB_PORT',
      'DB_NAME',
      'DB_USER',
      'DB_PASSWORD',
      'JWT_SECRET',
      'REDIS_HOST'
    ])

    // ç¯å¢ƒç‰¹å®šé…ç½®
    if (process.env.NODE_ENV === 'production') {
      this.validateProduction()
    }
  }

  static validateRequired(keys) {
    const missing = keys.filter(key => !process.env[key])
    if (missing.length > 0) {
      throw new Error(`ç¼ºå°‘å¿…éœ€é…ç½®: ${missing.join(', ')}`)
    }
  }

  static validateProduction() {
    if (process.env.JWT_SECRET === 'development_secret') {
      throw new Error('ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨é»˜è®¤JWTå¯†é’¥')
    }
  }
}

// å¯åŠ¨æ—¶å¼ºåˆ¶éªŒè¯
ConfigManager.load()
```

---

## ğŸ“‹ ä¼˜å…ˆçº§ä¿®å¤è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ(1å‘¨) - åœæœç»´æŠ¤ä¸ç ´åæ€§å˜æ›´

1. æ•´ç†æ•°æ®åº“è¿ç§»æ–‡ä»¶
2. ä¸ºå…³é”®ä¸šåŠ¡è¡¨æ·»åŠ å¹‚ç­‰é”®å”¯ä¸€çº¦æŸ
3. ç»Ÿä¸€äº‹åŠ¡å¤„ç†æ¨¡å¼
4. é¢„ç®—ç§¯åˆ†æ¶æ„ç ´åæ€§é‡æ„

### ç¬¬äºŒé˜¶æ®µ(1å‘¨) - Serviceå±‚å’ŒAPIéƒ¨ç½²

1. éƒ¨ç½²æ–°ç‰ˆAssetService
2. éƒ¨ç½²æ–°ç‰ˆBasicGuaranteeStrategy
3. éƒ¨ç½²æ–°ç‰ˆAPIæ¥å£
4. æ•°æ®ä¸€è‡´æ€§éªŒè¯

### ç¬¬ä¸‰é˜¶æ®µ(1å‘¨) - ç›‘æ§å’Œä¼˜åŒ–

1. ç›‘æ§æ–°æ¶æ„è¿è¡ŒçŠ¶æ€
2. ä¿®å¤å‘ç°çš„é—®é¢˜
3. æ€§èƒ½ä¼˜åŒ–
4. æ–‡æ¡£æ›´æ–°

### ç¬¬å››é˜¶æ®µ(2å‘¨) - æ€§èƒ½å’Œè´¨é‡æå‡

1. ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± é…ç½®
2. å»ºç«‹æ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿ
3. å®æ–½Redisç¼“å­˜ç­–ç•¥
4. æ·»åŠ N+1æŸ¥è¯¢æ£€æµ‹
5. å¼ºåˆ¶ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—

### ç¬¬äº”é˜¶æ®µ(1å‘¨) - å®‰å…¨åŠ å›º

1. SQLæ³¨å…¥é˜²æŠ¤å®¡è®¡
2. æ•æ„Ÿä¿¡æ¯æ³„éœ²æ£€æŸ¥
3. æƒé™æ§åˆ¶å®Œæ•´æ€§éªŒè¯
4. ä¾èµ–å®‰å…¨å®¡è®¡

---

## ğŸ¯ å…³é”®æŒ‡æ ‡ç›‘æ§

### æ•°æ®åº“æŒ‡æ ‡

- è¿æ¥æ± ä½¿ç”¨ç‡ < 80%
- æ…¢æŸ¥è¯¢æ•°é‡ < 10/å°æ—¶
- äº‹åŠ¡å›æ»šç‡ < 1%
- æ­»é”æ¬¡æ•° = 0

### åº”ç”¨æŒ‡æ ‡

- APIå“åº”æ—¶é—´ P95 < 500ms
- é”™è¯¯ç‡ < 0.1%
- å†…å­˜ä½¿ç”¨ç‡ < 80%
- CPUä½¿ç”¨ç‡ < 70%

### ä¸šåŠ¡æŒ‡æ ‡

- å¹‚ç­‰é‡å¤è¯·æ±‚ç‡ < 0.01%
- æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡ç‡ = 100%
- ç¼“å­˜å‘½ä¸­ç‡ > 80%
