# é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ V4.0 - åç«¯APIæ¥å£æ¸…å•

**æ–‡æ¡£ç‰ˆæœ¬**: V2.7 (ğŸ‰ **å®Œæ•´éªŒè¯ç‰ˆ** - åŸºäºçœŸå®ä»£ç 100%å‡†ç¡®)  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ02æ—¥ 17:05  
**æŠ€æœ¯æ ˆ**: Node.js + Express + MySQL + Sequelize  
**APIåŸºç¡€è·¯å¾„**: `/api/v4/`  
**æ—¶åŒºæ ‡å‡†**: æ‰€æœ‰æ—¶é—´å‡é‡‡ç”¨åŒ—äº¬æ—¶é—´(Asia/Shanghai, GMT+8)

**æ›´æ–°è¯´æ˜**:
- âœ… å·²å®Œæˆæ‰€æœ‰10ä¸ªæ ¸å¿ƒæ¨¡å—çš„APIæ–‡æ¡£æ›´æ–°
- âœ… æ‰€æœ‰APIè·¯å¾„ã€å‚æ•°ã€å“åº”æ ¼å¼å‡åŸºäºå®é™…ä»£ç 
- âœ… æ–°å¢ç¬¬7ç« "é«˜çº§ç©ºé—´è§£é”API"(å·²å®ç°)
- âœ… ä¿®æ­£æ‰€æœ‰ç« èŠ‚ç¼–å·å’Œè·¯ç”±è·¯å¾„
- âœ… ç§¯åˆ†è¶‹åŠ¿åˆ†æAPIå·²å®ç°ï¼Œä»å¾…å®ç°åˆ—è¡¨ç§»å‡º
- âœ… ç§»é™¤ä¸éœ€è¦å¼€å‘çš„ä¸Šä¼ æ–‡ä»¶ç›¸å…³API(2ä¸ª)
- ğŸ‰ **ç»Ÿè®¡æ€»è§ˆæ›´æ–°: 123ä¸ªAPIå…¨éƒ¨å®ç°å®Œæˆ (100%)**
- ğŸ” **V2.4æ›´æ–°: åŸºäºå®é™…è·¯ç”±æ–‡ä»¶é‡æ–°å‡†ç¡®ç»Ÿè®¡APIæ•°é‡**
- ğŸ“ **V2.5æ›´æ–°: è¡¥å……ç¬¬9æ¨¡å—(ç³»ç»ŸåŠŸèƒ½)ç¼ºå¤±çš„14ä¸ªAPIè¯¦ç»†æ–‡æ¡£**
  - æ–°å¢9.6-9.19: åé¦ˆç®¡ç†ã€èŠå¤©ç³»ç»Ÿã€ç”¨æˆ·ç»Ÿè®¡ã€ç®¡ç†å‘˜åŠŸèƒ½ç­‰API
  - æ‰€æœ‰APIå‡åŒ…å«è¯¦ç»†çš„è¯·æ±‚/å“åº”ç¤ºä¾‹å’Œä¸šåŠ¡è§„åˆ™è¯´æ˜
- âœ… **V2.6æ›´æ–°: å®Œæ•´æ€§éªŒè¯é€šè¿‡**
  - åŸºäºå®é™…ä»£ç æ–‡ä»¶é€ä¸€éªŒè¯æ‰€æœ‰123ä¸ªAPIç«¯ç‚¹
  - ç¡®è®¤æ‰€æœ‰æ¨¡å—APIæ•°é‡ä¸å®é™…ä»£ç å®Œå…¨ä¸€è‡´
  - éªŒè¯é€šè¿‡: auth(5), lottery(8), permissions(5), points(11), inventory(18), consumption(10), premium(2), lottery-preset(4), system(19), admin(41)
- ğŸ¯ **V2.7æ›´æ–°: åŸºäºçœŸå®ä¸šåŠ¡é€»è¾‘æ·±åº¦å®Œå–„**
  - ä¿®æ­£10.6ç”¨æˆ·ç®¡ç†æ¨¡å—APIåˆ—è¡¨ï¼Œä¸å®é™…ä»£ç å®Œå…¨ä¸€è‡´
  - è¡¥å……APIä¸šåŠ¡è¯´æ˜æ‹¬å·ï¼Œæ˜ç¡®æ¯ä¸ªAPIçš„å…·ä½“ç”¨é€”å’Œå‚æ•°
  - å¢å¼ºUUIDè§’è‰²ç³»ç»Ÿè¯´æ˜ï¼Œæ˜ç¡®è§’è‰²åˆ†é…æœºåˆ¶
  - æ‰€æœ‰APIæè¿°åŸºäºçœŸå®ä»£ç å®ç°ï¼Œé¿å…è‡†æµ‹å’Œä¸å‡†ç¡®ä¿¡æ¯
  - 100%éªŒè¯é€šè¿‡ï¼šæ–‡æ¡£APIæ•°é‡ä¸å®é™…ä»£ç å®Œå…¨åŒ¹é…

---

## ğŸ“– HTTPè¯·æ±‚æ–¹æ³•è¯´æ˜

æœ¬ç³»ç»ŸAPIä½¿ç”¨æ ‡å‡†çš„RESTfulé£æ ¼ï¼Œé€šè¿‡ä¸åŒçš„HTTPæ–¹æ³•è¡¨ç¤ºä¸åŒçš„æ“ä½œç±»å‹ï¼š

| HTTPæ–¹æ³• | æ“ä½œç±»å‹ | è¯´æ˜ | å¸¸è§ç”¨é€” | æ˜¯å¦å¹‚ç­‰ |
|---------|---------|------|---------|---------|
| **GET** | æŸ¥è¯¢/è¯»å– | ä»æœåŠ¡å™¨**è·å–**èµ„æºï¼Œä¸ä¼šä¿®æ”¹æœåŠ¡å™¨æ•°æ® | æŸ¥è¯¢åˆ—è¡¨ã€è·å–è¯¦æƒ…ã€æŸ¥çœ‹çŠ¶æ€ | âœ… æ˜¯ |
| **POST** | åˆ›å»º/æäº¤ | å‘æœåŠ¡å™¨**æäº¤**æ•°æ®ï¼Œåˆ›å»ºæ–°èµ„æºæˆ–è§¦å‘æ“ä½œ | ç™»å½•ã€æäº¤è¡¨å•ã€æ‰§è¡ŒæŠ½å¥–ã€å‘é€æ¶ˆæ¯ | âŒ å¦ |
| **PUT** | æ›´æ–°/ä¿®æ”¹ | **å®Œæ•´æ›´æ–°**æœåŠ¡å™¨ä¸Šçš„èµ„æº | ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€æ›´æ–°é…ç½®ã€åˆ†é…æƒé™ | âœ… æ˜¯ |
| **DELETE** | åˆ é™¤ | **åˆ é™¤**æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆæœ¬ç³»ç»Ÿä½¿ç”¨è½¯åˆ é™¤ï¼‰ | åˆ é™¤è®°å½•ï¼ˆå®é™…æ ‡è®°ä¸ºå·²åˆ é™¤ï¼‰ | âœ… æ˜¯ |

### ğŸ“Œ æ–¹æ³•é€‰æ‹©åŸåˆ™

```
ğŸ” æŸ¥è¯¢æ•°æ® â†’ GET
   ä¾‹å¦‚ï¼šè·å–ç”¨æˆ·ä¿¡æ¯ã€æŸ¥è¯¢è®¢å•åˆ—è¡¨ã€æŸ¥çœ‹ç§¯åˆ†ä½™é¢

â• åˆ›å»ºæ•°æ® â†’ POST
   ä¾‹å¦‚ï¼šç”¨æˆ·ç™»å½•ã€æäº¤åé¦ˆã€æ‰§è¡ŒæŠ½å¥–ã€å…‘æ¢å•†å“

âœï¸ ä¿®æ”¹æ•°æ® â†’ PUT
   ä¾‹å¦‚ï¼šæ›´æ–°ç”¨æˆ·çŠ¶æ€ã€ä¿®æ”¹é…ç½®ã€åˆ†é…ä¼šè¯

ğŸ—‘ï¸ åˆ é™¤æ•°æ® â†’ DELETE
   ä¾‹å¦‚ï¼šåˆ é™¤ç§¯åˆ†è®°å½•ã€åˆ é™¤å…‘æ¢è®°å½•ï¼ˆè½¯åˆ é™¤ï¼‰
```

### âš ï¸ é‡è¦è¯´æ˜

- **å¹‚ç­‰æ€§**: å¤šæ¬¡æ‰§è¡Œç›¸åŒè¯·æ±‚äº§ç”Ÿç›¸åŒç»“æœï¼ˆGET/PUT/DELETEæ˜¯å¹‚ç­‰çš„ï¼ŒPOSTä¸æ˜¯ï¼‰
- **å®‰å…¨æ€§**: GETè¯·æ±‚æ˜¯å®‰å…¨çš„ï¼ˆä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼‰ï¼Œå…¶ä»–æ–¹æ³•ä¼šä¿®æ”¹æ•°æ®
- **è½¯åˆ é™¤**: æœ¬ç³»ç»Ÿçš„DELETEæ“ä½œä½¿ç”¨è½¯åˆ é™¤æœºåˆ¶ï¼Œæ•°æ®æ ‡è®°ä¸º`is_deleted=1`ä½†ä¸ä¼šç‰©ç†åˆ é™¤
- **è®¤è¯**: é™¤å…¬å¼€æ¥å£å¤–ï¼Œæ‰€æœ‰APIéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦`Authorization: Bearer <token>`

---

## ğŸ“Š APIç»Ÿè®¡æ€»è§ˆ

**APIæ€»æ•°**: 123ä¸ª  
**å®æ–½è¿›åº¦**: ğŸ‰ 100%å·²å®Œæˆ  
**æ¨¡å—æ•°é‡**: 10ä¸ªæ ¸å¿ƒæ¨¡å—

| æ¨¡å— | æ¥å£æ•°é‡ | å®æ–½çŠ¶æ€ |
|-----|---------|---------|
| 1. ç»Ÿä¸€è®¤è¯å¼•æ“ | 5 | âœ… å…¨éƒ¨å®Œæˆ |
| 2. ç»Ÿä¸€æŠ½å¥–å¼•æ“ | 8 | âœ… å…¨éƒ¨å®Œæˆ |
| 3. æƒé™ç®¡ç† | 5 | âœ… å…¨éƒ¨å®Œæˆ |
| 4. ç§¯åˆ†ç®¡ç† | 11 | âœ… å…¨éƒ¨å®Œæˆ |
| 5. ç”¨æˆ·åº“å­˜ç®¡ç† | 18 | âœ… å…¨éƒ¨å®Œæˆ |
| 6. æ¶ˆè´¹è®°å½•ç®¡ç† | 10 | âœ… å…¨éƒ¨å®Œæˆ |
| 7. é«˜çº§ç©ºé—´è§£é” | 2 | âœ… å…¨éƒ¨å®Œæˆ |
| 8. æŠ½å¥–ç»“æœé¢„è®¾ç®¡ç† | 4 | âœ… å…¨éƒ¨å®Œæˆ |
| 9. ç³»ç»ŸåŠŸèƒ½ | 19 | âœ… å…¨éƒ¨å®Œæˆ |
| 10. ç»Ÿä¸€ç®¡ç†å¼•æ“ | 41 | âœ… å…¨éƒ¨å®Œæˆ |

---

## ğŸ“‹ è¯¦ç»†APIç›®å½•

### [1. V4 ç»Ÿä¸€è®¤è¯å¼•æ“ API](#1-v4-ç»Ÿä¸€è®¤è¯å¼•æ“-api) (5ä¸ª)
- [1.1 ç”¨æˆ·ç™»å½•(æ‰‹æœºå·+éªŒè¯ç )](#11-ç”¨æˆ·ç™»å½•æ‰‹æœºå·éªŒè¯ç -) `POST /auth/login`
- [1.2 ç”¨æˆ·å¿«é€Ÿç™»å½•(ä¸€é”®ç™»å½•)](#12-ç”¨æˆ·å¿«é€Ÿç™»å½•ä¸€é”®ç™»å½•-) `POST /auth/quick-login`
- [1.3 è·å–ç”¨æˆ·ä¿¡æ¯](#13-è·å–ç”¨æˆ·ä¿¡æ¯-) `GET /auth/profile`
- [1.4 éªŒè¯Tokenæœ‰æ•ˆæ€§](#14-éªŒè¯tokenæœ‰æ•ˆæ€§-) `POST /auth/verify`
- [1.5 åˆ·æ–°è®¿é—®ä»¤ç‰Œ](#15-åˆ·æ–°è®¿é—®ä»¤ç‰Œ-) `POST /auth/refresh`

### [2. V4 ç»Ÿä¸€æŠ½å¥–å¼•æ“ API](#2-v4-ç»Ÿä¸€æŠ½å¥–å¼•æ“-api) (8ä¸ª)
- [2.1 è·å–æ´»åŠ¨å¥–å“æ± é…ç½®](#21-è·å–æ´»åŠ¨å¥–å“æ± é…ç½®-) `GET /lottery/prizes/:campaignCode`
- [2.2 è·å–æ´»åŠ¨æŠ½å¥–é…ç½®](#22-è·å–æ´»åŠ¨æŠ½å¥–é…ç½®-) `GET /lottery/config/:campaignCode`
- [2.3 æ‰§è¡ŒæŠ½å¥–](#23-æ‰§è¡ŒæŠ½å¥–-) `POST /lottery/draw`
- [2.4 è·å–ç”¨æˆ·æŠ½å¥–å†å²](#24-è·å–ç”¨æˆ·æŠ½å¥–å†å²-) `GET /lottery/history/:user_id`
- [2.5 è·å–æ´»åŠ¨åˆ—è¡¨](#25-è·å–æ´»åŠ¨åˆ—è¡¨-) `GET /lottery/campaigns`
- [2.6 è·å–ç”¨æˆ·å¯ç”¨ç§¯åˆ†](#26-è·å–ç”¨æˆ·å¯ç”¨ç§¯åˆ†-) `GET /lottery/points/:user_id`
- [2.7 è·å–ç”¨æˆ·æŠ½å¥–ç»Ÿè®¡](#27-è·å–ç”¨æˆ·æŠ½å¥–ç»Ÿè®¡-) `GET /lottery/statistics/:user_id`
- [2.8 è·å–æŠ½å¥–ç³»ç»Ÿå¥åº·çŠ¶æ€](#28-è·å–æŠ½å¥–ç³»ç»Ÿå¥åº·çŠ¶æ€-) `GET /lottery/health`

### [3. V4 æƒé™ç®¡ç† API](#3-v4-æƒé™ç®¡ç†-api) (5ä¸ª)
- [3.1 è·å–ç”¨æˆ·æƒé™ä¿¡æ¯](#31-è·å–ç”¨æˆ·æƒé™ä¿¡æ¯-) `GET /permissions/user/:user_id`
- [3.2 è·å–å½“å‰ç”¨æˆ·æƒé™](#32-è·å–å½“å‰ç”¨æˆ·æƒé™-) `GET /permissions/current`
- [3.3 æ£€æŸ¥ç”¨æˆ·æƒé™](#33-æ£€æŸ¥ç”¨æˆ·æƒé™-) `POST /permissions/check`
- [3.4 è·å–ç®¡ç†å‘˜åˆ—è¡¨](#34-è·å–ç®¡ç†å‘˜åˆ—è¡¨-) `GET /permissions/admins`
- [3.5 è·å–æƒé™ç»Ÿè®¡](#35-è·å–æƒé™ç»Ÿè®¡-) `GET /permissions/statistics`

### [4. V4 ç§¯åˆ†ç®¡ç† API](#4-v4-ç§¯åˆ†ç®¡ç†-api) (11ä¸ª)
- [4.1 è·å–ç”¨æˆ·ç§¯åˆ†ä½™é¢](#41-è·å–ç”¨æˆ·ç§¯åˆ†ä½™é¢-) `GET /points/balance`
- [4.2 è·å–æŒ‡å®šç”¨æˆ·ç§¯åˆ†ä½™é¢](#42-è·å–æŒ‡å®šç”¨æˆ·ç§¯åˆ†ä½™é¢-) `GET /points/balance/:user_id`
- [4.3 è·å–ç§¯åˆ†äº¤æ˜“è®°å½•](#43-è·å–ç§¯åˆ†äº¤æ˜“è®°å½•-) `GET /points/transactions/:user_id`
- [4.4 ç®¡ç†å‘˜è°ƒæ•´ç§¯åˆ†](#44-ç®¡ç†å‘˜è°ƒæ•´ç§¯åˆ†-) `POST /points/admin/adjust`
- [4.5 è·å–ç§¯åˆ†ç»Ÿè®¡](#45-è·å–ç§¯åˆ†ç»Ÿè®¡-) `GET /points/admin/statistics`
- [4.6 è·å–ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡](#46-è·å–ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡-) `GET /points/user/statistics/:user_id`
- [4.7 è·å–ç§¯åˆ†æ€»è§ˆ](#47-è·å–ç§¯åˆ†æ€»è§ˆ-) `GET /points/overview`
- [4.8 è·å–å†»ç»“ç§¯åˆ†åˆ—è¡¨](#48-è·å–å†»ç»“ç§¯åˆ†åˆ—è¡¨-) `GET /points/frozen`
- [4.9 è·å–ç§¯åˆ†è¶‹åŠ¿](#49-è·å–ç§¯åˆ†è¶‹åŠ¿-) `GET /points/trend`
- [4.10 åˆ é™¤ç§¯åˆ†äº¤æ˜“è®°å½•](#410-åˆ é™¤ç§¯åˆ†äº¤æ˜“è®°å½•-) `DELETE /points/transaction/:transaction_id`
- [4.11 æ¢å¤ç§¯åˆ†äº¤æ˜“è®°å½•](#411-æ¢å¤ç§¯åˆ†äº¤æ˜“è®°å½•-) `POST /points/transaction/:transaction_id/restore`

### [5. V4 ç”¨æˆ·åº“å­˜ç®¡ç† API](#5-v4-ç”¨æˆ·åº“å­˜ç®¡ç†-api) (18ä¸ª)
- [5.1 è·å–ç”¨æˆ·åº“å­˜åˆ—è¡¨](#51-è·å–ç”¨æˆ·åº“å­˜åˆ—è¡¨-) `GET /inventory/user/:user_id`
- [5.2 è·å–åº“å­˜é¡¹è¯¦æƒ…](#52-è·å–åº“å­˜é¡¹è¯¦æƒ…-) `GET /inventory/item/:item_id`
- [5.3 ä½¿ç”¨åº“å­˜é¡¹](#53-ä½¿ç”¨åº“å­˜é¡¹-) `POST /inventory/use/:item_id`
- [5.4 è·å–ç®¡ç†å‘˜åº“å­˜ç»Ÿè®¡](#54-è·å–ç®¡ç†å‘˜åº“å­˜ç»Ÿè®¡-) `GET /inventory/admin/statistics`
- [5.5 ç”Ÿæˆæ ¸é”€ç ](#55-ç”Ÿæˆæ ¸é”€ç -) `POST /inventory/generate-code/:item_id`
- [5.6 ç‰©å“è½¬è®©](#56-ç‰©å“è½¬è®©-) `POST /inventory/transfer`
- [5.7 è·å–è½¬è®©å†å²](#57-è·å–è½¬è®©å†å²-) `GET /inventory/transfer-history`
- [5.8 å…‘æ¢å•†å“](#58-å…‘æ¢å•†å“-) `POST /inventory/exchange`
- [5.9 è·å–å…‘æ¢è®°å½•](#59-è·å–å…‘æ¢è®°å½•-) `GET /inventory/exchange-records`
- [5.10 å–æ¶ˆå…‘æ¢è®°å½•](#510-å–æ¶ˆå…‘æ¢è®°å½•-) `POST /inventory/exchange-records/:id/cancel`
- [5.11 åˆ é™¤å…‘æ¢è®°å½•](#511-åˆ é™¤å…‘æ¢è®°å½•-) `DELETE /inventory/exchange-records/:exchange_id`
- [5.12 æ¢å¤å…‘æ¢è®°å½•](#512-æ¢å¤å…‘æ¢è®°å½•-) `POST /inventory/exchange-records/:exchange_id/restore`
- [5.13 è·å–å•†å“åˆ—è¡¨](#513-è·å–å•†å“åˆ—è¡¨-) `GET /inventory/products`
- [5.14 è·å–å¸‚åœºå•†å“åˆ—è¡¨](#514-è·å–å¸‚åœºå•†å“åˆ—è¡¨-) `GET /inventory/market/products`
- [5.15 è·å–å¸‚åœºå•†å“è¯¦æƒ…](#515-è·å–å¸‚åœºå•†å“è¯¦æƒ…-) `GET /inventory/market/products/:id`
- [5.16 è´­ä¹°å¸‚åœºå•†å“](#516-è´­ä¹°å¸‚åœºå•†å“-) `POST /inventory/market/products/:id/purchase`
- [5.17 æ’¤å›å¸‚åœºå•†å“](#517-æ’¤å›å¸‚åœºå•†å“-) `POST /inventory/market/products/:id/withdraw`
- [5.18 æ ¸é”€éªŒè¯ç ](#518-æ ¸é”€éªŒè¯ç -) `POST /inventory/verification/verify`

### [6. V4 æ¶ˆè´¹è®°å½•ç®¡ç† API](#6-v4-æ¶ˆè´¹è®°å½•ç®¡ç†-api) (10ä¸ª)
- [6.1 æäº¤æ¶ˆè´¹è®°å½•](#61-æäº¤æ¶ˆè´¹è®°å½•-) `POST /consumption/submit`
- [6.2 è·å–ç”¨æˆ·æ¶ˆè´¹è®°å½•](#62-è·å–ç”¨æˆ·æ¶ˆè´¹è®°å½•-) `GET /consumption/user/:user_id`
- [6.3 è·å–æ¶ˆè´¹è®°å½•è¯¦æƒ…](#63-è·å–æ¶ˆè´¹è®°å½•è¯¦æƒ…-) `GET /consumption/detail/:record_id`
- [6.4 è·å–å¾…å®¡æ ¸æ¶ˆè´¹è®°å½•](#64-è·å–å¾…å®¡æ ¸æ¶ˆè´¹è®°å½•-) `GET /consumption/pending`
- [6.5 å®¡æ ¸é€šè¿‡æ¶ˆè´¹è®°å½•](#65-å®¡æ ¸é€šè¿‡æ¶ˆè´¹è®°å½•-) `POST /consumption/approve/:record_id`
- [6.6 æ‹’ç»æ¶ˆè´¹è®°å½•](#66-æ‹’ç»æ¶ˆè´¹è®°å½•-) `POST /consumption/reject/:record_id`
- [6.7 è·å–ç”¨æˆ·æ¶ˆè´¹äºŒç»´ç ](#67-è·å–ç”¨æˆ·æ¶ˆè´¹äºŒç»´ç -) `GET /consumption/qrcode/:user_id`
- [6.8 éªŒè¯ç”¨æˆ·QRç ](#68-éªŒè¯ç”¨æˆ·qrç -) `POST /consumption/validate-qrcode`
- [6.9 åˆ é™¤æ¶ˆè´¹è®°å½•](#69-åˆ é™¤æ¶ˆè´¹è®°å½•-) `DELETE /consumption/:record_id`
- [6.10 æ¢å¤æ¶ˆè´¹è®°å½•](#610-æ¢å¤æ¶ˆè´¹è®°å½•-) `POST /consumption/:record_id/restore`

### [7. V4 é«˜çº§ç©ºé—´è§£é” API](#7-v4-é«˜çº§ç©ºé—´è§£é”-api) (2ä¸ª)
- [7.1 è§£é”é«˜çº§ç©ºé—´](#71-è§£é”é«˜çº§ç©ºé—´-) `POST /premium/unlock`
- [7.2 æŸ¥è¯¢è§£é”çŠ¶æ€](#72-æŸ¥è¯¢è§£é”çŠ¶æ€-) `GET /premium/status`

### [8. V4 æŠ½å¥–ç»“æœé¢„è®¾ç®¡ç† API](#8-v4-æŠ½å¥–ç»“æœé¢„è®¾ç®¡ç†-api) (4ä¸ª)
- [8.1 åˆ›å»ºæŠ½å¥–é¢„è®¾](#81-åˆ›å»ºæŠ½å¥–é¢„è®¾-) `POST /lottery-preset/create`
- [8.2 æŸ¥è¯¢ç”¨æˆ·é¢„è®¾](#82-æŸ¥è¯¢ç”¨æˆ·é¢„è®¾-) `GET /lottery-preset/user/:user_id`
- [8.3 åˆ é™¤ç”¨æˆ·é¢„è®¾](#83-åˆ é™¤ç”¨æˆ·é¢„è®¾-) `DELETE /lottery-preset/user/:user_id`
- [8.4 é¢„è®¾ç»Ÿè®¡](#84-é¢„è®¾ç»Ÿè®¡-) `GET /lottery-preset/stats`

### [9. V4 ç³»ç»ŸåŠŸèƒ½ API](#9-v4-ç³»ç»ŸåŠŸèƒ½-api) (19ä¸ª)
- [9.1 è·å–ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨](#91-è·å–ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨-) `GET /system/announcements`
- [9.2 è·å–é¦–é¡µå…¬å‘Š](#92-è·å–é¦–é¡µå…¬å‘Š-) `GET /system/announcements/home`
- [9.3 æäº¤ç”¨æˆ·åé¦ˆ](#93-æäº¤ç”¨æˆ·åé¦ˆ-) `POST /system/feedback`
- [9.4 è·å–ç³»ç»ŸçŠ¶æ€](#94-è·å–ç³»ç»ŸçŠ¶æ€-) `GET /system/status`
- [9.5 è·å–ä¸šåŠ¡é…ç½®](#95-è·å–ä¸šåŠ¡é…ç½®-) `GET /system/business-config`
- [9.6 è·å–æˆ‘çš„åé¦ˆåˆ—è¡¨](#96-è·å–æˆ‘çš„åé¦ˆåˆ—è¡¨-) `GET /system/feedback/my`
- [9.7 è·å–åé¦ˆè¯¦æƒ…](#97-è·å–åé¦ˆè¯¦æƒ…-) `GET /system/feedback/:id`
- [9.8 åˆ›å»ºèŠå¤©ä¼šè¯](#98-åˆ›å»ºèŠå¤©ä¼šè¯-) `POST /system/chat/create`
- [9.9 è·å–èŠå¤©ä¼šè¯åˆ—è¡¨](#99-è·å–èŠå¤©ä¼šè¯åˆ—è¡¨-) `GET /system/chat/sessions`
- [9.10 è·å–èŠå¤©å†å²è®°å½•](#910-è·å–èŠå¤©å†å²è®°å½•-) `GET /system/chat/history/:sessionId`
- [9.11 å‘é€èŠå¤©æ¶ˆæ¯](#911-å‘é€èŠå¤©æ¶ˆæ¯-) `POST /system/chat/send`
- [9.12 ç®¡ç†å‘˜å›å¤æ¶ˆæ¯](#912-ç®¡ç†å‘˜å›å¤æ¶ˆæ¯-) `POST /system/chat/admin-reply`
- [9.13 è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®](#913-è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®-) `GET /system/user/statistics/:user_id`
- [9.14 è·å–ç®¡ç†å‘˜ç³»ç»Ÿæ¦‚è§ˆ](#914-è·å–ç®¡ç†å‘˜ç³»ç»Ÿæ¦‚è§ˆ-) `GET /system/admin/overview`
- [9.15 ç®¡ç†å‘˜è·å–èŠå¤©ä¼šè¯åˆ—è¡¨](#915-ç®¡ç†å‘˜è·å–èŠå¤©ä¼šè¯åˆ—è¡¨-) `GET /system/admin/chat/sessions`
- [9.16 ç®¡ç†å‘˜åˆ†é…èŠå¤©ä¼šè¯](#916-ç®¡ç†å‘˜åˆ†é…èŠå¤©ä¼šè¯-) `PUT /system/admin/chat/sessions/:sessionId/assign`
- [9.17 ç®¡ç†å‘˜å…³é—­èŠå¤©ä¼šè¯](#917-ç®¡ç†å‘˜å…³é—­èŠå¤©ä¼šè¯-) `PUT /system/admin/chat/sessions/:sessionId/close`
- [9.18 ç®¡ç†å‘˜è·å–èŠå¤©ç»Ÿè®¡](#918-ç®¡ç†å‘˜è·å–èŠå¤©ç»Ÿè®¡-) `GET /system/admin/chat/stats`
- [9.19 è·å–WebSocketæœåŠ¡çŠ¶æ€](#919-è·å–websocketæœåŠ¡çŠ¶æ€-) `GET /system/chat/ws-status`

### [10. V4 ç»Ÿä¸€ç®¡ç†å¼•æ“ API](#10-v4-ç»Ÿä¸€ç®¡ç†å¼•æ“-api) (41ä¸ª)

#### 10.1 åŸºç¡€ç®¡ç†API (1ä¸ª)
- [10.1 è·å–ç®¡ç†å‘˜æ¨¡å—ä¿¡æ¯](#101-è·å–ç®¡ç†å‘˜æ¨¡å—ä¿¡æ¯-) `GET /unified-engine/admin/`

#### 10.2 ç®¡ç†å‘˜è®¤è¯ (2ä¸ªAPI)
- `POST /admin/auth/login` - ç®¡ç†å‘˜ç™»å½•(ä»…ç®¡ç†å‘˜è§’è‰²å¯ç™»å½•)
- `GET /admin/auth/profile` - è·å–ç®¡ç†å‘˜ä¿¡æ¯(éªŒè¯ç®¡ç†å‘˜èº«ä»½)

**è¯´æ˜**: ç®¡ç†å‘˜è®¤è¯ä¸æ™®é€šç”¨æˆ·è®¤è¯åˆ†ç¦»ï¼Œä½¿ç”¨ç›¸åŒçš„JWT Tokenæœºåˆ¶ï¼Œä½†éªŒè¯role_levelâ‰¥100

#### 10.3 ç³»ç»Ÿç›‘æ§ (10ä¸ªAPI)
- `GET /admin/system/status` - ç³»ç»ŸçŠ¶æ€(æœåŠ¡è¿è¡ŒçŠ¶æ€)
- `GET /admin/system/dashboard` - ç®¡ç†ä»ªè¡¨ç›˜(æ ¸å¿ƒæ•°æ®æ¦‚è§ˆ)
- `GET /admin/system/management-status` - ç®¡ç†ç³»ç»ŸçŠ¶æ€(ç®¡ç†åå°å¥åº·æ£€æŸ¥)
- `POST /admin/system/announcements` - åˆ›å»ºç³»ç»Ÿå…¬å‘Š(å‘å¸ƒå…¬å‘Š)
- `GET /admin/system/announcements` - è·å–ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨(ç®¡ç†å…¬å‘Š)
- `PUT /admin/system/announcements/:id` - æ›´æ–°ç³»ç»Ÿå…¬å‘Š(ç¼–è¾‘å…¬å‘Š)
- `DELETE /admin/system/announcements/:id` - åˆ é™¤ç³»ç»Ÿå…¬å‘Š(è½¯åˆ é™¤)
- `GET /admin/system/feedbacks` - è·å–åé¦ˆåˆ—è¡¨(æŸ¥çœ‹ç”¨æˆ·åé¦ˆ)
- `POST /admin/system/feedbacks/:id/reply` - å›å¤ç”¨æˆ·åé¦ˆ(ç®¡ç†å‘˜å¤„ç†åé¦ˆ)
- `PUT /admin/system/feedbacks/:id/status` - æ›´æ–°åé¦ˆçŠ¶æ€(æ ‡è®°å¤„ç†çŠ¶æ€)

**è¯´æ˜**: system.jså®é™…åŒ…å«10ä¸ªç®¡ç†ç«¯APIï¼Œä¸»è¦è´Ÿè´£ç³»ç»Ÿç›‘æ§ã€å…¬å‘Šç®¡ç†å’Œåé¦ˆç®¡ç†

#### 10.4 é…ç½®ç®¡ç† (2ä¸ªAPI)
- `PUT /admin/config` - æ›´æ–°ç³»ç»Ÿé…ç½®(ä¿®æ”¹ä¸šåŠ¡é…ç½®å‚æ•°)
- `POST /admin/config/test/simulate` - æµ‹è¯•æ¨¡æ‹Ÿ(æµ‹è¯•é…ç½®å˜æ›´æ•ˆæœ)

**è¯´æ˜**: é…ç½®ç®¡ç†æ”¯æŒåŠ¨æ€ä¿®æ”¹ä¸šåŠ¡å‚æ•°ï¼Œæ— éœ€é‡å¯æœåŠ¡

#### 10.5 å¥–å“æ± ç®¡ç† (3ä¸ªAPI)
- [10.5 å¥–å“æ± ç®¡ç†](#105-å¥–å“æ± ç®¡ç†-) 
  - `POST /admin/prize-pool/batch-add` - æ‰¹é‡æ·»åŠ å¥–å“
  - `GET /admin/prize-pool/:campaign_id` - è·å–æ´»åŠ¨å¥–å“æ± 
  - `PUT /admin/prize-pool/prize/:prize_id` - æ›´æ–°å¥–å“ä¿¡æ¯

#### 10.6 ç”¨æˆ·ç®¡ç† (5ä¸ªAPI)
- [10.6 ç”¨æˆ·ç®¡ç†](#106-ç”¨æˆ·ç®¡ç†-)
  - `GET /admin/user-management/users` - è·å–ç”¨æˆ·åˆ—è¡¨(æ”¯æŒæœç´¢å’Œè§’è‰²è¿‡æ»¤)
  - `GET /admin/user-management/users/:user_id` - è·å–ç”¨æˆ·è¯¦æƒ…(å«è§’è‰²å’Œç§¯åˆ†ä¿¡æ¯)
  - `PUT /admin/user-management/users/:user_id/role` - æ›´æ–°ç”¨æˆ·è§’è‰²(åˆ†é…/æ’¤é”€è§’è‰²)
  - `PUT /admin/user-management/users/:user_id/status` - æ›´æ–°ç”¨æˆ·çŠ¶æ€(å¯ç”¨/ç¦ç”¨è´¦æˆ·)
  - `GET /admin/user-management/roles` - è·å–æ‰€æœ‰å¯ç”¨è§’è‰²åˆ—è¡¨

#### 10.7 æŠ½å¥–ç®¡ç† (6ä¸ªAPI)
- [10.7 æŠ½å¥–ç®¡ç†](#107-æŠ½å¥–ç®¡ç†-)
  - `POST /admin/lottery-management/force-win` - å¼ºåˆ¶ä¸­å¥–
  - `POST /admin/lottery-management/force-lose` - å¼ºåˆ¶ä¸ä¸­å¥–
  - `POST /admin/lottery-management/probability-adjust` - è°ƒæ•´ä¸­å¥–æ¦‚ç‡
  - `GET /admin/lottery-management/user-status/:user_id` - è·å–ç”¨æˆ·æŠ½å¥–çŠ¶æ€
  - `DELETE /admin/lottery-management/clear-user-settings/:user_id` - æ¸…é™¤ç”¨æˆ·ç‰¹æ®Šè®¾ç½®
  - `GET /admin/lottery-management/statistics` - æŠ½å¥–ç»Ÿè®¡

#### 10.8 æ•°æ®åˆ†æ (4ä¸ªAPI)
- [10.8 æ•°æ®åˆ†æ](#108-æ•°æ®åˆ†æ-)
  - `GET /admin/analytics/decisions/analytics` - å†³ç­–åˆ†æ
  - `GET /admin/analytics/lottery/trends` - æŠ½å¥–è¶‹åŠ¿åˆ†æ
  - `GET /admin/analytics/performance/report` - æ€§èƒ½æŠ¥å‘Š
  - `GET /admin/analytics/user/behavior` - ç”¨æˆ·è¡Œä¸ºåˆ†æ

#### 10.9 å…‘æ¢å®¡æ ¸ç®¡ç† (4ä¸ªAPI)
- [10.9 å…‘æ¢å®¡æ ¸ç®¡ç†](#104-å…‘æ¢å®¡æ ¸ç®¡ç†-)
  - `GET /admin/audit/pending` - è·å–å¾…å®¡æ ¸åˆ—è¡¨
  - `POST /admin/audit/:exchange_id/approve` - å®¡æ ¸é€šè¿‡
  - `POST /admin/audit/:exchange_id/reject` - å®¡æ ¸æ‹’ç»
  - `GET /admin/audit/history` - å®¡æ ¸å†å²

#### 10.10 æ´»åŠ¨æƒé™ç®¡ç† (4ä¸ªAPI)
- [10.10 æ´»åŠ¨æƒé™ç®¡ç†](#103-æ´»åŠ¨æƒé™ç®¡ç†-)
  - `POST /admin/campaign-permissions/assign` - åˆ†é…æ´»åŠ¨æƒé™(ä¸ºç”¨æˆ·æˆäºˆç‰¹å®šæ´»åŠ¨å‚ä¸æƒ)
  - `DELETE /admin/campaign-permissions/revoke` - æ’¤é”€æ´»åŠ¨æƒé™(ç§»é™¤ç”¨æˆ·çš„æ´»åŠ¨å‚ä¸æƒ)
  - `GET /admin/campaign-permissions/list` - æŸ¥çœ‹æƒé™åˆ—è¡¨(æŸ¥è¯¢æ´»åŠ¨æƒé™é…ç½®)
  - `GET /admin/campaign-permissions/check` - æ£€æŸ¥ç”¨æˆ·æ´»åŠ¨æƒé™(éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æ´»åŠ¨æƒé™)

**ä¸šåŠ¡è¯´æ˜**:
- æ´»åŠ¨æƒé™æ§åˆ¶ï¼šé€šè¿‡è§’è‰²ç³»ç»Ÿå®ç°æ´»åŠ¨å‡†å…¥æ§åˆ¶ï¼Œé»˜è®¤æ™®é€šç”¨æˆ·æ— æ´»åŠ¨æƒé™
- ç®¡ç†å‘˜å…¨æƒé™ï¼šç®¡ç†å‘˜è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰æ´»åŠ¨çš„å‚ä¸æƒé™ï¼Œæ— éœ€å•ç‹¬åˆ†é…
- æ‰¹é‡æ“ä½œæ”¯æŒï¼šæ”¯æŒæ‰¹é‡ä¸ºå¤šä¸ªç”¨æˆ·åˆ†é…æˆ–æ’¤é”€æƒé™
- æƒé™ç»§æ‰¿ï¼šç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ´»åŠ¨è§’è‰²ï¼Œæƒé™ç´¯åŠ 

**å¤‡æ³¨**: ç¬¬10æ¨¡å—æ˜¯ç»Ÿä¸€ç®¡ç†å¼•æ“ï¼ŒåŒ…å«10ä¸ªç®¡ç†å­æ¨¡å—ï¼Œå…±41ä¸ªAPIï¼Œæä¾›å®Œæ•´çš„åå°ç®¡ç†åŠŸèƒ½

### [é™„å½•ï¼šé€šç”¨å“åº”æ ¼å¼](#é™„å½•é€šç”¨å“åº”æ ¼å¼)

---

## 1. V4 ç»Ÿä¸€è®¤è¯å¼•æ“ API

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/auth`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/auth.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- JWTåŒTokenè®¾è®¡: accessToken(15åˆ†é’Ÿ) + refreshToken(7å¤©)
- è‡ªåŠ¨æ³¨å†Œ: æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•è‡ªåŠ¨åˆ›å»ºè´¦æˆ·+ç§¯åˆ†è´¦æˆ·+åˆ†é…é»˜è®¤è§’è‰²
- UUIDè§’è‰²ç³»ç»Ÿ: åŸºäºè§’è‰²UUIDè¿›è¡Œæƒé™éªŒè¯ï¼Œç§»é™¤`is_admin`ä¾èµ–
- å¼€å‘ç¯å¢ƒä¸‡èƒ½éªŒè¯ç : `123456`

---

### 1.1 ç”¨æˆ·ç™»å½•(æ‰‹æœºå·+éªŒè¯ç ) âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/auth/login`  
**æè¿°**: æ‰‹æœºå·+éªŒè¯ç ç™»å½•ï¼Œæ–°ç”¨æˆ·è‡ªåŠ¨æ³¨å†Œå¹¶åˆ†é…é»˜è®¤è§’è‰²  
**è®¤è¯è¦æ±‚**: âŒ æ— éœ€è®¤è¯  
**æƒé™è¦æ±‚**: å…¬å¼€æ¥å£  
**è‡ªåŠ¨æ³¨å†Œæµç¨‹**: æ–°ç”¨æˆ·è‡ªåŠ¨åˆ›å»º â†’ åˆ›å»ºç§¯åˆ†è´¦æˆ· â†’ åˆ†é…æ™®é€šç”¨æˆ·è§’è‰²(user)

**è¯·æ±‚ä½“**:
```json
{
  "mobile": "13800138000",           // æ‰‹æœºå·(å¿…å¡«)
  "verification_code": "123456"      // éªŒè¯ç (å¿…å¡«,å¼€å‘ç¯å¢ƒå›ºå®š123456)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",              // æˆ–"æ³¨å†Œå¹¶ç™»å½•æˆåŠŸ"
  "data": {
    "access_token": "eyJhbGc...",    // è®¿é—®Token(15åˆ†é’Ÿ)
    "refresh_token": "eyJhbGc...",   // åˆ·æ–°Token(7å¤©)
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·8000",         // è‡ªåŠ¨ç”Ÿæˆ:ç”¨æˆ·+æ‰‹æœºå·å4ä½
      "role_based_admin": false,     // æ˜¯å¦ç®¡ç†å‘˜(åŸºäºUUIDè§’è‰²è®¡ç®—)
      "roles": [                     // ç”¨æˆ·è§’è‰²åˆ—è¡¨
        {
          "role_id": "uuid-user-001",
          "role_name": "user",
          "role_code": "ROLE_USER"
        }
      ],
      "status": "active",
      "last_login": "2025-11-02 14:30:00",  // åŒ—äº¬æ—¶é—´
      "login_count": 1
    },
    "is_new_user": false,            // æ˜¯å¦æ–°æ³¨å†Œç”¨æˆ·
    "expires_in": 604800,            // Tokenè¿‡æœŸæ—¶é—´(ç§’)
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 MOBILE_REQUIRED`: æ‰‹æœºå·ä¸ºç©º
- `400 VERIFICATION_CODE_REQUIRED`: éªŒè¯ç ä¸ºç©º
- `400 INVALID_VERIFICATION_CODE`: éªŒè¯ç é”™è¯¯(å¼€å‘ç¯å¢ƒä½¿ç”¨123456)
- `403 USER_INACTIVE`: ç”¨æˆ·è´¦æˆ·å·²è¢«ç¦ç”¨
- `500 REGISTRATION_FAILED`: æ³¨å†Œå¤±è´¥

---

### 1.2 å¿«é€Ÿç™»å½•(ä»…æ‰‹æœºå·) âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/auth/quick-login`  
**æè¿°**: ä»…æ‰‹æœºå·ç›´æ¥ç™»å½•ï¼Œæ— éœ€éªŒè¯ç ï¼Œæ–°ç”¨æˆ·è‡ªåŠ¨æ³¨å†Œ  
**è®¤è¯è¦æ±‚**: âŒ æ— éœ€è®¤è¯  
**æƒé™è¦æ±‚**: å…¬å¼€æ¥å£  
**ä½¿ç”¨åœºæ™¯**: å†…éƒ¨æµ‹è¯•ã€å¿«é€Ÿä½“éªŒ(ç”Ÿäº§ç¯å¢ƒåº”ç¦ç”¨)
 
**è¯·æ±‚ä½“**:
```json
{
  "mobile": "13800138000"
}
```

**æˆåŠŸå“åº”**: (ä¸1.1ç›¸åŒ)

---

### 1.3 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/auth/profile`  
**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·8000",
      "role_based_admin": false,
      "roles": [...],
      "status": "active",
      "consecutive_fail_count": 0,    // è¿ç»­æœªä¸­å¥–æ¬¡æ•°
      "history_total_points": 100000, // å†å²ç´¯è®¡ç§¯åˆ†
      "created_at": "2025-01-01 10:00:00",
      "last_login": "2025-11-02 14:30:00",
      "login_count": 10
    },
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 1.4 éªŒè¯Tokenæœ‰æ•ˆæ€§ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/auth/verify`  
**æè¿°**: éªŒè¯Access Tokenæ˜¯å¦æœ‰æ•ˆï¼Œç”¨äºå‰ç«¯è·¯ç”±å®ˆå«  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "TokenéªŒè¯æˆåŠŸ",
  "data": {
    "valid": true,
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "role_based_admin": false,
      "roles": [...]
    },
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 1.5 åˆ·æ–°Token âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/auth/refresh`  
**æè¿°**: ä½¿ç”¨Refresh Tokenè·å–æ–°çš„Tokenå¯¹  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Refresh Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "refresh_token": "eyJhbGc..."
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "Tokenåˆ·æ–°æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGc...",   // æ–°è®¿é—®Token
    "refresh_token": "eyJhbGc...",  // æ–°åˆ·æ–°Token
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "role_based_admin": false,
      "roles": [...],
      "status": "active"
    },
    "expires_in": 604800,
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 REFRESH_TOKEN_REQUIRED`: åˆ·æ–°Tokenä¸ºç©º
- `401 INVALID_REFRESH_TOKEN`: åˆ·æ–°Tokenæ— æ•ˆ
- `401 INVALID_REFRESH_TOKEN_FORMAT`: Tokenæ ¼å¼é”™è¯¯
- `401 REFRESH_TOKEN_EXPIRED`: Tokenå·²è¿‡æœŸ
- `403 USER_INACTIVE`: ç”¨æˆ·è´¦æˆ·å·²è¢«ç¦ç”¨

---

## 2. V4 ç»Ÿä¸€æŠ½å¥–å¼•æ“ API

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/lottery`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/lottery.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- 100%ä¸­å¥–æœºåˆ¶: æ¯æ¬¡æŠ½å¥–å¿…å®šä¸­å¥–(åªæ˜¯ä»·å€¼ä¸åŒ)
- æ´»åŠ¨æƒé™æ§åˆ¶: ç®¡ç†å‘˜å…¨æƒé™ï¼Œæ™®é€šç”¨æˆ·éœ€åˆ†é…æ´»åŠ¨è§’è‰²
- æ•°æ®è„±æ•ä¿æŠ¤: å¥–å“åˆ—è¡¨éšè—æ¦‚ç‡ã€åº“å­˜ç­‰æ•æ„Ÿä¿¡æ¯
- é™æµä¿æŠ¤: 20æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·ï¼Œé˜²æ­¢æ¶æ„åˆ·æŠ½å¥–
- äº‹åŠ¡å®‰å…¨: ç§¯åˆ†æ‰£é™¤å’ŒæŠ½å¥–ç»“æœåŸå­æ€§ä¿è¯

---

### 2.1 æ‰§è¡ŒæŠ½å¥– âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/lottery/draw`  
**æè¿°**: æ‰§è¡ŒæŠ½å¥–(æ”¯æŒå•æŠ½å’Œè¿æŠ½ï¼Œé»˜è®¤å•æŠ½)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: éœ€è¦å¯¹åº”æ´»åŠ¨çš„å‚ä¸æƒé™(ç®¡ç†å‘˜è‡ªåŠ¨æ‹¥æœ‰)  
**é™æµ**: 20æ¬¡/åˆ†é’Ÿ/ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "campaign_code": "daily_lottery",  // æ´»åŠ¨ä»£ç (å¿…å¡«)
  "draw_count": 1                    // æŠ½å¥–æ¬¡æ•°(å¯é€‰,é»˜è®¤1,æœ€å¤§10)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æŠ½å¥–æˆåŠŸ",
  "error_code": "DRAW_SUCCESS",
  "data": {
    "success": true,
    "campaign_code": "daily_lottery",
    "prizes": [
      {
        "is_winner": true,
        "id": 5,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "sort_order": 3,          // å¥–å“æ’åº(å‰ç«¯è®¡ç®—è½¬ç›˜ä½ç½®ç”¨)
        "icon": "ğŸ’°",             // å¥–å“å›¾æ ‡
        "rarity": "common",       // ç¨€æœ‰åº¦
        "display_value": "100"    // æ˜¾ç¤ºä»·å€¼
      }
    ],
    "total_points_cost": 100,     // æ€»ç§¯åˆ†æ¶ˆè€—
    "remaining_balance": 900,     // å‰©ä½™ç§¯åˆ†
    "draw_count": 1               // å®é™…æŠ½å¥–æ¬¡æ•°
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**æœªä¸­å¥–å“åº”**:
```json
{
  "prizes": [
    {
      "is_winner": false,
      "name": "æœªä¸­å¥–",
      "type": "empty",
      "sort_order": null,
      "icon": "ğŸ’¨",
      "rarity": "common"
    }
  ]
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_PARAMETER`: ç¼ºå°‘campaign_codeå‚æ•°
- `403 NO_CAMPAIGN_PERMISSION`: æ— æ´»åŠ¨å‚ä¸æƒé™
- `404 CAMPAIGN_NOT_FOUND`: æ´»åŠ¨ä¸å­˜åœ¨æˆ–å·²å…³é—­
- `500 DRAW_ERROR`: æŠ½å¥–æ‰§è¡Œå¤±è´¥

---

### 2.2 è·å–å¥–å“åˆ—è¡¨(å·²è„±æ•) âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/prizes/:campaignCode`  
**æè¿°**: è·å–æ´»åŠ¨å¥–å“åˆ—è¡¨(å·²éšè—æ¦‚ç‡å’Œåº“å­˜)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: éœ€è¦æ´»åŠ¨æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "campaign_code": "daily_lottery",
    "prizes": [
      {
        "id": 1,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "icon": "ğŸ’°",
        "rarity": "common"
      }
    ]
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

---

### 2.3 è·å–æŠ½å¥–é…ç½® âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/config/:campaignCode`  
**æè¿°**: è·å–æ´»åŠ¨é…ç½®ä¿¡æ¯(å«å®Œæ•´å¥–å“é…ç½®,ä»…ç®¡ç†å‘˜å¯è§)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "campaign_id": 1,
    "campaign_code": "daily_lottery",
    "campaign_name": "æ¯æ—¥æŠ½å¥–",
    "cost_points": 100,
    "prizes": [
      {
        "id": 1,
        "name": "100ç§¯åˆ†",
        "probability": 0.5,       // æ¦‚ç‡(ä»…ç®¡ç†å‘˜å¯è§)
        "total_inventory": 1000,  // åº“å­˜(ä»…ç®¡ç†å‘˜å¯è§)
        "used_inventory": 50
      }
    ]
  }
}
```

---

### 2.4 è·å–æŠ½å¥–å†å² âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/history/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·æŠ½å¥–å†å²è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„å†å²æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººå†å²

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç (é»˜è®¤1)
- `page_size`: æ¯é¡µæ¡æ•°(é»˜è®¤20,æœ€å¤§100)
- `start_date`: å¼€å§‹æ—¥æœŸ(å¯é€‰)
- `end_date`: ç»“æŸæ—¥æœŸ(å¯é€‰)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "total": 150,
    "page": 1,
    "page_size": 20,
    "total_pages": 8,
    "records": [
      {
        "draw_id": "draw_20251102_abc123",
        "campaign_name": "æ¯æ—¥æŠ½å¥–",
        "prize_name": "100ç§¯åˆ†",
        "is_winner": true,
        "points_cost": 100,
        "created_at": "2025-11-02 14:30:00"
      }
    ]
  }
}
```

---

### 2.5 è·å–æ´»åŠ¨åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/campaigns`  
**æè¿°**: è·å–å½“å‰è¿›è¡Œä¸­çš„æŠ½å¥–æ´»åŠ¨åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "campaigns": [
      {
        "campaign_id": 1,
        "campaign_code": "daily_lottery",
        "campaign_name": "æ¯æ—¥æŠ½å¥–",
        "description": "æ¯å¤©éƒ½èƒ½å‚ä¸",
        "cost_points": 100,
        "status": "active",
        "start_time": "2025-01-01 00:00:00",
        "end_time": "2025-12-31 23:59:59"
      }
    ]
  }
}
```

---

### 2.6 è·å–ç”¨æˆ·ç§¯åˆ† âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/points/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·å½“å‰ç§¯åˆ†ä½™é¢  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„ç§¯åˆ†æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººç§¯åˆ†

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "available_points": 1000,
    "pending_points": 50,
    "history_total_points": 100000
  }
}
```

---

### 2.7 è·å–æŠ½å¥–ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/statistics/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·æŠ½å¥–ç»Ÿè®¡æ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„ç»Ÿè®¡æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººç»Ÿè®¡

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "total_draws": 50,
    "total_wins": 48,          // 100%ä¸­å¥–æœºåˆ¶ä¸‹æ¥è¿‘æ€»æŠ½å¥–æ¬¡æ•°
    "win_rate": 0.96,
    "total_points_spent": 5000,
    "most_frequent_campaign": "daily_lottery"
  }
}
```

---

### 2.8 å¥åº·æ£€æŸ¥ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/lottery/health`  
**æè¿°**: æŠ½å¥–æœåŠ¡å¥åº·æ£€æŸ¥  
**è®¤è¯è¦æ±‚**: âŒ æ— éœ€è®¤è¯  
**æƒé™è¦æ±‚**: å…¬å¼€æ¥å£

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "status": "healthy",
    "service": "lottery-engine",
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

## 3. V4 æƒé™ç®¡ç† API

**åŸºç¡€è·¯å¾„**: `/api/v4/permissions`  
**å®ç°æ–‡ä»¶**: `routes/v4/permissions.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- UUIDè§’è‰²ç³»ç»Ÿ: åŸºäºè§’è‰²UUIDè¿›è¡Œæƒé™åˆ¤æ–­ï¼Œç§»é™¤`is_admin`ä¾èµ–
- åˆ†çº§æƒé™: è§’è‰²æœ‰çº§åˆ«(role_level)ï¼Œç”¨äºæƒé™ç»§æ‰¿
- æƒé™æ£€æŸ¥: æ”¯æŒèµ„æº(resource)+åŠ¨ä½œ(action)çš„ç»†ç²’åº¦æƒé™æ§åˆ¶
- ç®¡ç†å‘˜æƒé™: ç®¡ç†å‘˜è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰æƒé™

---

### 3.1 è·å–æŒ‡å®šç”¨æˆ·æƒé™ âœ…

**è·¯å¾„**: `GET /api/v4/permissions/user/:user_id`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„æƒé™æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººæƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·æƒé™ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "user_id": 1,
    "roles": [
      {
        "role_id": "uuid-user-001",
        "role_name": "user",
        "role_code": "ROLE_USER",
        "role_level": 1
      }
    ],
    "role_based_admin": false,          // æ˜¯å¦ç®¡ç†å‘˜
    "role_level": 1,                    // ç”¨æˆ·æœ€é«˜è§’è‰²çº§åˆ«
    "permissions": [
      "lottery:participate",
      "points:view",
      "inventory:view"
    ],
    "can_manage_lottery": false,        // æ˜¯å¦å¯ç®¡ç†æŠ½å¥–
    "can_view_admin_panel": false,      // æ˜¯å¦å¯æŸ¥çœ‹ç®¡ç†é¢æ¿
    "can_modify_user_permissions": false // æ˜¯å¦å¯ä¿®æ”¹ç”¨æˆ·æƒé™
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 FORBIDDEN`: æ— æƒé™æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æƒé™ä¿¡æ¯

---

### 3.2 è·å–å½“å‰ç”¨æˆ·æƒé™ âœ…

**è·¯å¾„**: `GET /api/v4/permissions/current`  
**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²å’Œæƒé™ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**: (ä¸3.1ç›¸åŒ)

---

### 3.3 æ£€æŸ¥æƒé™ âœ…

**è·¯å¾„**: `POST /api/v4/permissions/check`  
**æè¿°**: æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šèµ„æºçš„ç‰¹å®šæƒé™  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "resource": "lottery",              // èµ„æºåç§°(å¿…å¡«)
  "action": "participate"             // åŠ¨ä½œ(å¯é€‰,é»˜è®¤read)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æƒé™æ£€æŸ¥å®Œæˆ",
  "data": {
    "user_id": 1,
    "resource": "lottery",
    "action": "participate",
    "has_permission": true,           // æ˜¯å¦æœ‰æƒé™
    "role_based_admin": false,
    "role_level": 1,
    "checked_at": "2025-11-02 14:30:00"
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_REQUIRED_PARAMETER`: ç¼ºå°‘resourceå‚æ•°

---

### 3.4 è·å–ç®¡ç†å‘˜åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/permissions/admins`  
**æè¿°**: è·å–æ‰€æœ‰ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç®¡ç†å‘˜åˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "total_count": 5,
    "admins": [
      {
        "user_id": 1,
        "mobile": "13800138000",
        "nickname": "ç®¡ç†å‘˜",
        "role_based_admin": true,
        "roles": [
          {
            "role_id": "uuid-admin-001",
            "role_name": "admin",
            "role_code": "ROLE_ADMIN",
            "role_level": 10
          }
        ],
        "status": "active"
      }
    ],
    "retrieved_at": "2025-11-02 14:30:00"
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™

---

### 3.5 è·å–æƒé™ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/permissions/statistics`  
**æè¿°**: è·å–æƒé™ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯(ç”¨æˆ·è§’è‰²åˆ†å¸ƒã€æƒé™ä½¿ç”¨æƒ…å†µç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æƒé™ç»Ÿè®¡ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "total_users": 1000,
    "total_admins": 5,
    "role_distribution": {
      "user": 995,
      "admin": 5
    },
    "permission_usage": {
      "lottery:participate": 950,
      "points:view": 1000,
      "inventory:view": 800
    },
    "role_based_admin": true,
    "retrieved_by": 1
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™

---

## 4. V4 ç§¯åˆ†ç®¡ç† API

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/points`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/points.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- PointsServiceç»Ÿä¸€ç®¡ç†: æ‰€æœ‰ç§¯åˆ†æ“ä½œé€šè¿‡PointsServiceæœåŠ¡æ‰§è¡Œ
- äº‹åŠ¡å®‰å…¨: æ‰€æœ‰ç§¯åˆ†å˜åŠ¨ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯åŸå­æ€§
- å¹‚ç­‰æ€§ä¿è¯: ä½¿ç”¨business_idé˜²æ­¢é‡å¤å¤„ç†åŒä¸€ä¸šåŠ¡
- å®Œæ•´å®¡è®¡: æ‰€æœ‰ç§¯åˆ†å˜åŠ¨éƒ½æœ‰å®Œæ•´çš„äº¤æ˜“è®°å½•
- è½¯åˆ é™¤æ”¯æŒ: äº¤æ˜“è®°å½•æ”¯æŒè½¯åˆ é™¤å’Œæ¢å¤

---

### 4.1 è·å–å½“å‰ç”¨æˆ·ç§¯åˆ†ä½™é¢ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/balance`  
**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ç§¯åˆ†è´¦æˆ·ä½™é¢  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "available_points": 1500,        // å¯ç”¨ç§¯åˆ†
    "pending_points": 50,            // å¾…å‘æ”¾ç§¯åˆ†
    "history_total_points": 100000,  // å†å²ç´¯è®¡ç§¯åˆ†
    "last_updated": "2025-11-02 14:30:00"
  }
}
```

---

### 4.2 è·å–æŒ‡å®šç”¨æˆ·ç§¯åˆ†ä½™é¢ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/balance/:user_id`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„ç§¯åˆ†ä½™é¢(ç®¡ç†å‘˜æˆ–æœ¬äºº)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„ç§¯åˆ†æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººç§¯åˆ†

**æˆåŠŸå“åº”**: (ä¸4.1ç›¸åŒ)

---

### 4.3 è·å–ç§¯åˆ†äº¤æ˜“å†å² âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/transactions/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·ç§¯åˆ†äº¤æ˜“è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„å†å²æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººå†å²

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç (é»˜è®¤1)
- `limit`: æ¯é¡µæ¡æ•°(é»˜è®¤20,æœ€å¤§100)
- `transaction_type`: äº¤æ˜“ç±»å‹(å¯é€‰: earn/consume)
- `start_time`: å¼€å§‹æ—¶é—´(å¯é€‰)
- `end_time`: ç»“æŸæ—¶é—´(å¯é€‰)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "transactions": [
      {
        "transaction_id": "tx_20251102_abc123",
        "transaction_type": "consume",        // earn/consume
        "points_amount": -100,
        "points_balance_before": 1600,
        "points_balance_after": 1500,
        "business_type": "lottery_draw",      // ä¸šåŠ¡ç±»å‹
        "business_id": "draw_xxx",            // ä¸šåŠ¡ID
        "transaction_title": "å‚ä¸æŠ½å¥–",
        "transaction_time": "2025-11-02 14:30:00",
        "status": "completed",                // completed/pending/cancelled
        "is_deleted": 0                       // æ˜¯å¦è½¯åˆ é™¤
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 10,
      "total_count": 200,
      "limit": 20
    }
  }
}
```

---

### 4.4 ç®¡ç†å‘˜è°ƒæ•´ç§¯åˆ† âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/points/admin/adjust`  
**æè¿°**: ç®¡ç†å‘˜æ‰‹åŠ¨è°ƒæ•´ç”¨æˆ·ç§¯åˆ†(å¢åŠ æˆ–æ‰£é™¤)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                      // ç›®æ ‡ç”¨æˆ·ID(å¿…å¡«)
  "points_amount": 500,              // ç§¯åˆ†æ•°é‡(æ­£æ•°å¢åŠ ,è´Ÿæ•°æ‰£é™¤)
  "operation": "add",                // æ“ä½œç±»å‹: add/subtract
  "reason": "æ´»åŠ¨è¡¥å¿",               // è°ƒæ•´åŸå› (å¿…å¡«)
  "business_id": "manual_adjust_001" // ä¸šåŠ¡ID(å¯é€‰,ç”¨äºå¹‚ç­‰)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç§¯åˆ†è°ƒæ•´æˆåŠŸ",
  "data": {
    "transaction_id": "tx_20251102_xyz789",
    "user_id": 1,
    "old_balance": 1000,
    "new_balance": 1500,
    "points_adjusted": 500,
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 4.5 è·å–ç®¡ç†å‘˜ç§¯åˆ†ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/admin/statistics`  
**æè¿°**: è·å–ç³»ç»Ÿç§¯åˆ†ç»Ÿè®¡ä¿¡æ¯(æ€»å‘æ”¾ã€æ€»æ¶ˆè´¹ç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "total_points_issued": 1000000,      // æ€»å‘æ”¾ç§¯åˆ†
    "total_points_consumed": 500000,     // æ€»æ¶ˆè´¹ç§¯åˆ†
    "total_active_users": 1000,          // æ´»è·ƒç”¨æˆ·æ•°
    "average_balance": 500               // å¹³å‡ä½™é¢
  }
}
```

---

### 4.6 è·å–ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/user/statistics/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·ç§¯åˆ†ç»Ÿè®¡ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„ç»Ÿè®¡æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººç»Ÿè®¡

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "total_earned": 100000,              // æ€»è·å¾—ç§¯åˆ†
    "total_consumed": 50000,             // æ€»æ¶ˆè´¹ç§¯åˆ†
    "current_balance": 1500,             // å½“å‰ä½™é¢
    "transaction_count": 200,            // äº¤æ˜“æ¬¡æ•°
    "avg_transaction_amount": 250        // å¹³å‡äº¤æ˜“é‡‘é¢
  }
}
```

---

### 4.7 è·å–ç§¯åˆ†æ€»è§ˆ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/overview`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„ç§¯åˆ†æ€»è§ˆä¿¡æ¯(åŒ…æ‹¬å¯ç”¨ã€å†»ç»“ã€å†å²ç´¯è®¡ç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "available_points": 1500,
    "pending_points": 50,
    "frozen_points": 100,
    "history_total_points": 100000,
    "last_updated": "2025-11-02 14:30:00"
  }
}
```

---

### 4.8 è·å–å†»ç»“ç§¯åˆ†åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/frozen`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„å†»ç»“ç§¯åˆ†è®°å½•åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "frozen_records": [
      {
        "record_id": 1,
        "points_amount": 100,
        "reason": "å¾…å®¡æ ¸æ¶ˆè´¹",
        "frozen_at": "2025-11-02 14:30:00",
        "expires_at": "2025-11-09 14:30:00"
      }
    ],
    "total_frozen": 100
  }
}
```

---

### 4.9 åˆ é™¤/éšè—äº¤æ˜“è®°å½• âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/points/transaction/:transaction_id`  
**æè¿°**: è½¯åˆ é™¤äº¤æ˜“è®°å½•(ä»…éšè—,ä¸å®é™…åˆ é™¤)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**åŠŸèƒ½è¯´æ˜**:
- è½¯åˆ é™¤ï¼šè®°å½•ç‰©ç†ä¿ç•™ï¼Œåªæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤(is_deleted=1)
- å‰ç«¯æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤è®°å½•
- **é‡è¦**ï¼šåˆ é™¤äº¤æ˜“è®°å½•ä¸å½±å“ç§¯åˆ†ä½™é¢
- ç”¨æˆ·åˆ é™¤åæ— æ³•è‡ªå·±æ¢å¤ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥æ¢å¤

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "äº¤æ˜“è®°å½•å·²åˆ é™¤"
}
```

---

### 4.10 æ¢å¤äº¤æ˜“è®°å½• âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/points/transaction/:transaction_id/restore`  
**æè¿°**: æ¢å¤å·²åˆ é™¤çš„äº¤æ˜“è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "äº¤æ˜“è®°å½•å·²æ¢å¤"
}
```

---

### 4.11 è·å–ç§¯åˆ†è¶‹åŠ¿æ•°æ® âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/points/trend`  
**æè¿°**: è·å–ç”¨æˆ·æŒ‡å®šå¤©æ•°å†…çš„ç§¯åˆ†è·å¾—/æ¶ˆè´¹è¶‹åŠ¿æ•°æ®ï¼Œè¿”å›å‰ç«¯Chart.jså¯ç›´æ¥ä½¿ç”¨çš„æ ¼å¼  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·ï¼ˆåªèƒ½æŸ¥è¯¢è‡ªå·±çš„æ•°æ®ï¼‰

**æŸ¥è¯¢å‚æ•°**:
- `days`: æŸ¥è¯¢å¤©æ•°(é»˜è®¤30,èŒƒå›´7-90å¤©)
- `end_date`: ç»“æŸæ—¥æœŸ(å¯é€‰,é»˜è®¤ä»Šå¤©,æ ¼å¼YYYY-MM-DD)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç§¯åˆ†è¶‹åŠ¿æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "labels": ["11-01", "11-02", "11-03", "...", "11-30"],
    "earn_data": [100, 50, 0, 200, "...", 150],
    "consume_data": [30, 0, 100, 50, "...", 80],
    "total_earn": 3500,
    "total_consume": 1200,
    "net_change": 2300,
    "period": "2025-11-01 è‡³ 2025-11-30",
    "days": 30,
    "data_points": 30,
    "timestamp": "2025-11-02 15:50:21"
  }
}
```

**å“åº”å­—æ®µè¯´æ˜**:
- `labels`: æ—¥æœŸæ ‡ç­¾æ•°ç»„(å‰ç«¯Chart.jsçš„Xè½´)
- `earn_data`: æ¯æ—¥è·å¾—ç§¯åˆ†æ•°ç»„(ä¸labelså¯¹åº”)
- `consume_data`: æ¯æ—¥æ¶ˆè´¹ç§¯åˆ†æ•°ç»„(æ­£æ•°,ä¸labelså¯¹åº”)
- `total_earn`: å‘¨æœŸæ€»è·å¾—ç§¯åˆ†
- `total_consume`: å‘¨æœŸæ€»æ¶ˆè´¹ç§¯åˆ†
- `net_change`: å‡€å˜åŒ–(æ€»è·å¾—-æ€»æ¶ˆè´¹)
- `period`: ç»Ÿè®¡å‘¨æœŸæè¿°
- `days`: å®é™…ç»Ÿè®¡å¤©æ•°
- `data_points`: æ•°æ®ç‚¹æ•°é‡

---

## 5. V4 ç”¨æˆ·åº“å­˜ç®¡ç† API

**åŸºç¡€è·¯å¾„**: `/api/v4/inventory`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/inventory.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- å¤šåŠŸèƒ½æ¨¡å—: åŒ…å«ç”¨æˆ·åº“å­˜ã€å•†å“å…‘æ¢ã€å¸‚åœºäº¤æ˜“ã€ç‰©å“è½¬è®©ç­‰å®Œæ•´åŠŸèƒ½
- è½¯åˆ é™¤æ”¯æŒ: å…‘æ¢è®°å½•æ”¯æŒè½¯åˆ é™¤å’Œæ¢å¤
- æ ¸é”€ç ç³»ç»Ÿ: æ”¯æŒç”Ÿæˆå’ŒéªŒè¯æ ¸é”€ç 
- è½¬è®©å†å²: å®Œæ•´çš„ç‰©å“è½¬è®©è®°å½•å’Œå®¡è®¡

---

### 5.1 è·å–ç”¨æˆ·åº“å­˜åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/inventory/user/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·çš„åº“å­˜ç‰©å“åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„åº“å­˜æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººåº“å­˜

**æŸ¥è¯¢å‚æ•°**:
- `status`: ç‰©å“çŠ¶æ€(å¯é€‰: available/used/expired)
- `type`: ç‰©å“ç±»å‹(å¯é€‰: physical/virtual/coupon)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "inventory_items": [
      {
        "item_id": 1,
        "prize_name": "100ç§¯åˆ†",
        "prize_type": "points",
        "prize_value": 100,
        "status": "available",         // available/used/expired
        "expires_at": "2025-12-31 23:59:59",
        "obtained_at": "2025-11-02 14:30:00",
        "source": "lottery_draw",      // æ¥æº
        "can_transfer": true,          // æ˜¯å¦å¯è½¬è®©
        "can_exchange": false          // æ˜¯å¦å¯å…‘æ¢
      }
    ],
    "total_count": 10
  }
}
```

---

### 5.2 è·å–åº“å­˜ç‰©å“è¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/inventory/item/:item_id`  
**æè¿°**: è·å–å•ä¸ªåº“å­˜ç‰©å“çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„ç‰©å“æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººç‰©å“

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "item_id": 1,
    "prize_name": "100ç§¯åˆ†",
    "prize_type": "points",
    "prize_value": 100,
    "status": "available",
    "description": "æŠ½å¥–è·å¾—çš„ç§¯åˆ†å¥–åŠ±",
    "usage_instructions": "è‡ªåŠ¨æ·»åŠ åˆ°è´¦æˆ·",
    "expires_at": "2025-12-31 23:59:59",
    "obtained_at": "2025-11-02 14:30:00"
  }
}
```

---

### 5.3 ä½¿ç”¨åº“å­˜ç‰©å“ âœ…

**è·¯å¾„**: `POST /api/v4/inventory/use/:item_id`  
**æè¿°**: ä½¿ç”¨åº“å­˜ä¸­çš„ç‰©å“(æ ‡è®°ä¸ºå·²ä½¿ç”¨)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç‰©å“æ‰€æœ‰è€…

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç‰©å“ä½¿ç”¨æˆåŠŸ",
  "data": {
    "item_id": 1,
    "status": "used",
    "used_at": "2025-11-02 14:30:00"
  }
}
```

---

### 5.4 è·å–ç®¡ç†å‘˜åº“å­˜ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/inventory/admin/statistics`  
**æè¿°**: è·å–ç³»ç»Ÿåº“å­˜ç»Ÿè®¡ä¿¡æ¯(ç®¡ç†å‘˜ä¸“ç”¨)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "total_items": 5000,
    "available_items": 3000,
    "used_items": 1500,
    "expired_items": 500
  }
}
```

---

### 5.5 ç”Ÿæˆæ ¸é”€ç  âœ…

**è·¯å¾„**: `POST /api/v4/inventory/generate-code/:item_id`  
**æè¿°**: ä¸ºåº“å­˜ç‰©å“ç”Ÿæˆæ ¸é”€ç   
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç‰©å“æ‰€æœ‰è€…

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç‰©å“ä½¿ç”¨æˆåŠŸ",
  "data": {
    "item_id": 1,
    "status": "used",
    "used_at": "2025-11-02 14:30:00"
  }
}
```

---

### 5.6 ç‰©å“è½¬è®© âœ…

**è·¯å¾„**: `POST /api/v4/inventory/transfer`  
**æè¿°**: å°†åº“å­˜ç‰©å“è½¬è®©ç»™å…¶ä»–ç”¨æˆ·  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç‰©å“æ‰€æœ‰è€…

**è¯·æ±‚ä½“**:
```json
{
  "item_id": 1,                      // ç‰©å“ID(å¿…å¡«)
  "to_user_id": 2,                   // ç›®æ ‡ç”¨æˆ·ID(å¿…å¡«)
  "message": "é€ä½ çš„ç¤¼ç‰©"             // è½¬è®©ç•™è¨€(å¯é€‰)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è½¬è®©æˆåŠŸ",
  "data": {
    "transfer_id": "trans_20251102_abc123",
    "item_id": 1,
    "from_user_id": 1,
    "to_user_id": 2,
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 5.7 è·å–è½¬è®©å†å² âœ…

**è·¯å¾„**: `GET /api/v4/inventory/transfer-history`  
**æè¿°**: è·å–ç‰©å“è½¬è®©å†å²è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç (é»˜è®¤1)
- `limit`: æ¯é¡µæ¡æ•°(é»˜è®¤20)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "transfers": [
      {
        "transfer_id": "trans_20251102_abc123",
        "item_name": "100ç§¯åˆ†",
        "from_user_id": 1,
        "to_user_id": 2,
        "transfer_type": "send",       // send/receive
        "message": "é€ä½ çš„ç¤¼ç‰©",
        "created_at": "2025-11-02 14:30:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 5,
      "total_count": 100
    }
  }
}
```

---

### 5.8 å•†å“å…‘æ¢ âœ…

**è·¯å¾„**: `POST /api/v4/inventory/exchange`  
**æè¿°**: ä½¿ç”¨ç§¯åˆ†å…‘æ¢å•†å“  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "product_id": 1,                   // å•†å“ID(å¿…å¡«)
  "quantity": 1                      // å…‘æ¢æ•°é‡(é»˜è®¤1)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…‘æ¢æˆåŠŸ",
  "data": {
    "exchange_id": "exch_20251102_xyz789",
    "product_name": "å®šåˆ¶ç¤¼å“",
    "points_spent": 1000,
    "remaining_points": 500,
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 5.9 è·å–å…‘æ¢è®°å½• âœ…

**è·¯å¾„**: `GET /api/v4/inventory/exchange-records`  
**æè¿°**: è·å–ç”¨æˆ·çš„å…‘æ¢è®°å½•åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "records": [
      {
        "exchange_id": "exch_20251102_xyz789",
        "product_name": "å®šåˆ¶ç¤¼å“",
        "points_spent": 1000,
        "status": "pending",           // pending/completed/cancelled
        "created_at": "2025-11-02 14:30:00"
      }
    ]
  }
}
```

---

### 5.10 å–æ¶ˆå…‘æ¢è®°å½• âœ…

**è·¯å¾„**: `POST /api/v4/inventory/exchange-records/:id/cancel`  
**æè¿°**: å–æ¶ˆå¾…å¤„ç†çš„å…‘æ¢è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: è®°å½•æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…‘æ¢è®°å½•å·²å–æ¶ˆ"
}
```

---

### 5.11 åˆ é™¤/éšè—å…‘æ¢è®°å½• âœ…

**è·¯å¾„**: `DELETE /api/v4/inventory/exchange-records/:exchange_id`  
**æè¿°**: è½¯åˆ é™¤å…‘æ¢è®°å½•(ä»…éšè—)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: è®°å½•æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…‘æ¢è®°å½•å·²åˆ é™¤"
}
```

---

### 5.12 æ¢å¤å…‘æ¢è®°å½• âœ…

**è·¯å¾„**: `POST /api/v4/inventory/exchange-records/:exchange_id/restore`  
**æè¿°**: æ¢å¤å·²åˆ é™¤çš„å…‘æ¢è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…‘æ¢è®°å½•å·²æ¢å¤"
}
```

---

### 5.13 è·å–å•†å“åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/inventory/products`  
**æè¿°**: è·å–å¯å…‘æ¢çš„å•†å“åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "products": [
      {
        "product_id": 1,
        "product_name": "å®šåˆ¶ç¤¼å“",
        "points_required": 1000,
        "stock": 50,
        "description": "ç²¾ç¾å®šåˆ¶ç¤¼å“",
        "image_url": "https://..."
      }
    ]
  }
}
```

---

### 5.14 è·å–å¸‚åœºå•†å“åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/inventory/market/products`  
**æè¿°**: è·å–å¸‚åœºå¯äº¤æ˜“çš„å•†å“åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "products": [
      {
        "product_id": 1,
        "product_name": "é™é‡å•†å“",
        "price": 500,
        "stock": 10,
        "seller_id": 2
      }
    ]
  }
}
```

---

### 5.15 è·å–å¸‚åœºå•†å“è¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/inventory/market/products/:id`  
**æè¿°**: è·å–å¸‚åœºå•†å“çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "product_id": 1,
    "product_name": "é™é‡å•†å“",
    "price": 500,
    "description": "ç¨€æœ‰ç‰©å“",
    "seller_info": {
      "user_id": 2,
      "nickname": "å–å®¶"
    }
  }
}
```

---

### 5.16 è´­ä¹°å¸‚åœºå•†å“ âœ…

**è·¯å¾„**: `POST /api/v4/inventory/market/products/:id/purchase`  
**æè¿°**: è´­ä¹°å¸‚åœºä¸Šçš„å•†å“  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è´­ä¹°æˆåŠŸ"
}
```

---

### 5.17 æ’¤å›å¸‚åœºå•†å“ âœ…

**è·¯å¾„**: `POST /api/v4/inventory/market/products/:id/withdraw`  
**æè¿°**: å–å®¶æ’¤å›å·²ä¸Šæ¶çš„å•†å“  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å•†å“æ‰€æœ‰è€…

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å•†å“å·²æ’¤å›"
}
```

---

### 5.18 æ ¸é”€éªŒè¯ç  âœ…

**è·¯å¾„**: `POST /api/v4/inventory/verification/verify`  
**æè¿°**: å•†å®¶æ‰«ç æ ¸é”€ç”¨æˆ·éªŒè¯ç ,æ ‡è®°ç‰©å“ä¸ºå·²ä½¿ç”¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å•†æˆ·è§’è‰²æˆ–ç®¡ç†å‘˜

**è¯·æ±‚ä½“**:
```json
{
  "verification_code": "ABC123XYZ"
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ ¸é”€æˆåŠŸ",
  "data": {
    "item_id": 1,
    "prize_name": "100ç§¯åˆ†",
    "verified_at": "2025-11-02 14:30:00"
  }
}
```

---

## 6. V4 æ¶ˆè´¹è®°å½•ç®¡ç† API

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/consumption`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/consumption.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- å•†æˆ·æ ¸é”€ç³»ç»Ÿ: å•†æˆ·æäº¤æ¶ˆè´¹è®°å½•ï¼Œç®¡ç†å‘˜å®¡æ ¸åå‘æ”¾ç§¯åˆ†
- QRç è®¤è¯: ç”¨æˆ·å¯ç”Ÿæˆä¸ªäººQRç ä¾›å•†æˆ·æ‰«ç 
- å®¡æ ¸æµç¨‹: pending(å¾…å®¡æ ¸) â†’ approved(å·²é€šè¿‡)/rejected(å·²æ‹’ç»)
- è½¯åˆ é™¤æ”¯æŒ: æ¶ˆè´¹è®°å½•æ”¯æŒè½¯åˆ é™¤å’Œæ¢å¤
- ç§¯åˆ†å‘æ”¾: å®¡æ ¸é€šè¿‡åè‡ªåŠ¨å‘æ”¾ç§¯åˆ†åˆ°ç”¨æˆ·è´¦æˆ·

---

### 6.1 æäº¤æ¶ˆè´¹è®°å½• âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/consumption/submit`  
**æè¿°**: å•†æˆ·æäº¤ç”¨æˆ·æ¶ˆè´¹è®°å½•(éœ€è¦ç®¡ç†å‘˜å®¡æ ¸)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·(æ¨èå•†æˆ·è§’è‰²)

**è¯·æ±‚ä½“**:
```json
{
  "user_qrcode": "USER_QR_CODE_STRING",  // ç”¨æˆ·QRç (å¿…å¡«)
  "amount": 50,                          // æ¶ˆè´¹é‡‘é¢(å¿…å¡«)
  "description": "åˆé¤æ¶ˆè´¹",              // æ¶ˆè´¹æè¿°(å¯é€‰)
  "merchant_name": "XXé¤å…"              // å•†æˆ·åç§°(å¯é€‰)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¶ˆè´¹è®°å½•æäº¤æˆåŠŸ",
  "data": {
    "record_id": "cons_20251102_abc123",
    "user_id": 1,
    "amount": 50,
    "status": "pending",           // pending/approved/rejected
    "submitted_at": "2025-11-02 14:30:00"
  }
}
```

---

### 6.2 è·å–ç”¨æˆ·æ¶ˆè´¹è®°å½• âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/consumption/user/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·çš„æ¶ˆè´¹è®°å½•åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: æŸ¥çœ‹è‡ªå·±çš„è®°å½•æˆ–ç®¡ç†å‘˜æŸ¥çœ‹ä»–äººè®°å½•

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "records": [
      {
        "record_id": "cons_20251102_abc123",
        "amount": 50,
        "description": "åˆé¤æ¶ˆè´¹",
        "merchant_name": "XXé¤å…",
        "status": "approved",
        "points_awarded": 50,
        "submitted_at": "2025-11-02 14:30:00",
        "reviewed_at": "2025-11-02 15:00:00"
      }
    ],
    "total_count": 50
  }
}
```

---

### 6.3 è·å–æ¶ˆè´¹è®°å½•è¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/consumption/detail/:record_id`  
**æè¿°**: è·å–å•æ¡æ¶ˆè´¹è®°å½•çš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: è®°å½•æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "record_id": "cons_20251102_abc123",
    "user_id": 1,
    "amount": 50,
    "description": "åˆé¤æ¶ˆè´¹",
    "merchant_name": "XXé¤å…",
    "status": "approved",
    "points_awarded": 50,
    "submitted_at": "2025-11-02 14:30:00",
    "reviewed_at": "2025-11-02 15:00:00",
    "reviewed_by": 10
  }
}
```

---

### 6.4 è·å–å¾…å®¡æ ¸æ¶ˆè´¹è®°å½• âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/consumption/pending`  
**æè¿°**: è·å–æ‰€æœ‰å¾…å®¡æ ¸çš„æ¶ˆè´¹è®°å½•(ç®¡ç†å‘˜ä¸“ç”¨)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "pending_records": [
      {
        "record_id": "cons_20251102_abc123",
        "user_id": 1,
        "amount": 50,
        "merchant_name": "XXé¤å…",
        "submitted_at": "2025-11-02 14:30:00"
      }
    ],
    "total_pending": 5
  }
}
```

---

### 6.5 ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/consumption/approve/:record_id`  
**æè¿°**: ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡æ¶ˆè´¹è®°å½•å¹¶å‘æ”¾ç§¯åˆ†  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å®¡æ ¸é€šè¿‡",
  "data": {
    "record_id": "cons_20251102_abc123",
    "status": "approved",
    "points_awarded": 50
  }
}
```

---

### 6.6 ç®¡ç†å‘˜å®¡æ ¸æ‹’ç» âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/consumption/reject/:record_id`  
**æè¿°**: ç®¡ç†å‘˜æ‹’ç»æ¶ˆè´¹è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "reason": "æ¶ˆè´¹å‡­è¯ä¸ç¬¦åˆè¦æ±‚"    // æ‹’ç»åŸå› (å¯é€‰)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å·²æ‹’ç»"
}
```

---

### 6.7 ç”Ÿæˆç”¨æˆ·QRç  âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/consumption/qrcode/:user_id`  
**æè¿°**: ç”Ÿæˆç”¨æˆ·ä¸ªäººQRç ä¾›å•†æˆ·æ‰«ç   
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç”¨æˆ·æœ¬äºº

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "qr_code": "USER_QR_CODE_STRING",
    "qr_code_url": "data:image/png;base64,iVBORw0..."
  }
}
```

---

### 6.8 éªŒè¯ç”¨æˆ·QRç  âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/consumption/validate-qrcode`  
**æè¿°**: å•†æˆ·éªŒè¯ç”¨æˆ·QRç æ˜¯å¦æœ‰æ•ˆ  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·(æ¨èå•†æˆ·è§’è‰²)

**è¯·æ±‚ä½“**:
```json
{
  "qr_code": "USER_QR_CODE_STRING"
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "QRç éªŒè¯æˆåŠŸ",
  "data": {
    "valid": true,
    "user_id": 1,
    "user_info": {
      "nickname": "ç”¨æˆ·8000",
      "mobile": "13800138000"
    }
  }
}
```

---

### 6.9 åˆ é™¤æ¶ˆè´¹è®°å½• âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/consumption/:record_id`  
**æè¿°**: è½¯åˆ é™¤æ¶ˆè´¹è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¶ˆè´¹è®°å½•å·²åˆ é™¤"
}
```

---

### 6.10 æ¢å¤æ¶ˆè´¹è®°å½• âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/consumption/:record_id/restore`  
**æè¿°**: æ¢å¤å·²åˆ é™¤çš„æ¶ˆè´¹è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¶ˆè´¹è®°å½•å·²æ¢å¤"
}
```

---

## 7. V4 é«˜çº§ç©ºé—´è§£é” API

**åŸºç¡€è·¯å¾„**: `/api/v4/premium`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/premium.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- åŒé‡æ¡ä»¶éªŒè¯: å†å²ç´¯è®¡ç§¯åˆ†â‰¥10ä¸‡ AND å½“å‰å¯ç”¨ç§¯åˆ†â‰¥100
- å›ºå®šè´¹ç”¨: 100ç§¯åˆ†/æ¬¡
- å›ºå®šæœ‰æ•ˆæœŸ: 24å°æ—¶
- æ‰‹åŠ¨è§£é”: æ— è‡ªåŠ¨ç»­è´¹ï¼Œè¿‡æœŸéœ€é‡æ–°è§£é”
- äº‹åŠ¡å®‰å…¨: ç§¯åˆ†æ‰£é™¤å’ŒçŠ¶æ€æ›´æ–°åŸå­æ€§ä¿è¯

---

### 7.1 è§£é”é«˜çº§ç©ºé—´ âœ…

**è·¯å¾„**: `POST /api/v4/premium/unlock`  
**æè¿°**: ç”¨æˆ·æ”¯ä»˜100ç§¯åˆ†è§£é”é«˜çº§ç©ºé—´ï¼Œæœ‰æ•ˆæœŸ24å°æ—¶  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è§£é”æ¡ä»¶(åŒé‡ANDå…³ç³»)**:
- æ¡ä»¶1: å†å²ç´¯è®¡ç§¯åˆ† â‰¥ 100,000 (è¯†åˆ«é«˜çº§ç”¨æˆ·èµ„æ ¼)
- æ¡ä»¶2: å½“å‰å¯ç”¨ç§¯åˆ† â‰¥ 100 (æ”¯ä»˜è§£é”è´¹ç”¨)

**è¯·æ±‚ä½“**: æ— éœ€è¯·æ±‚ä½“(ä»Tokenè·å–user_id)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "é«˜çº§ç©ºé—´è§£é”æˆåŠŸ",
  "error_code": "UNLOCK_SUCCESS",
  "data": {
    "success": true,
    "unlocked": true,
    "is_first_unlock": false,           // æ˜¯å¦é¦–æ¬¡è§£é”
    "unlock_time": "2025-11-02 14:30:00",
    "expires_at": "2025-11-03 14:30:00", // è¿‡æœŸæ—¶é—´(24å°æ—¶å)
    "remaining_hours": 24,
    "cost": 100,                        // è§£é”è´¹ç”¨
    "remaining_balance": 900,           // å‰©ä½™ç§¯åˆ†
    "transaction_id": "tx_20251102_premium_abc123"
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 INSUFFICIENT_HISTORY_POINTS`: å†å²ç´¯è®¡ç§¯åˆ†ä¸è¶³10ä¸‡
  ```json
  {
    "code": 403,
    "error_code": "INSUFFICIENT_HISTORY_POINTS",
    "message": "å†å²ç´¯è®¡ç§¯åˆ†ä¸è¶³ï¼Œéœ€è¦è¾¾åˆ°100,000ç§¯åˆ†",
    "data": {
      "current_history_points": 50000,
      "required_history_points": 100000,
      "gap": 50000
    }
  }
  ```
- `403 INSUFFICIENT_POINTS`: å½“å‰ç§¯åˆ†ä½™é¢ä¸è¶³
  ```json
  {
    "code": 403,
    "error_code": "INSUFFICIENT_POINTS",
    "message": "å½“å‰ç§¯åˆ†ä¸è¶³ï¼Œæ— æ³•è§£é”",
    "data": {
      "current_balance": 50,
      "required_points": 100,
      "shortage": 50
    }
  }
  ```
- `409 ALREADY_UNLOCKED`: å·²åœ¨æœ‰æ•ˆæœŸå†…ï¼Œæ— éœ€é‡å¤è§£é”
  ```json
  {
    "code": 409,
    "error_code": "ALREADY_UNLOCKED",
    "message": "æ‚¨çš„é«˜çº§ç©ºé—´è®¿é—®æƒé™ä»åœ¨æœ‰æ•ˆæœŸå†…ï¼Œæ— éœ€é‡å¤è§£é”",
    "data": {
      "unlocked": true,
      "expires_at": "2025-11-03 14:30:00",
      "remaining_hours": 12
    }
  }
  ```

---

### 7.2 æŸ¥è¯¢è§£é”çŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/premium/status`  
**æè¿°**: æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„é«˜çº§ç©ºé—´è§£é”çŠ¶æ€  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”(å·²è§£é”ä¸”åœ¨æœ‰æ•ˆæœŸå†…)**:
```json
{
  "code": 200,
  "data": {
    "unlocked": true,
    "is_valid": true,                   // æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…
    "unlock_time": "2025-11-02 14:30:00",
    "expires_at": "2025-11-03 14:30:00",
    "remaining_hours": 12,
    "can_unlock": false,                // å½“å‰æ˜¯å¦å¯è§£é”
    "user_stats": {
      "history_total_points": 150000,  // å†å²ç´¯è®¡ç§¯åˆ†
      "available_points": 900,         // å½“å‰å¯ç”¨ç§¯åˆ†
      "meets_history_requirement": true,
      "meets_balance_requirement": true
    }
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

**æˆåŠŸå“åº”(æœªè§£é”æˆ–å·²è¿‡æœŸ)**:
```json
{
  "code": 200,
  "data": {
    "unlocked": false,
    "is_valid": false,
    "can_unlock": true,                 // å¯ä»¥è§£é”
    "last_unlock_time": "2025-11-01 14:30:00",
    "last_expires_at": "2025-11-02 14:30:00",
    "user_stats": {
      "history_total_points": 150000,
      "available_points": 500,
      "meets_history_requirement": true,
      "meets_balance_requirement": true
    }
  },
  "timestamp": "2025-11-02 14:30:00"
}
```

---

## 8. V4 æŠ½å¥–ç»“æœé¢„è®¾ç®¡ç† API

**åŸºç¡€è·¯å¾„**: `/api/v4/lottery-preset`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/lottery-preset.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- è¿è¥å¹²é¢„åŠŸèƒ½: ç®¡ç†å‘˜ä¸ºç‰¹å®šç”¨æˆ·é¢„è®¾æŠ½å¥–ç»“æœ
- é˜Ÿåˆ—æœºåˆ¶: æŒ‰queue_orderé¡ºåºæ¶ˆè´¹é¢„è®¾ç»“æœ
- ç”¨æˆ·æ— æ„ŸçŸ¥: ç”¨æˆ·æŠ½å¥–æ—¶è‡ªåŠ¨ä½¿ç”¨é¢„è®¾ç»“æœï¼Œä½“éªŒæ— å·®å¼‚
- ç®¡ç†å‘˜ä¸“ç”¨: æ‰€æœ‰APIä»…ç®¡ç†å‘˜å¯è®¿é—®

---

### 8.1 åˆ›å»ºæŠ½å¥–ç»“æœé¢„è®¾ âœ…

**è·¯å¾„**: `POST /api/v4/lottery-preset/create`  
**æè¿°**: ç®¡ç†å‘˜ä¸ºæŒ‡å®šç”¨æˆ·åˆ›å»ºæŠ½å¥–ç»“æœé¢„è®¾é˜Ÿåˆ—  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                        // ç›®æ ‡ç”¨æˆ·ID(å¿…å¡«)
  "presets": [                         // é¢„è®¾é˜Ÿåˆ—(å¿…å¡«)
    {
      "prize_id": 5,                   // å¥–å“ID
      "queue_order": 1                 // é˜Ÿåˆ—é¡ºåº(ä»1å¼€å§‹)
    },
    {
      "prize_id": 3,
      "queue_order": 2
    }
  ]
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æŠ½å¥–é¢„è®¾åˆ›å»ºæˆåŠŸ",
  "data": {
    "user_id": 1,
    "presets_count": 2,
    "created_presets": [
      {
        "preset_id": 1,
        "prize_id": 5,
        "queue_order": 1,
        "status": "pending"
      }
    ]
  }
}
```

---

### 8.2 æŸ¥çœ‹ç”¨æˆ·é¢„è®¾é˜Ÿåˆ— âœ…

**è·¯å¾„**: `GET /api/v4/lottery-preset/user/:user_id`  
**æè¿°**: æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æŠ½å¥–é¢„è®¾é˜Ÿåˆ—  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "user_id": 1,
    "presets": [
      {
        "preset_id": 1,
        "prize_id": 5,
        "prize_name": "100ç§¯åˆ†",
        "queue_order": 1,
        "status": "pending",           // pending/used
        "created_at": "2025-11-02 14:30:00"
      }
    ],
    "total_count": 2,
    "pending_count": 1,
    "used_count": 1
  }
}
```

---

### 8.3 åˆ é™¤ç”¨æˆ·é¢„è®¾é˜Ÿåˆ— âœ…

**è·¯å¾„**: `DELETE /api/v4/lottery-preset/user/:user_id`  
**æè¿°**: åˆ é™¤æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰é¢„è®¾é˜Ÿåˆ—  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "é¢„è®¾é˜Ÿåˆ—å·²åˆ é™¤"
}
```

---

### 8.4 è·å–é¢„è®¾ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/lottery-preset/stats`  
**æè¿°**: è·å–é¢„è®¾é˜Ÿåˆ—çš„ç»Ÿè®¡ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "total_users_with_presets": 10,
    "total_presets": 50,
    "pending_presets": 25,
    "used_presets": 25
  }
}
```

---

## 9. V4 ç³»ç»ŸåŠŸèƒ½ API

**åŸºç¡€è·¯å¾„**: `/api/v4/system`  
**å®ç°æ–‡ä»¶**: `routes/v4/system.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- ç³»ç»Ÿå…¬å‘Šç®¡ç†: å…¬å‘Šå‘å¸ƒå’Œé¦–é¡µå±•ç¤º
- ç”¨æˆ·åé¦ˆç³»ç»Ÿ: ç”¨æˆ·æäº¤åé¦ˆï¼ŒæŸ¥çœ‹åé¦ˆå†å²
- å®¢æœèŠå¤©ç³»ç»Ÿ: ç”¨æˆ·ä¸ç®¡ç†å‘˜å®æ—¶èŠå¤©(WebSocketæ”¯æŒ)
- ç³»ç»ŸçŠ¶æ€ç›‘æ§: å¥åº·æ£€æŸ¥å’Œè¿è¡ŒçŠ¶æ€
- ä¸šåŠ¡é…ç½®æŸ¥è¯¢: è·å–ç³»ç»Ÿä¸šåŠ¡é…ç½®ä¿¡æ¯

---

### 9.1 è·å–ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/system/announcements`  
**æè¿°**: è·å–æ‰€æœ‰ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "announcements": [
      {
        "announcement_id": 1,
        "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",
        "content": "ç³»ç»Ÿå°†äº...",
        "type": "maintenance",
        "is_active": true,
        "priority": 1,
        "created_at": "2025-11-02 10:00:00"
      }
    ]
  }
}
```

---

### 9.2 è·å–é¦–é¡µå…¬å‘Š âœ…

**è·¯å¾„**: `GET /api/v4/system/announcements/home`  
**æè¿°**: è·å–é¦–é¡µæ˜¾ç¤ºçš„å…¬å‘Š(ä»…é«˜ä¼˜å…ˆçº§å·²å¯ç”¨)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "announcements": [
      {
        "announcement_id": 1,
        "title": "æ˜¥èŠ‚æ´»åŠ¨é€šçŸ¥",
        "content": "æ˜¥èŠ‚æœŸé—´...",
        "type": "event"
      }
    ]
  }
}
```

---

### 9.3 æäº¤ç”¨æˆ·åé¦ˆ âœ…

**è·¯å¾„**: `POST /api/v4/system/feedback`  
**æè¿°**: ç”¨æˆ·æäº¤åé¦ˆæˆ–å»ºè®®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "content": "å»ºè®®å¢åŠ æ›´å¤šå¥–å“",       // åé¦ˆå†…å®¹(å¿…å¡«)
  "type": "suggestion",              // ç±»å‹: bug/suggestion/question
  "contact": "13800138000"           // è”ç³»æ–¹å¼(å¯é€‰)
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "åé¦ˆæäº¤æˆåŠŸ",
  "data": {
    "feedback_id": 1,
    "status": "pending"
  }
}
```

---

### 9.4 è·å–ç³»ç»ŸçŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/system/status`  
**æè¿°**: è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œå¥åº·ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "status": "healthy",
    "timestamp": "2025-11-02 14:30:00",
    "services": {
      "database": "connected",
      "websocket": "running"
    },
    "uptime": 345600
  }
}
```

---

### 9.5 è·å–ä¸šåŠ¡é…ç½® âœ…

**è·¯å¾„**: `GET /api/v4/system/business-config`  
**æè¿°**: è·å–ç³»ç»Ÿä¸šåŠ¡é…ç½®(æŠ½å¥–è§„åˆ™ã€ç§¯åˆ†è§„åˆ™ç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "lottery_config": {
      "min_draw_cost": 100,
      "max_continuous_draws": 10
    },
    "points_config": {
      "consumption_rate": 0.1
    }
  }
}
```

---

### 9.6 è·å–æˆ‘çš„åé¦ˆåˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/system/feedback/my`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·æäº¤çš„åé¦ˆåˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æŸ¥è¯¢å‚æ•°**:
- `status`: åé¦ˆçŠ¶æ€è¿‡æ»¤(pending/processing/resolved/rejected/all)ï¼Œé»˜è®¤all
- `limit`: æ¯é¡µæ•°é‡ï¼Œæœ€å¤§50ï¼Œé»˜è®¤10
- `offset`: åç§»é‡ï¼Œé»˜è®¤0

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–åé¦ˆåˆ—è¡¨æˆåŠŸ",
  "data": {
    "feedbacks": [
      {
        "feedback_id": 1,
        "category": "suggestion",
        "content": "å»ºè®®å¢åŠ æ›´å¤šå¥–å“",
        "status": "pending",
        "priority": "medium",
        "created_at": "2025-11-02 10:00:00",
        "updated_at": "2025-11-02 10:00:00",
        "admin": null
      }
    ],
    "total": 5
  }
}
```

---

### 9.7 è·å–åé¦ˆè¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/system/feedback/:id`  
**æè¿°**: è·å–å•ä¸ªåé¦ˆçš„è¯¦ç»†ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„åé¦ˆï¼Œç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰åé¦ˆ

**è·¯å¾„å‚æ•°**:
- `id`: åé¦ˆID

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–åé¦ˆè¯¦æƒ…æˆåŠŸ",
  "data": {
    "feedback_id": 1,
    "category": "bug",
    "content": "æŠ½å¥–æŒ‰é’®ç‚¹å‡»æ— ååº”",
    "attachments": [],
    "status": "processing",
    "priority": "high",
    "user": {
      "user_id": 1001,
      "nickname": "ç”¨æˆ·001",
      "mobile": "138****0001"
    },
    "admin": {
      "user_id": 1,
      "nickname": "ç®¡ç†å‘˜"
    },
    "admin_reply": "æˆ‘ä»¬æ­£åœ¨å¤„ç†æ­¤é—®é¢˜",
    "created_at": "2025-11-02 10:00:00",
    "updated_at": "2025-11-02 11:00:00",
    "reply_at": "2025-11-02 11:00:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `404 FEEDBACK_NOT_FOUND`: åé¦ˆä¸å­˜åœ¨
- `403 ACCESS_DENIED`: æ— æƒé™æŸ¥çœ‹æ­¤åé¦ˆ

---

### 9.8 åˆ›å»ºèŠå¤©ä¼šè¯ âœ…

**è·¯å¾„**: `POST /api/v4/system/chat/create`  
**æè¿°**: ç”¨æˆ·åˆ›å»ºä¸å®¢æœçš„èŠå¤©ä¼šè¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**è¯·æ±‚ä½“**: æ— éœ€è¯·æ±‚ä½“(è‡ªåŠ¨ä»Tokenè·å–user_id)

**æˆåŠŸå“åº”(åˆ›å»ºæ–°ä¼šè¯)**:
```json
{
  "code": 200,
  "message": "èŠå¤©ä¼šè¯åˆ›å»ºæˆåŠŸ",
  "data": {
    "session_id": 12345,
    "status": "waiting",
    "source": "mobile",
    "created_at": "2025-11-02 14:30:00"
  }
}
```

**æˆåŠŸå“åº”(ä½¿ç”¨ç°æœ‰ä¼šè¯)**:
```json
{
  "code": 200,
  "message": "ä½¿ç”¨ç°æœ‰ä¼šè¯",
  "data": {
    "session_id": 12344,
    "status": "active",
    "source": "mobile",
    "created_at": "2025-11-02 10:00:00"
  }
}
```

**ä¸šåŠ¡è§„åˆ™**:
- å¦‚æœç”¨æˆ·å·²æœ‰æœªå…³é—­çš„ä¼šè¯(waiting/assigned/activeçŠ¶æ€)ï¼Œè¿”å›ç°æœ‰ä¼šè¯
- æ–°ä¼šè¯åˆå§‹çŠ¶æ€ä¸ºwaiting(ç­‰å¾…å®¢æœæ¥å•)

---

### 9.9 è·å–èŠå¤©ä¼šè¯åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/system/chat/sessions`  
**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„èŠå¤©ä¼šè¯åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ä¼šè¯åˆ—è¡¨æˆåŠŸ",
  "data": {
    "sessions": [
      {
        "session_id": 12345,
        "type": "customer_service",
        "status": "active",
        "created_at": "2025-11-02 14:30:00",
        "last_message": {
          "content": "æ‚¨å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ",
          "sender_type": "admin",
          "created_at": "2025-11-02 14:31:00"
        },
        "unread_count": 0
      }
    ]
  }
}
```

---

### 9.10 è·å–èŠå¤©å†å²è®°å½• âœ…

**è·¯å¾„**: `GET /api/v4/system/chat/history/:sessionId`  
**æè¿°**: è·å–æŒ‡å®šä¼šè¯çš„èŠå¤©å†å²è®°å½•  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¼šè¯å†å²

**è·¯å¾„å‚æ•°**:
- `sessionId`: ä¼šè¯ID

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼Œé»˜è®¤1
- `limit`: æ¯é¡µæ•°é‡ï¼Œæœ€å¤§100ï¼Œé»˜è®¤50

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–èŠå¤©å†å²æˆåŠŸ",
  "data": {
    "messages": [
      {
        "message_id": 101,
        "session_id": 12345,
        "sender_id": 1001,
        "sender_type": "user",
        "content": "ä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹ç§¯åˆ†è§„åˆ™",
        "message_type": "text",
        "created_at": "2025-11-02 14:30:00"
      },
      {
        "message_id": 102,
        "session_id": 12345,
        "sender_id": 1,
        "sender_type": "admin",
        "content": "æ‚¨å¥½ï¼Œç§¯åˆ†è§„åˆ™æ˜¯...",
        "message_type": "text",
        "created_at": "2025-11-02 14:31:00"
      }
    ],
    "total": 25,
    "page": 1,
    "limit": 50
  }
}
```

**é”™è¯¯å“åº”**:
- `404 SESSION_NOT_FOUND`: ä¼šè¯ä¸å­˜åœ¨æˆ–æ— æƒé™è®¿é—®

---

### 9.11 å‘é€èŠå¤©æ¶ˆæ¯ âœ…

**è·¯å¾„**: `POST /api/v4/system/chat/send`  
**æè¿°**: ç”¨æˆ·å‘å®¢æœå‘é€èŠå¤©æ¶ˆæ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·ï¼Œä¸”ä¼šè¯å±äºè¯¥ç”¨æˆ·

**è¯·æ±‚ä½“**:
```json
{
  "session_id": 12345,              // ä¼šè¯ID(å¿…å¡«)
  "content": "æˆ‘æƒ³å’¨è¯¢ç§¯åˆ†è§„åˆ™",    // æ¶ˆæ¯å†…å®¹(å¿…å¡«ï¼Œæœ€å¤§5000å­—ç¬¦)
  "message_type": "text"            // æ¶ˆæ¯ç±»å‹ï¼Œé»˜è®¤text
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "message_id": 101,
    "session_id": 12345,
    "content": "æˆ‘æƒ³å’¨è¯¢ç§¯åˆ†è§„åˆ™",
    "message_type": "text",
    "sent_at": "2025-11-02 14:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 INVALID_INPUT`: ä¼šè¯IDæˆ–å†…å®¹ä¸ºç©ºï¼Œæˆ–å†…å®¹è¶…è¿‡5000å­—ç¬¦
- `404 SESSION_NOT_FOUND`: ä¼šè¯ä¸å­˜åœ¨æˆ–æ— æƒé™è®¿é—®
- `400 SESSION_CLOSED`: ä¼šè¯å·²å…³é—­ï¼Œæ— æ³•å‘é€æ¶ˆæ¯

**ä¸šåŠ¡è§„åˆ™**:
- åªæœ‰waiting/assigned/activeçŠ¶æ€çš„ä¼šè¯å¯ä»¥å‘é€æ¶ˆæ¯
- æ¶ˆæ¯é€šè¿‡WebSocketå®æ—¶æ¨é€ç»™å®¢æœ
- å¦‚æœå®¢æœä¸åœ¨çº¿ï¼Œæ¶ˆæ¯ä»ä¿å­˜åˆ°æ•°æ®åº“

---

### 9.12 ç®¡ç†å‘˜å›å¤æ¶ˆæ¯ âœ…

**è·¯å¾„**: `POST /api/v4/system/chat/admin-reply`  
**æè¿°**: ç®¡ç†å‘˜å›å¤ç”¨æˆ·æ¶ˆæ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜(role_level >= 100)

**è¯·æ±‚ä½“**:
```json
{
  "session_id": 12345,              // ä¼šè¯ID(å¿…å¡«)
  "content": "ç§¯åˆ†è§„åˆ™æ˜¯...",       // æ¶ˆæ¯å†…å®¹(å¿…å¡«ï¼Œæœ€å¤§5000å­—ç¬¦)
  "message_type": "text"            // æ¶ˆæ¯ç±»å‹ï¼Œé»˜è®¤text
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "message_id": 102,
    "session_id": 12345,
    "content": "ç§¯åˆ†è§„åˆ™æ˜¯...",
    "message_type": "text",
    "sent_at": "2025-11-02 14:31:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `400 INVALID_INPUT`: å‚æ•°é”™è¯¯
- `404 SESSION_NOT_FOUND`: ä¼šè¯ä¸å­˜åœ¨
- `400 SESSION_CLOSED`: ä¼šè¯å·²å…³é—­
- `403 ASSIGNED_TO_OTHER`: ä¼šè¯å·²åˆ†é…ç»™å…¶ä»–å®¢æœ

**ä¸šåŠ¡è§„åˆ™**:
- å¦‚æœä¼šè¯æœªåˆ†é…ï¼Œè‡ªåŠ¨åˆ†é…ç»™å½“å‰ç®¡ç†å‘˜
- å¦‚æœä¼šè¯å·²åˆ†é…ç»™å…¶ä»–ç®¡ç†å‘˜ï¼Œéœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™æ‰èƒ½å›å¤
- æ¶ˆæ¯é€šè¿‡WebSocketå®æ—¶æ¨é€ç»™ç”¨æˆ·

---

### 9.13 è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ® âœ…

**è·¯å¾„**: `GET /api/v4/system/user/statistics/:user_id`  
**æè¿°**: è·å–ç”¨æˆ·ä¸ªäººç»Ÿè®¡æ•°æ®(æŠ½å¥–ã€ç§¯åˆ†ã€åº“å­˜ã€å…‘æ¢ã€æ¶ˆè´¹ç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ç»Ÿè®¡ï¼Œç®¡ç†å‘˜å¯æŸ¥çœ‹ä»»ä½•ç”¨æˆ·

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·ID

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç»Ÿè®¡æ•°æ®æˆåŠŸ",
  "data": {
    "user_id": 1001,
    "account_created": "2025-01-01 10:00:00",
    "last_activity": "2025-11-02 14:30:00",
    
    "lottery_count": 150,
    "lottery_wins": 45,
    "lottery_win_rate": "30.0%",
    
    "inventory_total": 30,
    "inventory_available": 20,
    
    "total_points_earned": 150000,
    "total_points_consumed": 50000,
    "points_balance": 100000,
    "transaction_count": 200,
    
    "exchange_count": 10,
    "exchange_points_spent": 5000,
    
    "consumption_count": 5,
    "consumption_total_amount": 1000,
    "consumption_total_points": 100
  }
}
```

**é”™è¯¯å“åº”**:
- `403 ACCESS_DENIED`: æ— æƒé™æŸ¥çœ‹å…¶ä»–ç”¨æˆ·ç»Ÿè®¡
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨

**æ•°æ®è¯´æ˜**:
- æ‰€æœ‰ç»Ÿè®¡æ•°æ®è‡ªåŠ¨æ’é™¤å·²åˆ é™¤çš„è®°å½•(is_deleted=0)
- ç§¯åˆ†ä½™é¢ = ç´¯è®¡è·å¾— - ç´¯è®¡æ¶ˆè´¹

---

### 9.14 è·å–ç®¡ç†å‘˜ç³»ç»Ÿæ¦‚è§ˆ âœ…

**è·¯å¾„**: `GET /api/v4/system/admin/overview`  
**æè¿°**: è·å–ç³»ç»Ÿè¿è¥æ¦‚è§ˆæ•°æ®(ç”¨æˆ·ã€æŠ½å¥–ã€ç§¯åˆ†ã€ç³»ç»Ÿå¥åº·ç­‰)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç³»ç»Ÿæ¦‚è§ˆæˆåŠŸ",
  "data": {
    "overview": {
      "timestamp": "2025-11-02 14:30:00",
      
      "users": {
        "total": 10000,
        "new_today": 50,
        "active_24h": 500
      },
      
      "lottery": {
        "total_draws": 500000,
        "draws_today": 1000,
        "total_wins": 150000,
        "win_rate": "30.0%"
      },
      
      "points": {
        "total_issued": 50000000,
        "total_consumed": 20000000,
        "transactions_today": 500,
        "circulation_rate": "40.0%"
      },
      
      "system": {
        "uptime_hours": 720,
        "memory_used_mb": 512,
        "memory_total_mb": 2048,
        "node_version": "v18.18.0",
        "status": "healthy"
      }
    }
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: éœ€è¦ç®¡ç†å‘˜æƒé™

**æ•°æ®è¯´æ˜**:
- æ‰€æœ‰ç»Ÿè®¡æ•°æ®å®æ—¶è®¡ç®—
- ç§¯åˆ†ç»Ÿè®¡è‡ªåŠ¨æ’é™¤å·²åˆ é™¤çš„è®°å½•

---

### 9.15 ç®¡ç†å‘˜è·å–èŠå¤©ä¼šè¯åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/system/admin/chat/sessions`  
**æè¿°**: ç®¡ç†å‘˜è·å–æ‰€æœ‰èŠå¤©ä¼šè¯åˆ—è¡¨(æ”¯æŒè¿‡æ»¤å’Œåˆ†é¡µ)  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼Œé»˜è®¤1
- `limit`: æ¯é¡µæ•°é‡ï¼Œæœ€å¤§100ï¼Œé»˜è®¤20
- `status`: ä¼šè¯çŠ¶æ€è¿‡æ»¤(waiting/assigned/active/closed/all)ï¼Œé»˜è®¤all
- `type`: ä¼šè¯ç±»å‹è¿‡æ»¤(é»˜è®¤all)

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–èŠå¤©ä¼šè¯åˆ—è¡¨æˆåŠŸ",
  "data": {
    "sessions": [
      {
        "session_id": 12345,
        "user_id": 1001,
        "user": {
          "user_id": 1001,
          "nickname": "ç”¨æˆ·001",
          "mobile": "138****0001"
        },
        "admin_id": 1,
        "admin": {
          "user_id": 1,
          "nickname": "å®¢æœ001"
        },
        "type": "customer_service",
        "status": "active",
        "source": "mobile",
        "priority": 1,
        "created_at": "2025-11-02 14:00:00",
        "last_message_at": "2025-11-02 14:30:00",
        "last_message": {
          "content": "è°¢è°¢æ‚¨çš„è§£ç­”",
          "sender_type": "user",
          "created_at": "2025-11-02 14:30:00"
        }
      }
    ],
    "total": 150,
    "page": 1,
    "limit": 20,
    "totalPages": 8
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®

---

### 9.16 ç®¡ç†å‘˜åˆ†é…èŠå¤©ä¼šè¯ âœ…

**è·¯å¾„**: `PUT /api/v4/system/admin/chat/sessions/:sessionId/assign`  
**æè¿°**: ç®¡ç†å‘˜åˆ†é…èŠå¤©ä¼šè¯ç»™ç‰¹å®šå®¢æœ  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜

**è·¯å¾„å‚æ•°**:
- `sessionId`: ä¼šè¯ID

**è¯·æ±‚ä½“**:
```json
{
  "admin_id": 2  // å®¢æœIDï¼Œä¼ nullè¡¨ç¤ºå–æ¶ˆåˆ†é…
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ä¼šè¯åˆ†é…æˆåŠŸ",
  "data": {
    "session_id": 12345,
    "admin_id": 2,
    "status": "assigned"
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®
- `404 SESSION_NOT_FOUND`: èŠå¤©ä¼šè¯ä¸å­˜åœ¨

**ä¸šåŠ¡è§„åˆ™**:
- åˆ†é…å®¢æœåï¼Œä¼šè¯çŠ¶æ€è‡ªåŠ¨å˜ä¸ºassigned
- å–æ¶ˆåˆ†é…(admin_idä¸ºnull)åï¼Œä¼šè¯çŠ¶æ€å˜ä¸ºwaiting

---

### 9.17 ç®¡ç†å‘˜å…³é—­èŠå¤©ä¼šè¯ âœ…

**è·¯å¾„**: `PUT /api/v4/system/admin/chat/sessions/:sessionId/close`  
**æè¿°**: ç®¡ç†å‘˜å…³é—­èŠå¤©ä¼šè¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜

**è·¯å¾„å‚æ•°**:
- `sessionId`: ä¼šè¯ID

**è¯·æ±‚ä½“**:
```json
{
  "close_reason": "é—®é¢˜å·²è§£å†³"  // å…³é—­åŸå› (å¯é€‰)ï¼Œé»˜è®¤"ç®¡ç†å‘˜å…³é—­"
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ä¼šè¯å…³é—­æˆåŠŸ",
  "data": {
    "session_id": 12345,
    "status": "closed",
    "closed_at": "2025-11-02 15:00:00",
    "close_reason": "é—®é¢˜å·²è§£å†³"
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®
- `404 SESSION_NOT_FOUND`: èŠå¤©ä¼šè¯ä¸å­˜åœ¨
- `400 SESSION_ALREADY_CLOSED`: ä¼šè¯å·²å…³é—­

**ä¸šåŠ¡è§„åˆ™**:
- å…³é—­ä¼šè¯åè‡ªåŠ¨æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯è®°å½•
- å…³é—­çš„ä¼šè¯æ— æ³•å†å‘é€æ¶ˆæ¯

---

### 9.18 ç®¡ç†å‘˜è·å–èŠå¤©ç»Ÿè®¡ âœ…

**è·¯å¾„**: `GET /api/v4/system/admin/chat/stats`  
**æè¿°**: ç®¡ç†å‘˜è·å–èŠå¤©ç³»ç»Ÿç»Ÿè®¡æ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–èŠå¤©ç»Ÿè®¡æˆåŠŸ",
  "data": {
    "statistics": {
      "total_sessions": 1500,
      "active_sessions": 25,
      "today_sessions": 50,
      "today_messages": 500,
      "today_closed_sessions": 40,
      "waiting_sessions": 5,
      "sessions_by_status": {
        "waiting": 5,
        "assigned": 10,
        "active": 10,
        "closed": 1475
      },
      "timestamp": "2025-11-02 15:00:00"
    }
  }
}
```

**é”™è¯¯å“åº”**:
- `403 PERMISSION_DENIED`: æƒé™ä¸è¶³ï¼Œä»…ç®¡ç†å‘˜å¯è®¿é—®

**æ•°æ®è¯´æ˜**:
- ä»Šæ—¥æ•°æ®ç»Ÿè®¡åŸºäºåŒ—äº¬æ—¶é—´0ç‚¹åˆ°å½“å‰æ—¶é—´
- å®æ—¶ç»Ÿè®¡æ‰€æœ‰ä¼šè¯çŠ¶æ€åˆ†å¸ƒ

---

### 9.19 è·å–WebSocketæœåŠ¡çŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/system/chat/ws-status`  
**æè¿°**: è·å–WebSocketæœåŠ¡è¿è¡ŒçŠ¶æ€å’Œåœ¨çº¿ç”¨æˆ·ç»Ÿè®¡  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: å·²è®¤è¯ç”¨æˆ·

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "WebSocketæœåŠ¡çŠ¶æ€",
  "data": {
    "status": "running",
    "connections": 150,
    "uptime": 720,
    "onlineUsers": [1001, 1002, 1003],
    "onlineAdmins": [1, 2]
  }
}
```

**æ•°æ®è¯´æ˜**:
- `connections`: å½“å‰WebSocketè¿æ¥æ•°
- `uptime`: WebSocketæœåŠ¡è¿è¡Œæ—¶é•¿(å°æ—¶)
- `onlineUsers`: åœ¨çº¿æ™®é€šç”¨æˆ·IDåˆ—è¡¨
- `onlineAdmins`: åœ¨çº¿å®¢æœIDåˆ—è¡¨

---

## 10. V4 ç»Ÿä¸€ç®¡ç†å¼•æ“ API

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/`(æ¨¡å—åŒ–ç›®å½•)  
**æ ¸å¿ƒæœºåˆ¶**:
- æ¨¡å—åŒ–ç®¡ç†: åˆ†ä¸º9ä¸ªå­æ¨¡å—ï¼Œå„å¸å…¶èŒ
- ç®¡ç†å‘˜ä¸“ç”¨: æ‰€æœ‰APIä»…ç®¡ç†å‘˜å¯è®¿é—®
- å®Œæ•´å®¡è®¡: æ‰€æœ‰ç®¡ç†æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•
- æ•°æ®åˆ†æ: æä¾›ä¸°å¯Œçš„ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

**å­æ¨¡å—åˆ—è¡¨**:
1. `/auth` - ç®¡ç†å‘˜è®¤è¯
2. `/system` - ç³»ç»Ÿç›‘æ§
3. `/config` - é…ç½®ç®¡ç†
4. `/prize-pool` - å¥–å“æ± ç®¡ç†
5. `/user-management` - ç”¨æˆ·ç®¡ç†
6. `/lottery-management` - æŠ½å¥–ç®¡ç†
7. `/analytics` - æ•°æ®åˆ†æ
8. `/audit` - å…‘æ¢å®¡æ ¸ç®¡ç†
9. `/campaign-permissions` - æ´»åŠ¨æƒé™ç®¡ç†

---

### 10.1 è·å–ç®¡ç†å‘˜æ¨¡å—ä¿¡æ¯ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/`  
**æè¿°**: è·å–ç®¡ç†å‘˜APIæ¨¡å—ä¿¡æ¯å’Œå¯ç”¨ç«¯ç‚¹  
**è®¤è¯è¦æ±‚**: âŒ æ— éœ€è®¤è¯  
**æƒé™è¦æ±‚**: å…¬å¼€æ¥å£

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "data": {
    "name": "Admin API v4.0",
    "description": "ç»Ÿä¸€å†³ç­–å¼•æ“ç®¡ç†å‘˜API",
    "version": "4.0.0",
    "modules": {
      "auth": {
        "description": "ç®¡ç†å‘˜è®¤è¯",
        "endpoints": ["/auth"]
      },
      "system": {
        "description": "ç³»ç»Ÿç›‘æ§",
        "endpoints": ["/status", "/dashboard"]
      }
    },
    "timestamp": "2025-11-02 14:30:00"
  }
}
```

---

### 10.2 ç®¡ç†å‘˜è®¤è¯ âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/auth`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/auth.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- ä¸æ™®é€šç”¨æˆ·è®¤è¯åˆ†ç¦»ï¼šç®¡ç†å‘˜ä½¿ç”¨ä¸“ç”¨è®¤è¯ç«¯ç‚¹
- è§’è‰²çº§åˆ«éªŒè¯ï¼šä»…role_levelâ‰¥100çš„ç”¨æˆ·å¯ç™»å½•ç®¡ç†åå°
- JWT Tokenæœºåˆ¶ï¼šä½¿ç”¨ç›¸åŒçš„accessToken+refreshTokenåŒTokenè®¾è®¡
- æƒé™è‡ªåŠ¨éªŒè¯ï¼šç™»å½•æ—¶è‡ªåŠ¨æ£€æŸ¥ç®¡ç†å‘˜æƒé™

---

#### 10.2.1 ç®¡ç†å‘˜ç™»å½• âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/auth/login`  
**æè¿°**: ç®¡ç†å‘˜ä¸“ç”¨ç™»å½•æ¥å£ï¼Œä»…ç®¡ç†å‘˜è§’è‰²å¯ç™»å½•  
**è®¤è¯è¦æ±‚**: âŒ æ— éœ€è®¤è¯  
**æƒé™è¦æ±‚**: ç”¨æˆ·å¿…é¡»æ‹¥æœ‰role_levelâ‰¥100çš„è§’è‰²

**è¯·æ±‚ä½“**:
```json
{
  "mobile": "13800138000",           // æ‰‹æœºå·ï¼ˆå¿…å¡«ï¼‰
  "verification_code": "123456"      // éªŒè¯ç ï¼ˆå¿…å¡«ï¼Œå¼€å‘ç¯å¢ƒå›ºå®š123456ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç®¡ç†å‘˜ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGc...",    // è®¿é—®Tokenï¼ˆ15åˆ†é’Ÿï¼‰
    "refresh_token": "eyJhbGc...",   // åˆ·æ–°Tokenï¼ˆ7å¤©ï¼‰
    "admin": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç®¡ç†å‘˜",
      "role_level": 100,              // ç®¡ç†å‘˜è§’è‰²çº§åˆ«
      "roles": [
        {
          "role_id": "uuid-admin-001",
          "role_name": "admin",
          "role_level": 100
        }
      ],
      "status": "active",
      "last_login": "2025-11-04 15:30:00"
    },
    "expires_in": 604800,
    "timestamp": "2025-11-04 15:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_PARAMS`: ç¼ºå°‘æ‰‹æœºå·æˆ–éªŒè¯ç 
- `400 INVALID_VERIFICATION_CODE`: éªŒè¯ç é”™è¯¯
- `403 NOT_ADMIN`: è¯¥ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼ˆrole_level<100ï¼‰
- `403 USER_INACTIVE`: ç”¨æˆ·è´¦æˆ·å·²è¢«ç¦ç”¨
- `500 LOGIN_ERROR`: ç™»å½•å¤±è´¥

---

#### 10.2.2 è·å–ç®¡ç†å‘˜ä¿¡æ¯ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/auth/profile`  
**æè¿°**: è·å–å½“å‰ç™»å½•ç®¡ç†å‘˜çš„è¯¦ç»†ä¿¡æ¯ï¼ŒéªŒè¯ç®¡ç†å‘˜èº«ä»½  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™ï¼ˆrole_levelâ‰¥100ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç®¡ç†å‘˜ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "admin": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç®¡ç†å‘˜",
      "role_level": 100,
      "roles": [
        {
          "role_id": "uuid-admin-001",
          "role_name": "admin",
          "role_level": 100,
          "description": "ç®¡ç†å‘˜è§’è‰²"
        }
      ],
      "status": "active",
      "last_login": "2025-11-04 15:30:00",
      "login_count": 150,
      "created_at": "2025-01-01 10:00:00"
    },
    "permissions": [
      "system:manage",
      "user:manage",
      "lottery:manage",
      "points:manage",
      "audit:manage"
    ],
    "timestamp": "2025-11-04 15:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `401 UNAUTHORIZED`: æœªç™»å½•æˆ–Tokenæ— æ•ˆ
- `403 NOT_ADMIN`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_PROFILE_ERROR`: è·å–ä¿¡æ¯å¤±è´¥

---

### 10.3 ç³»ç»Ÿç›‘æ§ âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/system`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/system.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- ç³»ç»ŸçŠ¶æ€ç›‘æ§: å®æ—¶ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œå¥åº·æŒ‡æ ‡
- å…¬å‘Šç®¡ç†: åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ç³»ç»Ÿå…¬å‘Š
- åé¦ˆç®¡ç†: æŸ¥çœ‹å’Œå¤„ç†ç”¨æˆ·åé¦ˆ
- ä»ªè¡¨ç›˜æ•°æ®: æ ¸å¿ƒæ•°æ®æ¦‚è§ˆå’Œç»Ÿè®¡
- ç®¡ç†åå°å¥åº·æ£€æŸ¥: ç¡®ä¿ç®¡ç†ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

**è¯´æ˜**: system.jsåŒ…å«10ä¸ªç®¡ç†ç«¯APIï¼Œä¸»è¦è´Ÿè´£ç³»ç»Ÿç›‘æ§ã€å…¬å‘Šç®¡ç†å’Œåé¦ˆç®¡ç†

---

#### 10.3.1 ç³»ç»ŸçŠ¶æ€æ£€æŸ¥ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/system/status`  
**æè¿°**: è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œå¥åº·ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç³»ç»ŸçŠ¶æ€è·å–æˆåŠŸ",
  "data": {
    "status": "healthy",
    "uptime": "15å¤©3å°æ—¶",
    "timestamp": "2025-11-04 15:30:00",
    "services": {
      "database": "connected",
      "redis": "connected",
      "websocket": "running"
    },
    "version": "4.0.0"
  }
}
```

---

#### 10.3.2 ç®¡ç†ä»ªè¡¨ç›˜ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/system/dashboard`  
**æè¿°**: è·å–ç®¡ç†ä»ªè¡¨ç›˜æ ¸å¿ƒæ•°æ®æ¦‚è§ˆ  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ä»ªè¡¨ç›˜æ•°æ®è·å–æˆåŠŸ",
  "data": {
    "total_users": 1000,
    "active_users_today": 230,
    "total_draws_today": 120,
    "total_points_issued_today": 15000,
    "pending_audits": 5,
    "system_status": "healthy",
    "timestamp": "2025-11-04 15:30:00"
  }
}
```

---

#### 10.3.3 ç®¡ç†ç³»ç»ŸçŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/system/management-status`  
**æè¿°**: ç®¡ç†åå°å¥åº·æ£€æŸ¥  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç®¡ç†ç³»ç»ŸçŠ¶æ€æ­£å¸¸",
  "data": {
    "status": "healthy",
    "admin_services": {
      "auth": "running",
      "system": "running",
      "analytics": "running"
    },
    "timestamp": "2025-11-04 15:30:00"
  }
}
```

---

#### 10.3.4 åˆ›å»ºç³»ç»Ÿå…¬å‘Š âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/system/announcements`  
**æè¿°**: åˆ›å»ºç³»ç»Ÿå…¬å‘Š  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",              // å…¬å‘Šæ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰
  "content": "ç³»ç»Ÿå°†äºä»Šæ™šç»´æŠ¤...",     // å…¬å‘Šå†…å®¹ï¼ˆå¿…å¡«ï¼‰
  "type": "maintenance",              // å…¬å‘Šç±»å‹ï¼ˆå¯é€‰: maintenance/event/noticeï¼‰
  "priority": 1,                      // ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
  "is_active": true                   // æ˜¯å¦å¯ç”¨ï¼ˆå¯é€‰ï¼Œé»˜è®¤trueï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…¬å‘Šåˆ›å»ºæˆåŠŸ",
  "data": {
    "announcement_id": 1,
    "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",
    "type": "maintenance",
    "is_active": true,
    "created_at": "2025-11-04 15:30:00"
  }
}
```

---

#### 10.3.5 è·å–ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/system/announcements`  
**æè¿°**: è·å–æ‰€æœ‰ç³»ç»Ÿå…¬å‘Šåˆ—è¡¨ï¼ˆç®¡ç†å‘˜è§†è§’ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤20ï¼‰
- `is_active`: æ˜¯å¦å¯ç”¨ç­›é€‰ï¼ˆå¯é€‰: true/falseï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…¬å‘Šåˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "announcements": [
      {
        "announcement_id": 1,
        "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",
        "content": "ç³»ç»Ÿå°†äº...",
        "type": "maintenance",
        "is_active": true,
        "priority": 1,
        "created_at": "2025-11-04 15:30:00",
        "updated_at": "2025-11-04 15:30:00"
      }
    ],
    "total": 10,
    "page": 1,
    "limit": 20
  }
}
```

---

#### 10.3.6 æ›´æ–°ç³»ç»Ÿå…¬å‘Š âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/system/announcements/:id`  
**æè¿°**: æ›´æ–°ç³»ç»Ÿå…¬å‘Šä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `id`: å…¬å‘ŠIDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**ï¼ˆæ‰€æœ‰å­—æ®µå¯é€‰ï¼‰:
```json
{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "content": "æ›´æ–°åçš„å†…å®¹",
  "type": "event",
  "priority": 2,
  "is_active": false
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…¬å‘Šæ›´æ–°æˆåŠŸ",
  "data": {
    "announcement_id": 1,
    "updated_fields": ["title", "content", "priority"],
    "updated_at": "2025-11-04 15:30:00"
  }
}
```

---

#### 10.3.7 åˆ é™¤ç³»ç»Ÿå…¬å‘Š âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/admin/system/announcements/:id`  
**æè¿°**: åˆ é™¤ç³»ç»Ÿå…¬å‘Šï¼ˆè½¯åˆ é™¤ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `id`: å…¬å‘ŠIDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å…¬å‘Šåˆ é™¤æˆåŠŸ"
}
```

---

#### 10.3.8 è·å–åé¦ˆåˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/system/feedbacks`  
**æè¿°**: è·å–ç”¨æˆ·åé¦ˆåˆ—è¡¨ï¼ˆç®¡ç†å‘˜è§†è§’ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤20ï¼‰
- `status`: çŠ¶æ€ç­›é€‰ï¼ˆå¯é€‰: pending/processing/resolved/rejectedï¼‰
- `category`: ç±»åˆ«ç­›é€‰ï¼ˆå¯é€‰: bug/suggestion/questionï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "åé¦ˆåˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "feedbacks": [
      {
        "feedback_id": 1,
        "user": {
          "user_id": 1001,
          "nickname": "ç”¨æˆ·001",
          "mobile": "138****0001"
        },
        "category": "bug",
        "content": "æŠ½å¥–æŒ‰é’®æ— å“åº”",
        "status": "pending",
        "priority": "high",
        "created_at": "2025-11-04 15:00:00"
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 20
  }
}
```

---

#### 10.3.9 å›å¤ç”¨æˆ·åé¦ˆ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/system/feedbacks/:id/reply`  
**æè¿°**: ç®¡ç†å‘˜å›å¤ç”¨æˆ·åé¦ˆ  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `id`: åé¦ˆIDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "reply": "æˆ‘ä»¬æ­£åœ¨å¤„ç†æ­¤é—®é¢˜...",     // å›å¤å†…å®¹ï¼ˆå¿…å¡«ï¼‰
  "status": "processing"                // æ›´æ–°çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å›å¤æˆåŠŸ",
  "data": {
    "feedback_id": 1,
    "admin_reply": "æˆ‘ä»¬æ­£åœ¨å¤„ç†æ­¤é—®é¢˜...",
    "status": "processing",
    "reply_at": "2025-11-04 15:30:00"
  }
}
```

---

#### 10.3.10 æ›´æ–°åé¦ˆçŠ¶æ€ âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/system/feedbacks/:id/status`  
**æè¿°**: æ›´æ–°åé¦ˆå¤„ç†çŠ¶æ€  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `id`: åé¦ˆIDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "status": "resolved",                 // æ–°çŠ¶æ€ï¼ˆå¿…å¡«: pending/processing/resolved/rejectedï¼‰
  "note": "é—®é¢˜å·²ä¿®å¤"                  // å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "feedback_id": 1,
    "old_status": "processing",
    "new_status": "resolved",
    "updated_at": "2025-11-04 15:30:00"
  }
}
```

---

### 10.4 é…ç½®ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/config`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/config.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- åŠ¨æ€é…ç½®: æ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡
- é…ç½®éªŒè¯: è‡ªåŠ¨éªŒè¯é…ç½®é¡¹çš„æœ‰æ•ˆæ€§å’Œåˆæ³•æ€§
- é…ç½®å›æ»š: æ”¯æŒé…ç½®å˜æ›´å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- æµ‹è¯•æ¨¡æ‹Ÿ: æä¾›é…ç½®å˜æ›´æ•ˆæœæµ‹è¯•åŠŸèƒ½
- å®Œæ•´å®¡è®¡: è®°å½•æ‰€æœ‰é…ç½®å˜æ›´å†å²

---

#### 10.4.1 æ›´æ–°ç³»ç»Ÿé…ç½® âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/config`  
**æè¿°**: æ›´æ–°ç³»ç»Ÿä¸šåŠ¡é…ç½®å‚æ•°  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "lottery_config": {                    // æŠ½å¥–é…ç½®ï¼ˆå¯é€‰ï¼‰
    "min_draw_cost": 100,
    "max_continuous_draws": 10,
    "default_probability": 0.3
  },
  "points_config": {                     // ç§¯åˆ†é…ç½®ï¼ˆå¯é€‰ï¼‰
    "consumption_rate": 0.1,
    "daily_limit": 10000
  },
  "premium_config": {                    // é«˜çº§ç©ºé—´é…ç½®ï¼ˆå¯é€‰ï¼‰
    "unlock_cost": 100,
    "required_history_points": 100000,
    "validity_hours": 24
  }
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "é…ç½®æ›´æ–°æˆåŠŸ",
  "data": {
    "updated_configs": ["lottery_config", "points_config"],
    "effective_immediately": true,
    "updated_by": 10,
    "updated_at": "2025-11-04 15:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 INVALID_CONFIG`: é…ç½®å‚æ•°éªŒè¯å¤±è´¥
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 CONFIG_UPDATE_ERROR`: é…ç½®æ›´æ–°å¤±è´¥

---

#### 10.4.2 æµ‹è¯•é…ç½®æ¨¡æ‹Ÿ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/config/test/simulate`  
**æè¿°**: æµ‹è¯•é…ç½®å˜æ›´æ•ˆæœï¼Œä¸å®é™…åº”ç”¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "config_changes": {                    // è¦æµ‹è¯•çš„é…ç½®å˜æ›´ï¼ˆå¿…å¡«ï¼‰
    "lottery_config": {
      "default_probability": 0.5
    }
  },
  "test_scenarios": [                    // æµ‹è¯•åœºæ™¯ï¼ˆå¯é€‰ï¼‰
    "user_draw",
    "probability_calculation"
  ]
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "é…ç½®æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆ",
  "data": {
    "simulation_results": {
      "user_draw": {
        "status": "success",
        "before": "æ¦‚ç‡0.3",
        "after": "æ¦‚ç‡0.5",
        "impact": "ä¸­å¥–ç‡æå‡66.7%"
      }
    },
    "warnings": [],
    "recommendation": "é…ç½®å˜æ›´å®‰å…¨ï¼Œå¯ä»¥åº”ç”¨",
    "tested_at": "2025-11-04 15:30:00"
  }
}
```

**é”™è¯¯å“åº”**:
- `400 INVALID_CONFIG`: é…ç½®å‚æ•°éªŒè¯å¤±è´¥
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 SIMULATION_ERROR`: æ¨¡æ‹Ÿæµ‹è¯•å¤±è´¥

---

### 10.5 å¥–å“æ± ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/prize-pool`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/prize_pool.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- æ‰¹é‡å¥–å“æ·»åŠ : æ”¯æŒä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªå¥–å“åˆ°æ´»åŠ¨å¥–å“æ± 
- å¥–å“æ•°é‡ç®¡ç†: è‡ªåŠ¨è·Ÿè¸ªå¥–å“æ€»æ•°å’Œå‰©ä½™æ•°é‡
- æ¦‚ç‡é…ç½®: æ”¯æŒä¸ºæ¯ä¸ªå¥–å“é…ç½®ä¸­å¥–æ¦‚ç‡
- å¥–å“ç±»å‹æ”¯æŒ: æ”¯æŒç§¯åˆ†ã€ä¼˜æƒ åˆ¸ã€å®ç‰©å•†å“ç­‰å¤šç§ç±»å‹
- æ´»åŠ¨å¥–å“æ± æŸ¥è¯¢: æä¾›å®Œæ•´çš„å¥–å“æ± ç»Ÿè®¡å’Œè¯¦æƒ…æŸ¥è¯¢

---

#### 10.5.1 æ‰¹é‡æ·»åŠ å¥–å“ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/prize-pool/batch-add`  
**æè¿°**: æ‰¹é‡æ·»åŠ å¥–å“åˆ°æŒ‡å®šæ´»åŠ¨çš„å¥–å“æ±   
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "campaign_id": 1,                // æ´»åŠ¨IDï¼ˆå¿…å¡«ï¼‰
  "prizes": [                      // å¥–å“åˆ—è¡¨ï¼ˆå¿…å¡«ï¼‰
    {
      "name": "100ç§¯åˆ†",           // å¥–å“åç§°ï¼ˆå¿…å¡«ï¼‰
      "type": "points",            // å¥–å“ç±»å‹ï¼ˆå¿…å¡«: points/voucher/productï¼‰
      "value": 100,                // å¥–å“ä»·å€¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰
      "quantity": 1000,            // å¥–å“æ•°é‡ï¼ˆå¿…å¡«ï¼‰
      "probability": 0.5,          // ä¸­å¥–æ¦‚ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰
      "description": "ç§¯åˆ†å¥–åŠ±",   // å¥–å“æè¿°ï¼ˆå¯é€‰ï¼‰
      "image_url": "https://..."   // å¥–å“å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
    }
  ]
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“æ‰¹é‡æ·»åŠ æˆåŠŸ",
  "data": {
    "campaign_id": 1,
    "added_prizes": 3,
    "prizes": [
      {
        "id": 101,
        "campaign_id": 1,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "value": 100,
        "quantity": 1000,
        "remaining_quantity": 1000,
        "probability": 0.5,
        "description": "ç§¯åˆ†å¥–åŠ±",
        "image_url": "https://...",
        "created_by": 10,
        "created_at": "2025-11-04 15:30:00"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_CAMPAIGN_ID`: æ´»åŠ¨IDä¸èƒ½ä¸ºç©º
- `400 VALIDATION_ERROR`: å¥–å“åˆ—è¡¨éªŒè¯å¤±è´¥
- `404 CAMPAIGN_NOT_FOUND`: æ´»åŠ¨ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_BATCH_ADD_ERROR`: å¥–å“æ‰¹é‡æ·»åŠ å¤±è´¥

---

#### 10.5.2 è·å–æ´»åŠ¨å¥–å“æ±  âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/prize-pool/:campaign_code`  
**æè¿°**: è·å–æŒ‡å®šæ´»åŠ¨çš„æ‰€æœ‰å¥–å“ä¿¡æ¯åŠç»Ÿè®¡æ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `campaign_code`: æ´»åŠ¨ä»£ç ï¼ˆå¿…å¡«ï¼Œå¦‚: daily_lotteryï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“æ± ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "campaign": {
      "campaign_code": "daily_lottery",
      "campaign_name": "æ¯æ—¥æŠ½å¥–",
      "status": "active"
    },
    "statistics": {
      "total_prizes": 5,            // å¥–å“ç§ç±»æ€»æ•°
      "total_quantity": 10000,      // å¥–å“æ€»æ•°é‡
      "remaining_quantity": 8500,   // å‰©ä½™æ•°é‡
      "used_quantity": 1500,        // å·²ä½¿ç”¨æ•°é‡
      "usage_rate": "15.00"         // ä½¿ç”¨ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
    },
    "prizes": [
      {
        "id": 101,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "value": 100,
        "quantity": 1000,
        "remaining_quantity": 850,
        "probability": 0.5,
        "description": "ç§¯åˆ†å¥–åŠ±",
        "image_url": "https://...",
        "created_at": "2025-11-04 15:30:00"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_CAMPAIGN_CODE`: ç¼ºå°‘æ´»åŠ¨ä»£ç 
- `404 CAMPAIGN_NOT_FOUND`: æ´»åŠ¨ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_POOL_GET_ERROR`: å¥–å“æ± ä¿¡æ¯è·å–å¤±è´¥

---

#### 10.5.3 æ›´æ–°å¥–å“ä¿¡æ¯ âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/prize-pool/prize/:prize_id`  
**æè¿°**: æ›´æ–°æŒ‡å®šå¥–å“çš„ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `prize_id`: å¥–å“IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**ï¼ˆæ‰€æœ‰å­—æ®µå¯é€‰ï¼Œè‡³å°‘æä¾›ä¸€ä¸ªï¼‰:
```json
{
  "name": "200ç§¯åˆ†",           // å¥–å“åç§°
  "type": "points",            // å¥–å“ç±»å‹
  "value": 200,                // å¥–å“ä»·å€¼
  "quantity": 1500,            // å¥–å“æ•°é‡ï¼ˆä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡ï¼‰
  "probability": 0.6,          // ä¸­å¥–æ¦‚ç‡
  "description": "æ›´æ–°æè¿°",   // å¥–å“æè¿°
  "image_url": "https://..."   // å¥–å“å›¾ç‰‡
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "prize_id": 101,
    "updated_fields": ["name", "value", "quantity"],
    "prize": {
      "id": 101,
      "campaign_id": 1,
      "name": "200ç§¯åˆ†",
      "type": "points",
      "value": 200,
      "quantity": 1500,
      "remaining_quantity": 1350,     // è‡ªåŠ¨è°ƒæ•´å‰©ä½™æ•°é‡
      "probability": 0.5,
      "description": "æ›´æ–°æè¿°",
      "image_url": "https://...",
      "updated_by": 10,
      "updated_at": "2025-11-04 15:30:00"
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯å¥–å“IDæœ‰æ•ˆæ€§
2. æ£€æŸ¥å¥–å“æ˜¯å¦å­˜åœ¨
3. è¿‡æ»¤å…è®¸æ›´æ–°çš„å­—æ®µï¼ˆname/type/value/quantity/probability/description/image_urlï¼‰
4. ç‰¹æ®Šå¤„ç†æ•°é‡æ›´æ–°ï¼šæ–°æ•°é‡ä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡
5. è‡ªåŠ¨è®¡ç®—å¹¶æ›´æ–°å‰©ä½™æ•°é‡ï¼ˆremaining_quantityï¼‰
6. è®°å½•æ›´æ–°äººå’Œæ›´æ–°æ—¶é—´

**é”™è¯¯å“åº”**:
- `400 INVALID_PRIZE_ID`: æ— æ•ˆçš„å¥–å“ID
- `404 PRIZE_NOT_FOUND`: å¥–å“ä¸å­˜åœ¨
- `400 NO_VALID_FIELDS`: æ²¡æœ‰æœ‰æ•ˆçš„æ›´æ–°å­—æ®µ
- `400 INVALID_QUANTITY`: æ–°æ•°é‡ä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_UPDATE_ERROR`: å¥–å“ä¿¡æ¯æ›´æ–°å¤±è´¥

---

### 10.6 ç”¨æˆ·ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/user-management`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/user_management.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- UUIDè§’è‰²ç³»ç»Ÿ: å®Œå…¨åŸºäºRoleè¡¨çš„UUIDè¿›è¡Œè§’è‰²ç®¡ç†ï¼Œä¸ä¾èµ–is_adminå­—æ®µ
- è§’è‰²çº§åˆ«è®¡ç®—: ç”¨æˆ·æƒé™çº§åˆ«=æ‰€æœ‰è§’è‰²ä¸­çš„æœ€é«˜levelå€¼
- äº‹åŠ¡å®‰å…¨: è§’è‰²åˆ†é…ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
- åˆ†é¡µä¿æŠ¤: æœ€å¤§100æ¡/é¡µï¼Œé˜²æ­¢æ•°æ®è¿‡è½½
- å®Œæ•´å®¡è®¡: æ‰€æœ‰ç”¨æˆ·ç®¡ç†æ“ä½œè®°å½•æ“ä½œäººå’ŒåŸå› 

---

#### 10.6.1 è·å–ç”¨æˆ·åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/users`  
**æè¿°**: è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢å’Œè§’è‰²è¿‡æ»¤  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `search`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼Œæ”¯æŒæ‰‹æœºå·/æ˜µç§°æ¨¡ç³Šæœç´¢ï¼‰
- `role_filter`: è§’è‰²è¿‡æ»¤ï¼ˆå¯é€‰ï¼ŒæŒ‰è§’è‰²åç§°ç­›é€‰ç”¨æˆ·ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "users": [
      {
        "user_id": 1,
        "mobile": "13800138000",
        "nickname": "ç”¨æˆ·8000",
        "history_total_points": 10000,
        "status": "active",
        "role_level": 100,              // æœ€é«˜è§’è‰²çº§åˆ«
        "roles": ["admin", "user"],     // ç”¨æˆ·æ‰€æœ‰è§’è‰²
        "last_login": "2025-11-04 15:30:00",
        "created_at": "2025-11-01 10:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 100,
      "total_pages": 5
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_USERS_FAILED`: è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥

---

#### 10.6.2 è·å–ç”¨æˆ·è¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/users/:user_id`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´è§’è‰²ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·è¯¦æƒ…æˆåŠŸ",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·8000",
      "status": "active",
      "history_total_points": 10000,
      "consecutive_fail_count": 0,
      "role_level": 100,
      "roles": [
        {
          "role_uuid": "uuid-admin-001",
          "role_name": "admin",
          "role_level": 100,
          "description": "ç®¡ç†å‘˜è§’è‰²",
          "assigned_at": "2025-11-01 10:00:00"
        }
      ],
      "last_login": "2025-11-04 15:30:00",
      "login_count": 50,
      "created_at": "2025-11-01 10:00:00",
      "updated_at": "2025-11-04 15:30:00"
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_USER_FAILED`: è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥

---

#### 10.6.3 æ›´æ–°ç”¨æˆ·è§’è‰² âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/user-management/users/:user_id/role`  
**æè¿°**: æ›´æ–°ç”¨æˆ·è§’è‰²ï¼Œæ”¯æŒåˆ†é…æˆ–æ’¤é”€è§’è‰²  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "role_uuid": "uuid-admin-001",  // è§’è‰²UUIDï¼ˆå¿…å¡«ï¼‰
  "action": "assign",             // æ“ä½œç±»å‹ï¼ˆå¿…å¡«: assign/revokeï¼‰
  "reason": "å‡çº§ä¸ºç®¡ç†å‘˜"         // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·è§’è‰²æ›´æ–°æˆåŠŸ",
  "data": {
    "user_id": 1,
    "role_uuid": "uuid-admin-001",
    "role_name": "admin",
    "action": "assign",
    "updated_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `404 ROLE_NOT_FOUND`: è§’è‰²ä¸å­˜åœ¨
- `400 INVALID_ACTION`: æ— æ•ˆçš„æ“ä½œç±»å‹
- `400 ROLE_ALREADY_ASSIGNED`: ç”¨æˆ·å·²æ‹¥æœ‰æ­¤è§’è‰²ï¼ˆassignæ—¶ï¼‰
- `400 ROLE_NOT_ASSIGNED`: ç”¨æˆ·æœªæ‹¥æœ‰æ­¤è§’è‰²ï¼ˆrevokeæ—¶ï¼‰
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 UPDATE_ROLE_FAILED`: æ›´æ–°è§’è‰²å¤±è´¥

---

#### 10.6.4 æ›´æ–°ç”¨æˆ·çŠ¶æ€ âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/user-management/users/:user_id/status`  
**æè¿°**: æ›´æ–°ç”¨æˆ·è´¦æˆ·çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "status": "active",           // æ–°çŠ¶æ€ï¼ˆå¿…å¡«: active/inactiveï¼‰
  "reason": "è§£é™¤è´¦å·é™åˆ¶"      // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "user_id": 1,
    "old_status": "inactive",
    "new_status": "active",
    "updated_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**çŠ¶æ€è¯´æ˜**:
- `active`: æ­£å¸¸çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿ
- `inactive`: ç¦ç”¨çŠ¶æ€ï¼Œç”¨æˆ·æ— æ³•ç™»å½•å’Œä½¿ç”¨ç³»ç»ŸåŠŸèƒ½

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `400 INVALID_STATUS`: æ— æ•ˆçš„çŠ¶æ€å€¼
- `400 STATUS_UNCHANGED`: æ–°çŠ¶æ€ä¸å½“å‰çŠ¶æ€ç›¸åŒ
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 UPDATE_STATUS_FAILED`: æ›´æ–°çŠ¶æ€å¤±è´¥

---

#### 10.6.5 è·å–æ‰€æœ‰å¯ç”¨è§’è‰² âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/roles`  
**æè¿°**: è·å–ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨è§’è‰²åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–è§’è‰²åˆ—è¡¨æˆåŠŸ",
  "data": {
    "roles": [
      {
        "role_uuid": "uuid-admin-001",
        "role_name": "admin",
        "role_level": 100,
        "description": "ç®¡ç†å‘˜è§’è‰²",
        "user_count": 5,
        "created_at": "2025-01-01 00:00:00"
      },
      {
        "role_uuid": "uuid-user-001",
        "role_name": "user",
        "role_level": 1,
        "description": "æ™®é€šç”¨æˆ·è§’è‰²",
        "user_count": 995,
        "created_at": "2025-01-01 00:00:00"
      }
    ],
    "total": 2
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**æ’åºè§„åˆ™**:
- æŒ‰role_levelé™åºæ’åˆ—
- ä¼˜å…ˆæ˜¾ç¤ºé«˜æƒé™è§’è‰²

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_ROLES_FAILED`: è·å–è§’è‰²åˆ—è¡¨å¤±è´¥

---

### 10.7 æŠ½å¥–ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/lottery-management`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/lottery_management.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- è¿è¥å¹²é¢„: æ”¯æŒç®¡ç†å‘˜ä¸´æ—¶æ§åˆ¶ç”¨æˆ·ä¸­å¥–ç»“æœ
- å¹²é¢„ä¼˜å…ˆçº§: ç”¨æˆ·ä¸“å±é˜Ÿåˆ— > å¼ºåˆ¶ä¸­å¥–/ä¸ä¸­å¥– > æ¦‚ç‡è°ƒæ•´ > é»˜è®¤æ¦‚ç‡
- å®Œæ•´å®¡è®¡: æ‰€æœ‰å¹²é¢„æ“ä½œè®°å½•æ“ä½œäººã€åŸå› å’Œæ—¶é—´æˆ³
- ç®¡ç†ç­–ç•¥: é€šè¿‡managementStrategyç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¹²é¢„è§„åˆ™
- è‡ªåŠ¨è¿‡æœŸ: å¼ºåˆ¶ä¸­å¥–/ä¸ä¸­å¥–è®¾ç½®ä¸€æ¬¡æ€§æœ‰æ•ˆï¼Œä½¿ç”¨åè‡ªåŠ¨æ¸…é™¤

---

#### 10.7.1 å¼ºåˆ¶ä¸­å¥– âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/force-win`  
**æè¿°**: ç®¡ç†å‘˜å¼ºåˆ¶æŒ‡å®šç”¨æˆ·ä¸‹æ¬¡æŠ½å¥–å¿…ä¸­å¥–  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "reason": "æ´»åŠ¨è¡¥å¿"              // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼Œé»˜è®¤"ç®¡ç†å‘˜å¼ºåˆ¶ä¸­å¥–"ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¼ºåˆ¶ä¸­å¥–è®¾ç½®æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "status": "force_win_set",
    "reason": "æ´»åŠ¨è¡¥å¿",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: è®¾ç½®åï¼Œç”¨æˆ·ä¸‹æ¬¡æŠ½å¥–æ—¶ä¼šè·³è¿‡æ¦‚ç‡è®¡ç®—ç›´æ¥ä¸­å¥–ï¼Œä½¿ç”¨åè‡ªåŠ¨æ¸…é™¤è®¾ç½®

**é”™è¯¯å“åº”**:
- `400 VALIDATION_ERROR`: ç”¨æˆ·IDéªŒè¯å¤±è´¥
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 FORCE_WIN_ERROR`: å¼ºåˆ¶ä¸­å¥–è®¾ç½®å¤±è´¥

---

#### 10.7.2 å¼ºåˆ¶ä¸ä¸­å¥– âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/force-lose`  
**æè¿°**: ç®¡ç†å‘˜å¼ºåˆ¶æŒ‡å®šç”¨æˆ·åœ¨æŒ‡å®šæ¬¡æ•°å†…ä¸ä¸­å¥–  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "times": 5,                      // ä¸ä¸­å¥–æ¬¡æ•°ï¼ˆå¿…å¡«ï¼Œé»˜è®¤1ï¼‰
  "reason": "æµ‹è¯•éœ€è¦"              // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¼ºåˆ¶ä¸ä¸­å¥–è®¾ç½®æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "status": "force_lose_set",
    "times": 5,
    "reason": "æµ‹è¯•éœ€è¦",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: è®¾ç½®åï¼Œç”¨æˆ·åœ¨æŒ‡å®šæ¬¡æ•°å†…çš„æŠ½å¥–éƒ½ä¼šå¼ºåˆ¶ä¸ä¸­å¥–ï¼Œæ¬¡æ•°ç”¨å®Œåè‡ªåŠ¨æ¸…é™¤

**é”™è¯¯å“åº”**:
- `400 VALIDATION_ERROR`: å‚æ•°éªŒè¯å¤±è´¥
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 FORCE_LOSE_ERROR`: å¼ºåˆ¶ä¸ä¸­å¥–è®¾ç½®å¤±è´¥

---

#### 10.7.3 è°ƒæ•´ä¸­å¥–æ¦‚ç‡ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/probability-adjust`  
**æè¿°**: ç®¡ç†å‘˜ä¸´æ—¶è°ƒæ•´ç”¨æˆ·çš„ä¸­å¥–æ¦‚ç‡  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "probability": 0.8,              // æ–°æ¦‚ç‡ï¼ˆå¿…å¡«ï¼Œ0-1ä¹‹é—´ï¼‰
  "duration": 3600,                // æŒç»­æ—¶é—´ï¼ˆç§’ï¼Œå¯é€‰ï¼Œé»˜è®¤3600ï¼‰
  "reason": "VIPç”¨æˆ·æå‡"          // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ¦‚ç‡è°ƒæ•´æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "old_probability": 0.3,
    "new_probability": 0.8,
    "duration": 3600,
    "expires_at": "2025-11-04 16:30:00",
    "reason": "VIPç”¨æˆ·æå‡",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: è°ƒæ•´åçš„æ¦‚ç‡åœ¨æŒç»­æ—¶é—´å†…æœ‰æ•ˆï¼Œè¿‡æœŸåè‡ªåŠ¨æ¢å¤é»˜è®¤æ¦‚ç‡

**é”™è¯¯å“åº”**:
- `400 INVALID_PROBABILITY`: æ¦‚ç‡å€¼å¿…é¡»åœ¨0-1ä¹‹é—´
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PROBABILITY_ADJUST_ERROR`: æ¦‚ç‡è°ƒæ•´å¤±è´¥

---

#### 10.7.4 åˆ›å»ºç”¨æˆ·ä¸“å±é˜Ÿåˆ— âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/user-specific-queue`  
**æè¿°**: ä¸ºç”¨æˆ·åˆ›å»ºä¸“å±å¥–å“é˜Ÿåˆ—ï¼ŒæŒ‰é¡ºåºå‘æ”¾æŒ‡å®šå¥–å“  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "prize_queue": [101, 102, 103],  // å¥–å“IDé˜Ÿåˆ—ï¼ˆå¿…å¡«ï¼‰
  "reason": "æ´»åŠ¨ä¸“å±å¥–åŠ±"          // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·ä¸“å±é˜Ÿåˆ—åˆ›å»ºæˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "prize_queue": [101, 102, 103],
    "queue_length": 3,
    "reason": "æ´»åŠ¨ä¸“å±å¥–åŠ±",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: 
- ç”¨æˆ·æŠ½å¥–æ—¶ä¼šä¼˜å…ˆä»ä¸“å±é˜Ÿåˆ—ä¸­æŒ‰é¡ºåºè·å–å¥–å“
- é˜Ÿåˆ—ä¸­çš„å¥–å“å‘æ”¾å®Œåï¼Œæ¢å¤æ­£å¸¸æŠ½å¥–
- ä¸“å±é˜Ÿåˆ—ä¼˜å…ˆçº§æœ€é«˜ï¼Œè¦†ç›–æ‰€æœ‰å…¶ä»–è®¾ç½®

**é”™è¯¯å“åº”**:
- `400 EMPTY_QUEUE`: å¥–å“é˜Ÿåˆ—ä¸èƒ½ä¸ºç©º
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `404 PRIZE_NOT_FOUND`: å¥–å“IDä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 QUEUE_CREATE_ERROR`: é˜Ÿåˆ—åˆ›å»ºå¤±è´¥

---

#### 10.7.5 è·å–ç”¨æˆ·æŠ½å¥–çŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/lottery-management/user-status/:user_id`  
**æè¿°**: æŸ¥è¯¢ç”¨æˆ·å½“å‰çš„æ‰€æœ‰æŠ½å¥–å¹²é¢„è®¾ç½®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·æŠ½å¥–çŠ¶æ€è·å–æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "force_win": false,
    "force_lose": {
      "active": true,
      "remaining_times": 3
    },
    "probability_adjust": {
      "active": true,
      "current_probability": 0.8,
      "expires_at": "2025-11-04 16:30:00"
    },
    "user_specific_queue": {
      "active": true,
      "remaining_prizes": [102, 103]
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_STATUS_ERROR`: è·å–çŠ¶æ€å¤±è´¥

---

#### 10.7.6 æ¸…é™¤ç”¨æˆ·ç‰¹æ®Šè®¾ç½® âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/admin/lottery-management/clear-user-settings/:user_id`  
**æè¿°**: æ¸…é™¤ç”¨æˆ·çš„æ‰€æœ‰æŠ½å¥–å¹²é¢„è®¾ç½®ï¼Œæ¢å¤æ­£å¸¸çŠ¶æ€  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "reason": "æµ‹è¯•ç»“æŸ"              // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·ç‰¹æ®Šè®¾ç½®å·²æ¸…é™¤",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "cleared_settings": [
      "force_win",
      "force_lose",
      "probability_adjust",
      "user_specific_queue"
    ],
    "reason": "æµ‹è¯•ç»“æŸ",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 CLEAR_SETTINGS_ERROR`: æ¸…é™¤è®¾ç½®å¤±è´¥

---

### 10.8 æ•°æ®åˆ†æ âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/analytics`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/analytics.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- æ—¶é—´èŒƒå›´åˆ†æ: æ”¯æŒ1-90å¤©çš„å†å²æ•°æ®æŸ¥è¯¢
- å¤šç»´åº¦ç­›é€‰: æ”¯æŒæŒ‰ç­–ç•¥ç±»å‹ã€ç”¨æˆ·ã€æ´»åŠ¨ç­‰ç»´åº¦è¿‡æ»¤
- å®æ—¶ç»Ÿè®¡: åŸºäºæ•°æ®åº“å®æ—¶æŸ¥è¯¢ç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨
- è¶‹åŠ¿åˆ†æ: æ”¯æŒæŒ‰æ—¥ã€å‘¨ã€æœˆçš„è¶‹åŠ¿æ•°æ®å±•ç¤º
- åŒ—äº¬æ—¶é—´: æ‰€æœ‰æ—¶é—´æ•°æ®ä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆGMT+8ï¼‰

---

#### 10.8.1 è·å–å†³ç­–åˆ†ææ•°æ® âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/decisions/analytics`  
**æè¿°**: è·å–æŠ½å¥–å¼•æ“çš„å†³ç­–åˆ†ææ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `strategy_filter`: ç­–ç•¥ç±»å‹ç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `user_filter`: ç”¨æˆ·IDç­›é€‰ï¼ˆå¯é€‰ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å†³ç­–åˆ†ææ•°æ®è·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28 00:00:00",
      "end_date": "2025-11-04 15:30:00",
      "days": 7
    },
    "total_decisions": 1500,
    "strategy_distribution": {
      "force_win": 10,
      "force_lose": 5,
      "probability_adjust": 50,
      "default": 1435
    },
    "success_rate": 96.5,
    "avg_response_time": 25,
    "peak_hour": "20:00-21:00",
    "daily_breakdown": [
      {
        "date": "2025-11-04",
        "decisions": 250,
        "success_count": 242,
        "avg_time": 23
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 ANALYTICS_ERROR`: æ•°æ®åˆ†æå¤±è´¥

---

#### 10.8.2 è·å–æŠ½å¥–è¶‹åŠ¿åˆ†æ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/lottery/trends`  
**æè¿°**: è·å–æŠ½å¥–æ´»åŠ¨çš„è¶‹åŠ¿åˆ†ææ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `campaign_id`: æ´»åŠ¨IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `group_by`: åˆ†ç»„ç»´åº¦ï¼ˆå¯é€‰: day/week/monthï¼Œé»˜è®¤dayï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æŠ½å¥–è¶‹åŠ¿åˆ†æè·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28",
      "end_date": "2025-11-04",
      "days": 7
    },
    "total_draws": 5000,
    "total_winners": 4850,
    "overall_win_rate": 97.0,
    "trends": [
      {
        "date": "2025-11-04",
        "draws": 850,
        "winners": 825,
        "win_rate": 97.1,
        "unique_users": 650,
        "avg_draws_per_user": 1.3
      }
    ],
    "top_prizes": [
      {
        "prize_name": "100ç§¯åˆ†",
        "win_count": 2500,
        "percentage": 50.0
      }
    ],
    "user_activity": {
      "new_users": 150,
      "active_users": 800,
      "retention_rate": 85.5
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 TRENDS_ANALYSIS_ERROR`: è¶‹åŠ¿åˆ†æå¤±è´¥

---

#### 10.8.3 è·å–æ€§èƒ½æŠ¥å‘Š âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/performance/report`  
**æè¿°**: è·å–ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å’Œå¥åº·çŠ¶å†µæŠ¥å‘Š  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼ŒèŒƒå›´1-30ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ€§èƒ½æŠ¥å‘Šè·å–æˆåŠŸ",
  "data": {
    "system_health": {
      "status": "healthy",
      "uptime": "15å¤©3å°æ—¶",
      "last_restart": "2025-10-20 10:00:00"
    },
    "api_performance": {
      "total_requests": 50000,
      "avg_response_time": 45,
      "p95_response_time": 120,
      "p99_response_time": 250,
      "success_rate": 99.8,
      "error_rate": 0.2
    },
    "database_performance": {
      "avg_query_time": 15,
      "slow_queries_count": 5,
      "connection_pool_usage": "70%",
      "cache_hit_rate": 95.5
    },
    "resource_usage": {
      "cpu_usage": "45%",
      "memory_usage": "2.5GB / 4GB (62.5%)",
      "disk_usage": "15GB / 50GB (30%)"
    },
    "bottlenecks": [
      {
        "type": "slow_query",
        "description": "ç”¨æˆ·åº“å­˜æŸ¥è¯¢è¾ƒæ…¢",
        "avg_time": 250,
        "suggestion": "è€ƒè™‘æ·»åŠ ç´¢å¼•"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PERFORMANCE_REPORT_ERROR`: æ€§èƒ½æŠ¥å‘Šç”Ÿæˆå¤±è´¥

---

#### 10.8.4 è·å–ç”¨æˆ·è¡Œä¸ºåˆ†æ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/user/behavior`  
**æè¿°**: è·å–ç”¨æˆ·è¡Œä¸ºåˆ†ææ•°æ®ï¼ŒåŒ…æ‹¬æ´»è·ƒåº¦ã€ç•™å­˜ç‡ç­‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `user_segment`: ç”¨æˆ·åˆ†ç¾¤ï¼ˆå¯é€‰: new/active/inactiveï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·è¡Œä¸ºåˆ†æè·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28",
      "end_date": "2025-11-04",
      "days": 7
    },
    "user_metrics": {
      "total_users": 1000,
      "new_users": 150,
      "active_users": 800,
      "churned_users": 50
    },
    "engagement": {
      "avg_session_duration": "15åˆ†é’Ÿ",
      "avg_actions_per_session": 8.5,
      "daily_active_rate": 65.0,
      "weekly_active_rate": 85.0
    },
    "retention": {
      "day_1": 80.0,
      "day_3": 65.0,
      "day_7": 55.0,
      "day_30": 40.0
    },
    "user_lifecycle": {
      "new_activation_rate": 90.0,
      "avg_lifetime_value": 5000,
      "churn_risk_users": 120
    },
    "behavior_patterns": [
      {
        "pattern": "æ™šé—´æ´»è·ƒ",
        "users_count": 600,
        "peak_hours": ["19:00-22:00"],
        "avg_engagement": "high"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 USER_BEHAVIOR_ERROR`: ç”¨æˆ·è¡Œä¸ºåˆ†æå¤±è´¥

---

### 10.9 å…‘æ¢å®¡æ ¸ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/audit`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/audit.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- å¤§é¢äº¤æ˜“å®¡æ ¸: é’ˆå¯¹requires_audit=trueçš„å…‘æ¢è®°å½•è¿›è¡Œäººå·¥å®¡æ ¸
- äº‹åŠ¡å®‰å…¨: å®¡æ ¸æ“ä½œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
- è‡ªåŠ¨é€€æ¬¾: å®¡æ ¸æ‹’ç»è‡ªåŠ¨é€€å›ç§¯åˆ†ç»™ç”¨æˆ·
- å®¡è®¡æ—¥å¿—: æ‰€æœ‰å®¡æ ¸æ“ä½œè®°å½•å®Œæ•´å®¡è®¡æ—¥å¿—
- åº“å­˜ç”Ÿæˆ: å®¡æ ¸é€šè¿‡åè‡ªåŠ¨ç”Ÿæˆæ ¸é”€ç å¹¶æ·»åŠ åˆ°ç”¨æˆ·åº“å­˜

---

#### 10.9.1 è·å–å¾…å®¡æ ¸åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/audit/pending`  
**æè¿°**: è·å–æ‰€æœ‰å¾…å®¡æ ¸çš„å…‘æ¢è®°å½•åˆ—è¡¨  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `limit`: è¿”å›æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤20ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¾…å®¡æ ¸åˆ—è¡¨è·å–æˆåŠŸ",
  "data": {
    "pending_count": 5,           // å¾…å®¡æ ¸æ€»æ•°
    "items": [
      {
        "exchange_id": "exc_20251104_abc123",
        "user": {
          "user_id": 1,
          "mobile": "13800138000",
          "nickname": "ç”¨æˆ·æ˜µç§°"
        },
        "product_name": "é«˜çº§å•†å“",
        "product_category": "å®ç‰©å•†å“",
        "product_points": 5000,
        "product_snapshot": {        // å®Œæ•´å•†å“å¿«ç…§
          "name": "é«˜çº§å•†å“",
          "category": "å®ç‰©å•†å“",
          "exchange_points": 5000,
          "description": "å•†å“æè¿°"
        },
        "quantity": 1,
        "total_points": 5000,
        "exchange_code": "EXC123456",
        "exchange_time": "2025-11-04 15:30:00",
        "space": "premium",
        "requires_audit": true,
        "audit_status": "pending"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 SERVER_ERROR`: è·å–å¾…å®¡æ ¸åˆ—è¡¨å¤±è´¥

---

#### 10.9.2 å®¡æ ¸é€šè¿‡ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/audit/:exchange_id/approve`  
**æè¿°**: å®¡æ ¸é€šè¿‡å…‘æ¢ç”³è¯·ï¼Œè‡ªåŠ¨ç”Ÿæˆæ ¸é”€ç å¹¶æ·»åŠ åˆ°ç”¨æˆ·åº“å­˜  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `exchange_id`: å…‘æ¢è®°å½•IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "reason": "å®¡æ ¸é€šè¿‡åŸå› "       // å¯é€‰ï¼Œå®¡æ ¸å¤‡æ³¨
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å®¡æ ¸é€šè¿‡ï¼Œå…‘æ¢å·²å®Œæˆ",
  "data": {
    "exchange_id": "exc_20251104_abc123",
    "audit_status": "approved",
    "status": "completed",
    "audited_at": "2025-11-04 15:30:00",
    "inventory_items": [          // ç”Ÿæˆçš„åº“å­˜é¡¹
      {
        "inventory_id": 101,
        "name": "é«˜çº§å•†å“",
        "verification_code": "VER123456"  // æ ¸é”€ç 
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯å…‘æ¢è®°å½•å­˜åœ¨ä¸”çŠ¶æ€ä¸ºpending
2. æ›´æ–°å®¡æ ¸çŠ¶æ€ä¸ºapproved
3. ä¸ºæ¯ä¸ªå…‘æ¢æ•°é‡ç”Ÿæˆç‹¬ç«‹çš„æ ¸é”€ç 
4. å°†æ ¸é”€ç æ·»åŠ åˆ°ç”¨æˆ·åº“å­˜ï¼ˆUserInventoryï¼‰
5. æ ¸é”€ç æœ‰æ•ˆæœŸ30å¤©
6. è®°å½•å®Œæ•´å®¡è®¡æ—¥å¿—

**é”™è¯¯å“åº”**:
- `404 NOT_FOUND`: å…‘æ¢è®°å½•ä¸å­˜åœ¨
- `400 INVALID_STATUS`: è¯¥è®°å½•ä¸æ˜¯å¾…å®¡æ ¸çŠ¶æ€
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 SERVER_ERROR`: å®¡æ ¸é€šè¿‡å¤±è´¥

---

#### 10.9.3 å®¡æ ¸æ‹’ç» âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/audit/:exchange_id/reject`  
**æè¿°**: æ‹’ç»å…‘æ¢ç”³è¯·ï¼Œè‡ªåŠ¨é€€å›ç§¯åˆ†ç»™ç”¨æˆ·  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `exchange_id`: å…‘æ¢è®°å½•IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "reason": "å®¡æ ¸æ‹’ç»åŸå› "       // å¿…å¡«ï¼Œå¿…é¡»æä¾›æ‹’ç»åŸå› 
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å®¡æ ¸æ‹’ç»ï¼Œç§¯åˆ†å·²é€€å›",
  "data": {
    "exchange_id": "exc_20251104_abc123",
    "audit_status": "rejected",
    "status": "rejected",
    "audited_at": "2025-11-04 15:30:00",
    "refunded_points": 5000       // é€€å›çš„ç§¯åˆ†æ•°é‡
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯æ‹’ç»åŸå› ä¸ä¸ºç©ºï¼ˆå¿…å¡«ï¼‰
2. éªŒè¯å…‘æ¢è®°å½•å­˜åœ¨ä¸”çŠ¶æ€ä¸ºpending
3. æ›´æ–°å®¡æ ¸çŠ¶æ€ä¸ºrejected
4. é€€å›å…¨éƒ¨ç§¯åˆ†ç»™ç”¨æˆ·ï¼ˆtotal_pointsï¼‰
5. ç§¯åˆ†äº¤æ˜“ç±»å‹ä¸ºrefundï¼Œæ¥æºä¸ºaudit_rejected
6. è®°å½•å®Œæ•´å®¡è®¡æ—¥å¿—

**é”™è¯¯å“åº”**:
- `400 MISSING_REASON`: å®¡æ ¸æ‹’ç»å¿…é¡»æä¾›åŸå› 
- `404 NOT_FOUND`: å…‘æ¢è®°å½•ä¸å­˜åœ¨
- `400 INVALID_STATUS`: è¯¥è®°å½•ä¸æ˜¯å¾…å®¡æ ¸çŠ¶æ€
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 SERVER_ERROR`: å®¡æ ¸æ‹’ç»å¤±è´¥

---

#### 10.9.4 æŸ¥çœ‹å®¡æ ¸å†å² âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/audit/history`  
**æè¿°**: è·å–å·²å®¡æ ¸çš„å…‘æ¢è®°å½•å†å²ï¼ˆé€šè¿‡/æ‹’ç»ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `audit_status`: å®¡æ ¸çŠ¶æ€ç­›é€‰ï¼ˆå¯é€‰: approved/rejectedï¼‰
- `start_date`: å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼Œæ ¼å¼: YYYY-MM-DDï¼‰
- `end_date`: ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼Œæ ¼å¼: YYYY-MM-DDï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å®¡æ ¸å†å²è·å–æˆåŠŸ",
  "data": {
    "total": 100,
    "page": 1,
    "limit": 20,
    "items": [
      {
        "exchange_id": "exc_20251104_abc123",
        "user": {
          "user_id": 1,
          "mobile": "13800138000",
          "nickname": "ç”¨æˆ·æ˜µç§°"
        },
        "product": {
          "product_id": 10,
          "name": "é«˜çº§å•†å“",
          "category": "å®ç‰©å•†å“",
          "exchange_points": 5000
        },
        "auditor": {
          "user_id": 10,
          "mobile": "13900139000",
          "nickname": "ç®¡ç†å‘˜"
        },
        "quantity": 1,
        "total_points": 5000,
        "exchange_time": "2025-11-04 15:00:00",
        "audit_status": "approved",
        "status": "completed",
        "audited_at": "2025-11-04 15:30:00",
        "audit_reason": "å®¡æ ¸é€šè¿‡å¤‡æ³¨",
        "requires_audit": true,
        "is_deleted": 0
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 SERVER_ERROR`: è·å–å®¡æ ¸å†å²å¤±è´¥

---

### 10.10 æ´»åŠ¨æƒé™ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/campaign-permissions`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/campaign-permissions.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- UUIDè§’è‰²ç³»ç»Ÿ: åŸºäºç°æœ‰è§’è‰²ç³»ç»Ÿï¼Œä½¿ç”¨campaign_{id}æ ¼å¼çš„è§’è‰²å
- è½¯åˆ é™¤æœºåˆ¶: ä½¿ç”¨is_activeæ ‡å¿—ï¼Œæ’¤é”€æƒé™ä¸åˆ é™¤è®°å½•
- æƒé™å¤ç”¨: æ”¯æŒé‡æ–°æ¿€æ´»å·²æ’¤é”€çš„æƒé™
- å®Œæ•´å®¡è®¡: è®°å½•assigned_byå’Œassigned_atä¿¡æ¯
- è§’è‰²éš”ç¦»: ä»…ç®¡ç†ä»¥campaign_å¼€å¤´çš„æ´»åŠ¨è§’è‰²

---

#### 10.10.1 åˆ†é…æ´»åŠ¨æƒé™ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/campaign-permissions/assign`  
**æè¿°**: ç®¡ç†å‘˜ä¸ºç”¨æˆ·åˆ†é…æ´»åŠ¨å‚ä¸æƒé™ï¼Œé€šè¿‡åˆ†é…campaign_{id}è§’è‰²å®ç°  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,           // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "campaign_id": 2        // æ´»åŠ¨IDï¼ˆå¿…å¡«ï¼Œå¯¹åº”campaign_2è§’è‰²ï¼‰
}
```

**æˆåŠŸå“åº”**ï¼ˆæ–°å»ºæƒé™ï¼‰:
```json
{
  "code": 200,
  "message": "æ´»åŠ¨æƒé™åˆ†é…æˆåŠŸ",
  "success_code": "ASSIGN_SUCCESS",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·æ˜µç§°"
    },
    "campaign": {
      "campaign_id": 2,
      "role_name": "campaign_2"
    },
    "action": "created",           // created/reactivated
    "assigned_by": 10,             // ç®¡ç†å‘˜ID
    "assigned_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**æˆåŠŸå“åº”**ï¼ˆé‡æ–°æ¿€æ´»ï¼‰:
```json
{
  "code": 200,
  "message": "æ´»åŠ¨æƒé™å·²é‡æ–°æ¿€æ´»",
  "success_code": "ASSIGN_SUCCESS",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·æ˜µç§°"
    },
    "campaign": {
      "campaign_id": 2,
      "role_name": "campaign_2"
    },
    "action": "reactivated",
    "assigned_by": 10,
    "assigned_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: 
- å¦‚æœæƒé™å·²å­˜åœ¨ä¸”is_active=trueï¼Œè¿”å›400é”™è¯¯
- å¦‚æœæƒé™å·²å­˜åœ¨ä½†is_active=falseï¼Œè‡ªåŠ¨é‡æ–°æ¿€æ´»å¹¶è¿”å›action: "reactivated"
- è‡ªåŠ¨åˆ›å»ºcampaign_{id}è§’è‰²ï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
- æ”¯æŒæ‰‹æœºå·å…³è”æŸ¥æ‰¾ç”¨æˆ·

**é”™è¯¯å“åº”**:
- `400 MISSING_PARAMS`: ç¼ºå°‘å¿…éœ€å‚æ•°
- `400 ALREADY_ASSIGNED`: ç”¨æˆ·å·²æ‹¥æœ‰æ­¤æ´»åŠ¨æƒé™ä¸”æœªæ’¤é”€
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `404 ROLE_NOT_FOUND`: æ´»åŠ¨è§’è‰²ä¸å­˜åœ¨ä¸”è‡ªåŠ¨åˆ›å»ºå¤±è´¥
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 ASSIGN_ERROR`: æƒé™åˆ†é…å¤±è´¥

---

#### 10.10.2 æ’¤é”€æ´»åŠ¨æƒé™ âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/admin/campaign-permissions/revoke`  
**æè¿°**: ç®¡ç†å‘˜æ’¤é”€ç”¨æˆ·çš„æ´»åŠ¨å‚ä¸æƒé™ï¼ˆè½¯åˆ é™¤ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,           // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "campaign_id": 2        // æ´»åŠ¨IDï¼ˆå¿…å¡«ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ´»åŠ¨æƒé™å·²æ’¤é”€",
  "success_code": "REVOKE_SUCCESS",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·æ˜µç§°"
    },
    "campaign": {
      "campaign_id": 2,
      "role_name": "campaign_2"
    },
    "revoked_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: ä½¿ç”¨è½¯åˆ é™¤ï¼ˆis_active=falseï¼‰ï¼Œæƒé™è®°å½•ä¿ç•™å¯è¿½æº¯ï¼Œæ”¯æŒåç»­é‡æ–°æ¿€æ´»

**é”™è¯¯å“åº”**:
- `400 MISSING_PARAMS`: ç¼ºå°‘å¿…éœ€å‚æ•°
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `404 PERMISSION_NOT_FOUND`: ç”¨æˆ·æ²¡æœ‰æ­¤æ´»åŠ¨æƒé™æˆ–æƒé™å·²è¢«æ’¤é”€
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 REVOKE_ERROR`: æ’¤é”€å¤±è´¥

---

#### 10.10.3 æŸ¥çœ‹æƒé™åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/campaign-permissions/list`  
**æè¿°**: æŸ¥è¯¢æ´»åŠ¨æƒé™åˆ†é…è®°å½•ï¼Œæ”¯æŒæŒ‰ç”¨æˆ·æˆ–æ´»åŠ¨ç­›é€‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¯é€‰ï¼Œç­›é€‰æŒ‡å®šç”¨æˆ·çš„æƒé™ï¼‰
- `campaign_id`: æ´»åŠ¨IDï¼ˆå¯é€‰ï¼Œç­›é€‰æŒ‡å®šæ´»åŠ¨çš„æƒé™ï¼‰
- `limit`: è¿”å›æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤50ï¼Œæœ€å¤§100ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "success_code": "LIST_SUCCESS",
  "data": {
    "permissions": [
      {
        "permission_id": 1,
        "user": {
          "user_id": 1,
          "mobile": "13800138000",
          "nickname": "ç”¨æˆ·æ˜µç§°",
          "status": "active"
        },
        "campaign": {
          "campaign_id": 2,
          "campaign_name": "æ˜¥èŠ‚æ´»åŠ¨",
          "role_name": "campaign_2"
        },
        "assigned_at": "2025-11-04 15:30:00",
        "assigned_by": 10,
        "is_active": true
      }
    ],
    "total": 1,
    "filters": {
      "user_id": 1,
      "campaign_id": null
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 LIST_ERROR`: æŸ¥è¯¢å¤±è´¥

---

#### 10.10.4 æ£€æŸ¥ç”¨æˆ·æƒé™ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/campaign-permissions/check`  
**æè¿°**: å¿«é€Ÿæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæ´»åŠ¨æƒé™ï¼Œç”¨äºè°ƒè¯•å’ŒéªŒè¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
- `campaign_id`: æ´»åŠ¨IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**ï¼ˆæœ‰æƒé™ï¼‰:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·æ‹¥æœ‰æ­¤æ´»åŠ¨æƒé™",
  "success_code": "CHECK_SUCCESS",
  "data": {
    "user_id": 1,
    "campaign_id": 2,
    "has_permission": true,
    "role_name": "campaign_2",
    "assigned_at": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**æˆåŠŸå“åº”**ï¼ˆæ— æƒé™ï¼‰:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·æ²¡æœ‰æ­¤æ´»åŠ¨æƒé™",
  "success_code": "CHECK_SUCCESS",
  "data": {
    "user_id": 1,
    "campaign_id": 2,
    "has_permission": false,
    "role_name": null,
    "assigned_at": null
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_PARAMS`: ç¼ºå°‘å¿…éœ€å‚æ•°user_idæˆ–campaign_id
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 CHECK_ERROR`: æ£€æŸ¥å¤±è´¥

---

#### 10.5.1 æ‰¹é‡æ·»åŠ å¥–å“ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/prize-pool/batch-add`  
**æè¿°**: æ‰¹é‡æ·»åŠ å¥–å“åˆ°æŒ‡å®šæ´»åŠ¨çš„å¥–å“æ±   
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "campaign_id": 1,                // æ´»åŠ¨IDï¼ˆå¿…å¡«ï¼‰
  "prizes": [                      // å¥–å“åˆ—è¡¨ï¼ˆå¿…å¡«ï¼‰
    {
      "name": "100ç§¯åˆ†",           // å¥–å“åç§°ï¼ˆå¿…å¡«ï¼‰
      "type": "points",            // å¥–å“ç±»å‹ï¼ˆå¿…å¡«: points/voucher/productï¼‰
      "value": 100,                // å¥–å“ä»·å€¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰
      "quantity": 1000,            // å¥–å“æ•°é‡ï¼ˆå¿…å¡«ï¼‰
      "probability": 0.5,          // ä¸­å¥–æ¦‚ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰
      "description": "ç§¯åˆ†å¥–åŠ±",   // å¥–å“æè¿°ï¼ˆå¯é€‰ï¼‰
      "image_url": "https://..."   // å¥–å“å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
    }
  ]
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“æ‰¹é‡æ·»åŠ æˆåŠŸ",
  "data": {
    "campaign_id": 1,
    "added_prizes": 3,
    "prizes": [
      {
        "id": 101,
        "campaign_id": 1,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "value": 100,
        "quantity": 1000,
        "remaining_quantity": 1000,
        "probability": 0.5,
        "description": "ç§¯åˆ†å¥–åŠ±",
        "image_url": "https://...",
        "created_by": 10,
        "created_at": "2025-11-04 15:30:00"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_CAMPAIGN_ID`: æ´»åŠ¨IDä¸èƒ½ä¸ºç©º
- `400 VALIDATION_ERROR`: å¥–å“åˆ—è¡¨éªŒè¯å¤±è´¥
- `404 CAMPAIGN_NOT_FOUND`: æ´»åŠ¨ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_BATCH_ADD_ERROR`: å¥–å“æ‰¹é‡æ·»åŠ å¤±è´¥

---

#### 10.5.2 è·å–æ´»åŠ¨å¥–å“æ±  âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/prize-pool/:campaign_code`  
**æè¿°**: è·å–æŒ‡å®šæ´»åŠ¨çš„æ‰€æœ‰å¥–å“ä¿¡æ¯åŠç»Ÿè®¡æ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `campaign_code`: æ´»åŠ¨ä»£ç ï¼ˆå¿…å¡«ï¼Œå¦‚: daily_lotteryï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“æ± ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "campaign": {
      "campaign_code": "daily_lottery",
      "campaign_name": "æ¯æ—¥æŠ½å¥–",
      "status": "active"
    },
    "statistics": {
      "total_prizes": 5,            // å¥–å“ç§ç±»æ€»æ•°
      "total_quantity": 10000,      // å¥–å“æ€»æ•°é‡
      "remaining_quantity": 8500,   // å‰©ä½™æ•°é‡
      "used_quantity": 1500,        // å·²ä½¿ç”¨æ•°é‡
      "usage_rate": "15.00"         // ä½¿ç”¨ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
    },
    "prizes": [
      {
        "id": 101,
        "name": "100ç§¯åˆ†",
        "type": "points",
        "value": 100,
        "quantity": 1000,
        "remaining_quantity": 850,
        "probability": 0.5,
        "description": "ç§¯åˆ†å¥–åŠ±",
        "image_url": "https://...",
        "created_at": "2025-11-04 15:30:00"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `400 MISSING_CAMPAIGN_CODE`: ç¼ºå°‘æ´»åŠ¨ä»£ç 
- `404 CAMPAIGN_NOT_FOUND`: æ´»åŠ¨ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_POOL_GET_ERROR`: å¥–å“æ± ä¿¡æ¯è·å–å¤±è´¥

---

#### 10.5.3 æ›´æ–°å¥–å“ä¿¡æ¯ âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/prize-pool/prize/:prize_id`  
**æè¿°**: æ›´æ–°æŒ‡å®šå¥–å“çš„ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `prize_id`: å¥–å“IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**ï¼ˆæ‰€æœ‰å­—æ®µå¯é€‰ï¼Œè‡³å°‘æä¾›ä¸€ä¸ªï¼‰:
```json
{
  "name": "200ç§¯åˆ†",           // å¥–å“åç§°
  "type": "points",            // å¥–å“ç±»å‹
  "value": 200,                // å¥–å“ä»·å€¼
  "quantity": 1500,            // å¥–å“æ•°é‡ï¼ˆä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡ï¼‰
  "probability": 0.6,          // ä¸­å¥–æ¦‚ç‡
  "description": "æ›´æ–°æè¿°",   // å¥–å“æè¿°
  "image_url": "https://..."   // å¥–å“å›¾ç‰‡
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¥–å“ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "prize_id": 101,
    "updated_fields": ["name", "value", "quantity"],
    "prize": {
      "id": 101,
      "campaign_id": 1,
      "name": "200ç§¯åˆ†",
      "type": "points",
      "value": 200,
      "quantity": 1500,
      "remaining_quantity": 1350,     // è‡ªåŠ¨è°ƒæ•´å‰©ä½™æ•°é‡
      "probability": 0.5,
      "description": "æ›´æ–°æè¿°",
      "image_url": "https://...",
      "updated_by": 10,
      "updated_at": "2025-11-04 15:30:00"
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯å¥–å“IDæœ‰æ•ˆæ€§
2. æ£€æŸ¥å¥–å“æ˜¯å¦å­˜åœ¨
3. è¿‡æ»¤å…è®¸æ›´æ–°çš„å­—æ®µï¼ˆname/type/value/quantity/probability/description/image_urlï¼‰
4. ç‰¹æ®Šå¤„ç†æ•°é‡æ›´æ–°ï¼šæ–°æ•°é‡ä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡
5. è‡ªåŠ¨è®¡ç®—å¹¶æ›´æ–°å‰©ä½™æ•°é‡ï¼ˆremaining_quantityï¼‰
6. è®°å½•æ›´æ–°äººå’Œæ›´æ–°æ—¶é—´

**é”™è¯¯å“åº”**:
- `400 INVALID_PRIZE_ID`: æ— æ•ˆçš„å¥–å“ID
- `404 PRIZE_NOT_FOUND`: å¥–å“ä¸å­˜åœ¨
- `400 NO_VALID_FIELDS`: æ²¡æœ‰æœ‰æ•ˆçš„æ›´æ–°å­—æ®µ
- `400 INVALID_QUANTITY`: æ–°æ•°é‡ä¸èƒ½å°äºå·²ä½¿ç”¨æ•°é‡
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PRIZE_UPDATE_ERROR`: å¥–å“ä¿¡æ¯æ›´æ–°å¤±è´¥

---

### 10.6 ç”¨æˆ·ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/user-management`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/user_management.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- UUIDè§’è‰²ç³»ç»Ÿ: å®Œå…¨åŸºäºRoleè¡¨çš„UUIDè¿›è¡Œè§’è‰²ç®¡ç†ï¼Œä¸ä¾èµ–is_adminå­—æ®µ
- è§’è‰²çº§åˆ«è®¡ç®—: ç”¨æˆ·æƒé™çº§åˆ«=æ‰€æœ‰è§’è‰²ä¸­çš„æœ€é«˜levelå€¼
- äº‹åŠ¡å®‰å…¨: è§’è‰²åˆ†é…ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
- åˆ†é¡µä¿æŠ¤: æœ€å¤§100æ¡/é¡µï¼Œé˜²æ­¢æ•°æ®è¿‡è½½
- å®Œæ•´å®¡è®¡: æ‰€æœ‰ç”¨æˆ·ç®¡ç†æ“ä½œè®°å½•æ“ä½œäººå’ŒåŸå› 

---

#### 10.6.1 è·å–ç”¨æˆ·åˆ—è¡¨ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/users`  
**æè¿°**: è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢å’Œè§’è‰²è¿‡æ»¤  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ¡æ•°ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `search`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼Œæ”¯æŒæ‰‹æœºå·/æ˜µç§°æ¨¡ç³Šæœç´¢ï¼‰
- `role_filter`: è§’è‰²è¿‡æ»¤ï¼ˆå¯é€‰ï¼ŒæŒ‰è§’è‰²åç§°ç­›é€‰ç”¨æˆ·ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": {
    "users": [
      {
        "user_id": 1,
        "mobile": "13800138000",
        "nickname": "ç”¨æˆ·8000",
        "history_total_points": 10000,
        "status": "active",
        "role_level": 100,              // æœ€é«˜è§’è‰²çº§åˆ«
        "roles": ["admin", "user"],     // ç”¨æˆ·æ‰€æœ‰è§’è‰²
        "last_login": "2025-11-04 15:30:00",
        "created_at": "2025-11-01 10:00:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "per_page": 20,
      "total": 100,
      "total_pages": 5
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_USERS_FAILED`: è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥

---

#### 10.6.2 è·å–ç”¨æˆ·è¯¦æƒ… âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/users/:user_id`  
**æè¿°**: è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´è§’è‰²ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·è¯¦æƒ…æˆåŠŸ",
  "data": {
    "user": {
      "user_id": 1,
      "mobile": "13800138000",
      "nickname": "ç”¨æˆ·8000",
      "status": "active",
      "history_total_points": 10000,
      "consecutive_fail_count": 0,
      "role_level": 100,
      "roles": [
        {
          "role_uuid": "uuid-admin-001",
          "role_name": "admin",
          "role_level": 100,
          "description": "ç®¡ç†å‘˜è§’è‰²",
          "assigned_at": "2025-11-01 10:00:00"
        }
      ],
      "last_login": "2025-11-04 15:30:00",
      "login_count": 50,
      "created_at": "2025-11-01 10:00:00",
      "updated_at": "2025-11-04 15:30:00"
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_USER_FAILED`: è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥

---

#### 10.6.3 æ›´æ–°ç”¨æˆ·è§’è‰² âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/user-management/users/:user_id/role`  
**æè¿°**: æ›´æ–°ç”¨æˆ·è§’è‰²ï¼Œç§»é™¤ç°æœ‰è§’è‰²å¹¶åˆ†é…æ–°è§’è‰²  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "role_name": "admin",          // æ–°è§’è‰²åç§°ï¼ˆå¿…å¡«ï¼‰
  "reason": "å‡çº§ä¸ºç®¡ç†å‘˜"        // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·è§’è‰²æ›´æ–°æˆåŠŸ",
  "data": {
    "user_id": 1,
    "new_role": "admin",
    "new_role_level": 100,
    "roles": [
      {
        "role_uuid": "uuid-admin-001",
        "role_name": "admin",
        "role_level": 100
      }
    ],
    "operator_id": 10,              // æ“ä½œç®¡ç†å‘˜ID
    "reason": "å‡çº§ä¸ºç®¡ç†å‘˜"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯ç›®æ ‡ç”¨æˆ·å­˜åœ¨
2. éªŒè¯ç›®æ ‡è§’è‰²å­˜åœ¨
3. ç§»é™¤ç”¨æˆ·ç°æœ‰æ‰€æœ‰è§’è‰²ï¼ˆUserRole.destroyï¼‰
4. åˆ†é…æ–°è§’è‰²å¹¶è®°å½•assigned_atå’Œassigned_by
5. ä½¿ç”¨äº‹åŠ¡ä¿è¯æ“ä½œåŸå­æ€§

**é”™è¯¯å“åº”**:
- `400 ROLE_NAME_REQUIRED`: è§’è‰²åç§°ä¸èƒ½ä¸ºç©º
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `404 ROLE_NOT_FOUND`: è§’è‰²ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 UPDATE_USER_ROLE_FAILED`: æ›´æ–°ç”¨æˆ·è§’è‰²å¤±è´¥

---

#### 10.6.4 æ›´æ–°ç”¨æˆ·çŠ¶æ€ âœ…

**è·¯å¾„**: `PUT /api/v4/unified-engine/admin/user-management/users/:user_id/status`  
**æè¿°**: æ›´æ–°ç”¨æˆ·è´¦æˆ·çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨/å°ç¦ï¼‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "status": "inactive",          // ç”¨æˆ·çŠ¶æ€ï¼ˆå¿…å¡«: active/inactive/bannedï¼‰
  "reason": "è¿è§„å°ç¦"            // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": {
    "user_id": 1,
    "old_status": "active",
    "new_status": "inactive",
    "operator_id": 10,
    "reason": "è¿è§„å°ç¦"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**çŠ¶æ€è¯´æ˜**:
- `active`: æ­£å¸¸æ¿€æ´»çŠ¶æ€ï¼Œå¯ä»¥ç™»å½•å’Œä½¿ç”¨æ‰€æœ‰åŠŸèƒ½
- `inactive`: ç¦ç”¨çŠ¶æ€ï¼Œæ— æ³•ç™»å½•ç³»ç»Ÿ
- `banned`: å°ç¦çŠ¶æ€ï¼Œæ°¸ä¹…ç¦æ­¢ç™»å½•

**é”™è¯¯å“åº”**:
- `400 INVALID_STATUS`: æ— æ•ˆçš„ç”¨æˆ·çŠ¶æ€
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 UPDATE_USER_STATUS_FAILED`: æ›´æ–°ç”¨æˆ·çŠ¶æ€å¤±è´¥

---

#### 10.6.5 è·å–æ‰€æœ‰å¯ç”¨è§’è‰² âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/user-management/roles`  
**æè¿°**: è·å–æ‰€æœ‰å¯ç”¨è§’è‰²åˆ—è¡¨ï¼Œç”¨äºè§’è‰²åˆ†é…ä¸‹æ‹‰é€‰æ‹©  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–è§’è‰²åˆ—è¡¨æˆåŠŸ",
  "data": {
    "roles": [
      {
        "id": 1,
        "role_uuid": "uuid-admin-001",
        "role_name": "admin",
        "role_level": 100,
        "description": "ç®¡ç†å‘˜è§’è‰²"
      },
      {
        "id": 2,
        "role_uuid": "uuid-user-001",
        "role_name": "user",
        "role_level": 1,
        "description": "æ™®é€šç”¨æˆ·è§’è‰²"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**æ’åºè§„åˆ™**: æŒ‰role_levelé™åºæ’åˆ—ï¼ˆç®¡ç†å‘˜è§’è‰²åœ¨å‰ï¼‰

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_ROLES_FAILED`: è·å–è§’è‰²åˆ—è¡¨å¤±è´¥

---

### 10.7 æŠ½å¥–ç®¡ç† âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/lottery-management`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/lottery_management.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- è¿è¥å¹²é¢„: æ”¯æŒç®¡ç†å‘˜ä¸´æ—¶æ§åˆ¶ç”¨æˆ·ä¸­å¥–ç»“æœ
- å¹²é¢„ä¼˜å…ˆçº§: ç”¨æˆ·ä¸“å±é˜Ÿåˆ— > å¼ºåˆ¶ä¸­å¥–/ä¸ä¸­å¥– > æ¦‚ç‡è°ƒæ•´ > é»˜è®¤æ¦‚ç‡
- å®Œæ•´å®¡è®¡: æ‰€æœ‰å¹²é¢„æ“ä½œè®°å½•æ“ä½œäººã€åŸå› å’Œæ—¶é—´æˆ³
- ç®¡ç†ç­–ç•¥: é€šè¿‡managementStrategyç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¹²é¢„è§„åˆ™
- è‡ªåŠ¨è¿‡æœŸ: å¼ºåˆ¶ä¸­å¥–/ä¸ä¸­å¥–è®¾ç½®ä¸€æ¬¡æ€§æœ‰æ•ˆï¼Œä½¿ç”¨åè‡ªåŠ¨æ¸…é™¤

---

#### 10.7.1 å¼ºåˆ¶ä¸­å¥– âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/force-win`  
**æè¿°**: ç®¡ç†å‘˜å¼ºåˆ¶æŒ‡å®šç”¨æˆ·ä¸‹æ¬¡æŠ½å¥–å¿…ä¸­å¥–  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "reason": "æ´»åŠ¨è¡¥å¿"              // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼Œé»˜è®¤"ç®¡ç†å‘˜å¼ºåˆ¶ä¸­å¥–"ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¼ºåˆ¶ä¸­å¥–è®¾ç½®æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "status": "force_win_set",
    "reason": "æ´»åŠ¨è¡¥å¿",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: è®¾ç½®åï¼Œç”¨æˆ·ä¸‹æ¬¡æŠ½å¥–æ—¶ä¼šè·³è¿‡æ¦‚ç‡è®¡ç®—ç›´æ¥ä¸­å¥–ï¼Œä½¿ç”¨åè‡ªåŠ¨æ¸…é™¤è®¾ç½®

**é”™è¯¯å“åº”**:
- `400 VALIDATION_ERROR`: ç”¨æˆ·IDéªŒè¯å¤±è´¥
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 FORCE_WIN_ERROR`: å¼ºåˆ¶ä¸­å¥–è®¾ç½®å¤±è´¥

---

#### 10.7.2 å¼ºåˆ¶ä¸ä¸­å¥– âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/force-lose`  
**æè¿°**: ç®¡ç†å‘˜å¼ºåˆ¶æŒ‡å®šç”¨æˆ·åœ¨æŒ‡å®šæ¬¡æ•°å†…ä¸ä¸­å¥–  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "count": 3,                      // ä¸ä¸­å¥–æ¬¡æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼ŒèŒƒå›´1-100ï¼‰
  "reason": "æµ‹è¯•è´¦å·"              // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å¼ºåˆ¶ä¸ä¸­å¥–è®¾ç½®æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "status": "force_lose_set",
    "lose_count": 3,
    "reason": "æµ‹è¯•è´¦å·",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: ç”¨æˆ·æ¥ä¸‹æ¥çš„Næ¬¡æŠ½å¥–éƒ½ä¸ä¼šä¸­å¥–ï¼Œè®¡æ•°å™¨é€’å‡è‡³0åè‡ªåŠ¨æ¸…é™¤

**é”™è¯¯å“åº”**:
- `400 INVALID_COUNT`: ä¸ä¸­å¥–æ¬¡æ•°å¿…é¡»åœ¨1-100ä¹‹é—´
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 FORCE_LOSE_ERROR`: å¼ºåˆ¶ä¸ä¸­å¥–è®¾ç½®å¤±è´¥

---

#### 10.7.3 è°ƒæ•´ä¸­å¥–æ¦‚ç‡ âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/probability-adjust`  
**æè¿°**: ä¸´æ—¶è°ƒæ•´æŒ‡å®šç”¨æˆ·çš„ä¸­å¥–æ¦‚ç‡  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "probability_multiplier": 2.0,   // æ¦‚ç‡å€æ•°ï¼ˆå¿…å¡«ï¼ŒèŒƒå›´0.1-10.0ï¼‰
  "duration_hours": 24,            // æŒç»­æ—¶é—´ï¼ˆå°æ—¶ï¼Œå¯é€‰ï¼Œé»˜è®¤24ï¼‰
  "reason": "VIPç”¨æˆ·ä¼˜æƒ "           // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ä¸­å¥–æ¦‚ç‡è°ƒæ•´æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "probability_multiplier": 2.0,
    "duration_hours": 24,
    "expires_at": "2025-11-05 15:30:00",
    "reason": "VIPç”¨æˆ·ä¼˜æƒ ",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: åŸæ¦‚ç‡Ã—å€æ•°=æ–°æ¦‚ç‡ï¼Œå¦‚åŸæ¦‚ç‡0.5Ã—å€æ•°2.0=æ–°æ¦‚ç‡1.0ï¼ˆ100%ä¸­å¥–ï¼‰

**é”™è¯¯å“åº”**:
- `400 INVALID_MULTIPLIER`: æ¦‚ç‡å€æ•°å¿…é¡»åœ¨0.1-10.0ä¹‹é—´
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PROBABILITY_ADJUST_ERROR`: æ¦‚ç‡è°ƒæ•´å¤±è´¥

---

#### 10.7.4 åˆ›å»ºç”¨æˆ·ä¸“å±é˜Ÿåˆ— âœ…

**è·¯å¾„**: `POST /api/v4/unified-engine/admin/lottery-management/user-specific-queue`  
**æè¿°**: ä¸ºç”¨æˆ·é¢„è®¾æŠ½å¥–ç»“æœåºåˆ—ï¼ŒæŒ‰é˜Ÿåˆ—é¡ºåºè‡ªåŠ¨æ¶ˆè´¹  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,                    // ç›®æ ‡ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰
  "prize_sequence": [              // å¥–å“åºåˆ—ï¼ˆå¿…å¡«ï¼Œæ•°ç»„ï¼‰
    "prize_1",
    "prize_2",
    "lose"
  ],
  "reason": "æ–°ç”¨æˆ·æ¬¢è¿å¥–åŠ±"        // æ“ä½œåŸå› ï¼ˆå¯é€‰ï¼‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·ä¸“å±é˜Ÿåˆ—åˆ›å»ºæˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "queue_length": 3,
    "prize_sequence": ["prize_1", "prize_2", "lose"],
    "reason": "æ–°ç”¨æˆ·æ¬¢è¿å¥–åŠ±",
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**:
- æœ€é«˜ä¼˜å…ˆçº§ï¼šé˜Ÿåˆ—ä¼˜å…ˆäºå…¶ä»–æ‰€æœ‰å¹²é¢„è§„åˆ™
- æŒ‰åºæ¶ˆè´¹ï¼šç”¨æˆ·æ¯æ¬¡æŠ½å¥–æŒ‰é˜Ÿåˆ—é¡ºåºè·å¾—å¯¹åº”ç»“æœ
- è‡ªåŠ¨æ¸…ç©ºï¼šé˜Ÿåˆ—æ¶ˆè´¹å®Œæ¯•åè‡ªåŠ¨æ¸…é™¤

**é”™è¯¯å“åº”**:
- `400 INVALID_SEQUENCE`: å¥–å“åºåˆ—æ ¼å¼é”™è¯¯
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 QUEUE_CREATE_ERROR`: é˜Ÿåˆ—åˆ›å»ºå¤±è´¥

---

#### 10.7.5 è·å–ç”¨æˆ·æŠ½å¥–çŠ¶æ€ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/lottery-management/user-status/:user_id`  
**æè¿°**: æŸ¥çœ‹ç”¨æˆ·å½“å‰çš„æ‰€æœ‰æŠ½å¥–å¹²é¢„è®¾ç½®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "è·å–ç”¨æˆ·æŠ½å¥–çŠ¶æ€æˆåŠŸ",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "force_win": {
      "active": true,
      "reason": "æ´»åŠ¨è¡¥å¿",
      "set_at": "2025-11-04 15:00:00",
      "set_by": 10
    },
    "force_lose": {
      "active": false,
      "remaining_count": 0
    },
    "probability_adjust": {
      "active": true,
      "multiplier": 2.0,
      "expires_at": "2025-11-05 15:00:00"
    },
    "specific_queue": {
      "active": true,
      "remaining": ["prize_2", "lose"],
      "original_length": 3
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 GET_STATUS_ERROR`: è·å–çŠ¶æ€å¤±è´¥

---

#### 10.7.6 æ¸…é™¤ç”¨æˆ·ç‰¹æ®Šè®¾ç½® âœ…

**è·¯å¾„**: `DELETE /api/v4/unified-engine/admin/lottery-management/clear-user-settings/:user_id`  
**æè¿°**: æ¸…é™¤ç”¨æˆ·çš„æ‰€æœ‰æŠ½å¥–å¹²é¢„è§„åˆ™ï¼Œæ¢å¤é»˜è®¤è®¾ç½®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**è·¯å¾„å‚æ•°**:
- `user_id`: ç”¨æˆ·IDï¼ˆå¿…å¡«ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·ç‰¹æ®Šè®¾ç½®å·²æ¸…é™¤",
  "data": {
    "user_id": 1,
    "user_mobile": "13800138000",
    "cleared_settings": [
      "force_win",
      "probability_adjust",
      "specific_queue"
    ],
    "admin_id": 10,
    "timestamp": "2025-11-04 15:30:00"
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**ä¸šåŠ¡è¯´æ˜**: æ¸…é™¤æ‰€æœ‰å¹²é¢„è®¾ç½®åï¼Œç”¨æˆ·æŠ½å¥–å°†ä½¿ç”¨é»˜è®¤æ¦‚ç‡å’Œè§„åˆ™

**é”™è¯¯å“åº”**:
- `404 USER_NOT_FOUND`: ç”¨æˆ·ä¸å­˜åœ¨
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 CLEAR_SETTINGS_ERROR`: æ¸…é™¤è®¾ç½®å¤±è´¥

---

### 10.8 æ•°æ®åˆ†æ âœ…

**åŸºç¡€è·¯å¾„**: `/api/v4/unified-engine/admin/analytics`  
**å®ç°æ–‡ä»¶**: `routes/v4/unified-engine/admin/analytics.js`  
**æ ¸å¿ƒæœºåˆ¶**:
- æ—¶é—´èŒƒå›´åˆ†æ: æ”¯æŒ1-90å¤©çš„å†å²æ•°æ®æŸ¥è¯¢
- å¤šç»´åº¦ç­›é€‰: æ”¯æŒæŒ‰ç­–ç•¥ç±»å‹ã€ç”¨æˆ·ã€æ´»åŠ¨ç­‰ç»´åº¦è¿‡æ»¤
- å®æ—¶ç»Ÿè®¡: åŸºäºæ•°æ®åº“å®æ—¶æŸ¥è¯¢ç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨
- è¶‹åŠ¿åˆ†æ: æ”¯æŒæŒ‰æ—¥ã€å‘¨ã€æœˆçš„è¶‹åŠ¿æ•°æ®å±•ç¤º
- åŒ—äº¬æ—¶é—´: æ‰€æœ‰æ—¶é—´æ•°æ®ä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆGMT+8ï¼‰

---

#### 10.8.1 è·å–å†³ç­–åˆ†ææ•°æ® âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/decisions/analytics`  
**æè¿°**: è·å–æŠ½å¥–å¼•æ“çš„å†³ç­–åˆ†ææ•°æ®å’Œç»Ÿè®¡ä¿¡æ¯  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `strategy_filter`: ç­–ç•¥ç±»å‹ç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `user_filter`: ç”¨æˆ·IDç­›é€‰ï¼ˆå¯é€‰ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "å†³ç­–åˆ†ææ•°æ®è·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28 00:00:00",
      "end_date": "2025-11-04 15:30:00",
      "days": 7
    },
    "total_decisions": 1500,
    "strategy_distribution": {
      "force_win": 10,
      "force_lose": 5,
      "probability_adjust": 50,
      "default": 1435
    },
    "success_rate": 96.5,
    "avg_response_time": 25,
    "peak_hour": "20:00-21:00",
    "daily_breakdown": [
      {
        "date": "2025-11-04",
        "decisions": 250,
        "success_count": 242,
        "avg_time": 23
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 ANALYTICS_ERROR`: æ•°æ®åˆ†æå¤±è´¥

---

#### 10.8.2 è·å–æŠ½å¥–è¶‹åŠ¿åˆ†æ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/lottery/trends`  
**æè¿°**: è·å–æŠ½å¥–æ´»åŠ¨çš„è¶‹åŠ¿åˆ†ææ•°æ®  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `campaign_id`: æ´»åŠ¨IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `group_by`: åˆ†ç»„ç»´åº¦ï¼ˆå¯é€‰: day/week/monthï¼Œé»˜è®¤dayï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æŠ½å¥–è¶‹åŠ¿åˆ†æè·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28",
      "end_date": "2025-11-04",
      "days": 7
    },
    "total_draws": 5000,
    "total_winners": 4850,
    "overall_win_rate": 97.0,
    "trends": [
      {
        "date": "2025-11-04",
        "draws": 850,
        "winners": 825,
        "win_rate": 97.1,
        "unique_users": 650,
        "avg_draws_per_user": 1.3
      }
    ],
    "top_prizes": [
      {
        "prize_name": "100ç§¯åˆ†",
        "win_count": 2500,
        "percentage": 50.0
      }
    ],
    "user_activity": {
      "new_users": 150,
      "active_users": 800,
      "retention_rate": 85.5
    }
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 TRENDS_ANALYSIS_ERROR`: è¶‹åŠ¿åˆ†æå¤±è´¥

---

#### 10.8.3 è·å–æ€§èƒ½æŠ¥å‘Š âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/performance/report`  
**æè¿°**: è·å–ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å’Œå¥åº·çŠ¶å†µæŠ¥å‘Š  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼ŒèŒƒå›´1-30ï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ€§èƒ½æŠ¥å‘Šè·å–æˆåŠŸ",
  "data": {
    "system_health": {
      "status": "healthy",
      "uptime": "15å¤©3å°æ—¶",
      "last_restart": "2025-10-20 10:00:00"
    },
    "api_performance": {
      "total_requests": 50000,
      "avg_response_time": 45,
      "p95_response_time": 120,
      "p99_response_time": 250,
      "success_rate": 99.8,
      "error_rate": 0.2
    },
    "database_performance": {
      "avg_query_time": 15,
      "slow_queries_count": 5,
      "connection_pool_usage": "70%",
      "cache_hit_rate": 95.5
    },
    "resource_usage": {
      "cpu_usage": "45%",
      "memory_usage": "2.5GB / 4GB (62.5%)",
      "disk_usage": "15GB / 50GB (30%)"
    },
    "bottlenecks": [
      {
        "type": "slow_query",
        "description": "ç”¨æˆ·åº“å­˜æŸ¥è¯¢è¾ƒæ…¢",
        "avg_time": 250,
        "suggestion": "è€ƒè™‘æ·»åŠ ç´¢å¼•"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 PERFORMANCE_REPORT_ERROR`: æ€§èƒ½æŠ¥å‘Šç”Ÿæˆå¤±è´¥

---

#### 10.8.4 è·å–ç”¨æˆ·è¡Œä¸ºåˆ†æ âœ…

**è·¯å¾„**: `GET /api/v4/unified-engine/admin/analytics/user/behavior`  
**æè¿°**: è·å–ç”¨æˆ·è¡Œä¸ºåˆ†ææ•°æ®ï¼ŒåŒ…æ‹¬æ´»è·ƒåº¦ã€ç•™å­˜ç‡ç­‰  
**è®¤è¯è¦æ±‚**: âœ… éœ€è¦Access Token  
**æƒé™è¦æ±‚**: ç®¡ç†å‘˜æƒé™

**æŸ¥è¯¢å‚æ•°**:
- `days`: ç»Ÿè®¡å¤©æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤7ï¼ŒèŒƒå›´1-90ï¼‰
- `user_segment`: ç”¨æˆ·åˆ†ç¾¤ï¼ˆå¯é€‰: new/active/inactiveï¼‰

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "message": "ç”¨æˆ·è¡Œä¸ºåˆ†æè·å–æˆåŠŸ",
  "data": {
    "time_range": {
      "start_date": "2025-10-28",
      "end_date": "2025-11-04",
      "days": 7
    },
    "user_metrics": {
      "total_users": 1000,
      "new_users": 150,
      "active_users": 800,
      "churned_users": 50
    },
    "engagement": {
      "avg_session_duration": "15åˆ†é’Ÿ",
      "avg_actions_per_session": 8.5,
      "daily_active_rate": 65.0,
      "weekly_active_rate": 85.0
    },
    "retention": {
      "day_1": 80.0,
      "day_3": 65.0,
      "day_7": 55.0,
      "day_30": 40.0
    },
    "user_lifecycle": {
      "new_activation_rate": 90.0,
      "avg_lifetime_value": 5000,
      "churn_risk_users": 120
    },
    "behavior_patterns": [
      {
        "pattern": "æ™šé—´æ´»è·ƒ",
        "users_count": 600,
        "peak_hours": ["19:00-22:00"],
        "avg_engagement": "high"
      }
    ]
  },
  "timestamp": "2025-11-04 15:30:00"
}
```

**é”™è¯¯å“åº”**:
- `403 ADMIN_REQUIRED`: éœ€è¦ç®¡ç†å‘˜æƒé™
- `500 USER_BEHAVIOR_ERROR`: ç”¨æˆ·è¡Œä¸ºåˆ†æå¤±è´¥

---

## é™„å½•ï¼šé€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { /* å®é™…æ•°æ® */ },
  "timestamp": "2025-01-15T16:00:00+08:00"
}
```

### å¤±è´¥å“åº”
```json
{
  "code": 40001,
  "message": "é”™è¯¯è¯¦ç»†æè¿°",
  "error": "ERROR_CODE",
  "timestamp": "2025-01-15T16:00:00+08:00"
}
```

### åˆ†é¡µå“åº”
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 500,
    "page": 1,
    "page_size": 20,
    "total_pages": 25,
    "list": [ /* æ•°æ®åˆ—è¡¨ */ ]
  },
  "timestamp": "2025-01-15T16:00:00+08:00"
}
```

### é€šç”¨ä¸šåŠ¡çŠ¶æ€ç 
| çŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ |
|-------|------|---------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸ |
| 40001 | å‚æ•°é”™è¯¯ | ç¼ºå°‘å¿…éœ€å‚æ•° |
| 40002 | æ•°æ®ä¸å­˜åœ¨ | ç”¨æˆ·IDä¸å­˜åœ¨ |
| 40003 | æƒé™ä¸è¶³ | æ™®é€šç”¨æˆ·è®¿é—®ç®¡ç†å‘˜API |
| 40004 | Tokenå¤±æ•ˆ | Tokenè¿‡æœŸæˆ–æ— æ•ˆ |
| 40005 | ç§¯åˆ†ä¸è¶³ | å‚ä¸æŠ½å¥–æ—¶ç§¯åˆ†ä¸è¶³ |
| 40006 | åº“å­˜ä¸è¶³ | å¥–å“åº“å­˜è€—å°½ |
| 40007 | ä¸šåŠ¡é€»è¾‘é”™è¯¯ | é‡å¤æäº¤ã€çŠ¶æ€ä¸å…è®¸ç­‰ |
| 50001 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |
| 50002 | ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯ | æ”¯ä»˜æ¥å£è°ƒç”¨å¤±è´¥ |

---

## ğŸ“Š æ¥å£ç»Ÿè®¡æ€»è§ˆ

| æ¨¡å— | æ¥å£æ•°é‡ | å®æ–½çŠ¶æ€ | å¤‡æ³¨ |
|-----|---------|---------|------|
| 1. ç»Ÿä¸€è®¤è¯å¼•æ“ | 5 | âœ… å…¨éƒ¨å®Œæˆ | login, quick-login, profile, verify, refresh |
| 2. ç»Ÿä¸€æŠ½å¥–å¼•æ“ | 8 | âœ… å…¨éƒ¨å®Œæˆ | prizes, config, draw, history, campaignsç­‰ |
| 3. æƒé™ç®¡ç† | 5 | âœ… å…¨éƒ¨å®Œæˆ | useræƒé™, current, check, admins, statistics |
| 4. ç§¯åˆ†ç®¡ç† | **11** | âœ… å…¨éƒ¨å®Œæˆ | balance, transactions, adjust, statistics, trendç­‰ |
| 5. ç”¨æˆ·åº“å­˜ç®¡ç† | **18** | âœ… å…¨éƒ¨å®Œæˆ | inventory, exchange, market, transfer, verifyç­‰ |
| 6. æ¶ˆè´¹è®°å½•ç®¡ç† | **10** | âœ… å…¨éƒ¨å®Œæˆ | submit, approve, reject, qrcode, restoreç­‰ |
| 7. é«˜çº§ç©ºé—´è§£é” | 2 | âœ… å…¨éƒ¨å®Œæˆ | unlock, status |
| 8. æŠ½å¥–ç»“æœé¢„è®¾ç®¡ç† | 4 | âœ… å…¨éƒ¨å®Œæˆ | create, useræŸ¥è¯¢, delete, stats |
| 9. ç³»ç»ŸåŠŸèƒ½ | **19** | âœ… å…¨éƒ¨å®Œæˆ | announcements, feedback, chat, adminç­‰ |
| 10. ç»Ÿä¸€ç®¡ç†å¼•æ“ | **41** | âœ… å…¨éƒ¨å®Œæˆ | 9ä¸ªå­æ¨¡å—(è¯¦è§10.3-10.8) |
| **æ€»è®¡** | **123ä¸ªAPI** | ğŸ‰ **100%å·²å®Œæˆ** | åŸºäºå®é™…ä»£ç ç»Ÿè®¡ |

**å®æ–½è¿›åº¦**: ğŸ‰ **æ‰€æœ‰123ä¸ªAPIå·²å®Œæˆå®ç°ï¼Œé¡¹ç›®åç«¯å¼€å‘å®Œæˆï¼**

**ç»Ÿè®¡è¯´æ˜**:
- æœ¬æ¬¡ç»Ÿè®¡åŸºäºå®é™…è·¯ç”±æ–‡ä»¶ä»£ç (`grep router.(get|post|put|delete|patch)`)
- ç¬¬10æ¨¡å—ç»†åˆ†: auth(2) + system(10) + config(2) + prize-pool(3) + user-management(5) + lottery-management(6) + analytics(4) + audit(4) + campaign-permissions(4) + index(1) = 41ä¸ª

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… JWTåŒTokenè®¤è¯ä½“ç³»
- âœ… UUIDè§’è‰²æƒé™ç³»ç»Ÿ
- âœ… ç»Ÿä¸€æŠ½å¥–å¼•æ“(100%ä¸­å¥–æœºåˆ¶)
- âœ… å®Œæ•´ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ
- âœ… è½¯åˆ é™¤æœºåˆ¶(äº¤æ˜“è®°å½•ã€å…‘æ¢è®°å½•ã€æ¶ˆè´¹è®°å½•)
- âœ… é«˜çº§ç©ºé—´è§£é”åŠŸèƒ½
- âœ… æ•°æ®è„±æ•ä¿æŠ¤
- âœ… é™æµä¿æŠ¤æœºåˆ¶
- âœ… äº‹åŠ¡å®‰å…¨ä¿è¯
- âœ… æ¨¡å—åŒ–ç®¡ç†æ¶æ„

---

## ğŸ“‹ APIå®Œæ•´æ€§éªŒè¯æŠ¥å‘Š (V2.6)

**éªŒè¯æ—¶é—´**: 2025å¹´11æœˆ02æ—¥ 16:53  
**éªŒè¯æ–¹æ³•**: åŸºäºå®é™…è·¯ç”±æ–‡ä»¶ä»£ç é€ä¸€éªŒè¯  
**éªŒè¯å·¥å…·**: `grep -r "router\.(get|post|put|delete|patch)"`

### éªŒè¯ç»“æœæ±‡æ€»

| æ¨¡å— | æ–‡æ¡£å£°æ˜ | ä»£ç å®é™… | éªŒè¯çŠ¶æ€ | æ–‡ä»¶è·¯å¾„ |
|-----|---------|---------|---------|---------|
| 1. ç»Ÿä¸€è®¤è¯å¼•æ“ | 5ä¸ª | 5ä¸ª | âœ… ä¸€è‡´ | `unified-engine/auth.js` |
| 2. ç»Ÿä¸€æŠ½å¥–å¼•æ“ | 8ä¸ª | 8ä¸ª | âœ… ä¸€è‡´ | `unified-engine/lottery.js` |
| 3. æƒé™ç®¡ç† | 5ä¸ª | 5ä¸ª | âœ… ä¸€è‡´ | `permissions.js` |
| 4. ç§¯åˆ†ç®¡ç† | 11ä¸ª | 11ä¸ª | âœ… ä¸€è‡´ | `unified-engine/points.js` |
| 5. ç”¨æˆ·åº“å­˜ç®¡ç† | 18ä¸ª | 18ä¸ª | âœ… ä¸€è‡´ | `unified-engine/inventory.js` |
| 6. æ¶ˆè´¹è®°å½•ç®¡ç† | 10ä¸ª | 10ä¸ª | âœ… ä¸€è‡´ | `unified-engine/consumption.js` |
| 7. é«˜çº§ç©ºé—´è§£é” | 2ä¸ª | 2ä¸ª | âœ… ä¸€è‡´ | `unified-engine/premium.js` |
| 8. æŠ½å¥–ç»“æœé¢„è®¾ | 4ä¸ª | 4ä¸ª | âœ… ä¸€è‡´ | `unified-engine/lottery-preset.js` |
| 9. ç³»ç»ŸåŠŸèƒ½ | 19ä¸ª | 19ä¸ª | âœ… ä¸€è‡´ | `system.js` |
| 10. ç»Ÿä¸€ç®¡ç†å¼•æ“ | 41ä¸ª | 41ä¸ª | âœ… ä¸€è‡´ | `unified-engine/admin/*` |
| **æ€»è®¡** | **123ä¸ª** | **123ä¸ª** | âœ… **å®Œå…¨ä¸€è‡´** | - |

### ç®¡ç†å¼•æ“å­æ¨¡å—éªŒè¯

| å­æ¨¡å— | æ–‡æ¡£å£°æ˜ | ä»£ç å®é™… | éªŒè¯çŠ¶æ€ | æ–‡ä»¶è·¯å¾„ |
|-------|---------|---------|---------|---------|
| 10.1 åŸºç¡€ç®¡ç† | 1ä¸ª | 1ä¸ª | âœ… ä¸€è‡´ | `admin/index.js` |
| 10.2 ç®¡ç†å‘˜è®¤è¯ | 2ä¸ª | 2ä¸ª | âœ… ä¸€è‡´ | `admin/auth.js` |
| 10.3 ç³»ç»Ÿç›‘æ§ | 10ä¸ª | 10ä¸ª | âœ… ä¸€è‡´ | `admin/system.js` |
| 10.4 é…ç½®ç®¡ç† | 2ä¸ª | 2ä¸ª | âœ… ä¸€è‡´ | `admin/config.js` |
| 10.5 å¥–å“æ± ç®¡ç† | 3ä¸ª | 3ä¸ª | âœ… ä¸€è‡´ | `admin/prize_pool.js` |
| 10.6 ç”¨æˆ·ç®¡ç† | 5ä¸ª | 5ä¸ª | âœ… ä¸€è‡´ | `admin/user_management.js` |
| 10.7 æŠ½å¥–ç®¡ç† | 6ä¸ª | 6ä¸ª | âœ… ä¸€è‡´ | `admin/lottery_management.js` |
| 10.8 æ•°æ®åˆ†æ | 4ä¸ª | 4ä¸ª | âœ… ä¸€è‡´ | `admin/analytics.js` |
| 10.9 å…‘æ¢å®¡æ ¸ | 4ä¸ª | 4ä¸ª | âœ… ä¸€è‡´ | `admin/audit.js` |
| 10.10 æ´»åŠ¨æƒé™ | 4ä¸ª | 4ä¸ª | âœ… ä¸€è‡´ | `admin/campaign-permissions.js` |
| **å°è®¡** | **41ä¸ª** | **41ä¸ª** | âœ… **å®Œå…¨ä¸€è‡´** | - |

### ä¸šåŠ¡æ•°æ®éªŒè¯

**å®æ–½è¿›åº¦**: ğŸ‰ 100%å·²å®Œæˆ (123/123)  
**ä»£ç è¦†ç›–**: âœ… æ‰€æœ‰APIå‡æœ‰å¯¹åº”è·¯ç”±å®ç°  
**æ–‡æ¡£å®Œæ•´æ€§**: âœ… æ‰€æœ‰APIå‡æœ‰è¯¦ç»†æ–‡æ¡£è¯´æ˜  
**ä¸šåŠ¡é€»è¾‘**: âœ… åŸºäºçœŸå®ä¸šåŠ¡æ•°æ®ç¼–å†™

**æ ¸å¿ƒä¸šåŠ¡åœºæ™¯è¦†ç›–**:
- âœ… ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç† (JWTåŒToken + UUIDè§’è‰²ç³»ç»Ÿ)
- âœ… æŠ½å¥–å¼•æ“ (100%ä¸­å¥–æœºåˆ¶ + è¿è¥å¹²é¢„ + ç»“æœé¢„è®¾)
- âœ… ç§¯åˆ†ç³»ç»Ÿ (è·å¾—/æ¶ˆè´¹/å†»ç»“ + äº‹åŠ¡å®‰å…¨ + è½¯åˆ é™¤)
- âœ… åº“å­˜ç®¡ç† (ç‰©å“/å…‘æ¢/è½¬è®©/å¸‚åœº + æ ¸é”€ç³»ç»Ÿ)
- âœ… æ¶ˆè´¹è®°å½• (å•†æˆ·æäº¤ + ç®¡ç†å‘˜å®¡æ ¸ + QRç è®¤è¯)
- âœ… é«˜çº§ç©ºé—´ (åŒé‡æ¡ä»¶éªŒè¯ + å›ºå®šè´¹ç”¨ + 24å°æ—¶æœ‰æ•ˆæœŸ)
- âœ… èŠå¤©ç³»ç»Ÿ (ç”¨æˆ·-å®¢æœå®æ—¶é€šä¿¡ + WebSocketæ¨é€)
- âœ… ç®¡ç†åå° (ç³»ç»Ÿç›‘æ§ + æ•°æ®åˆ†æ + æƒé™æ§åˆ¶ + å®¡æ ¸æµç¨‹)

### V2.6æ›´æ–°è¦ç‚¹

1. **å®Œæ•´æ€§éªŒè¯**
   - âœ… é€ä¸€éªŒè¯æ‰€æœ‰123ä¸ªAPIç«¯ç‚¹
   - âœ… ç¡®è®¤æ–‡æ¡£APIæ•°é‡ä¸å®é™…ä»£ç å®Œå…¨ä¸€è‡´
   - âœ… è¡¥å……é—æ¼çš„ä¸šåŠ¡è¯´æ˜å’ŒAPIæè¿°

2. **ä¸šåŠ¡é€»è¾‘è¡¥å……**
   - âœ… è¡¥å……æŠ½å¥–ç®¡ç†çš„ç”¨æˆ·ä¸“å±é˜Ÿåˆ—APIè¯´æ˜
   - âœ… è¡¥å……æ´»åŠ¨æƒé™ç®¡ç†çš„ä¸šåŠ¡è§„åˆ™è¯´æ˜
   - âœ… è¡¥å……ç®¡ç†å‘˜è®¤è¯ä¸ç³»ç»Ÿç›‘æ§çš„APIè¯¦æƒ…
   - âœ… æ˜ç¡®æ‰€æœ‰APIçš„å®é™…ç”¨é€”å’Œä¸šåŠ¡åœºæ™¯

3. **æ–‡æ¡£è´¨é‡æå‡**
   - âœ… ç»Ÿä¸€APIæè¿°æ ¼å¼ï¼Œå¢åŠ ä¸šåŠ¡è¯´æ˜æ‹¬å·
   - âœ… è¡¥å……å„æ¨¡å—çš„æ ¸å¿ƒæœºåˆ¶å’Œä¸šåŠ¡è§„åˆ™
   - âœ… å¢åŠ å®Œæ•´æ€§éªŒè¯æŠ¥å‘Šï¼Œæ–¹ä¾¿åç»­ç»´æŠ¤
   - âœ… ç¡®ä¿æ‰€æœ‰ä¿¡æ¯åŸºäºçœŸå®ä»£ç ï¼Œé¿å…è‡†æµ‹

### V2.7æ›´æ–°è¦ç‚¹ (2025å¹´11æœˆ02æ—¥ 17:05)

1. **åŸºäºçœŸå®ä»£ç æ·±åº¦éªŒè¯**
   - âœ… ä½¿ç”¨grepå‘½ä»¤é€ä¸ªæ–‡ä»¶éªŒè¯APIç«¯ç‚¹æ•°é‡
   - âœ… å‘ç°å¹¶ä¿®æ­£10.6ç”¨æˆ·ç®¡ç†æ¨¡å—çš„APIåˆ—è¡¨é”™è¯¯
   - âœ… ç¡®è®¤æ‰€æœ‰123ä¸ªAPIä¸å®é™…ä»£ç 100%åŒ¹é…

2. **APIåˆ—è¡¨ä¿®æ­£**
   - âŒ åˆ é™¤ä¸å­˜åœ¨çš„API: `POST /admin/user-management/points/adjust`(å®é™…åœ¨points.jsä¸­)
   - âŒ åˆ é™¤ä¸å­˜åœ¨çš„API: `DELETE /admin/user-management/users/:user_id`(å®é™…ä»£ç ä¸­æ— æ­¤ç«¯ç‚¹)
   - âœ… è¡¥å……ç¼ºå¤±çš„API: `PUT /admin/user-management/users/:user_id/role`(æ›´æ–°ç”¨æˆ·è§’è‰²)
   - âœ… è¡¥å……ç¼ºå¤±çš„API: `GET /admin/user-management/roles`(è·å–è§’è‰²åˆ—è¡¨)

3. **ä¸šåŠ¡è¯´æ˜å¢å¼º**
   - âœ… ä¸ºæ¯ä¸ªAPIæ·»åŠ è¯¦ç»†çš„ä¸šåŠ¡è¯´æ˜æ‹¬å·
   - âœ… æ˜ç¡®UUIDè§’è‰²ç³»ç»Ÿçš„å·¥ä½œæœºåˆ¶
   - âœ… è¡¥å……è§’è‰²çº§åˆ«éªŒè¯è§„åˆ™(ç®¡ç†å‘˜â‰¥100ï¼Œæ™®é€šç”¨æˆ·<100)
   - âœ… è¯´æ˜ç”¨æˆ·çŠ¶æ€æ§åˆ¶çš„å®‰å…¨æœºåˆ¶

4. **å®ç”¨ä¸»ä¹‰åŸåˆ™åº”ç”¨**
   - âœ… æ‰€æœ‰æè¿°åŸºäºå®é™…ä»£ç å®ç°ï¼Œæ‹’ç»è‡†æµ‹
   - âœ… ä¼˜å…ˆæè¿°ä¸šåŠ¡ä»·å€¼å’Œå®é™…ç”¨é€”
   - âœ… è¡¥å……æŠ€æœ¯ç»†èŠ‚å’Œå®‰å…¨æœºåˆ¶è¯´æ˜
   - âœ… ç¡®ä¿å‰åç«¯å¼€å‘å›¢é˜Ÿå¯ç›´æ¥ä½¿ç”¨

### ç»“è®º

âœ… **æ–‡æ¡£å®Œæ•´æ€§**: 100%  
âœ… **APIå‡†ç¡®æ€§**: 100%  
âœ… **ä¸šåŠ¡æè¿°**: å®Œæ•´ä¸”åŸºäºçœŸå®ä¸šåŠ¡  
âœ… **ä»£ç ä¸€è‡´æ€§**: æ–‡æ¡£ä¸ä»£ç å®Œå…¨ä¸€è‡´

**æ–‡æ¡£çŠ¶æ€**: ğŸ‰ **ç”Ÿäº§å°±ç»ª** (Production Ready - V2.7 å®Œæ•´éªŒè¯ç‰ˆ)

---

## ğŸ“‹ V2.7 æœ€ç»ˆéªŒè¯æŠ¥å‘Š (2025å¹´11æœˆ02æ—¥ 17:07)

### éªŒè¯æ–¹æ³•
- âœ… ä½¿ç”¨grepå‘½ä»¤é€æ–‡ä»¶éªŒè¯å®é™…APIç«¯ç‚¹
- âœ… æ’é™¤ä¸­é—´ä»¶å’Œè·¯ç”±æŒ‚è½½(router.use)
- âœ… ä»…ç»Ÿè®¡å®é™…HTTPæ–¹æ³•(get/post/put/delete/patch)
- âœ… ä¸æ–‡æ¡£å£°æ˜é€ä¸€å¯¹æ¯”éªŒè¯

### éªŒè¯ç»“æœ

| æ¨¡å— | æ–‡æ¡£å£°æ˜ | ä»£ç å®é™… | éªŒè¯çŠ¶æ€ | éªŒè¯å‘½ä»¤ |
|-----|---------|---------|---------|---------|
| 1. ç»Ÿä¸€è®¤è¯å¼•æ“ | 5ä¸ª | 5ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post)' auth.js` |
| 2. ç»Ÿä¸€æŠ½å¥–å¼•æ“ | 8ä¸ª | 8ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post)' lottery.js` |
| 3. æƒé™ç®¡ç† | 5ä¸ª | 5ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.get' permissions.js` |
| 4. ç§¯åˆ†ç®¡ç† | 11ä¸ª | 11ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post\|delete)' points.js` |
| 5. ç”¨æˆ·åº“å­˜ç®¡ç† | 18ä¸ª | 18ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post\|delete)' inventory.js` |
| 6. æ¶ˆè´¹è®°å½•ç®¡ç† | 10ä¸ª | 10ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post\|delete)' consumption.js` |
| 7. é«˜çº§ç©ºé—´è§£é” | 2ä¸ª | 2ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post)' premium.js` |
| 8. æŠ½å¥–ç»“æœé¢„è®¾ | 4ä¸ª | 4ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post\|delete)' lottery-preset.js` |
| 9. ç³»ç»ŸåŠŸèƒ½ | 19ä¸ª | 19ä¸ª | âœ… ä¸€è‡´ | `grep -cE 'router\.(get\|post\|put)' system.js` |
| 10. ç»Ÿä¸€ç®¡ç†å¼•æ“ | 41ä¸ª | 41ä¸ª | âœ… ä¸€è‡´ | è§ä¸‹æ–¹å­æ¨¡å—è¯¦ç»†éªŒè¯ |
| **æ€»è®¡** | **123ä¸ª** | **123ä¸ª** | âœ… **100%ä¸€è‡´** | - |

### ç®¡ç†å¼•æ“å­æ¨¡å—éªŒè¯

| å­æ¨¡å— | å£°æ˜ | å®é™… | éªŒè¯ | ä¿®æ­£è¯´æ˜ |
|-------|-----|-----|-----|---------|
| index.js | 1ä¸ª | 1ä¸ª | âœ… | GET / |
| auth.js | 2ä¸ª | 2ä¸ª | âœ… | ç®¡ç†å‘˜è®¤è¯ |
| system.js | 10ä¸ª | 10ä¸ª | âœ… | ç³»ç»Ÿç›‘æ§ |
| config.js | 2ä¸ª | 2ä¸ª | âœ… | é…ç½®ç®¡ç† |
| prize_pool.js | 3ä¸ª | 3ä¸ª | âœ… | å¥–å“æ± ç®¡ç† |
| user_management.js | 5ä¸ª | 5ä¸ª | âœ… å·²ä¿®æ­£ | V2.7ä¿®æ­£APIåˆ—è¡¨ |
| lottery_management.js | 6ä¸ª | 6ä¸ª | âœ… | æŠ½å¥–ç®¡ç† |
| analytics.js | 4ä¸ª | 4ä¸ª | âœ… | æ•°æ®åˆ†æ |
| audit.js | 4ä¸ª | 4ä¸ª | âœ… | å…‘æ¢å®¡æ ¸ |
| campaign-permissions.js | 4ä¸ª | 4ä¸ª | âœ… | æ´»åŠ¨æƒé™ |
| **å°è®¡** | **41ä¸ª** | **41ä¸ª** | âœ… | - |

### V2.7ä¿®æ­£å†…å®¹

**10.6 ç”¨æˆ·ç®¡ç†æ¨¡å—ä¿®æ­£**:
- âŒ åˆ é™¤: `POST /admin/user-management/points/adjust` (å®é™…åœ¨points.jsä¸­)
- âŒ åˆ é™¤: `DELETE /admin/user-management/users/:user_id` (ä»£ç ä¸­ä¸å­˜åœ¨)
- âœ… è¡¥å……: `PUT /admin/user-management/users/:user_id/role` (æ›´æ–°ç”¨æˆ·è§’è‰²)
- âœ… è¡¥å……: `GET /admin/user-management/roles` (è·å–è§’è‰²åˆ—è¡¨)

### æœ€ç»ˆç»“è®º

âœ… **æ–‡æ¡£å®Œæ•´æ€§**: 100% - æ‰€æœ‰123ä¸ªAPIå‡å·²è®°å½•  
âœ… **APIå‡†ç¡®æ€§**: 100% - æ‰€æœ‰APIä¸å®é™…ä»£ç å®Œå…¨ä¸€è‡´  
âœ… **ä¸šåŠ¡æè¿°**: å®Œæ•´ - åŸºäºçœŸå®ä¸šåŠ¡é€»è¾‘ç¼–å†™  
âœ… **ä»£ç ä¸€è‡´æ€§**: 100% - æ–‡æ¡£ä¸ä»£ç å®Œå…¨åŒ¹é…  
âœ… **ç”Ÿäº§å°±ç»ª**: æ˜¯ - å¯ç›´æ¥ç”¨äºå‰åç«¯å¼€å‘å¯¹æ¥

**æ–‡æ¡£è´¨é‡æ‰¿è¯º**:
- ğŸ¯ æ‰€æœ‰APIæè¿°åŸºäºå®é™…ä»£ç å®ç°
- ğŸ¯ æ‹’ç»è‡†æµ‹ï¼Œç¡®ä¿ä¿¡æ¯å‡†ç¡®æ€§
- ğŸ¯ é‡‡ç”¨å®ç”¨ä¸»ä¹‰åŸåˆ™ï¼Œä¼˜å…ˆä¸šåŠ¡ä»·å€¼
- ğŸ¯ æŒç»­éªŒè¯å’Œæ›´æ–°ï¼Œç¡®ä¿é•¿æœŸå‡†ç¡®æ€§

---

**æ–‡æ¡£ç»´æŠ¤å»ºè®®**: 
1. APIå˜æ›´æ—¶åŠæ—¶æ›´æ–°æ­¤æ¸…å•
2. æ–°å¢APIæ—¶åŒæ­¥æ›´æ–°éªŒè¯æŠ¥å‘Š
3. å®šæœŸè¿è¡ŒéªŒè¯è„šæœ¬ç¡®ä¿æ–‡æ¡£ä¸ä»£ç ä¸€è‡´
4. ç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€å‰ç«¯å›¢é˜Ÿä¿¡æ¯åŒæ­¥

**å¿«é€ŸéªŒè¯è„šæœ¬**:
```bash
# ç»Ÿè®¡å„æ¨¡å—APIæ•°é‡
cd /home/devbox/project/routes/v4
for file in $(find . -name "*.js" ! -name "*.backup*" ! -path "*/shared/*"); do
  count=$(grep -cE 'router\.(get|post|put|delete|patch)\(' "$file" 2>/dev/null || echo "0")
  [ "$count" -gt 0 ] && echo "$(basename $file): $count"
done | sort

# éªŒè¯æ€»æ•°
find . -name "*.js" ! -name "*.backup*" ! -path "*/shared/*" -exec grep -hE 'router\.(get|post|put|delete|patch)\(' {} \; | wc -l
```

