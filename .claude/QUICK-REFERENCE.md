# 规则快速参考卡

## 🚦 执行任务前快速检查

### ✅ 必须做的事情：
1. ✅ 说明使用模型（Claude Sonnet 4.5）
2. ✅ 检查现有功能（搜索 /scripts/, /routes/, /services/, /utils/）
3. ✅ 查看 utils/api.js 实际定义（不推测）
4. ✅ 深度理解代码、文档、注释
5. ✅ 使用详细的中文注释
6. ✅ 使用北京时间（Asia/Shanghai）
7. ✅ 说明思考过程和工具使用

### ❌ 禁止做的事情：
1. ❌ 不检查就创建新文件
2. ❌ 推测 API 方法名
3. ❌ 删除或破坏原有功能
4. ❌ 使用非中文注释
5. ❌ 使用非北京时间
6. ❌ 增加技术债务
7. ❌ 使用不兼容微信小程序的 API

## 📋 任务执行检查清单

### 开始任务：
- [ ] 🤖 说明使用模型
- [ ] 📖 阅读相关代码和文档
- [ ] 🔍 搜索现有功能
- [ ] 💭 说明思考过程

### 编写代码：
- [ ] ✅ 验证 API 实际定义
- [ ] 📝 编写详细中文注释
- [ ] 🕐 使用北京时间
- [ ] 🛡️ 不破坏原有功能
- [ ] 📱 检查小程序兼容性

### 完成任务：
- [ ] 🏃 验证项目可运行
- [ ] 🔧 即时修复问题
- [ ] 🗑️ 清理临时文件
- [ ] 📊 说明解决方案

## ⏱️ 超时处理

```
命令执行 > 120秒无响应
    ↓
🔄 自动重试（第1次）
    ↓
仍然超时？
    ↓
💡 切换替代方案
    ↓
✅ 说明原因和新方案
```

## 🔍 问题诊断三层检查

```
出现问题
    ↓
1️⃣ 组件层：缺失？版本错误？配置错误？
    ↓
2️⃣ 逻辑层：业务逻辑？数据处理？边界条件？
    ↓
3️⃣ 环境层：运行环境？依赖？配置？
```

## 📱 微信小程序兼容性

### ❌ 禁止使用：
- `document.xxx`
- `window.xxx`
- DOM 操作
- 浏览器专属 API

### ✅ 正确使用：
- `wx.xxx` API
- 小程序组件
- 小程序生命周期

## 🗂️ 文件创建决策树

```
需要创建新文件？
    ↓
搜索现有功能（/scripts/, /routes/, /services/, /utils/）
    ↓
找到类似功能？
    ├─ 是 → 扩展现有文件 ✅
    └─ 否 → 继续检查
            ↓
        同时满足以下条件？
        • 职责明确分离
        • 有独特业务价值
        • 不增加技术债务
        • 不增加系统复杂度
            ├─ 是 → 可以创建新文件 ✅
            └─ 否 → 寻找其他方案 ❌
```

## 💬 沟通模板

```
🤖 使用模型：Claude Sonnet 4.5

📋 思考过程：
- [说明为什么这样做]

⚠️ 发现的问题：
- [列出遇到的问题]

🔧 使用的工具：
- [列出使用的工具]

📦 需要安装：
- [列出需要的依赖]

✅ 解决方案：
- [说明如何解决]
```

## 🧹 任务完成清理清单

- [ ] 删除临时测试文件
- [ ] 删除调试临时文件
- [ ] 删除备份文件（.bak, .tmp）
- [ ] 删除重复文件
- [ ] 删除无用 .md 文档
- [ ] 移除无效引用
- [ ] 更新 import/require
- [ ] 验证项目可运行

---

**记住**：这些规则是强制性的，确保每次都遵守！

## 🆕 新增规则快速参考（规则 22-31）

### 规则 22：代码修改后清理
```
修改代码后必须：
✅ 删除旧功能代码
✅ 避免代码重复
✅ 验证项目可运行
```

### 规则 23：测试数据管理
```
测试数据管理五要素：
1. 统一配置
2. 强制数据存在性检查
3. 模型导入一致性
4. 测试数据同步
5. 增强错误处理
```

### 规则 24：长文档分步创建
```
长文档处理：
分析 → 划分 → 创建 → 验证 → 合并 → 检查
❌ 不可简化文档
```

### 规则 25：任务清单管理
```
必须：
✅ 列出任务清单
✅ 标注完成状态
✅ 不可敷衍
```

### 规则 26：Git操作限制
```
❌ 没有明确指示不自动上传
✅ 只有用户要求才执行Git操作
```

### 规则 27：内容完整性
```
分批添加时：
✅ 保证完整性
✅ 不可遗漏
```

### 规则 28：Memory Rules
```
规则层级：
Memory Rules > Project Rules > Global Rules
```

### 规则 29：文档生成分析
```
❌ 不任意生成.md文件
✅ 优先写入现有文档
```

### 规则 30：异常处理
```
核心原则：
❌ 禁止生成模拟结果
✅ 明确提示问题来源（前端/后端/数据库）
```

### 规则 31：深度思考
```
Meta思考六要素：
1. 主动Meta思考
2. 分享思考过程
3. 建立反思机制
4. 主动提供洞察
5. 深层原因分析
6. 系统性思考

角色：深度思考者 + 高效执行者
```

## 📋 完整任务清单模板（31条规则版）

### 接收任务：
- [ ] 🤖 说明模型（Claude Sonnet 4.5）
- [ ] 📋 列出任务清单
- [ ] 🧠 Meta思考和深层分析
- [ ] 📖 理解需求和代码
- [ ] 💭 说明思考过程

### 执行任务：
- [ ] 🔍 检查现有功能
- [ ] ✅ 验证API实际定义
- [ ] 🛡️ 保护原有功能
- [ ] 📱 检查小程序兼容性
- [ ] 🕐 使用北京时间
- [ ] 📝 简体中文注释
- [ ] ⏱️ 120秒超时处理
- [ ] 🔧 三层问题诊断
- [ ] 🔗 前端适配后端API
- [ ] ⚠️ 完善错误处理
- [ ] 🌐 网络和token验证
- [ ] 📊 统一测试数据
- [ ] ✔️ 强制数据存在性检查
- [ ] 🚫 不生成模拟结果
- [ ] 📦 分批保证完整性

### 完成任务：
- [ ] 🗑️ 删除旧代码功能
- [ ] 🔄 确认服务重启
- [ ] 🔐 验证环境变量
- [ ] ✅ 验证项目运行
- [ ] 🔧 即时修复问题
- [ ] 🧹 清理临时文件
- [ ] 📋 更新任务清单
- [ ] 💡 任务反思总结
- [ ] 🧠 分享深层洞察

### Git操作：
- [ ] ❌ 无明确指示不上传

---

## 🎯 核心原则总结（更新版）

### 原有五大原则：
1. **不乱生成** - 创建前必查
2. **不推测** - 必查实际定义
3. **简体中文** - 统一语言
4. **完善验证** - 全面检查
5. **权威原则** - 后端为准

### 新增五大原则：
6. **清理旧代码** - 避免重复
7. **统一测试** - 强制检查
8. **任务清单** - 不可敷衍
9. **禁止模拟** - 明确提示
10. **深度思考** - Meta反思

---

**最后更新**：2025年11月17日（北京时间）
**规则总数**：31条
